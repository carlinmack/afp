<div id="Lightweight_Java_Definition">
<div class="head">
<h1>Theory Lightweight_Java_Definition</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Lightweight Java, the definition
    Authors:     Rok Strnisa &lt;rok@strnisa.com&gt;, 2006
                 Matthew Parkinson &lt;matt@matthewp.com&gt;, 2006
    Maintainer:
    Note:        This file should _not_ be modified directly. Please see the
                 accompanying README file.
*)</span>

<span class="comment1">(* generated by Ott 0.20.3 from: lj_common.ott lj_base.ott lj.ott *)</span>
<span class="keyword1"><span class="command">theory</span></span> Lightweight_Java_Definition
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(** warning: the backend selected ignores the file structure informations *)</span>
<span class="comment1">(** syntax *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"j"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"f"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"string"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"meth"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"string"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"var"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"string"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"dcl"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"string"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"oid"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"fqn"</span> <span class="main">=</span>
   fqn_def <span class="quoted"><span class="quoted">"dcl"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"cl"</span> <span class="main">=</span>
   cl_object
 <span class="main">|</span> cl_fqn <span class="quoted"><span class="quoted">"fqn"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"x"</span> <span class="main">=</span>
   x_var <span class="quoted"><span class="quoted">"var"</span></span>
 <span class="main">|</span> x_this

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"vd"</span> <span class="main">=</span>
   vd_def <span class="quoted"><span class="quoted">"cl"</span></span> <span class="quoted"><span class="quoted">"var"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"X"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x list"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"ctx"</span> <span class="main">=</span>
   ctx_def

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"vds"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"vd list"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"s"</span> <span class="main">=</span>
   s_block <span class="quoted"><span class="quoted">"s list"</span></span>
 <span class="main">|</span> s_ass <span class="quoted"><span class="quoted">"var"</span></span> <span class="quoted"><span class="quoted">"x"</span></span>
 <span class="main">|</span> s_read <span class="quoted"><span class="quoted">"var"</span></span> <span class="quoted"><span class="quoted">"x"</span></span> <span class="quoted"><span class="quoted">"f"</span></span>
 <span class="main">|</span> s_write <span class="quoted"><span class="quoted">"x"</span></span> <span class="quoted"><span class="quoted">"f"</span></span> <span class="quoted"><span class="quoted">"x"</span></span>
 <span class="main">|</span> s_if <span class="quoted"><span class="quoted">"x"</span></span> <span class="quoted"><span class="quoted">"x"</span></span> <span class="quoted"><span class="quoted">"s"</span></span> <span class="quoted"><span class="quoted">"s"</span></span>
 <span class="main">|</span> s_new <span class="quoted"><span class="quoted">"var"</span></span> <span class="quoted"><span class="quoted">"ctx"</span></span> <span class="quoted"><span class="quoted">"cl"</span></span>
 <span class="main">|</span> s_call <span class="quoted"><span class="quoted">"var"</span></span> <span class="quoted"><span class="quoted">"x"</span></span> <span class="quoted"><span class="quoted">"meth"</span></span> <span class="quoted"><span class="quoted">"X"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"meth_sig"</span> <span class="main">=</span>
   meth_sig_def <span class="quoted"><span class="quoted">"cl"</span></span> <span class="quoted"><span class="quoted">"meth"</span></span> <span class="quoted"><span class="quoted">"vds"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"meth_body"</span> <span class="main">=</span>
   meth_body_def <span class="quoted"><span class="quoted">"s list"</span></span> <span class="quoted"><span class="quoted">"x"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"fd"</span> <span class="main">=</span>
   fd_def <span class="quoted"><span class="quoted">"cl"</span></span> <span class="quoted"><span class="quoted">"f"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"meth_def"</span> <span class="main">=</span>
   meth_def_def <span class="quoted"><span class="quoted">"meth_sig"</span></span> <span class="quoted"><span class="quoted">"meth_body"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"fds"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fd list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"meth_defs"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"meth_def list"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"cld"</span> <span class="main">=</span>
   cld_def <span class="quoted"><span class="quoted">"dcl"</span></span> <span class="quoted"><span class="quoted">"cl"</span></span> <span class="quoted"><span class="quoted">"fds"</span></span> <span class="quoted"><span class="quoted">"meth_defs"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"ctxcld"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ctx <span class="main">×</span> cld<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"ty"</span> <span class="main">=</span>
   ty_top
 <span class="main">|</span> ty_def <span class="quoted"><span class="quoted">"ctx"</span></span> <span class="quoted"><span class="quoted">"dcl"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"v"</span> <span class="main">=</span>
   v_null
 <span class="main">|</span> v_oid <span class="quoted"><span class="quoted">"oid"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"clds"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cld list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"ctxclds"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ctxcld list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"fs"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"f list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"ty_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ty option"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"tys"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ty list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"L"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x <span class="main">⇀</span> v"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"H"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"oid <span class="main">⇀</span> <span class="main">(</span>ty <span class="main">×</span> <span class="main">(</span>f <span class="main">⇀</span> v<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"Exception"</span> <span class="main">=</span>
   ex_npe

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"P"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"clds"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"ctxcld_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ctxcld option"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"nn"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"ctxclds_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ctxclds option"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"fs_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fs option"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"meths"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"meth list"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"ty_opt_bot"</span> <span class="main">=</span>
   ty_opt_bot_opt <span class="quoted"><span class="quoted">"ty_opt"</span></span>
 <span class="main">|</span> ty_opt_bot_bot

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"meth_def_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"meth_def option"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"ctxmeth_def_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ctx <span class="main">×</span> meth_def<span class="main">)</span> option"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"mty"</span> <span class="main">=</span>
   mty_def <span class="quoted"><span class="quoted">"tys"</span></span> <span class="quoted"><span class="quoted">"ty"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"Γ"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x <span class="main">⇀</span> ty"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"v_opt"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"v option"</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="quoted">"config"</span> <span class="main">=</span>
   config_normal <span class="quoted"><span class="quoted">"P"</span></span> <span class="quoted"><span class="quoted">"L"</span></span> <span class="quoted"><span class="quoted">"H"</span></span> <span class="quoted"><span class="quoted">"s list"</span></span>
 <span class="main">|</span> config_ex <span class="quoted"><span class="quoted">"P"</span></span> <span class="quoted"><span class="quoted">"L"</span></span> <span class="quoted"><span class="quoted">"H"</span></span> <span class="quoted"><span class="quoted">"Exception"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"T"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x <span class="main">⇀</span> x"</span></span>


<span class="comment1">(** library functions *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
         <span class="main">(</span><span class="main">!!</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">--&gt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">==&gt;</span> list_all <span class="main">(</span><span class="main">%</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">foo_list</span><span class="main">)</span><span class="main">--&gt;</span>
                    list_all <span class="main">(</span><span class="main">%</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>map <span class="free">g</span> <span class="free">foo_list</span><span class="main">)</span> "</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">foo_list</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"case_prod <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>fst <span class="free">p</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def<span class="main">)</span>

<span class="comment1">(** definitions *)</span>
<span class="comment1">(*defns class_name_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">class_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> dcl <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn class_name *)</span>

class_nameI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">class_name</span> <span class="main">(</span><span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns superclass_name_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">superclass_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> cl <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn superclass_name *)</span>

superclass_nameI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">superclass_name</span> <span class="main">(</span><span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns class_fields_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">class_fields</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> fds <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn class_fields *)</span>

class_fieldsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">class_fields</span> <span class="main">(</span><span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns class_methods_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">class_methods</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> meth_defs <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn class_methods *)</span>

class_methodsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">class_methods</span> <span class="main">(</span><span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns method_name_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">method_name</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"meth_def <span class="main">⇒</span> meth <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn method_name *)</span>

method_nameI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">method_name</span> <span class="main">(</span><span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span> <span class="free"><span class="bound"><span class="entity">vds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_body</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns distinct_names_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">distinct_names</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn distinct_names *)</span>

dn_defI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">=</span>    <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">::</span>dcl<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">cld_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cld_dcl_list</span></span></span><span class="main">)</span><span class="main">)</span>    <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">::</span>dcl<span class="main">)</span><span class="main">)</span><span class="main">.</span>class_name <span class="main">(</span><span class="bound">cld_XXX</span><span class="main">)</span> <span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cld_dcl_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 distinct <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">::</span>dcl<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">dcl_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cld_dcl_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">distinct_names</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_cld_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_cld</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> fqn <span class="main">⇒</span> ctxcld_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_cld *)</span>

fc_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_cld</span> <span class="main">(</span>  <span class="main">[]</span>  <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> fc_cons_trueI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">=</span>    <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span>    <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">cld</span></span></span>  <span class="main">=</span>  <span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_cld</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span>  <span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fc_cons_falseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span>  <span class="main">=</span>  <span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl'</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span>  <span class="main">;</span>
 <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">≠</span>  <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl'</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
<span class="free">find_cld</span> <span class="main">(</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span>  <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_cld</span> <span class="main">(</span>  <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span>  <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_type_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> ty_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_type *)</span>

ft_objI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_type</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span>cl_object<span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> ty_top <span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> ft_nullI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_cld <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_type</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> ft_dclI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_cld <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span>  <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_type</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="comment1">(*defns path_length_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">path_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> nn <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn path_length *)</span>

pl_objI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">path_length</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span>cl_object<span class="main">)</span> <span class="main">(</span> <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> pl_fqnI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_cld <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span>  <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
superclass_name <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">path_length</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nn</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">path_length</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">nn</span></span></span> <span class="main">+</span>  <span class="main">1</span>  <span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="comment1">(*defns acyclic_clds_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">acyclic_clds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn acyclic_clds *)</span>

ac_defI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span>  <span class="bound">ctx</span>   <span class="bound">fqn</span> <span class="main">.</span>   <span class="main">(</span>    <span class="main">(</span>  <span class="main">(</span><span class="main">∃</span>  <span class="bound">ctx'</span>   <span class="bound">cld</span>  <span class="main">.</span>  find_cld <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">)</span> <span class="main">(</span><span class="bound">fqn</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span>  <span class="main">(</span> <span class="bound">ctx'</span> <span class="main">,</span> <span class="bound">cld</span> <span class="main">)</span>  <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">)</span>  <span class="main">)</span>   <span class="main">⟶</span>     <span class="main">(</span><span class="main">∃</span>  <span class="bound">nn</span>  <span class="main">.</span>  path_length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="bound">fqn</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">nn</span><span class="main">)</span> <span class="main">)</span>      <span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">acyclic_clds</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_path_rec_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_path_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> ctxclds <span class="main">⇒</span> ctxclds_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_path_rec *)</span>

fpr_objI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_path_rec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span>cl_object<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fpr_nullI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="main">(</span>  <span class="main">¬</span> <span class="main">(</span> acyclic_clds <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">)</span>  <span class="main">)</span>   <span class="main">∨</span>  find_cld <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_path_rec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> fpr_fqnI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> acyclic_clds <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">∧</span>  find_cld <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span>  <span class="main">)</span><span class="main">)</span> <span class="main">)</span>  <span class="main">;</span>
superclass_name <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">find_path_rec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="main">@</span><span class="main">[</span>   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span>   <span class="main">]</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_path_rec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_path_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> ctxclds_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_path *)</span>

fp_defI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_rec <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_path_ty_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_path_ty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> ctxclds_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_path_ty *)</span>

fpty_objI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_path_ty</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>ty_top<span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span>  <span class="main">[]</span>  <span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fpty_dclI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_path_ty</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns fields_in_path_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">fields_in_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ctxclds <span class="main">⇒</span> fs <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn fields_in_path *)</span>

fip_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fields_in_path</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fip_consI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>fd_def <span class="bound">cl_XXX</span> <span class="bound">f_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_f_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
<span class="free">fields_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">fs'</span></span></span>  <span class="main">=</span>   <span class="main">(</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">f_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_f_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">fields_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs'</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns fields_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">fields</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> fs_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn fields *)</span>

fields_noneI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">fields</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> fields_someI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
fields_in_path <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">fields</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="comment1">(*defns methods_in_path_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">methods_in_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"clds <span class="main">⇒</span> meths <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn methods_in_path *)</span>

mip_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">methods_in_path</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> mip_consI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_methods <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">vds_XXX</span><span class="main">::</span>vds<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_body_XXX</span><span class="main">::</span>meth_body<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">meth_def_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_cl_meth_vds_meth_body_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">vds_XXX</span><span class="main">::</span>vds<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_body_XXX</span><span class="main">::</span>meth_body<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">meth_def_XXX</span>  <span class="main">=</span>  <span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="bound">cl_XXX</span> <span class="bound">meth_XXX</span> <span class="bound">vds_XXX</span><span class="main">)</span> <span class="bound">meth_body_XXX</span><span class="main">)</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_cl_meth_vds_meth_body_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
<span class="free">methods_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meths'</span></span></span><span class="main">)</span> <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">meths</span></span></span>  <span class="main">=</span>   <span class="main">(</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">vds_XXX</span><span class="main">::</span>vds<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_body_XXX</span><span class="main">::</span>meth_body<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">meth_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_cl_meth_vds_meth_body_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">meths'</span></span></span> <span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">methods_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meths</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns methods_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">methods</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meths <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn methods *)</span>

methods_methodsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">::</span>ctx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span> <span class="bound">ctx_XXX</span> <span class="main">,</span> <span class="bound">cld_XXX</span> <span class="main">)</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx_cld_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
methods_in_path <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">::</span>ctx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">cld_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx_cld_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meths</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">methods</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meths</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns ftype_in_fds_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">ftype_in_fds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> fds <span class="main">⇒</span> f <span class="main">⇒</span> ty_opt_bot <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn ftype_in_fds *)</span>

ftif_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ftype_in_fds</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_opt_bot_opt  None <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> ftif_cons_botI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype_in_fds</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>fd_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">fd_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>ty_opt_bot_bot<span class="main">)</span>"</span></span>

<span class="main">|</span> ftif_cons_trueI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype_in_fds</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>fd_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">fd_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_opt_bot_opt  <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> ftif_cons_falseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>  <span class="main">≠</span>  <span class="free"><span class="bound"><span class="entity">f'</span></span></span>  <span class="main">;</span>
<span class="free">ftype_in_fds</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fd_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt_bot</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype_in_fds</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>fd_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">fd_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt_bot</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns ftype_in_path_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">ftype_in_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctxclds <span class="main">⇒</span> f <span class="main">⇒</span> ty_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn ftype_in_path *)</span>

ftip_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ftype_in_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> ftip_cons_botI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">;</span>
ftype_in_fds <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>ty_opt_bot_bot<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype_in_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> ftip_cons_trueI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">;</span>
ftype_in_fds <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_opt_bot_opt  <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype_in_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> ftip_cons_falseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">;</span>
ftype_in_fds <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_opt_bot_opt  None <span class="main">)</span><span class="main">)</span> <span class="main">;</span>
<span class="free">ftype_in_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype_in_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns ftype_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">ftype</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> f <span class="main">⇒</span> ty <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn ftype *)</span>

ftypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
ftype_in_path <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">ftype</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty'</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_meth_def_in_list_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_meth_def_in_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"meth_defs <span class="main">⇒</span> meth <span class="main">⇒</span> meth_def_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_meth_def_in_list *)</span>

fmdil_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_meth_def_in_list</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span>"</span></span>

<span class="main">|</span> fmdil_cons_trueI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span>  <span class="main">=</span>  <span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span> <span class="free"><span class="bound"><span class="entity">vds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_body</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_meth_def_in_list</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_def</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">meth_def_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span> <span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fmdil_cons_falseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span>  <span class="main">=</span>  <span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">meth'</span></span></span> <span class="free"><span class="bound"><span class="entity">vds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_body</span></span></span><span class="main">)</span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">≠</span>  <span class="free"><span class="bound"><span class="entity">meth'</span></span></span>  <span class="main">;</span>
<span class="free">find_meth_def_in_list</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_def_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_def_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_meth_def_in_list</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_def</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">meth_def_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_def_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_meth_def_in_path_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_meth_def_in_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ctxclds <span class="main">⇒</span> meth <span class="main">⇒</span> ctxmeth_def_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_meth_def_in_path *)</span>

fmdip_emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_meth_def_in_path</span> <span class="main">(</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>None<span class="main">::</span>ctxmeth_def_opt<span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fmdip_cons_trueI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_methods <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span> <span class="main">;</span>
find_meth_def_in_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_meth_def_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span> <span class="main">)</span><span class="main">::</span>ctxmeth_def_opt<span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fmdip_cons_falseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>class_methods <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span> <span class="main">;</span>
find_meth_def_in_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span> <span class="main">;</span>
<span class="free">find_meth_def_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxmeth_def_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_meth_def_in_path</span> <span class="main">(</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ctxcld_list</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxmeth_def_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns find_meth_def_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">find_meth_def</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meth <span class="main">⇒</span> ctxmeth_def_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn find_meth_def *)</span>

fmd_nullI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> None <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_meth_def</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>None<span class="main">::</span>ctxmeth_def_opt<span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> fmd_optI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
find_meth_def_in_path <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxmeth_def_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">find_meth_def</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxmeth_def_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns mtype_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">mtype</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meth <span class="main">⇒</span> mty <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn mtype *)</span>

mtypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_meth_def <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span> <span class="main">)</span><span class="main">::</span>ctxmeth_def_opt<span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">meth_def</span></span></span>  <span class="main">=</span>  <span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>vd_def <span class="bound">cl_XXX</span> <span class="bound">var_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_body</span></span></span><span class="main">)</span>  <span class="main">;</span>
find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">cl_XXX</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="bound">ty_XXX</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">mty</span></span></span>  <span class="main">=</span>  <span class="main">(</span>mty_def  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">ty_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">ty'</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">mtype</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mty</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns sty_one_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">sty_one</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> ty <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn one *)</span>

sty_objI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">sty_one</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span>ty_top<span class="main">)</span>"</span></span>

<span class="main">|</span> sty_dclI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_ty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">::</span>ctx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">::</span>dcl<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span> <span class="bound">ctx_XXX</span> <span class="main">,</span> <span class="bound">cld_XXX</span> <span class="main">)</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx_cld_dcl_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">::</span>ctx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">::</span>dcl<span class="main">)</span><span class="main">)</span><span class="main">.</span>class_name <span class="main">(</span><span class="bound">cld_XXX</span><span class="main">)</span> <span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx_cld_dcl_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="main">,</span> <span class="free"><span class="bound"><span class="entity">dcl'</span></span></span> <span class="main">)</span> <span class="main">∈</span> set  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">::</span>ctx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">dcl_XXX</span><span class="main">::</span>dcl<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">,</span><span class="bound">dcl_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx_cld_dcl_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">sty_one</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx'</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns sty_many_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">sty_many</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> tys <span class="main">⇒</span> tys <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn many *)</span>

sty_manyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">tys</span></span></span>  <span class="main">=</span>   <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_'</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">ty_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ty_ty'_list</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">tys'</span></span></span>  <span class="main">=</span>   <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_'</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">ty_'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ty_ty'_list</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_'</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span>sty_one <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ty_XXX</span><span class="main">)</span> <span class="main">(</span><span class="bound">ty_'</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ty_ty'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">sty_many</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tys</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">tys'</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns sty_option_def *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">sty_option</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty_opt <span class="main">⇒</span> ty_opt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn option *)</span>

sty_optionI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span>  <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">ty_opt'</span></span></span>  <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
sty_one <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty'</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">sty_option</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt'</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns well_formedness *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">wf_object</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> H <span class="main">⇒</span> v_opt <span class="main">⇒</span> ty_opt <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_varstate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> Γ <span class="main">⇒</span> H <span class="main">⇒</span> L <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_heap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> H <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_config</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Γ <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_stmt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> Γ <span class="main">⇒</span> s <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_meth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meth_def <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_class_common</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> dcl <span class="main">⇒</span> cl <span class="main">⇒</span> fds <span class="main">⇒</span> meth_defs <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_class</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> cld <span class="main">⇒</span> bool"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">wf_program</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn object *)</span>

wf_nullI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span>  <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_object</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span> Some  v_null <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_objectI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span>   <span class="free"><span class="bound"><span class="entity">oid</span></span></span>  <span class="keyword1">of</span>
                     None <span class="main">⇒</span> None
                   <span class="main">|</span> Some <span class="bound">tyfs</span> <span class="main">⇒</span> Some <span class="main">(</span>fst <span class="bound">tyfs</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_object</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span> Some  <span class="main">(</span>v_oid <span class="free"><span class="bound"><span class="entity">oid</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty_opt</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn varstate *)</span>

wf_varstateI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="main">(</span>dom <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="main">∀</span>  <span class="bound">x</span>  <span class="main">∈</span> dom  <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">.</span>  <span class="free">wf_object</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="bound">x</span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="bound">x</span> <span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_varstate</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn heap *)</span>

wf_heapI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="main">(</span>dom <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="main">∀</span>  <span class="bound">oid</span>  <span class="main">∈</span> dom  <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">.</span>   <span class="main">(</span>   <span class="main">∃</span>  <span class="bound">ty</span>  <span class="main">.</span>     <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span>   <span class="bound">oid</span>  <span class="keyword1">of</span>
                     None <span class="main">⇒</span> None
                   <span class="main">|</span> Some <span class="bound">tyfs</span> <span class="main">⇒</span> Some <span class="main">(</span>fst <span class="bound">tyfs</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="bound">ty</span> <span class="main">)</span><span class="main">)</span>    <span class="main">∧</span>   <span class="main">(</span><span class="main">∃</span>  <span class="bound">fs</span>  <span class="main">.</span>   fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ty</span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="bound">fs</span> <span class="main">)</span> <span class="main">)</span>  <span class="main">∧</span>     <span class="main">(</span><span class="main">∀</span>  <span class="bound">f</span>  <span class="main">∈</span> set  <span class="bound">fs</span> <span class="main">.</span>   <span class="main">∃</span>  <span class="bound">ty'</span>  <span class="main">.</span>   <span class="main">(</span>   ftype <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ty</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">ty'</span><span class="main">)</span>  <span class="main">∧</span>   <span class="free">wf_object</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span>   <span class="bound">oid</span>  <span class="keyword1">of</span>
                     None <span class="main">⇒</span> None
                   <span class="main">|</span> Some <span class="bound">tyfs</span> <span class="main">⇒</span> <span class="main">(</span>snd <span class="bound">tyfs</span><span class="main">)</span>  <span class="bound">f</span> <span class="main">)</span> <span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="bound">ty'</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span>    <span class="main">)</span>   <span class="main">)</span>     <span class="main">)</span>     <span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_heap</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn config *)</span>

wf_all_exI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wf_program</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">wf_heap</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">wf_varstate</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_config</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_ex <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">Exception</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_allI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">wf_program</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">wf_heap</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">wf_varstate</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s_XXX</span><span class="main">::</span>s<span class="main">)</span><span class="main">.</span><span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">s_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_config</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn stmt *)</span>

wf_blockI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s_XXX</span><span class="main">::</span>s<span class="main">)</span><span class="main">.</span><span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">s_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_block <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_var_assignI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_ass <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_field_readI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
ftype <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty'</span></span></span><span class="main">)</span> <span class="main">;</span>
sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_read <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_field_writeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
ftype <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty'</span></span></span><span class="main">)</span> <span class="main">;</span>
sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_write <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_ifI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">)</span>  <span class="main">∨</span>  sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">)</span>  <span class="main">;</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_if <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_newI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_new <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> wf_mcallI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>  <span class="main">=</span>   <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">y_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
mtype <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>mty_def  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">ty_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">ty'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span>sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="bound">y_XXX</span> <span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="bound">ty_XXX</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_call <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn meth *)</span>

wf_methodI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> distinct <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">var_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">cl_XXX</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="bound">ty_XXX</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>  <span class="main">=</span>   <span class="main">(</span>  <span class="main">(</span>map_of <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">(</span>x_var <span class="bound">var_XXX</span><span class="main">)</span><span class="main">,</span><span class="bound">ty_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>   <span class="main">(</span> x_this   <span class="main">↦</span>   <span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s_XXX</span><span class="main">::</span>s<span class="main">)</span><span class="main">.</span><span class="free">wf_stmt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">s_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
sty_option <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_meth</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>vd_def <span class="bound">cl_XXX</span> <span class="bound">var_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_var_ty_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span>meth_body_def <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn class_common *)</span>

wf_class_commonI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 <span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span>  <span class="main">≠</span>  <span class="free"><span class="bound"><span class="entity">ty</span></span></span>  <span class="main">;</span>
 distinct <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">f_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_f_ty_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>  <span class="main">;</span>
fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 <span class="main">(</span>set   <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">f_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_f_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set  <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">cl_XXX</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="bound">ty_XXX</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_f_ty_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="free">wf_meth</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_meth_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">)</span><span class="main">.</span>method_name <span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">)</span> <span class="main">(</span><span class="bound">meth_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_meth_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 distinct <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">meth_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_meth_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>  <span class="main">;</span>
methods <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_'</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_XXX</span><span class="main">::</span>mty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_'</span><span class="main">::</span>mty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">meth_'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth'_mty_mty'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_'</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_XXX</span><span class="main">::</span>mty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_'</span><span class="main">::</span>mty<span class="main">)</span><span class="main">)</span><span class="main">.</span>mtype <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">meth_'</span><span class="main">)</span> <span class="main">(</span><span class="bound">mty_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth'_mty_mty'_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_'</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_XXX</span><span class="main">::</span>mty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_'</span><span class="main">::</span>mty<span class="main">)</span><span class="main">)</span><span class="main">.</span>mtype <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">meth_'</span><span class="main">)</span> <span class="main">(</span><span class="bound">mty_'</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth'_mty_mty'_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_'</span><span class="main">::</span>meth<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_XXX</span><span class="main">::</span>mty<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">mty_'</span><span class="main">::</span>mty<span class="main">)</span><span class="main">)</span><span class="main">.</span>  <span class="bound">meth_'</span>  <span class="main">∈</span> set   <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">meth_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_meth_list</span></span></span><span class="main">)</span><span class="main">)</span>    <span class="main">⟶</span>   <span class="bound">mty_XXX</span>  <span class="main">=</span>  <span class="bound">mty_'</span>  <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth'_mty_mty'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_class_common</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">ty_XXX</span><span class="main">::</span>ty<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>fd_def <span class="bound">cl_XXX</span> <span class="bound">f_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cl_f_ty_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">meth_def_XXX</span><span class="main">::</span>meth_def<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">meth_XXX</span><span class="main">::</span>meth<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">meth_def_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">meth_def_meth_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn class *)</span>

wf_classI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span>  <span class="main">∈</span> set  <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">;</span>
<span class="free">wf_class_common</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>ctx_def<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_class</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>cld_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">meth_defs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="comment1">(* defn program *)</span>

wf_programI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">=</span>    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span>    <span class="main">;</span>
distinct_names <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">cld_XXX</span><span class="main">::</span>cld<span class="main">)</span><span class="main">.</span><span class="free">wf_class</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">cld_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cld_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
acyclic_clds <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">wf_program</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns var_trans *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">tr_s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"T <span class="main">⇒</span> s <span class="main">⇒</span> s <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn tr_s *)</span>

tr_s_blockI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">s_XXX</span><span class="main">::</span>s<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">s_'</span><span class="main">::</span>s<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">s_XXX</span><span class="main">)</span> <span class="main">(</span><span class="bound">s_'</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s_s'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_block <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">s_XXX</span><span class="main">::</span>s<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">s_'</span><span class="main">::</span>s<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">s_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s_s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_block <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">s_XXX</span><span class="main">::</span>s<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">s_'</span><span class="main">::</span>s<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">s_'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s_s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> tr_s_var_assignI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>  <span class="main">(</span>x_var  <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">)</span> <span class="keyword1">of</span>
                    None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>  <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x'</span> <span class="keyword1">of</span> x_this <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>
                           <span class="main">|</span> x_var <span class="bound">var'</span> <span class="main">⇒</span> <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">var'</span></span></span>  <span class="main">;</span>
 <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_ass <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_ass <span class="free"><span class="bound"><span class="entity">var'</span></span></span> <span class="free"><span class="bound"><span class="entity">x'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> tr_s_field_readI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>  <span class="main">(</span>x_var  <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">)</span> <span class="keyword1">of</span>
                    None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>  <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x'</span> <span class="keyword1">of</span> x_this <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>
                           <span class="main">|</span> x_var <span class="bound">var'</span> <span class="main">⇒</span> <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">var'</span></span></span>  <span class="main">;</span>
 <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_read <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_read <span class="free"><span class="bound"><span class="entity">var'</span></span></span> <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> tr_s_field_writeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">x'</span></span></span>  <span class="main">;</span>
 <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">y</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">y'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_write <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_write <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> tr_s_ifI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">x'</span></span></span>  <span class="main">;</span>
 <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">y</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">y'</span></span></span>  <span class="main">;</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1'</span></span></span><span class="main">)</span> <span class="main">;</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2'</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_if <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_if <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="free"><span class="bound"><span class="entity">y'</span></span></span> <span class="free"><span class="bound"><span class="entity">s1'</span></span></span> <span class="free"><span class="bound"><span class="entity">s2'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> tr_s_newI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>  <span class="main">(</span>x_var  <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">)</span> <span class="keyword1">of</span>
                    None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>  <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x'</span> <span class="keyword1">of</span> x_this <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>
                           <span class="main">|</span> x_var <span class="bound">var'</span> <span class="main">⇒</span> <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">var'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_new <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_new <span class="free"><span class="bound"><span class="entity">var'</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> tr_s_mcallI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>  <span class="main">(</span>x_var  <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">)</span> <span class="keyword1">of</span>
                    None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>  <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x'</span> <span class="keyword1">of</span> x_this <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">var</span></span></span>
                           <span class="main">|</span> x_var <span class="bound">var'</span> <span class="main">⇒</span> <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">var'</span></span></span>  <span class="main">;</span>
 <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">x'</span></span></span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">y_'</span><span class="main">::</span>x<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="bound">y_XXX</span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="bound">y_XXX</span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="bound">y_'</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_y'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">tr_s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_call <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">y_'</span><span class="main">::</span>x<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">y_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_y'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>s_call <span class="free"><span class="bound"><span class="entity">var'</span></span></span> <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">y_'</span><span class="main">::</span>x<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">y_'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_y'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*defns reduction *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">r_stmt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* defn stmt *)</span>

r_blockI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_block <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_var_assignI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_ass <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>  <span class="main">(</span> <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span>   <span class="main">↦</span>   <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">)</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_field_read_npeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  v_null <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_read <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_ex <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> ex_npe<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_field_readI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  <span class="main">(</span>v_oid <span class="free"><span class="bound"><span class="entity">oid</span></span></span><span class="main">)</span>  <span class="main">;</span>
  <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span>   <span class="free"><span class="bound"><span class="entity">oid</span></span></span>  <span class="keyword1">of</span>
                     None <span class="main">⇒</span> None
                   <span class="main">|</span> Some <span class="bound">tyfs</span> <span class="main">⇒</span> <span class="main">(</span>snd <span class="bound">tyfs</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">)</span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_read <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>  <span class="main">(</span> <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span>   <span class="main">↦</span>   <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">)</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_field_write_npeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  v_null <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_write <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_ex <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> ex_npe<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_field_writeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  <span class="main">(</span>v_oid <span class="free"><span class="bound"><span class="entity">oid</span></span></span><span class="main">)</span>  <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_write <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>  <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span>   <span class="free"><span class="bound"><span class="entity">oid</span></span></span>  <span class="keyword1">of</span>
                None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">arbitrary</span></span></span>
              <span class="main">|</span> Some <span class="bound">tyfs</span> <span class="main">⇒</span>
                   <span class="main">(</span><span class="main">(</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">oid</span></span></span>   <span class="main">↦</span>
                       <span class="main">(</span>fst <span class="bound">tyfs</span><span class="main">,</span> snd <span class="bound">tyfs</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>   <span class="main">↦</span>   <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>H<span class="main">)</span><span class="main">)</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_if_trueI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">v</span></span></span>  <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">w</span></span></span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">v</span></span></span>  <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_if <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_if_falseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">v</span></span></span>  <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span>   <span class="main">=</span> Some  <span class="free"><span class="bound"><span class="entity">w</span></span></span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">v</span></span></span>  <span class="main">≠</span>  <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_if <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s'_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_newI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_type <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
fields <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span> Some <span class="main">(</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f_list</span></span></span><span class="main">)</span>  <span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">oid</span></span></span>  <span class="main">∉</span> dom  <span class="free"><span class="bound"><span class="entity">H</span></span></span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">H'</span></span></span>  <span class="main">=</span>   <span class="main">(</span><span class="main">(</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">oid</span></span></span>   <span class="main">↦</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">,</span>
                          map_of  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">::</span>f<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">f_XXX</span><span class="main">,</span>v_null<span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>H<span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_new <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>  <span class="main">(</span> <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span>   <span class="main">↦</span>   <span class="main">(</span>v_oid <span class="free"><span class="bound"><span class="entity">oid</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">H'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_mcall_npeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  v_null <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_call <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y_list</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_ex <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> ex_npe<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> r_mcallI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">=</span> Some  <span class="main">(</span>v_oid <span class="free"><span class="bound"><span class="entity">oid</span></span></span><span class="main">)</span>  <span class="main">;</span>
  <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">H</span></span></span>   <span class="free"><span class="bound"><span class="entity">oid</span></span></span>  <span class="keyword1">of</span>
                     None <span class="main">⇒</span> None
                   <span class="main">|</span> Some <span class="bound">tyfs</span> <span class="main">⇒</span> Some <span class="main">(</span>fst <span class="bound">tyfs</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span>   <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
find_meth_def <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">meth</span></span></span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>Some <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">,</span> <span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>vd_def <span class="bound">cl_XXX</span> <span class="bound">var_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span>meth_body_def <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">s_''</span><span class="main">::</span>s<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">s_'</span><span class="main">::</span>s<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">s_'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s''_s'_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">::</span>ctxmeth_def_opt<span class="main">)</span> <span class="main">)</span> <span class="main">;</span>
 <span class="main">(</span>set  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>x_var <span class="bound">var_'</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="keyword1">Int</span> <span class="main">(</span>dom  <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>  <span class="main">;</span>
 distinct <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">var_'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">x'</span></span></span>  <span class="main">∉</span> dom  <span class="free"><span class="bound"><span class="entity">L</span></span></span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">x'</span></span></span>  <span class="main">∉</span> set  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>x_var <span class="bound">var_'</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">L</span></span></span>   <span class="bound">y_XXX</span>   <span class="main">=</span> Some  <span class="bound">v_XXX</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">L'</span></span></span>  <span class="main">=</span>   <span class="main">(</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>  <span class="main">++</span> <span class="main">(</span>map_of <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">(</span>x_var <span class="bound">var_'</span><span class="main">)</span><span class="main">,</span><span class="bound">v_XXX</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">x'</span></span></span>   <span class="main">↦</span>   <span class="main">(</span>v_oid <span class="free"><span class="bound"><span class="entity">oid</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
 <span class="free"><span class="bound"><span class="entity">T</span></span></span>  <span class="main">=</span>   <span class="main">(</span>  <span class="main">(</span>map_of <span class="main">(</span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">(</span>x_var <span class="bound">var_XXX</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>x_var <span class="bound">var_'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>   <span class="main">(</span> x_this   <span class="main">↦</span>   <span class="free"><span class="bound"><span class="entity">x'</span></span></span> <span class="main">)</span><span class="main">)</span>   <span class="main">;</span>
 list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">s_''</span><span class="main">::</span>s<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">s_'</span><span class="main">::</span>s<span class="main">)</span><span class="main">)</span><span class="main">.</span>tr_s <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">s_'</span><span class="main">)</span> <span class="main">(</span><span class="bound">s_''</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s''_s'_list</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">;</span>
 <span class="main">(</span><span class="keyword1">case</span>  <span class="free"><span class="bound"><span class="entity">T</span></span></span>   <span class="free"><span class="bound"><span class="entity">y</span></span></span>  <span class="keyword1">of</span> None <span class="main">⇒</span>  <span class="free"><span class="bound"><span class="entity">y</span></span></span>
                                    <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">y'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
<span class="free">r_stmt</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">(</span>s_call <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">meth</span></span></span>  <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">::</span>x<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">::</span>cl<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_XXX</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">var_'</span><span class="main">::</span>var<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">v_XXX</span><span class="main">::</span>v<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">y_XXX</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y_cl_var_var'_v_list</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>config_normal <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">L'</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">(</span>List.map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="main">(</span><span class="bound">s_''</span><span class="main">::</span>s<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">s_'</span><span class="main">::</span>s<span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="bound">s_''</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s''_s'_list</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="main">(</span>s_ass <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">y'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s_list</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lightweight_Java_Equivalence">
<div class="head">
<h1>Theory Lightweight_Java_Equivalence</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Lightweight Java, the equivalence functions
    Authors:     Rok Strnisa &lt;rok@strnisa.com&gt;, 2006
                 Matthew Parkinson &lt;matt@matthewp.com&gt;, 2006
    Maintainer:  
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Lightweight_Java_Equivalence <span class="keyword2"><span class="keyword">imports</span></span> <a href="Lightweight_Java_Definition.html">Lightweight_Java_Definition</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* BEGIN: HELPER FUNCTIONS *)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map id <span class="free">list</span> <span class="main">=</span> <span class="free">list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> id_map_two<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">list</span> <span class="main">=</span> <span class="free">list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> id_image_two<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="free">list</span> <span class="main">=</span> set <span class="free">list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free">list</span> <span class="main">=</span> map fst <span class="free">list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_snd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">list</span> <span class="main">=</span> map snd <span class="free">list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zip_map_map_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">list</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> concat_map_singlton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> list_all_map_P <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">list</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> dom_single<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> dom <span class="main">(</span>Map.empty<span class="main">(</span><span class="free">k</span> <span class="main">↦</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> predicted_lu<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">list</span> <span class="main">⟶</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">key</span><span class="main">.</span> <span class="main">(</span><span class="bound">key</span><span class="main">,</span> <span class="free">value</span><span class="main">)</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">value</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> key_in_map1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> dom <span class="free">M'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">M</span> <span class="main">++</span> <span class="free">M'</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">M</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">M'</span> <span class="free">k</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> forall_cons <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">s</span><span class="main">#</span><span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">S</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_cong<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">list</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="free">f</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> forall_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> dom <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="bound">a</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> dom <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">B</span> <span class="bound">b</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> dom <span class="free">A</span> <span class="main">∪</span> dom <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">B</span> <span class="main">++</span> <span class="free">A</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="comment1">(* END: HELPER FUNCTIONS *)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">class_name_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> dcl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">class_name_f</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">dcl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>class_name <span class="free">cld</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>class_name_f <span class="free">cld</span> <span class="main">=</span> <span class="free">dcl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> class_nameI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> class_name.cases<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">superclass_name_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> cl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">superclass_name_f</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>superclass_name <span class="free">cld</span> <span class="free">cl</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>superclass_name_f <span class="free">cld</span> <span class="main">=</span> <span class="free">cl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> superclass_nameI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> superclass_name.cases<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">class_fields_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> fds"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">class_fields_f</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">fds</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>class_fields <span class="free">cld</span> <span class="free">fds</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>class_fields_f <span class="free">cld</span> <span class="main">=</span> <span class="free">fds</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_fields_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> class_fieldsI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> class_fields.cases<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">class_methods_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cld <span class="main">⇒</span> meth_defs"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">class_methods_f</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">mds</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>class_methods <span class="free">cld</span> <span class="free">fds</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>class_methods_f <span class="free">cld</span> <span class="main">=</span> <span class="free">fds</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> class_methodsI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> class_methods.cases<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">method_name_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"meth_def <span class="main">⇒</span> meth"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">method_name_f</span> <span class="free"><span class="bound"><span class="entity">md</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">md</span></span></span> <span class="keyword1">of</span> meth_def_def <span class="bound">meth_sig</span> <span class="bound">meth_body</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">meth_sig</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">meth</span> <span class="bound">vds</span> <span class="main">⇒</span> <span class="bound">meth</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>method_name <span class="free">md</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>method_name_f <span class="free">md</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> method_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> method_nameI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> method_name.cases<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">distinct_names_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">distinct_names_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span>
  <span class="main">(</span>distinct <span class="main">(</span>map class_name_f <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> distinct_names_map<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cld_dcl_list</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">cld</span><span class="main">.</span> <span class="main">(=)</span> <span class="main">(</span>class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span>map snd <span class="free">cld_dcl_list</span><span class="main">)</span>
      <span class="main">⟶</span> distinct_names_f <span class="main">(</span>map fst <span class="free">cld_dcl_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cld_dcl_list</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_names_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>distinct_names <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>distinct_names_f <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> distinct_names.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_names_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_names_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> cld_dcl_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">cld</span><span class="main">.</span> <span class="main">(</span><span class="bound">cld</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> dn_defI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">find_cld_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> fqn <span class="main">⇒</span> ctxcld_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_cld_f</span> <span class="main">[]</span>         <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span> <span class="main">=</span> None"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">find_cld_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">clds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span> <span class="keyword1">of</span> fqn_def <span class="bound">dcl'</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">dcl</span> <span class="main">=</span> <span class="bound">dcl'</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctx</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">find_cld_f</span> <span class="free"><span class="bound"><span class="entity">clds</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_cld <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="free">ctxcld_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> <span class="free">ctxcld_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_cld.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fc_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">fqn</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cld clds dcl<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">cld</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl' cl' vds' mds'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fc_cons_trueI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fc_cons_falseI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_to_mem<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">cld</span> <span class="main">:</span> set <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits fqn.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_cld_name_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ctxcld</span><span class="main">.</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>fqn_def <span class="free">dcl</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">ctxcld</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span><span class="main">.</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ctxcld</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits fqn.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">find_type_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> ty_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_type_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> cl_object <span class="main">=</span> Some ty_top"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">find_type_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">(</span>cl_fqn <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span> <span class="keyword1">of</span> fqn_def <span class="bound">dcl</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> find_cld_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">⇒</span>
     Some <span class="main">(</span>ty_def <span class="bound">ctx'</span> <span class="bound">dcl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_type <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">ty_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="main">=</span> <span class="free">ty_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> find_type.cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fqn.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">cl</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ft_objI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> fqn<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fqn</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ft_nullI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ft_dclI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_remove<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cld</span> <span class="main">:</span> set <span class="free">P</span> <span class="main">⟹</span> length <span class="main">(</span>remove1 <span class="free">cld</span> <span class="free">P</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_program<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">cld</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ctx</span> <span class="bound">ctx'</span> <span class="bound">fqn</span><span class="main">.</span> find_cld_f <span class="bound">P</span> <span class="bound">ctx</span> <span class="bound">fqn</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
      length <span class="main">(</span>remove1 <span class="bound">cld</span> <span class="bound">P</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="bound">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> find_to_mem<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_remove<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> path_length_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_length <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">nn</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">nn'</span><span class="main">.</span> path_length <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="bound">nn'</span> <span class="main">⟶</span> <span class="free">nn</span> <span class="main">=</span> <span class="bound">nn'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> path_length.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> path_length.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a4.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">nn'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_length.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_termination<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">cld</span> <span class="bound">ctx</span> <span class="bound">ctx'</span> <span class="bound">fqn</span><span class="main">.</span> find_cld_f <span class="bound">P</span> <span class="bound">ctx</span> <span class="bound">fqn</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∧</span> acyclic_clds <span class="bound">P</span>
       <span class="main">⟶</span> The <span class="main">(</span>path_length <span class="bound">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> The <span class="main">(</span>path_length <span class="bound">P</span> <span class="bound">ctx</span> <span class="main">(</span>cl_fqn <span class="bound">fqn</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> acyclic_clds.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> P<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">fqn</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_length_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> path_length.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_length_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> path_length_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> path_length.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> path_length_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">function</span></span>
<span class="entity">find_path_rec_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> ctxclds <span class="main">⇒</span> ctxclds_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_path_rec_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span>  cl_object   <span class="free"><span class="bound"><span class="entity">path</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">path</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">find_path_rec_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">(</span>cl_fqn <span class="free"><span class="bound"><span class="entity">fqn</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">path</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">~</span><span class="main">(</span>acyclic_clds <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="keyword1">then</span> None <span class="keyword1">else</span>
  <span class="main">(</span><span class="keyword1">case</span> find_cld_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">fqn</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">⇒</span>
   <span class="free">find_path_rec_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ctx'</span>
                    <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">path</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span><span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span> <span class="bound">ctx</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">path</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nn</span><span class="main">.</span> path_length <span class="bound">P</span> <span class="bound">ctx</span> <span class="bound">cl</span> <span class="bound">nn</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_path_rec <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path</span> <span class="free">path_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path</span> <span class="main">=</span> <span class="free">path_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> find_path_rec.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpr_objI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpr_nullI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fpr_nullI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpr_nullI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fpr_fqnI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">find_path_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> cl <span class="main">⇒</span> ctxclds_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_path_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">=</span> find_path_rec_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_path <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="main">=</span> <span class="free">path_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> find_path.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fp_defI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">find_path_ty_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> ctxclds_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_path_ty_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  ty_top          <span class="main">=</span> Some <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">find_path_ty_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>ty_def <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span> <span class="main">=</span>
   find_path_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free"><span class="bound"><span class="entity">dcl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_path_ty <span class="free">P</span> <span class="free">ty</span> <span class="free">ctxclds_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_path_ty_f <span class="free">P</span> <span class="free">ty</span> <span class="main">=</span> <span class="free">ctxclds_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> find_path_ty.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpty_objI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpty_dclI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">fields_in_path_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ctxclds <span class="main">⇒</span> fs"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">fields_in_path_f</span> <span class="main">[]</span>               <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">fields_in_path_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">fd</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">fd</span> <span class="keyword1">of</span> fd_def <span class="bound">cl</span> <span class="bound">f</span> <span class="main">⇒</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>class_fields_f <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">ctxcld</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">@</span> <span class="free">fields_in_path_f</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> cl_f_list_map<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>case_fd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">cl_f_list</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_XXX</span><span class="main">,</span> <span class="bound">f_XXX</span><span class="main">)</span><span class="main">.</span> <span class="bound">f_XXX</span><span class="main">)</span> <span class="free">cl_f_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fip_ind_to_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">fs</span><span class="main">.</span> fields_in_path <span class="free">clds</span> <span class="bound">fs</span> <span class="main">⟶</span> fields_in_path_f <span class="free">clds</span> <span class="main">=</span> <span class="bound">fs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">clds</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> fields_in_path.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> fields_in_path.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl_f_list_map<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fd_map_split<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>case_fd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fd_map_split'<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>case_fd Pair<span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fd.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fd_map_split''<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∘</span> case_fd Pair<span class="main">)</span> <span class="free">list</span> <span class="main">=</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fd.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">fs</span><span class="main">.</span> <span class="main">(</span>fields_in_path <span class="free">ctxclds</span> <span class="bound">fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fields_in_path_f <span class="free">ctxclds</span> <span class="main">=</span> <span class="bound">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> fields_in_path.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fip_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> fields_in_path.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fip_ind_to_f fd_map_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> cld <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctxcld_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctxclds</span></span>
           <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl_f_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>case_fd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>class_fields_f <span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fip_consI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_map_split''<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fd_map_split'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fd.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">fields_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> fs option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">fields_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> find_path_ty_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">ctxclds</span> <span class="main">⇒</span>
    Some <span class="main">(</span>fields_in_path_f <span class="bound">ctxclds</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">fs_opt</span><span class="main">.</span> <span class="main">(</span>fields <span class="free">P</span> <span class="free">ty</span> <span class="bound">fs_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fields_f <span class="free">P</span> <span class="free">ty</span> <span class="main">=</span> <span class="bound">fs_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fs_opt</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> fields.cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> fields.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"find_path_ty_f <span class="free">P</span> <span class="free">ty</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_noneI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"find_path_ty_f <span class="free">P</span> <span class="free">ty</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fields_someI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">methods_in_path_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"clds <span class="main">⇒</span> meths"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">methods_in_path_f</span> <span class="main">[]</span>         <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">methods_in_path_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">clds</span></span></span><span class="main">)</span> <span class="main">=</span>
  map <span class="main">(</span><span class="main">λ</span><span class="bound">md</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">md</span> <span class="keyword1">of</span> meth_def_def <span class="bound">meth_sig</span> <span class="bound">meth_body</span> <span class="main">⇒</span>
         <span class="keyword1">case</span> <span class="bound">meth_sig</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">meth</span> <span class="bound">vds</span> <span class="main">⇒</span> <span class="bound">meth</span><span class="main">)</span>
              <span class="main">(</span>class_methods_f <span class="free"><span class="bound"><span class="entity">cld</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="free">methods_in_path_f</span> <span class="free"><span class="bound"><span class="entity">clds</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> meth_def_map<span class="main">[</span><span class="operator">THEN</span> mp<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">md</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">vds</span><span class="main">,</span> <span class="bound">mb</span><span class="main">)</span><span class="main">.</span> <span class="bound">md</span> <span class="main">=</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="bound">cl</span> <span class="bound">m</span> <span class="bound">vds</span><span class="main">)</span> <span class="bound">mb</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
     <span class="main">⟶</span> map <span class="main">(</span>case_meth_def <span class="main">(</span><span class="main">λ</span><span class="bound">ms</span> <span class="bound">mb</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ms</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">m</span> <span class="bound">vds</span> <span class="main">⇒</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">md</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">vds</span><span class="main">,</span> <span class="bound">mb</span><span class="main">)</span><span class="main">.</span> <span class="bound">md</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">md</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">vds</span><span class="main">,</span> <span class="bound">mb</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span><span class="main">)</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> meth_def_map'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">md</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">vds</span><span class="main">,</span> <span class="bound">mb</span><span class="main">)</span><span class="main">.</span> <span class="bound">md</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">md</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">md</span> <span class="keyword1">of</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="bound">cl</span> <span class="bound">m</span> <span class="bound">vds</span><span class="main">)</span> <span class="bound">mb</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">md</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">vds</span><span class="main">,</span> <span class="bound">mb</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">list</span> <span class="main">=</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">meths</span><span class="main">.</span> <span class="main">(</span>methods_in_path <span class="free">clds</span> <span class="bound">meths</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>methods_in_path_f <span class="free">clds</span> <span class="main">=</span> <span class="bound">meths</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">clds</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> methods_in_path.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mip_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> methods_in_path.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span>
  meth_def_cl_meth_vds_meth_body_list <span class="main"><span class="main">=</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="improper">a</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span>
    <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">md</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">md</span> <span class="keyword1">of</span> meth_def_def <span class="bound">ms</span> <span class="bound">mb</span> <span class="main">⇒</span>
               <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ms</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">m</span> <span class="bound">vds</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">md</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">vds</span><span class="main">,</span> <span class="bound">mb</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">mds</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
  mip_consI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def meth_def_map'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">methods_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meths option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">methods_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> find_path_ty_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">ctxclds</span> <span class="main">⇒</span>
    Some <span class="main">(</span>methods_in_path_f <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="bound">cld</span><span class="main">)</span> <span class="bound">ctxclds</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>methods <span class="free">P</span> <span class="free">ty</span> <span class="free">meths</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>methods_f <span class="free">P</span> <span class="free">ty</span> <span class="main">=</span> Some <span class="free">meths</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> methods.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> methods_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> methods_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> methods_methodsI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">ftype_in_fds_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctx <span class="main">⇒</span> fds <span class="main">⇒</span> f <span class="main">⇒</span> ty_opt_bot"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ftype_in_fds_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">[]</span>       <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> ty_opt_bot_opt None"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ftype_in_fds_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fd</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">fds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">fd</span></span></span> <span class="keyword1">of</span> fd_def <span class="bound">cl</span> <span class="bound">f'</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="bound">f'</span> <span class="keyword1">then</span>
  <span class="main">(</span><span class="keyword1">case</span> find_type_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="bound">cl</span> <span class="keyword1">of</span> None <span class="main">⇒</span> ty_opt_bot_bot <span class="main">|</span> Some <span class="bound">ty</span> <span class="main">⇒</span>
     ty_opt_bot_opt <span class="main">(</span>Some <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">ftype_in_fds_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">fds</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ftype_in_fds <span class="free">P</span> <span class="free">ctx</span> <span class="free">fds</span> <span class="free">f</span> <span class="free">ty_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ftype_in_fds_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fds</span> <span class="free">f</span> <span class="main">=</span> <span class="free">ty_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ftype_in_fds.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ftype_in_fds.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fds</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ftif_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> fd fds<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fd</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> cl f'<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="improper">cl</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftif_cons_botI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftif_cons_trueI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ftif_cons_falseI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">ftype_in_path_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ctxclds <span class="main">⇒</span> f <span class="main">⇒</span> ty_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ftype_in_path_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">[]</span>               <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> None"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ftype_in_path_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ctxcld</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> ftype_in_fds_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ctx</span> <span class="main">(</span>class_fields_f <span class="bound">cld</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">of</span>
     ty_opt_bot_bot <span class="main">⇒</span> None <span class="main">|</span> ty_opt_bot_opt <span class="bound">ty_opt</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ty_opt</span> <span class="keyword1">of</span> Some <span class="bound">ty</span> <span class="main">⇒</span> Some <span class="bound">ty</span> <span class="main">|</span> None <span class="main">⇒</span>
     <span class="free">ftype_in_path_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ftype_in_path <span class="free">P</span> <span class="free">ctxclds</span> <span class="free">f</span> <span class="free">ty_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ftype_in_path_f <span class="free">P</span> <span class="free">ctxclds</span> <span class="free">f</span> <span class="main">=</span> <span class="free">ty_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ftype_in_path.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ftip_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">hypsubst_thin</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ftype_in_fds_f <span class="free">P</span> <span class="improper">a</span> <span class="main">(</span>class_fields_f <span class="improper">b</span><span class="main">)</span> <span class="free">f</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_opt<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ty_opt</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftip_cons_falseI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftip_cons_trueI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftip_cons_botI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">ftype_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> f <span class="main">⇒</span> ty_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ftype_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> find_path_ty_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">ctxclds</span> <span class="main">⇒</span>
     ftype_in_path_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ctxclds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ftype <span class="free">P</span> <span class="free">ty</span> <span class="free">f</span> <span class="free">ty'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ftype_f <span class="free">P</span> <span class="free">ty</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ftype.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ftypeI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">find_meth_def_in_list_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"meth_defs <span class="main">⇒</span> meth <span class="main">⇒</span> meth_def_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_meth_def_in_list_f</span> <span class="main">[]</span>       <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> None"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">find_meth_def_in_list_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">md</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">md</span></span></span> <span class="keyword1">of</span> meth_def_def <span class="bound">ms</span> <span class="bound">mb</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ms</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">m'</span> <span class="bound">vds</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="bound">m'</span> <span class="keyword1">then</span> Some <span class="free"><span class="bound"><span class="entity">md</span></span></span> <span class="keyword1">else</span> <span class="free">find_meth_def_in_list_f</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_meth_def_in_list <span class="free">mds</span> <span class="free">m</span> <span class="free">md_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_meth_def_in_list_f <span class="free">mds</span> <span class="free">m</span> <span class="main">=</span> <span class="free">md_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_meth_def_in_list.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">mds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fmdil_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.split meth_sig.split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fmdil_cons_trueI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fmdil_cons_falseI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">find_meth_def_in_path_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ctxclds <span class="main">⇒</span> meth <span class="main">⇒</span> ctxmeth_def_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
fmdip_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">find_meth_def_in_path_f</span> <span class="main">[]</span>               <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> None"</span></span> <span class="main">|</span>
fmdip_cons<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">find_meth_def_in_path_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ctxcld</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ctxcld</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> find_meth_def_in_list_f <span class="main">(</span>class_methods_f <span class="bound">cld</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">of</span>
    Some <span class="bound">md</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">md</span><span class="main">)</span> <span class="main">|</span>
    None <span class="main">⇒</span> <span class="free">find_meth_def_in_path_f</span> <span class="free"><span class="bound"><span class="entity">ctxclds</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_meth_def_in_path <span class="free">ctxclds</span> <span class="free">m</span> <span class="free">ctxmeth_def_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_meth_def_in_path_f <span class="free">ctxclds</span> <span class="free">m</span> <span class="main">=</span> <span class="free">ctxmeth_def_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_meth_def_in_path.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fmdip_emptyI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"find_meth_def_in_list_f <span class="main">(</span>class_methods_f <span class="improper">b</span><span class="main">)</span> <span class="free">m</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmdip_cons_falseI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmdip_cons_trueI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">find_meth_def_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meth <span class="main">⇒</span> ctxmeth_def_opt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">find_meth_def_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> find_path_ty_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">ctxclds</span> <span class="main">⇒</span>
    find_meth_def_in_path_f <span class="bound">ctxclds</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_meth_def <span class="free">P</span> <span class="free">ty</span> <span class="free">m</span> <span class="free">ctxmd_opt</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>find_meth_def_f <span class="free">P</span> <span class="free">ty</span> <span class="free">m</span> <span class="main">=</span> <span class="free">ctxmd_opt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_meth_def.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmd_nullI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmd_optI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">lift_opts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option list <span class="main">⇒</span> <span class="tfree">'a</span> list option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lift_opts</span> <span class="main">[]</span>         <span class="main">=</span> Some <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_opts</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">opt</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">opts</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">opt</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">v</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free">lift_opts</span> <span class="free"><span class="bound"><span class="entity">opts</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">vs</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">#</span><span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">mtype_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> meth <span class="main">⇒</span> mty option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">mtype_f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> find_meth_def_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">md</span><span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">md</span> <span class="keyword1">of</span> meth_def_def <span class="bound">ms</span> <span class="bound">mb</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ms</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">m'</span> <span class="bound">vds</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> find_type_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ctx</span> <span class="bound">cl</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">ty'</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">vd</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">clk</span> <span class="bound">vark</span> <span class="main">⇒</span>
    find_type_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ctx</span> <span class="bound">clk</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">tys</span> <span class="main">⇒</span>
      Some <span class="main">(</span>mty_def <span class="bound">tys</span> <span class="bound">ty'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_ind<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">cl</span> <span class="main">=</span> Some <span class="bound">ty</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">⟶</span> lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> find_md_m_match'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_meth_def_in_list_f <span class="free">mds</span> <span class="free">m</span> <span class="main">=</span> Some <span class="main">(</span>meth_def_def <span class="main">(</span>meth_sig_def <span class="free">cl</span> <span class="free">m'</span> <span class="free">vds</span><span class="main">)</span> <span class="free">mb</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">mds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_md_m_match<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_meth_def_in_path_f <span class="free">path</span> <span class="free">m</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="free">cl</span> <span class="free">m'</span> <span class="free">vds</span><span class="main">)</span> <span class="free">mb</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> find_md_m_match'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vds_map_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">=</span> length <span class="free">vds</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_length<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">tys</span><span class="main">.</span> lift_opts <span class="free">ty_opts</span> <span class="main">=</span> Some <span class="bound">tys</span> <span class="main">⟶</span> length <span class="free">ty_opts</span> <span class="main">=</span> length <span class="bound">tys</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ty_opts</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vds_tys_length_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tys</span> <span class="main">⟶</span> length <span class="free">vds</span> <span class="main">=</span> length <span class="free">tys</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lift_opts_length<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vds_map_length<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> vds_tys_length_eq'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">tys</span><span class="main">.</span> length <span class="free">vds</span> <span class="main">=</span> length <span class="bound">tys</span> <span class="main">⟶</span> <span class="free">vds</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">vd</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">vds</span> <span class="bound">tys</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">tys</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> vds_tys_length_eq''<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">vds</span><span class="main">.</span> length <span class="bound">vds</span> <span class="main">=</span> length <span class="free">tys</span> <span class="main">⟶</span> <span class="free">tys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">vd</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">vds</span> <span class="free">tys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">tys</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">vds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> vd.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_find_type<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">tys</span><span class="main">.</span> lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">tys</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">vd</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">vds</span> <span class="bound">tys</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">cl</span> <span class="main">=</span> Some <span class="bound">ty</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> vd.splits option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl' var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vd_def <span class="improper">cl'</span> <span class="improper">var</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mtype <span class="free">P</span> <span class="free">ty</span> <span class="free">m</span> <span class="free">mty</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mtype_f <span class="free">P</span> <span class="free">ty</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mtype.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="improper">cl_var_ty_list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_opts_ind<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_opts_ind<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits meth_def.splits meth_sig.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx mb cl m' vds ty' tys<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> meth_body <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">mb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty'</span></span>
           <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl_var_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">vd</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="improper">vds</span> <span class="improper">tys</span><span class="main">)</span>"</span></span>
           <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> meth_def <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"meth_def_def <span class="main">(</span>meth_sig_def <span class="improper">cl</span> <span class="improper">m'</span> <span class="improper">vds</span><span class="main">)</span> <span class="improper">mb</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mtypeI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_md_m_match<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> vds_tys_length_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> vds_tys_length_eq'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> vd.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lift_opts_find_type<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> vds_tys_length_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vds_tys_length_eq''<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">is_sty_one</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> ty <span class="main">⇒</span> ty <span class="main">⇒</span> bool option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_sty_one</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> find_path_ty_f <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">ctxclds</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ty'</span></span></span> <span class="keyword1">of</span> ty_top <span class="main">⇒</span> Some True <span class="main">|</span> ty_def <span class="bound">ctx'</span> <span class="bound">dcl'</span> <span class="main">⇒</span>
    Some <span class="main">(</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">dcl'</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="bound">ctxclds</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> class_name_mem_map<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">,</span> class_name_f <span class="free">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ctx_cld_dcl_list</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> class_name_f <span class="free">cld</span><span class="main">)</span>
          <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> <span class="bound">dcl</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
            set <span class="free">ctx_cld_dcl_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctx_cld_dcl_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_map_three<span class="main">:</span>
  <span class="quoted"><span class="quoted">" <span class="free">ctxclds</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> <span class="bound">dcl</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ctxclds</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_el_map<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ctxclds</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> class_name_f <span class="free">dcl</span><span class="main">)</span>
          <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">,</span> <span class="bound">cld_XXX</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
            set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="free">ctxclds</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty'</span> <span class="main">=</span> Some True<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sty_one.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx cld dcl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">ctx</span><span class="main">,</span> <span class="improper">cld</span><span class="main">,</span> <span class="improper">dcl</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> case_prod_conv image_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits ty.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sty_objI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctxclds ctx dcl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ctx_cld_dcl_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="improper">ctxclds</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_dclI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_map_three<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mem_el_map<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_append<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path'</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">path''</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="free">path'</span> <span class="main">@</span> <span class="bound">path''</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_in_path_found'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path'</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">ctxcld</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">.</span> <span class="bound">ctxcld</span> <span class="main">∈</span> set <span class="free">path'</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ctx'</span> <span class="bound">fqn'</span><span class="main">.</span> find_cld_f <span class="free">P</span> <span class="bound">ctx'</span> <span class="bound">fqn'</span> <span class="main">=</span> Some <span class="bound">ctxcld</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_in_path_found<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> <span class="free">ctxcld</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ctx'</span> <span class="bound">fqn'</span><span class="main">.</span> find_cld_f <span class="free">P</span> <span class="bound">ctx'</span> <span class="bound">fqn'</span> <span class="main">=</span> Some <span class="free">ctxcld</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> all_in_path_found'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_target_is_head'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path'</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">fqn</span> <span class="bound">ctxcld</span><span class="main">.</span> <span class="free">cl</span> <span class="main">=</span> cl_fqn <span class="bound">fqn</span> <span class="main">∧</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">fqn</span> <span class="main">=</span> Some <span class="bound">ctxcld</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">path''</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="free">path'</span> <span class="main">@</span> <span class="bound">ctxcld</span> <span class="main">#</span> <span class="bound">path''</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">path'</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"superclass_name_f <span class="improper">b</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_target_is_head<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="free">fqn</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ctxcld</span><span class="main">.</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="bound">ctxcld</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">path''</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="bound">ctxcld</span> <span class="main">#</span> <span class="bound">path''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fpr_target_is_head'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> mp<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_sub_path'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path'</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">fqn</span> <span class="bound">ctxcld</span> <span class="bound">path''</span> <span class="bound">path_fqn</span><span class="main">.</span>
         <span class="free">cl</span> <span class="main">=</span> cl_fqn <span class="bound">fqn</span> <span class="main">∧</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">fqn</span> <span class="main">=</span> Some <span class="bound">ctxcld</span> <span class="main">∧</span>
         find_path_rec_f <span class="free">P</span> <span class="main">(</span>fst <span class="bound">ctxcld</span><span class="main">)</span> <span class="main">(</span>superclass_name_f <span class="main">(</span>snd <span class="bound">ctxcld</span><span class="main">)</span><span class="main">)</span> <span class="bound">path''</span> <span class="main">=</span> Some <span class="bound">path_fqn</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">path'''</span><span class="main">.</span> <span class="bound">path_fqn</span> <span class="main">=</span> <span class="bound">path''</span> <span class="main">@</span> <span class="bound">path'''</span> <span class="main">∧</span> <span class="free">path</span> <span class="main">=</span> <span class="free">path'</span> <span class="main">@</span> <span class="bound">ctxcld</span> <span class="main">#</span> <span class="bound">path'''</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">path'</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"superclass_name_f <span class="improper">b</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_sub_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="free">fqn</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="free">ctxcld</span><span class="main">;</span>
    find_path_f <span class="free">P</span> <span class="main">(</span>fst <span class="free">ctxcld</span><span class="main">)</span> <span class="main">(</span>superclass_name_f <span class="main">(</span>snd <span class="free">ctxcld</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path'</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="free">path</span> <span class="main">=</span> <span class="free">ctxcld</span> <span class="main">#</span> <span class="free">path'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fpr_sub_path'<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_sub_path_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>superclass_name_f <span class="free">cld</span><span class="main">)</span> <span class="free">path''</span> <span class="main">=</span> Some <span class="free">path_fqn</span><span class="main">;</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span><span class="main">;</span> acyclic_clds <span class="free">P</span><span class="main">;</span>
    find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>superclass_name_f <span class="free">cld</span><span class="main">)</span> <span class="main">(</span><span class="free">path'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">path'''</span><span class="main">.</span> <span class="free">path_fqn</span> <span class="main">=</span> <span class="free">path''</span> <span class="main">@</span> <span class="bound">path'''</span> <span class="main">∧</span> <span class="free">path</span> <span class="main">=</span> <span class="free">path'</span> <span class="main">@</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span> <span class="main">#</span> <span class="bound">path'''</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"cl_fqn <span class="free">fqn</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_sub_path'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_same_suffix'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">prefix</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">suffix</span> <span class="bound">prefix'</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="free">prefix</span> <span class="main">@</span> <span class="bound">suffix</span> <span class="main">⟶</span>
          find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">prefix</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_same_suffix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">prefix</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">suffix</span> <span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="free">prefix</span> <span class="main">@</span> <span class="bound">suffix</span> <span class="main">∧</span>
          find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span>
             <span class="main">⟶</span> <span class="bound">suffix</span> <span class="main">=</span> <span class="bound">suffix'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">prefix</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fpr_same_suffix' option.inject same_append_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_mid_path'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path'</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">ctxcld</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">.</span>
         <span class="bound">ctxcld</span> <span class="main">∈</span> set <span class="free">path'</span> <span class="main">∨</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">path_fqn</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="main">(</span>fst <span class="bound">ctxcld</span><span class="main">)</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="main">(</span>snd <span class="bound">ctxcld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">path''</span> <span class="main">=</span> Some <span class="bound">path_fqn</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">path'''</span><span class="main">.</span> <span class="bound">path_fqn</span> <span class="main">=</span> <span class="free">path''</span> <span class="main">@</span> <span class="bound">path'''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">path_rest</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="bound">path_rest</span> <span class="main">@</span> <span class="bound">path'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">path'</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path' ctx' cld' cld'' ctx'' path''' cl fds mds<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"find_path_rec_f <span class="improper">P</span> <span class="improper">ctx'</span> <span class="main">(</span>superclass_name_f <span class="improper">cld'</span><span class="main">)</span> <span class="main">(</span><span class="improper">path'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ctx'</span><span class="main">,</span> <span class="improper">cld'</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">ctxcld</span><span class="main">∈</span>set <span class="free">path</span><span class="main">.</span>
                  <span class="bound">ctxcld</span> <span class="main">=</span> <span class="main">(</span><span class="improper">ctx'</span><span class="main">,</span> <span class="improper">cld'</span><span class="main">)</span> <span class="main">∨</span>
                  <span class="bound">ctxcld</span> <span class="main">∈</span> set <span class="improper">path'</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">path_fqn</span><span class="main">.</span> case_option None <span class="main">(</span>case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">ctx'</span> <span class="bound">cld</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="free">path''</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="main">(</span>fst <span class="bound">ctxcld</span><span class="main">)</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="main">(</span>snd <span class="bound">ctxcld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                              Some <span class="bound">path_fqn</span> <span class="main">⟶</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">path'''</span><span class="main">.</span> <span class="bound">path_fqn</span> <span class="main">=</span> <span class="free">path''</span> <span class="main">@</span> <span class="bound">path'''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">path_rest</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="bound">path_rest</span> <span class="main">@</span> <span class="bound">path'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">ctx''</span><span class="main">,</span> <span class="improper">cld''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">cld'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl' cl' fds' mds'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fqn</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl''<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">path''</span> <span class="main">@</span> <span class="improper">path'''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">path''</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ctx'</span><span class="main">,</span> cld_def <span class="improper">dcl'</span> <span class="improper">cl'</span> <span class="improper">fds'</span> <span class="improper">mds'</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
                suffix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_mid_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">;</span>
    find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path'</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">path''</span><span class="main">.</span> <span class="free">path</span> <span class="main">=</span> <span class="bound">path''</span> <span class="main">@</span> <span class="free">path'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span>  P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">cl</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctxcld <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_mid_path'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_first_in_path'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">path'</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">fqn</span> <span class="bound">ctxcld</span><span class="main">.</span> <span class="free">cl</span> <span class="main">=</span> cl_fqn <span class="bound">fqn</span> <span class="main">∧</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">fqn</span> <span class="main">=</span> Some <span class="bound">ctxcld</span> <span class="main">⟶</span> <span class="bound">ctxcld</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">cl</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_first_in_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="free">fqn</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="free">ctxcld</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">ctxcld</span> <span class="main">∈</span> set <span class="free">path</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fpr_first_in_path'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cld_for_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="free">fqn</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ctxcld</span><span class="main">.</span> find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="bound">ctxcld</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ctx_cld_ctx_dcl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl</span> <span class="free">cl</span> <span class="free">fds</span> <span class="free">mds</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="free">path</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ctx_dcl_ctx_cld<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="free">path</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span><span class="main">.</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ctx_dcl_mem_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free">dcl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="free">path</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> cld_for_path<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fpr_first_in_path<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ctx_cld_ctx_dcl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> sty_reflexiveI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty'</span> <span class="main">=</span> Some True <span class="main">⟹</span> is_sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty</span> <span class="main">=</span> Some True"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ctx_dcl_mem_path<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> sty_transitiveI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty'</span> <span class="main">=</span> Some True<span class="main">;</span> is_sty_one <span class="free">P</span> <span class="free">ty'</span> <span class="free">ty''</span> <span class="main">=</span> Some True<span class="main">⟧</span>
       <span class="main">⟹</span> is_sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty''</span> <span class="main">=</span> Some True"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ty.splits option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path ctx dcl path' ctx' dcl'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx dcl ctx' cld' ctx'' cld''<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fpr_mid_path<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">is_sty_many</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"P <span class="main">⇒</span> tys <span class="main">⇒</span> tys <span class="main">⇒</span> bool option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_sty_many</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">tys</span></span></span> <span class="free"><span class="bound"><span class="entity">tys'</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">tys</span></span></span> <span class="main">≠</span> length <span class="free"><span class="bound"><span class="entity">tys'</span></span></span> <span class="keyword1">then</span> None <span class="keyword1">else</span>
  <span class="main">(</span><span class="keyword1">case</span> lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ty</span><span class="main">,</span> <span class="bound">ty'</span><span class="main">)</span><span class="main">.</span> is_sty_one <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ty</span> <span class="bound">ty'</span><span class="main">)</span> <span class="main">(</span>zip <span class="free"><span class="bound"><span class="entity">tys</span></span></span> <span class="free"><span class="bound"><span class="entity">tys'</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">bools</span> <span class="main">⇒</span> Some <span class="main">(</span>list_all id <span class="bound">bools</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">ty_ty'_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ty</span><span class="main">,</span> <span class="bound">ty'</span><span class="main">)</span><span class="main">.</span> is_sty_one <span class="free">P</span> <span class="bound">ty</span> <span class="bound">ty'</span> <span class="main">=</span> Some True<span class="main">)</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bools</span><span class="main">.</span> lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ty</span><span class="main">,</span> <span class="bound">ty'</span><span class="main">)</span><span class="main">.</span> is_sty_one <span class="free">P</span> <span class="bound">ty</span> <span class="bound">ty'</span><span class="main">)</span> <span class="free">ty_ty'_list</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">bools</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ty_ty'_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_all_true<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bools</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">ty_ty'_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ty</span><span class="main">,</span> <span class="bound">ty'</span><span class="main">)</span><span class="main">.</span> is_sty_one <span class="free">P</span> <span class="bound">ty</span> <span class="bound">ty'</span> <span class="main">=</span> Some True<span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
            lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ty</span><span class="main">,</span> <span class="bound">ty'</span><span class="main">)</span><span class="main">.</span> is_sty_one <span class="free">P</span> <span class="bound">ty</span> <span class="bound">ty'</span><span class="main">)</span> <span class="free">ty_ty'_list</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">bools</span>
                  <span class="main">⟶</span> list_all id <span class="bound">bools</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ty_ty'_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tys_tys'_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">bools</span> <span class="bound">ty</span> <span class="bound">ty'</span><span class="main">.</span> <span class="main">⟦</span>lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> is_sty_one <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">tys_tys'_list</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">bools</span><span class="main">;</span> length <span class="free">tys</span> <span class="main">=</span> length <span class="free">tys'</span><span class="main">;</span> list_all id <span class="bound">bools</span><span class="main">;</span> <span class="main">(</span><span class="bound">ty</span><span class="main">,</span> <span class="bound">ty'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">tys_tys'_list</span><span class="main">⟧</span> <span class="main">⟹</span> is_sty_one <span class="free">P</span> <span class="bound">ty</span> <span class="bound">ty'</span> <span class="main">=</span> Some True"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">tys_tys'_list</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sty_many <span class="free">P</span> <span class="free">tys</span> <span class="free">tys'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_sty_many <span class="free">P</span> <span class="free">tys</span> <span class="free">tys'</span> <span class="main">=</span> Some True<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_many.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_many_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_opts_exists<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lift_opts_all_true<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_many_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty_ty'_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"zip <span class="free">tys</span> <span class="free">tys'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_manyI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_fst_zip<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_snd_zip<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tys_tys'_list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* TODO: here will go all the other definitions for functions equivalent to
   relations concerning well-formedness *)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">tr_x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"T <span class="main">⇒</span> x <span class="main">⇒</span> x"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tr_x</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">tr_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"T <span class="main">⇒</span> var <span class="main">⇒</span> var"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tr_var</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>x_var <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="keyword1">of</span> x_this <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">|</span> x_var <span class="bound">var'</span> <span class="main">⇒</span> <span class="bound">var'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">tr_s_f</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"T <span class="main">⇒</span> s <span class="main">⇒</span> s"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="entity">tr_ss_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"T <span class="main">⇒</span> s list <span class="main">⇒</span> s list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_block <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span>        <span class="main">=</span> s_block <span class="main">(</span><span class="free">tr_ss_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_ass <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>       <span class="main">=</span> s_ass <span class="main">(</span>tr_var <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_read <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>    <span class="main">=</span> s_read <span class="main">(</span>tr_var <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_write <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>     <span class="main">=</span> s_write <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_if <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>    <span class="main">=</span> s_if <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_call <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> s_call <span class="main">(</span>tr_var <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>map <span class="main">(</span>tr_x <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>s_new <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span><span class="main">)</span>  <span class="main">=</span> s_new <span class="main">(</span>tr_var <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ctx</span></span></span> <span class="free"><span class="bound"><span class="entity">cl</span></span></span>"</span></span> <span class="main">|</span>

<span class="quoted"><span class="quoted">"<span class="free">tr_ss_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tr_ss_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">tr_s_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">#</span> <span class="free">tr_ss_f</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">s_s'_list</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s_XXX</span><span class="main">,</span> <span class="bound">s_'</span><span class="main">)</span> <span class="main">⇒</span> tr_s <span class="free">T</span> <span class="bound">s_XXX</span> <span class="bound">s_'</span> <span class="main">∧</span> tr_s_f <span class="free">T</span> <span class="bound">s_XXX</span> <span class="main">=</span> <span class="bound">s_'</span><span class="main">)</span> <span class="main">⟶</span>
       tr_ss_f <span class="free">T</span> <span class="main">(</span>map fst <span class="free">s_s'_list</span><span class="main">)</span> <span class="main">=</span> map snd <span class="free">s_s'_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s_s'_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_y'_list</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">y_XXX</span><span class="main">.</span> <span class="main">(=)</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">T</span> <span class="bound">y_XXX</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">y_XXX</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> map <span class="main">(</span>tr_x <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">y_y'_list</span><span class="main">)</span> <span class="main">=</span> map snd <span class="free">y_y'_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_y'_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_zip_tr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">ss</span> <span class="main">(</span>tr_ss_f <span class="free">T</span> <span class="free">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s'</span> <span class="main">=</span> tr_s_f <span class="free">T</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> length <span class="main">(</span>tr_ss_f <span class="free">T</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tr_ss_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tr_ss_f <span class="free">T</span> <span class="main">(</span>map fst <span class="free">s_s'_list</span><span class="main">)</span> <span class="main">=</span> map snd <span class="free">s_s'_list</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">s_s'_list</span><span class="main">.</span> case_prod <span class="main">(</span>tr_s <span class="free">T</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">s_s'_list</span> <span class="main">⟶</span> tr_s <span class="free">T</span> <span class="free">a</span> <span class="main">(</span>tr_s_f <span class="free">T</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s_s'_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tr_f_to_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> tr_s_f <span class="free">T</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">s'</span> <span class="main">⟶</span> tr_s <span class="free">T</span> <span class="free">s</span> <span class="bound">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tr_s_f.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_s_var_assignI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def tr_var_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_s_field_readI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def tr_var_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_s_field_writeI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tr_s_f.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_s_ifI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_s_newI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def tr_var_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> var x m ys<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> var <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> var' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tr_var <span class="free">T</span> <span class="improper">var</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
              x' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tr_x <span class="free">T</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y_y'_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"zip <span class="improper">ys</span> <span class="main">(</span>map <span class="main">(</span>tr_x <span class="free">T</span><span class="main">)</span> <span class="improper">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
              meth <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tr_s_mcallI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def tr_var_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tr_x_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip tr_x_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s_s'_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tr_s_blockI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s ss<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s_s'_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span><span class="improper">s</span> <span class="main">#</span> <span class="improper">ss</span><span class="main">)</span> <span class="main">(</span>tr_s_f <span class="free">T</span> <span class="improper">s</span> <span class="main">#</span> tr_ss_f <span class="free">T</span> <span class="improper">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tr_s_blockI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x x'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> set_zip_tr<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> mp<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> in_set_zipE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a1.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?a2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"s_block <span class="improper">ss</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?a3.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"s_block <span class="main">(</span>tr_ss_f <span class="free">T</span> <span class="improper">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tr_s.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_ss_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> mp<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> tr_rel_f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>tr_s <span class="free">T</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_s_f <span class="free">T</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_x_def tr_var_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tr_f_to_rel<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lightweight_Java_Proof">
<div class="head">
<h1>Theory Lightweight_Java_Proof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Lightweight Java, the proof
    Authors:     Rok Strnisa &lt;rok@strnisa.com&gt;, 2006
                 Matthew Parkinson &lt;matt@matthewp.com&gt;, 2006
    Maintainer:  
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Lightweight_Java_Proof
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Lightweight_Java_Equivalence.html">Lightweight_Java_Equivalence</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Infinite_Set.html">HOL-Library.Infinite_Set</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> wf_intros <span class="main">=</span> wf_object_wf_varstate_wf_heap_wf_config_wf_stmt_wf_meth_wf_class_common_wf_class_wf_program.intros <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_induct <span class="main">=</span> wf_object_wf_varstate_wf_heap_wf_config_wf_stmt_wf_meth_wf_class_common_wf_class_wf_program.induct <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_config_normalI <span class="main">=</span> wf_object_wf_varstate_wf_heap_wf_config_wf_stmt_wf_meth_wf_class_common_wf_class_wf_program.wf_allI <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_objectE   <span class="main">=</span> wf_object.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_varstateE <span class="main">=</span> wf_varstate.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_heapE     <span class="main">=</span> wf_heap.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_configE   <span class="main">=</span> wf_config.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_stmtE     <span class="main">=</span> wf_stmt.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_methE     <span class="main">=</span> wf_meth.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_class_cE  <span class="main">=</span> wf_class_common.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_classE    <span class="main">=</span> wf_class.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> wf_programE  <span class="main">=</span> wf_program.cases<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_subvarstateI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_varstate <span class="free">P</span> <span class="free">Γ</span> <span class="free">H</span> <span class="free">L</span><span class="main">;</span> <span class="free">Γ</span> <span class="free">x'</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">;</span>
    wf_object <span class="free">P</span> <span class="free">H</span> <span class="main">(</span>Some <span class="free">v</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">ty</span><span class="main">)</span><span class="main">⟧</span>
        <span class="main">⟹</span> wf_varstate <span class="free">P</span> <span class="free">Γ</span> <span class="free">H</span> <span class="main">(</span><span class="free">L</span> <span class="main">(</span><span class="free">x'</span> <span class="main">↦</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_varstateI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_super_varstate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">x'</span> <span class="main">↦</span> v_oid <span class="free">oid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> finite <span class="main">(</span>dom <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free">x'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">x'</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_disj_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def dom_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">aa</span><span class="main">.</span> <span class="bound">aa</span> <span class="main">≠</span> x_var <span class="improper">a</span> <span class="main">⟶</span> <span class="bound">aa</span> <span class="main">≠</span> <span class="free">x'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> case_option <span class="main">(</span><span class="free">L</span> <span class="bound">aa</span><span class="main">)</span> Some <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="improper">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                   <span class="main">{</span><span class="bound">aa</span><span class="main">.</span> <span class="bound">aa</span> <span class="main">=</span> x_var <span class="improper">a</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">aa</span> <span class="main">=</span> <span class="free">x'</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> case_option <span class="main">(</span><span class="free">L</span> <span class="bound">aa</span><span class="main">)</span> Some <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="improper">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="bound">aa</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_disj_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_map_elem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_ty_var_var'_v_list</span> <span class="main">⟹</span>
      x_var <span class="free">var'_k</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_ty_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_add_x_var<span class="main">[</span><span class="operator">THEN</span> mp<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">var'</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">⟶</span>
   x_var <span class="free">var'</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_map_and_x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">ty_x</span><span class="main">;</span> <span class="free">L</span> <span class="free">x'</span> <span class="main">=</span> None<span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_cl_var_var'_v_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="bound">x</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>Map.dom <span class="free">Γ</span><span class="main">.</span> wf_object <span class="free">Pa</span> <span class="free">H</span> <span class="main">(</span><span class="free">L</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Γ</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x'</span> <span class="keyword1">then</span> Some <span class="free">ty</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
          Some <span class="free">ty_x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">x'</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">.</span> x_var <span class="bound">var'</span> <span class="main">≠</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y cl var var' v y' ty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y</span><span class="main">,</span> <span class="improper">cl</span><span class="main">,</span> <span class="improper">var</span><span class="main">,</span> <span class="improper">var'</span><span class="main">,</span> <span class="improper">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"x_var <span class="improper">var'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> wf_objectE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_stmt_in_G'<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="free">x'</span> <span class="main">=</span> None <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_cl_var_var'_v_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>dom <span class="free">Γ</span><span class="main">.</span> wf_object <span class="free">P</span> <span class="free">H</span> <span class="main">(</span><span class="free">L</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Γ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> wf_stmt <span class="free">P</span> <span class="free">Γ</span> <span class="free">s</span> <span class="main">⟶</span>
       wf_stmt <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">x'</span> <span class="main">↦</span> <span class="free">ty</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">L</span> <span class="free">x'</span> <span class="main">=</span> None <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_cl_var_var'_v_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>dom <span class="free">Γ</span><span class="main">.</span> wf_object <span class="free">P</span> <span class="free">H</span> <span class="main">(</span><span class="free">L</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Γ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> wf_stmt <span class="free">P</span> <span class="free">Γ</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> wf_stmt <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">x'</span> <span class="main">↦</span> <span class="free">ty</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tr_s_f_tr_ss_f.induct<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_blockI<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_var_assignI sty_optionI<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_field_readI sty_optionI<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_field_writeI sty_optionI<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_ifI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_newI sty_optionI<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_mcallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k ty_k<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">ty_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a3.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Some <span class="improper">ty_k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_option.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_three_in_four<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">var_k</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>
   <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="bound">cl</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">cl_var_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y_k</span> <span class="bound">cl'_k</span> <span class="bound">u_k</span><span class="main">.</span> <span class="main">(</span><span class="bound">y_k</span><span class="main">,</span> <span class="bound">cl'_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="bound">u_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">var_k</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_three_in_four<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_one_in_two<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">y_ty_list</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="free">y_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_two_in_two<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">y_ty_list</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="free">y_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_two_in_three<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">cl_var_ty_list</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_var_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_three_in_three<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">cl_var_ty_list</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_var_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_three_in_four<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_one_in_five<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_three_in_five<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_length_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> length <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_length_y<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span> <span class="main">⟹</span>
   length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> length_one_in_five length_one_in_two<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_length_y'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map fst <span class="free">y_y'_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span> <span class="main">⟹</span> length <span class="free">y_y'_list</span> <span class="main">=</span> length <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> length_one_in_two length_two_in_two<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_length_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">⟹</span>
   length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="free">cl_var_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> length_three_in_five length_two_in_three<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_length_ty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span> <span class="main">⟹</span>
   length <span class="free">cl_var_ty_list</span> <span class="main">=</span> length <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> length_three_in_three length_two_in_two<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_length_var_ty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">⟧</span> <span class="main">⟹</span>
   length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cl_var_ty_list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> length_three_in_four length_two_in_three<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> length_three_in_three length_two_in_two<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fun_eq_fst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fst_zip_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">⟹</span>
   <span class="main">(</span>map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_x_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">=</span>
   distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contrapos_np<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_x_var'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">=</span>
   distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contrapos_np<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_fst_two<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">=</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fst_two'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">=</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fst_var'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_fst_two' distinct_x_var'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">⟧</span> <span class="main">⟹</span>
      distinct <span class="main">(</span>map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_fst_two distinct_x_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_var'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">⟧</span> <span class="main">⟹</span>
    distinct <span class="main">(</span>map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_length_var_ty fst_zip_eq distinct_x_var'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_list_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_list_fd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="free">list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_list_y<span class="main">:</span>
 <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span>
  map fst <span class="free">y_cl_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_cld_from_lu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> find_cld <span class="free">P</span> <span class="free">ctx</span> <span class="free">fqn</span> <span class="main">(</span>Some <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> wf_class <span class="free">P</span> <span class="free">cld'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> find_to_mem<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_programE<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> meth_def_in_set<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_meth_def_in_list <span class="free">meth_defs</span> <span class="free">meth</span> <span class="main">(</span>Some <span class="free">meth_def</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">meth_def</span> <span class="main">∈</span> set <span class="free">meth_defs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">meth_defs</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> find_meth_def_in_list_mem<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_meth_def_in_list_f <span class="free">meth_defs</span> <span class="free">meth</span> <span class="main">=</span> Some <span class="free">meth_def</span> <span class="main">⟶</span> <span class="free">meth_def</span> <span class="main">∈</span> set <span class="free">meth_defs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">meth_defs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_meth_def_in_path_ex_cld<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"find_meth_def_in_path_f <span class="free">ctxclds</span> <span class="free">meth</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">meth_def</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cld</span> <span class="bound">meth_defs</span><span class="main">.</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ctxclds</span> <span class="main">∧</span> class_methods_f <span class="bound">cld</span> <span class="main">=</span> <span class="bound">meth_defs</span> <span class="main">∧</span> <span class="free">meth_def</span> <span class="main">∈</span> set <span class="bound">meth_defs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cld</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_ctx_cld_dcl_two<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ctxclds</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> <span class="bound">dcl</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> <span class="free">classname_f</span> <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="free">ctxclds</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> clds_in_path_exist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="free">fqn</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">.</span> <span class="bound">cld</span> <span class="main">∈</span> set <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> all_in_path_found<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> find_to_mem<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_meth_defs_in_wf_class<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">meth_def</span> <span class="main">∈</span> set <span class="main">(</span>class_methods_f <span class="free">cld</span><span class="main">)</span> <span class="main">∧</span> wf_class <span class="free">P</span> <span class="free">cld</span> 
     <span class="main">⟶</span> wf_meth <span class="free">P</span> <span class="main">(</span>ty_def ctx_def <span class="main">(</span>class_name_f <span class="free">cld</span><span class="main">)</span><span class="main">)</span> <span class="free">meth_def</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_classE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> class_methods_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_class_cE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> class_name_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_ctxclds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ctxclds</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">,</span> <span class="bound">cld_XXX</span><span class="main">,</span> <span class="bound">dcl_XXX</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx_XXX</span><span class="main">,</span> <span class="bound">cld_XXX</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ctxclds</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ctxclds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_method_from_find'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_program <span class="free">P</span> <span class="main">∧</span> find_path_ty_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctxa</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ctxclds</span> <span class="main">∧</span> find_meth_def_in_path_f <span class="free">ctxclds</span> <span class="free">meth</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">meth_def</span><span class="main">)</span>
       <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">dcla</span><span class="main">.</span> is_sty_one <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctxa</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">(</span>ty_def <span class="free">ctx</span> <span class="bound">dcla</span><span class="main">)</span> <span class="main">=</span> Some True <span class="main">∧</span> wf_meth <span class="free">P</span> <span class="main">(</span>ty_def ctx_def <span class="bound">dcla</span><span class="main">)</span> <span class="free">meth_def</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> find_meth_def_in_path_ex_cld<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"class_name_f <span class="improper">cld</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ctx_cld_dcl_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">,</span> class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span> <span class="free">ctxclds</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_dclI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_ctxclds<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> clds_in_path_exist<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_programE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="improper">cld</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cld</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_meth_defs_in_wf_class<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="comment1">(* fix the ctx problem here… *)</span>
<span class="keyword1"><span class="command">lemma</span></span> wf_method_from_find<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> find_meth_def <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">meth</span> <span class="main">(</span>Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">meth_def</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">dcl</span><span class="main">.</span> sty_one <span class="free">P</span> <span class="free">ty_x_d</span> <span class="main">(</span>ty_def <span class="free">ctx</span> <span class="bound">dcl</span><span class="main">)</span> <span class="main">∧</span> wf_meth <span class="free">P</span> <span class="main">(</span>ty_def ctx_def <span class="bound">dcl</span><span class="main">)</span> <span class="free">meth_def</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> find_meth_def.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ty_x_d</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx' dcl' ctxclds<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctxa <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> dcl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">dcl'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctxclds <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctxclds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
              meth <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">meth</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> meth_def <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">meth_def</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_method_from_find'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_type_lift_opts<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cl_var_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">cl_k</span> <span class="main">=</span> Some <span class="bound">ty_k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span>
      lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl_k</span> <span class="bound">var_k</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_var_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> find_md_in_pre_path<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_meth_def_in_path_f <span class="free">path</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">ctxmd</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">path'</span><span class="main">.</span> find_meth_def_in_path_f <span class="main">(</span><span class="free">path</span> <span class="main">@</span> <span class="bound">path'</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">ctxmd</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cl_var_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">cl_k</span> <span class="main">=</span> Some <span class="bound">ty_k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⟹</span>
      lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl_k</span> <span class="bound">var_k</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_var_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> m_in_list<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">meth_def_meth_list</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">meth_def</span><span class="main">.</span> <span class="main">(=)</span> <span class="main">(</span>method_name_f <span class="bound">meth_def</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
   find_meth_def_in_list_f <span class="main">(</span>map fst <span class="free">meth_def_meth_list</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">md</span> <span class="main">⟶</span>
       <span class="free">m</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="free">meth_def_meth_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">meth_def_meth_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> method_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> meth_def.splits meth_sig.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> m_image_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"meth_def_def <span class="main">(</span>meth_sig_def <span class="free">cl</span> <span class="free">m</span> <span class="free">list2</span><span class="main">)</span> <span class="free">meth_body</span> <span class="main">∈</span> set <span class="free">meth_defs</span> <span class="main">⟶</span>
      <span class="free">m</span> <span class="main">∈</span> case_meth_def <span class="main">(</span><span class="main">λ</span><span class="bound">meth_sig</span> <span class="bound">meth_body</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">meth_sig</span> <span class="keyword1">of</span> meth_sig_def <span class="bound">cl</span> <span class="bound">meth</span> <span class="bound">vds</span> <span class="main">⇒</span> <span class="bound">meth</span><span class="main">)</span> <span class="main">`</span> set <span class="free">meth_defs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">meth_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fmdip_to_mip<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_meth_def_in_path_f <span class="free">path</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">ctxmd</span> <span class="main">⟶</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>methods_in_path_f <span class="main">(</span>map snd <span class="free">path</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits cld.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> aa bb<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">aa</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> meth_sig meth_body<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">meth_sig</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_md_m_match'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_meth_def_in_list_mem<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> m_image_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_for_all<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cl_var_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> ctx_def <span class="bound">cl</span> <span class="main">=</span> Some <span class="bound">ty</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_var_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ctx</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mty_preservation''''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>fqn_def <span class="free">dcl'</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="free">fds'</span> <span class="free">mds'</span><span class="main">)</span><span class="main">;</span>
    find_cld_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>fqn_def <span class="free">dcl''</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl''</span> <span class="free">cl''</span> <span class="free">fds''</span> <span class="free">mds''</span><span class="main">)</span><span class="main">;</span>
    find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl''</span> <span class="main">[</span><span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl''</span> <span class="free">cl''</span> <span class="free">fds''</span> <span class="free">mds''</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span>
    find_meth_def_in_path_f <span class="free">path</span> <span class="free">m</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx''</span><span class="main">,</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="free">cl_r</span> <span class="free">m'</span> <span class="free">vds</span><span class="main">)</span> <span class="free">mb</span><span class="main">)</span><span class="main">;</span>
    find_type_f <span class="free">P</span> <span class="free">ctx''</span> <span class="free">cl_r</span> <span class="main">=</span> Some <span class="free">ty_r</span><span class="main">;</span> lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx''</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tys</span><span class="main">;</span>
    lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx'</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="free">vds'</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">tys'</span><span class="main">;</span> find_type_f <span class="free">P</span> <span class="free">ctx'</span> <span class="free">cl_r'</span> <span class="main">=</span> Some <span class="free">ty_r'</span><span class="main">;</span>
    find_meth_def_in_path_f <span class="main">(</span><span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="free">fds'</span> <span class="free">mds'</span><span class="main">)</span> <span class="main">#</span> <span class="free">path</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="free">cl_r'</span> <span class="free">m''</span> <span class="free">vds'</span><span class="main">)</span> <span class="free">mb'</span><span class="main">)</span><span class="main">;</span>
    wf_program <span class="free">P</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="free">tys'</span> <span class="main">=</span> <span class="free">tys</span> <span class="main">∧</span> <span class="free">ty_r'</span> <span class="main">=</span> <span class="free">ty_r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">hypsubst_thin</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">true</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> wf_cld_from_lu<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_classE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_class_cE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="improper">meth_def_meth_list</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> md_m m<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="improper"><span class="improper"><span class="improper">md_m</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="improper"><span class="improper"><span class="improper">m</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ctx'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">md_m</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> meth_sig meth_body<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">meth_sig</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ms mb_m cl_r_m m vds_m<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> method_name_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">tys'</span> <span class="main">=</span> <span class="free">tys</span> <span class="main">⟶</span> <span class="free">ty_r'</span> <span class="main">≠</span> <span class="free">ty_r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contrapos_pp<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> methods_f_def find_path_f_def superclass_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fmdip_to_mip<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m mty mty'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="improper"><span class="improper"><span class="improper"><span class="improper">m</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="improper"><span class="improper"><span class="improper"><span class="improper">mty</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="improper"><span class="improper"><span class="improper"><span class="improper">mty'</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted">snd</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> imageI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="improper">meth_def_meth_list</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits meth_def.splits meth_sig.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def find_path_f_def superclass_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ad<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ad</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> prefix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>ctx_def<span class="main">,</span> cld_def <span class="free">dcl''</span> <span class="free">cl''</span> <span class="free">fds''</span> <span class="free">mds''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
                 prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>ctx_def<span class="main">,</span> cld_def <span class="free">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="improper">cl_f_ty_list</span><span class="main">)</span> <span class="main">(</span>map fst <span class="improper">meth_def_meth_list</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                 <span class="main">(</span>ctx_def<span class="main">,</span> cld_def <span class="free">dcl''</span> <span class="free">cl''</span> <span class="free">fds''</span> <span class="free">mds''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> m_in_list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mty_preservation'''<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">suffix</span> <span class="bound">dcl</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">prefix</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">prefix</span> <span class="main">@</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span> wf_program <span class="free">P</span> <span class="main">∧</span> <span class="free">cl</span> <span class="main">=</span> cl_fqn <span class="main">(</span>fqn_def <span class="bound">dcl</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld'</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">suffix</span><span class="main">.</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="bound">ctx'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
               mtype_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="bound">ctx'</span> <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span> <span class="main">⟶</span> mtype_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctx</span> <span class="bound">dcl</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">prefix</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> find_cld_name_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl' cl' fds' mds'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">cl'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> fqn<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fqn</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl''<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">aa</span> <span class="bound">b</span> <span class="bound">ab</span> <span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">ab</span> <span class="main">∧</span> cld_def <span class="improper">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="improper">fds'</span> <span class="improper">mds'</span> <span class="main">=</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="bound">ab</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">bb</span><span class="main">)</span>
                      <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">ab</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">bb</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ab</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">ab</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                                  <span class="main">(</span><span class="main">∀</span><span class="bound">dcl</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">bb</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="main">=</span> cl_fqn <span class="main">(</span>fqn_def <span class="bound">dcl</span><span class="main">)</span> <span class="main">⟶</span>
                                         <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                                             <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld'</span><span class="main">)</span><span class="main">.</span>
                                                 <span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
                                                     case_option None <span class="main">(</span>case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">ctx'</span> <span class="bound">cld</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                                     Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                                 mtype_f <span class="improper">P</span> <span class="main">(</span>ty_def <span class="bound">ctx'</span> <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span> <span class="main">⟶</span>
                                                 mtype_f <span class="improper">P</span> <span class="main">(</span>ty_def <span class="bound">ab</span> <span class="bound">dcl</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span><span class="main">)</span>
                                              <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">aa</span> <span class="bound">b</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
           <span class="main">⟦</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">∧</span> cld_def <span class="improper">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="improper">fds'</span> <span class="improper">mds'</span> <span class="main">=</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">b</span><span class="main">⟧</span>
           <span class="main">⟹</span> <span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span>
                 find_path_rec_f <span class="improper">P</span> <span class="bound">aa</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">b</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
                 Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">dcl</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">b</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="main">=</span> cl_fqn <span class="main">(</span>fqn_def <span class="bound">dcl</span><span class="main">)</span> <span class="main">⟶</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                            <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span>
                            <span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld'</span><span class="main">)</span> <span class="main">⇒</span>
                              <span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
                                  case_option None
                                   <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span>
                                       find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span>
                                        <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                  Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                              mtype_f <span class="improper">P</span> <span class="main">(</span>ty_def <span class="bound">ctx'</span> <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span> <span class="main">⟶</span>
                              mtype_f <span class="improper">P</span> <span class="main">(</span>ty_def <span class="bound">aa</span> <span class="bound">dcl</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">aa</span><span class="main">,</span> <span class="improper">ba</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="improper">ab</span> <span class="main">(</span><span class="keyword1">case</span> <span class="improper">bb</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> <span class="improper">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prefix</span> <span class="bound">suffix'</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">prefix</span> <span class="bound">suffix'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">P</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"mtype_f <span class="improper">P</span> <span class="main">(</span>ty_def <span class="improper">aa</span> <span class="main">(</span>class_name_f <span class="improper">ba</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits meth_def.splits meth_sig.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">path'</span><span class="main">.</span> find_path_f <span class="improper">P</span> <span class="improper">a</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">path'</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def superclass_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> meth_body cl list_char1 list_vd ty list_ty list_char2 cla list_fd list_md list_p1 path'<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ag ah<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ag</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="improper">ac</span><span class="main">,</span> cld_def <span class="improper">list_char2</span> <span class="improper">cla</span> <span class="improper">list_fd</span> <span class="improper">list_md</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_methods_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def superclass_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">a</span><span class="main">,</span> cld_def <span class="improper">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="improper">fds'</span> <span class="improper">mds'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="improper">ac</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="improper">a</span><span class="main">,</span> cld_def <span class="improper">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="improper">fds'</span> <span class="improper">mds'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="improper">ac</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ty_x_d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ty_def <span class="improper">a</span> <span class="improper">dcl'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_method_from_find<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_methE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ag ah ai aj ak al am an ao ap aq ar as at au av<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ag</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ty_x_d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ty_def <span class="improper">a</span> <span class="improper">dcl'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_method_from_find<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_methE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> lift_opts_for_all<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"find_path_rec_f <span class="improper">P</span> <span class="improper">ab</span> <span class="main">(</span><span class="keyword1">case</span> <span class="improper">bb</span> <span class="keyword1">of</span> cld_def <span class="bound">dcl</span> <span class="bound">cl</span> <span class="bound">fds</span> <span class="bound">mds</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="main">(</span><span class="improper">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> <span class="improper">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">prefix'</span> <span class="main">@</span> <span class="improper">suffix'</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"find_cld_f <span class="improper">P</span> <span class="improper">aa</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="improper">ba</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">ab</span><span class="main">,</span> <span class="improper">bb</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">aa</span><span class="main">,</span> <span class="improper">ba</span><span class="main">)</span> <span class="main">∈</span> set <span class="improper">path''</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> dcl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">dcl''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx ctx'' mb cl_r m' vds ty_r tys ctx' cl_r' m'' vds' ty_r' tys' mb' dcl'' cl'' fds'' mds''<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def find_path_f_def superclass_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"find_path_rec_f <span class="improper">P</span> <span class="improper">ctx</span> <span class="improper">cl''</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ctx</span><span class="main">,</span> cld_def <span class="improper">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="improper">fds'</span> <span class="improper">mds'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="improper">ctx</span><span class="main">,</span> cld_def <span class="improper">dcl''</span> <span class="improper">cl''</span> <span class="improper">fds''</span> <span class="improper">mds''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="improper">ctx</span><span class="main">,</span> cld_def <span class="improper">dcl'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl''</span><span class="main">)</span><span class="main">)</span> <span class="improper">fds'</span> <span class="improper">mds'</span><span class="main">)</span> <span class="main">#</span> <span class="improper">path''</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path'' path'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="improper">ctx</span><span class="main">,</span> cld_def <span class="improper">dcl''</span> <span class="improper">cl''</span> <span class="improper">fds''</span> <span class="improper">mds''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> find_meth_def_in_path_f.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path''<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ctx' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">m''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> fds'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">fds''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
                 path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">ctx</span><span class="main">,</span> cld_def <span class="improper">dcl''</span> <span class="improper">cl''</span> <span class="improper">fds''</span> <span class="improper">mds''</span><span class="main">)</span> <span class="main">#</span> <span class="improper">path''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mty_preservation''''<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">prefix'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mty_preservation''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free">dcl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">⟧</span> <span class="main">⟹</span>
     <span class="main">∀</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
        find_path_rec_f <span class="free">P</span> <span class="free">ctx'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
        mtype_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctx'</span> <span class="main">(</span>class_name_f <span class="free">cld'</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span> <span class="main">⟶</span> mtype_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctx</span> <span class="free">dcl</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mty_preservation'''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mty_preservation'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="free">dcl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">;</span>
    find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path'</span><span class="main">;</span> mtype_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctx'</span> <span class="main">(</span>class_name_f <span class="free">cld'</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span><span class="main">⟧</span>
        <span class="main">⟹</span> mtype_f <span class="free">P</span> <span class="main">(</span>ty_def <span class="free">ctx</span> <span class="free">dcl</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">mty</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mty_preservation''<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_for_all_true<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y_ty_list</span><span class="main">.</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cl_var_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">cl_k</span> <span class="main">=</span> Some <span class="bound">ty_k</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
      lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl_k</span> <span class="bound">var_k</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>map snd <span class="bound">y_ty_list</span><span class="main">)</span> <span class="main">⟶</span>
          map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="bound">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_var_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mty_preservation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span>
    find_meth_def_f <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">meth</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="free">cl_r</span> <span class="free">meth</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl_k</span> <span class="bound">var_k</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="free">meth_body</span><span class="main">)</span><span class="main">;</span>
    find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl_r</span> <span class="main">=</span> Some <span class="free">ty_r_d</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cl_var_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl_k</span><span class="main">,</span> <span class="bound">var_k</span><span class="main">,</span> <span class="bound">ty_k</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="bound">cl_k</span> <span class="main">=</span> Some <span class="bound">ty_k</span><span class="main">)</span> <span class="bound">x</span><span class="main">;</span>
    mtype_f <span class="free">P</span> <span class="free">ty_x_s</span> <span class="free">meth</span> <span class="main">=</span> Some <span class="main">(</span>mty_def <span class="main">(</span>map snd <span class="free">y_ty_list</span><span class="main">)</span> <span class="free">ty_r_s</span><span class="main">)</span><span class="main">;</span> is_sty_one <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">ty_x_s</span> <span class="main">=</span> Some True<span class="main">⟧</span>
       <span class="main">⟹</span> <span class="free">ty_r_d</span> <span class="main">=</span> <span class="free">ty_r_s</span> <span class="main">∧</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">ty_x_d</span> <span class="main">=</span> <span class="free">ty_x_s</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def find_type_lift_opts<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_s</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def find_meth_def_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path_d ctx_s cld_s<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_d</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx_d dcl_d<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">path_s</span><span class="main">.</span> find_path_f <span class="free">P</span> <span class="improper">ctx_s</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="improper">cld_s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">path_s</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path_d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path_s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mty_preservation'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits meth_def.splits meth_sig.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> lift_opts_for_all_true<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def find_meth_def_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_mem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_ty_var_var'_v_list</span><span class="main">;</span> <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_ty_var_var'_v_list</span><span class="main">⟧</span>
         <span class="main">⟹</span> x_var <span class="free">var'_k</span> <span class="main">≠</span> <span class="free">x'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fst<span class="main">:</span>
   <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="free">y_ty_var_var'_v_list</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="free">y_ty_var_var'_v_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> supertype_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sty_one <span class="free">P</span> <span class="free">ty</span> <span class="free">ty'</span> <span class="main">⟹</span> <span class="free">ty</span> <span class="main">=</span> ty_top <span class="main">⟶</span> <span class="free">ty'</span> <span class="main">=</span> ty_top"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sty_one.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> top_not_subtype<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sty_one <span class="free">P</span> ty_top <span class="main">(</span>ty_def <span class="free">ctx</span> <span class="free">dcl</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> supertype_top<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_in_found_fds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ftype_in_fds_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">fds</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt <span class="main">(</span>Some <span class="free">ty_f</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">∈</span> case_fd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="main">`</span> set <span class="free">fds</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fd.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_fields<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ftype_in_path_f <span class="free">P</span> <span class="free">path_s</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty_f</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="free">path_s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path_s</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx path_s dcl cl fds mds<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_fields_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ty_opt_bot.splits option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_in_found_fds<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_field_hiding'''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">prefix</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">prefix</span> <span class="main">@</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span> wf_program <span class="free">P</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">suffix</span><span class="main">.</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="bound">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
               <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">prefix</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">aa</span> <span class="bound">ba</span> <span class="bound">aaa</span> <span class="bound">bb</span><span class="main">.</span>
           <span class="main">(</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">aaa</span> <span class="main">∧</span> <span class="improper">b</span> <span class="main">=</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="bound">aaa</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> <span class="bound">bb</span><span class="main">)</span>
           <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">aaa</span> <span class="main">(</span>superclass_name_f <span class="bound">bb</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">aaa</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">aaa</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                           <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
                                             case_option None <span class="main">(</span>case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">ctx'</span> <span class="bound">cld</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                             Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
                                             <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                                         <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix</span><span class="main">)</span><span class="main">)</span>
                            <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">_</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">aa</span> <span class="bound">ba</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
           <span class="main">⟦</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">∧</span> <span class="improper">b</span> <span class="main">=</span> <span class="bound">ba</span><span class="main">;</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">ba</span><span class="main">⟧</span>
           <span class="main">⟹</span> <span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span>
                 find_path_rec_f <span class="improper">P</span> <span class="bound">aa</span> <span class="main">(</span>superclass_name_f <span class="bound">ba</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
                 Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                     <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span>
                     <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">⇒</span>
                       <span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
                           case_option None
                            <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span>
                                find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                           Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
                           <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tl <span class="improper">suffix</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fqn</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fmdip_cons <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> find_cld_name_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fmdip_cons <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> list1 cl list2 list3<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">prefix'</span> <span class="main">@</span> <span class="improper">suffix'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fmdip_cons<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> prefix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> cld_def <span class="improper">list1</span> <span class="improper">cl</span> <span class="improper">list2</span> <span class="improper">list3</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
                 prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> cld_def <span class="improper">list1</span> <span class="improper">cl</span> <span class="improper">list2</span> <span class="improper">list3</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">aa</span><span class="main">,</span> <span class="improper">ba</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_field_hiding''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">suffix</span><span class="main">;</span> wf_program <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">suffix</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">∀</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
            find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="bound">suffix'</span><span class="main">)</span> <span class="main">⟶</span>
                        <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="free">suffix</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_field_hiding'''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_field_hiding'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> wf_program <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">;</span>
    find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path'</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="free">path'</span><span class="main">)</span><span class="main">⟧</span>
         <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="free">path</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> no_field_hiding''<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_field_hiding<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> is_sty_one <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">ty_x_s</span> <span class="main">=</span> Some True<span class="main">;</span> ftype_f <span class="free">P</span> <span class="free">ty_x_s</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty_f</span><span class="main">;</span> fields_f <span class="free">P</span> <span class="free">ty_x_d</span> <span class="main">=</span> Some <span class="free">fields_oid</span><span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> set <span class="free">fields_oid</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_s</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_d</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx_s dcl_s path_d ctx_d dcl_d<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ftype_fields<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> no_field_hiding'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_fields class_name_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_pre_path<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ftype_in_path_f <span class="free">P</span> <span class="free">path_s</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty_f</span> <span class="main">⟶</span> ftype_in_path_f <span class="free">P</span> <span class="main">(</span><span class="free">path_s</span> <span class="main">@</span> <span class="free">path''</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty_f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path_s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits ty_opt_bot.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fields_non_intersection<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="main">`</span> set <span class="free">cl_f_ty_list</span> <span class="main">∩</span> set <span class="main">(</span>fields_in_path_f <span class="free">path''</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
    <span class="main">∧</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="free">path''</span><span class="main">)</span>
       <span class="main">⟶</span> ftype_in_fds_f <span class="free">P</span> ctx_def <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_notin_list<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∉</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="main">⟶</span> ftype_in_fds_f <span class="free">P</span> ctx_def <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> find_path_rec_f.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemma</span></span> ftype_preservation'''''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="main">(</span><span class="free">prefix</span> <span class="main">@</span> <span class="main">[</span><span class="free">cld'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">prefix</span> <span class="main">@</span> <span class="free">cld'</span> <span class="main">#</span> <span class="free">path''</span><span class="main">)</span><span class="main">;</span>
    find_type_f <span class="free">P</span> ctx_def <span class="free">cl</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">;</span> fields_f <span class="free">P</span> <span class="free">ty</span> <span class="main">=</span> Some <span class="free">fs</span><span class="main">;</span>
    ftype_in_path_f <span class="free">P</span> <span class="free">path''</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty_f</span><span class="main">;</span>
    <span class="main">(</span>set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span>
        <span class="main">⟹</span> ftype_in_fds_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt None"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">cl</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_rec_f.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fqn.splits option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl ctx'' cld''<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ctx''</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ctx</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> prefix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">prefix</span> <span class="main">@</span> <span class="main">[</span><span class="free">cld'</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">path''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ftype_fields<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> fields_non_intersection<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">declare</span></span> find_path_rec_f.simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_preservation''''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">prefix</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">prefix</span> <span class="main">@</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span> wf_program <span class="free">P</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">suffix</span><span class="main">.</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="bound">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
               ftype_in_path_f <span class="free">P</span> <span class="bound">suffix'</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span> <span class="main">⟶</span> ftype_in_path_f <span class="free">P</span> <span class="bound">suffix</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">prefix</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">aa</span> <span class="bound">ba</span> <span class="bound">aaa</span> <span class="bound">bb</span><span class="main">.</span>
           <span class="main">(</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">aaa</span> <span class="main">∧</span> <span class="improper">b</span> <span class="main">=</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="bound">aaa</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> <span class="bound">bb</span><span class="main">)</span>
           <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">aaa</span> <span class="main">(</span>superclass_name_f <span class="bound">bb</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">aaa</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">aaa</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                           <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
                                             case_option None <span class="main">(</span>case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">ctx'</span> <span class="bound">cld</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                             Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span>
                                             ftype_in_path_f <span class="improper">P</span> <span class="bound">suffix'</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">)</span> <span class="main">⟶</span>
                                         ftype_in_path_f <span class="improper">P</span> <span class="bound">suffix</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">)</span>
                            <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">_</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tl <span class="improper">suffix</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fqn</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> find_cld_name_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list1 cl list2 list3<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">prefix'</span> <span class="main">@</span> <span class="improper">suffix'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> prefix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> cld_def <span class="improper">list1</span> <span class="improper">cl</span> <span class="improper">list2</span> <span class="improper">list3</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
                 prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> cld_def <span class="improper">list1</span> <span class="improper">cl</span> <span class="improper">list2</span> <span class="improper">list3</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> suffix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">aa</span><span class="main">,</span> <span class="improper">ba</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
            find_path_rec_f <span class="improper">P</span> <span class="improper">ab</span> <span class="main">(</span>superclass_name_f <span class="improper">bb</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">ab</span><span class="main">,</span> <span class="improper">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span> ftype_in_path_f <span class="improper">P</span> <span class="bound">suffix'</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"ftype_in_fds_f <span class="improper">P</span> <span class="improper">a</span> <span class="main">(</span>class_fields_f <span class="improper">b</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt None"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> cld' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_cld_from_lu<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_classE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_class_cE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> superclass_name_f_def class_fields_f_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ftype_preservation'''''<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_preservation'''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">suffix</span><span class="main">;</span> wf_program <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">suffix</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">∀</span><span class="bound">prefix'</span> <span class="bound">suffix'</span><span class="main">.</span>
            find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="bound">suffix'</span><span class="main">)</span> <span class="main">∧</span> ftype_in_path_f <span class="free">P</span> <span class="bound">suffix'</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span> <span class="main">⟶</span>
                        ftype_in_path_f <span class="free">P</span> <span class="free">suffix</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ftype_preservation''''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_preservation''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx'</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">path</span><span class="main">;</span> wf_program <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> <span class="free">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">;</span>
    find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">path'</span><span class="main">;</span> ftype_in_path_f <span class="free">P</span> <span class="free">path'</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span><span class="main">⟧</span>
         <span class="main">⟹</span> ftype_in_path_f <span class="free">P</span> <span class="free">path</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">ty</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> ftype_preservation'''<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> find_path_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_preservation'<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> sty_one <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">ty_x_s</span><span class="main">;</span> ftype <span class="free">P</span> <span class="free">ty_x_s</span> <span class="free">f</span> <span class="free">ty_f</span><span class="main">⟧</span>
     <span class="main">⟹</span> ftype <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">f</span> <span class="free">ty_f</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_s</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_d</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx_s dcl_s path_d ctx_d dcl_d<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path_s cl_s fds_s mds_s<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ftype_preservation''<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_preservation<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>dom <span class="free">Γ</span><span class="main">.</span> wf_object <span class="free">P</span> <span class="free">H</span> <span class="main">(</span><span class="free">L</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Γ</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">ty_x_s</span><span class="main">;</span> ftype <span class="free">P</span> <span class="free">ty_x_s</span> <span class="free">f</span> <span class="free">ty_f_s</span><span class="main">;</span>
    <span class="free">L</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>v_oid <span class="free">oid_x</span><span class="main">)</span><span class="main">;</span> <span class="free">H</span> <span class="free">oid_x</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ty_x_d</span><span class="main">,</span> <span class="free">fs_oid</span><span class="main">)</span><span class="main">;</span> ftype <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">f</span> <span class="free">ty_f_d</span><span class="main">⟧</span>
     <span class="main">⟹</span> <span class="free">ty_f_s</span> <span class="main">=</span> <span class="free">ty_f_d</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_preservation'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_f<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">cl_f_ty_list</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">cl_f_ty_list</span> <span class="main">⟶</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">cl_f_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fields_to_owner<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>fields_in_path_f <span class="free">path</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cld</span> <span class="main">∈</span> set <span class="main">(</span>map snd <span class="free">path</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">cl_f</span><span class="main">.</span> fd_def <span class="bound">cl_f</span> <span class="free">f</span> <span class="main">∈</span> set <span class="main">(</span>class_fields_f <span class="bound">cld</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cld path fd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_fields_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits cld.splits fd.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_in_fds_none<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="main">`</span> set <span class="free">cl_f_ty_list</span> <span class="main">⟶</span> ftype_in_fds_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ftype_in_fds_some<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cl_f</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="free">ty_f</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">cl_f_ty_list</span> <span class="main">∧</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="main">∧</span> find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl_f</span> <span class="main">=</span> Some <span class="free">ty_f</span>
        <span class="main">⟶</span> ftype_in_fds_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt <span class="main">(</span>Some <span class="free">ty_f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> ftype_in_fds_none<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_ty_bot<span class="main">[</span><span class="operator">THEN</span> mp<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">cl_f_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> find_type_f <span class="free">P</span> ctx_def <span class="bound">cl</span> <span class="main">=</span> Some <span class="bound">ty</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">⟶</span> ftype_in_fds_f <span class="free">P</span> <span class="free">ctx'</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">f</span> <span class="main">≠</span> ty_opt_bot_bot"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cl_f_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ctx'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="comment1">(* should get rid of ctx dependency here *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> field_has_type'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cl_f</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="free">ty_f</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">cl_f_ty_list</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span><span class="main">.</span> wf_class <span class="free">P</span> <span class="bound">cld</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="free">ctx</span><span class="main">,</span> cld_def <span class="free">dcl</span> <span class="free">cl</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">mds</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">path</span> <span class="main">∧</span>
   distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="main">∧</span>
   find_type_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl_f</span> <span class="main">=</span> Some <span class="free">ty_f</span>
           <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ty'</span><span class="main">.</span> ftype_in_path_f <span class="free">P</span> <span class="free">path</span> <span class="free">f</span> <span class="main">=</span> Some <span class="bound">ty'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">path</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span>
    <span class="quoted"><span class="quoted">"ftype_in_fds_f <span class="free">P</span> <span class="free">ctx</span> <span class="main">(</span>class_fields_f <span class="main">(</span>cld_def <span class="free">dcl</span> <span class="free">cl</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> fd_def <span class="bound">cl</span> <span class="bound">f</span><span class="main">)</span> <span class="free">cl_f_ty_list</span><span class="main">)</span> <span class="free">mds</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ty_opt_bot_opt <span class="main">(</span>Some <span class="free">ty_f</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_fields_f_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ftype_in_fds_some<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx' cld'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ftype_in_fds_f <span class="free">P</span> <span class="improper">ctx'</span> <span class="main">(</span>class_fields_f <span class="improper">cld'</span><span class="main">)</span> <span class="free">f</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_opt<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ty_opt</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_classE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_class_cE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_fields_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> no_ty_bot<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_class_wf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> <span class="free">cld</span> <span class="main">∈</span> set <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> wf_class <span class="free">P</span> <span class="free">cld</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_programE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">cld</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> field_has_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> fields <span class="free">P</span> <span class="free">ty_oid</span> <span class="main">(</span>Some <span class="free">f_list</span><span class="main">)</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> set <span class="free">f_list</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ty</span><span class="main">.</span> ftype <span class="free">P</span> <span class="free">ty_oid</span> <span class="free">f</span> <span class="bound">ty</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_oid</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dcl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fields_to_owner<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ctx' cld cl_f<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> clds_in_path_exist<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">ctx'</span><span class="main">,</span> <span class="improper">cld</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> mem_class_wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_classE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_class_cE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_fields_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl_f ty_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">cl_f</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="improper">ty_f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftype_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> cl_f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl_f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty_f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl_f_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl_f_ty_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
               dcl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">dclb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cla</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> mds <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="improper">meth_def_meth_list</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> field_has_type'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ctx'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> cl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"cl_fqn <span class="main">(</span>fqn_def <span class="improper">dcl</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctxcld <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> all_in_path_found<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_cld_from_lu<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exists_three_in_five<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">var_k</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="bound">cl</span> <span class="bound">var'</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_xx<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">cl</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span> <span class="main">⟶</span>
   <span class="main">(</span>x_var <span class="free">var_k</span><span class="main">,</span> x_var <span class="free">var'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_vd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">cl_var_ty_list</span><span class="main">.</span>
      map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="bound">cl_var_ty_list</span>
      <span class="main">⟶</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="bound">cl_var_ty_list</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_vd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vd_def <span class="free">cl_k</span> <span class="free">var_k</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="free">var_k</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_cl_var_var'_v_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exists_var'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
    map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span> <span class="free">var_k</span> <span class="main">=</span> Some <span class="free">ty_k</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">∃</span><span class="bound">var'_k</span><span class="main">.</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">var_k</span> <span class="main">=</span> Some <span class="main">(</span>x_var <span class="bound">var'_k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst_thin</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl_k var_k<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">var_k</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k cl_k' var_k var'_k v_k<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var'_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_of_is_SomeI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> distinct_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_xx<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> map_y<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span><span class="main">,</span> <span class="free">y'_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y_ty_list</span> <span class="main">!</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_zip_var'_v<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span><span class="main">,</span> <span class="free">y'_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">(</span>x_var <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_map_zip_none<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="free">x_G</span> <span class="main">=</span> None<span class="main">⟧</span>
      <span class="main">⟹</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">x_G</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_length_y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_eq_None_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> set_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> fst_zip_eq<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_map_zip_some<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="free">x_G</span> <span class="main">=</span> Some <span class="free">ty_k</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">∃</span><span class="bound">v_k</span><span class="main">.</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">x_G</span> <span class="main">=</span> Some <span class="bound">v_k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y cl var var' v y'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y</span><span class="main">,</span> <span class="improper">cl</span><span class="main">,</span> <span class="improper">var</span><span class="main">,</span> <span class="improper">var'</span><span class="main">,</span> <span class="improper">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_of_is_SomeI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_fst_two' distinct_x_var'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x'_not_in_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">⟧</span>
      <span class="main">⟹</span> x_var <span class="free">var'_k</span> <span class="main">≠</span> <span class="free">x'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_in_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_ty_list</span><span class="main">;</span> map fst <span class="free">y_ty_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">y_k</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y_k</span> <span class="main">∈</span> set <span class="main">(</span>map fst <span class="free">y_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="main">(</span>map fst <span class="free">y_ty_list</span><span class="main">)</span><span class="main">.</span> map fst <span class="free">y_ty_list</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">y_k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_one_in_two<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y_k</span> <span class="main">∈</span> set <span class="main">(</span>map fst <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ty</span><span class="main">.</span> <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_ty_list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exists_i<span class="main">:</span> <span class="comment1">(* can probably simplify a lot *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_ka</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    <span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">cl_var_ty_list</span><span class="main">;</span>
     map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">⟧</span> <span class="main">⟹</span>
        <span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">cl_var_ty_list</span><span class="main">.</span> <span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_ka</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cl_var_ty_list</span> <span class="main">∧</span> <span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="main">(</span><span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="main">(</span><span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="improper">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> j<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distinct_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_length_var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> y_ty_match<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cl_var_ty_list</span><span class="main">;</span> <span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_ka</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">⟧</span> <span class="main">⟹</span>
       <span class="free">y_ty_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_y<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_ty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y_ty_list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y_ty_list</span> <span class="main">!</span> <span class="free">i</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_ty_k<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span>
    distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_ka</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    <span class="main">(</span><span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">cl_var_ty_list</span><span class="main">;</span>
     map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
     map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">;</span>
     map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">⟧</span>
       <span class="main">⟹</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var'_k</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_of_is_SomeI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_zip_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distinct_x_var'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> exists_i<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y_ty_list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> y_ty_match<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span> <span class="main">!</span> <span class="improper">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="improper">i</span><span class="main">,</span>  <span class="free">y_ty_list</span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&lt;</span> length <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">!</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span>x_var <span class="free">var'_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_zip<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_ty_k'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
     <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span> map fst <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
     map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">;</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
     map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_var</span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">if</span> x_var <span class="main">(</span>case_option <span class="free">var</span> <span class="main">(</span>case_x <span class="main">(</span><span class="main">λ</span><span class="bound">var'</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">var</span><span class="main">)</span> <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x'</span> <span class="keyword1">then</span> Some <span class="free">ty_x_m</span>
        <span class="keyword1">else</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>x_var <span class="main">(</span>case_option <span class="free">var</span> <span class="main">(</span>case_x <span class="main">(</span><span class="main">λ</span><span class="bound">var'</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">var</span><span class="main">)</span>
                       <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       Some <span class="free">ty_var</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> exists_var'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weaken_list_var<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> x'_not_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_of_ty_k<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weaken_list_y weaken_list_var<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> var_not_var'_x'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Γ</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_var</span><span class="main">;</span> <span class="free">L</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">v_var</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_cl_var_var'_v_list</span><span class="main">.</span> <span class="free">L</span> <span class="main">(</span>x_var <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">;</span> <span class="free">L</span> <span class="free">x'</span> <span class="main">=</span> None<span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">++</span> Map.empty<span class="main">(</span><span class="free">x'</span> <span class="main">↦</span> <span class="free">ty_x_d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_var</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"x_var <span class="free">var</span> <span class="main">≠</span> <span class="free">x'</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_eq_None_iff set_zip<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k cl_k var_k v_k y'_k ty_k i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">cl_k</span><span class="main">,</span> <span class="improper">var_k</span><span class="main">,</span> <span class="free">var</span><span class="main">,</span> <span class="improper">v_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> same_el<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
    <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    <span class="main">(</span><span class="free">y_i</span><span class="main">,</span> <span class="free">cl_i</span><span class="main">,</span> <span class="free">var_i</span><span class="main">,</span> <span class="free">var'_i</span><span class="main">,</span> <span class="free">v_i</span><span class="main">)</span> <span class="main">=</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="free">i</span><span class="main">;</span>
    <span class="main">(</span><span class="free">y_j</span><span class="main">,</span> <span class="free">cl_j</span><span class="main">,</span> <span class="free">var_j</span><span class="main">,</span> <span class="free">var'_i</span><span class="main">,</span> <span class="free">v_j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="free">y_i</span><span class="main">,</span> <span class="free">cl_i</span><span class="main">,</span> <span class="free">var_i</span><span class="main">,</span> <span class="free">var'_i</span><span class="main">,</span> <span class="free">v_i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y_j</span><span class="main">,</span> <span class="free">cl_j</span><span class="main">,</span> <span class="free">var_j</span><span class="main">,</span> <span class="free">var'_i</span><span class="main">,</span> <span class="free">v_j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> j<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distinct_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> same_y<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    <span class="main">(</span><span class="free">y'_k</span><span class="main">,</span> <span class="free">ty_k</span><span class="main">)</span> <span class="main">=</span> <span class="free">y_ty_list</span> <span class="main">!</span> <span class="free">i</span><span class="main">;</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">y_k</span><span class="main">,</span> <span class="free">cl_k</span><span class="main">,</span> <span class="free">var_k</span><span class="main">,</span> <span class="free">var'_k</span><span class="main">,</span> <span class="free">v_k</span><span class="main">)</span><span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">y'_k</span> <span class="main">=</span> <span class="free">y_k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted">fst</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_y<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_map_zip_y'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map fst <span class="free">y_y'_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span> <span class="main">⟹</span>
   map snd <span class="free">y_y'_list</span> <span class="main">=</span> map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_y'_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_y'_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_y'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y_y'_list</span> <span class="main">!</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y_ty_list</span> <span class="main">!</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_y'_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted">fst</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_y'_list</span> <span class="free">y_ty_list</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">list</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_y'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_length_list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_map_zip_ty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map fst <span class="free">y_y'_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span> <span class="main">⟹</span>
   map snd <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_y'_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_length_y'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y_y'_list</span> <span class="main">!</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y_ty_list</span> <span class="main">!</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_y_yy<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_y'_list</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_ty_list</span><span class="main">;</span>
    map fst <span class="free">y_y'_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    <span class="free">y_y'_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">)</span><span class="main">;</span> <span class="free">y_ty_list</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">yy</span><span class="main">,</span> <span class="free">ty</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
       <span class="free">y</span> <span class="main">=</span> <span class="free">yy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted">fst</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f1 <span class="main"><span class="main">=</span></span> <span class="quoted">fst</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> var_k_of_ty_k<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
    <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    map fst <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">ty_x_m</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_x</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free">x</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span> <span class="free">x'</span>
           <span class="keyword1">then</span> Some <span class="free">ty_x_m</span>
           <span class="keyword1">else</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free">x</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          Some <span class="free">ty_x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> exists_var'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weaken_list_var<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> x'_not_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_of_ty_k<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weaken_list_y weaken_list_var<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_var_not_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> x_var <span class="free">var</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> subtype_through_tr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
    <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span>
    map fst <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
    is_sty_one <span class="free">P</span> <span class="free">ty_x</span> <span class="free">ty_var</span> <span class="main">=</span> Some True<span class="main">;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">ty_x_m</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_x</span><span class="main">;</span>
    map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ty_var</span><span class="main">⟧</span>
       <span class="main">⟹</span> sty_option <span class="free">P</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free">x</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">=</span>
                 <span class="free">x'</span>
              <span class="keyword1">then</span> Some <span class="free">ty_x_m</span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free">x</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="keyword1">if</span> x_var <span class="main">(</span>case_option <span class="free">var</span> <span class="main">(</span>case_x <span class="main">(</span><span class="main">λ</span><span class="bound">var'</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">var</span><span class="main">)</span> <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x'</span> <span class="keyword1">then</span> Some <span class="free">ty_x_m</span>
           <span class="keyword1">else</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>x_var <span class="main">(</span>case_option <span class="free">var</span> <span class="main">(</span>case_x <span class="main">(</span><span class="main">λ</span><span class="bound">var'</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">var</span><span class="main">)</span>
                          <span class="main">(</span><span class="keyword1">if</span> x_var <span class="free">var</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="free">var</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ty_x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ty_var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_optionI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> x_var_not_this<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_of_ty_k'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> subtypes_through_tr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">;</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">;</span>
    <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span><span class="main">;</span> map fst <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span><span class="main">;</span>
    map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span><span class="main">;</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_y'_list</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(=)</span> <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">x'</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="bound">y</span> <span class="keyword1">of</span>
                                       None <span class="main">⇒</span> <span class="bound">y</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_ty_lista</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> sty_option <span class="free">P</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="free">ty_x_m</span> <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>Some <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">;</span>
    map fst <span class="free">y_y'_list</span> <span class="main">=</span> map fst <span class="free">y_ty_lista</span><span class="main">;</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">)</span> <span class="main">=</span> <span class="free">y_y'_list</span> <span class="main">!</span> <span class="free">i</span><span class="main">;</span> <span class="main">(</span><span class="free">yy</span><span class="main">,</span> <span class="free">ty</span><span class="main">)</span> <span class="main">=</span> <span class="free">y_ty_lista</span> <span class="main">!</span> <span class="free">i</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_y'_list</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y_ty_lista</span><span class="main">⟧</span> <span class="main">⟹</span>
     sty_option <span class="free">P</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">y'</span> <span class="main">=</span> <span class="free">x'</span> <span class="keyword1">then</span> Some <span class="free">ty_x_m</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">y'</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">ty</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">yy</span><span class="main">,</span> <span class="free">ty</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> y_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">y_ty_lista</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> map_y_yy<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">tya</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_override_get<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">x'</span> <span class="keyword1">then</span> Some <span class="free">ty_x_d</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span> <span class="free">x'</span> <span class="main">=</span> Some <span class="free">ty_x_d</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_induct'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span>set <span class="bound">ss</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>s_block <span class="bound">ss</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">list</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>s_ass <span class="bound">list</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">list1</span> <span class="bound">x</span> <span class="bound">list2</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>s_read <span class="bound">list1</span> <span class="bound">x</span> <span class="bound">list2</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x1</span> <span class="bound">list</span> <span class="bound">x2</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>s_write <span class="bound">x1</span> <span class="bound">list</span> <span class="bound">x2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span> <span class="bound">s1</span><span class="main">;</span> <span class="free">P</span> <span class="bound">s2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>s_if <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">list1</span> <span class="bound">x</span> <span class="bound">list2</span> <span class="bound">list3</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>s_call <span class="bound">list1</span> <span class="bound">x</span> <span class="bound">list2</span> <span class="bound">list3</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">list</span> <span class="bound">ctx</span> <span class="bound">cl</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>s_new <span class="bound">list</span> <span class="bound">ctx</span> <span class="bound">cl</span><span class="main">)</span><span class="main">⟧</span>
         <span class="main">⟹</span> <span class="free">P</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> s.induct<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_tr_stmt_in_G'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span>
    <span class="main">∧</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span>
    <span class="main">∧</span> <span class="free">x'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span>
    <span class="main">∧</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span>
    <span class="main">∧</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">ty</span><span class="main">)</span> <span class="free">cl_var_ty_list</span> <span class="main">=</span> map snd <span class="free">y_ty_list</span>
    <span class="main">∧</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span> <span class="free">cl_var_ty_list</span>
    <span class="main">∧</span> is_sty_one <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">ty_x_m</span> <span class="main">=</span> Some True
    <span class="main">∧</span> wf_stmt <span class="free">P</span> <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="free">cl_var_ty_list</span><span class="main">)</span><span class="main">(</span>x_this <span class="main">↦</span> <span class="free">ty_x_m</span><span class="main">)</span><span class="main">)</span> <span class="bound">s'</span>
    <span class="main">∧</span> tr_s <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span> <span class="free">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">(</span>x_this <span class="main">↦</span> <span class="free">x'</span><span class="main">)</span><span class="main">)</span> <span class="bound">s'</span> <span class="free">s''</span>
    <span class="main">⟶</span> wf_stmt <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">Γ</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">y_cl_var_var'_v_list</span> <span class="free">y_ty_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">x'</span> <span class="main">↦</span> <span class="free">ty_x_m</span><span class="main">)</span><span class="main">)</span> <span class="free">s''</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> s_induct'<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_blockI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s'_s''_list s' s''<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="improper"><span class="improper"><span class="improper"><span class="improper">s'</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="improper"><span class="improper"><span class="improper"><span class="improper">s''</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> var x s'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_var_assignI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty_x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subtype_through_tr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> var x f s'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> f ty_x var x ty_f ty_var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_field_readI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_optionI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_of_ty_k'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x f y s'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> f ty_x x y ty_y ty_f<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_field_writeI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x y s1 s2 s'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_ifI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> var x meth ys s'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> y_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">yy</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="improper">y_y'_list</span> <span class="improper">y_ty_lista</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_mcallI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_map_zip_y'<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_k_of_ty_k<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_map_zip_ty<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subtypes_through_tr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_ty_k'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> var ctx cl s'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tr_s.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_newI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_ty_k'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_object_heap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_object <span class="free">P</span> <span class="free">H</span> <span class="free">v_opt</span> <span class="main">(</span>Some <span class="free">ty'</span><span class="main">)</span><span class="main">;</span> is_sty_one <span class="free">Pa</span> <span class="free">ty_y_s</span> <span class="free">ty_f</span> <span class="main">=</span> Some True<span class="main">;</span> <span class="free">H</span> <span class="free">oid_x</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ty_x_d</span><span class="main">,</span> <span class="free">fs_oid</span><span class="main">)</span><span class="main">⟧</span>
     <span class="main">⟹</span> wf_object <span class="free">P</span> <span class="main">(</span><span class="free">H</span><span class="main">(</span><span class="free">oid_x</span> <span class="main">↦</span> <span class="main">(</span><span class="free">ty_x_d</span><span class="main">,</span> <span class="free">fs_oid</span><span class="main">(</span><span class="free">f</span> <span class="main">↦</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">v_opt</span> <span class="main">(</span>Some <span class="free">ty'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_nullI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_dom_is_none<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="free">y_cl_var_var'_v_list</span> <span class="main">∩</span> Map.dom <span class="free">L</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_cl_var_var'_v_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> type_to_val<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_varstate <span class="free">P</span> <span class="free">Γ</span> <span class="free">H</span> <span class="free">L</span><span class="main">;</span> sty_option <span class="free">P</span> <span class="main">(</span><span class="free">Γ</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Γ</span> <span class="free">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="free">L</span> <span class="free">x</span> <span class="main">=</span> Some <span class="bound">v</span> <span class="main">∧</span> <span class="free">L</span> <span class="free">y</span> <span class="main">=</span> Some <span class="bound">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> find_path_fields<span class="main">[</span><span class="operator">THEN</span> mp<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_path_ty_f <span class="free">P</span> <span class="free">ty</span> <span class="main">=</span> Some <span class="free">path</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">fs</span><span class="main">.</span> fields_in_path_f <span class="free">path</span> <span class="main">=</span> <span class="bound">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_eq_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"replicate <span class="free">x</span> <span class="free">c</span> <span class="main">=</span> replicate <span class="free">y</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>replicate <span class="free">x</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>replicate <span class="free">y</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="main">_</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>replicate <span class="free">x</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>replicate <span class="free">y</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">lemma</span></span> string_infinite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> string set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_iff_countable_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> replicate <span class="bound">n</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> linorder_injI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> replicate_eq_length<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_infinite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> x set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_iff_countable_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> x_this <span class="keyword1">else</span> x_var <span class="main">(</span>replicate <span class="bound">n</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> linorder_injI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_oid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_heap <span class="free">P</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">oid</span><span class="main">.</span> <span class="bound">oid</span> <span class="main">∉</span> dom <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_heapE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> infinite_UNIV_nat<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex_new_if_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_x<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">::</span>x<span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x_infinite<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex_new_if_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_var_not_in_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">::</span>x set<span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">var</span><span class="main">::</span>var<span class="main">.</span> x_var <span class="bound">var</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">var</span> <span class="main">∉</span> set <span class="free">list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x_infinite<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert x_this <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> F <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert x_this <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> G <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"x_var <span class="main">`</span> set <span class="free">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_UnI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"insert x_this <span class="free">A</span> <span class="main">∪</span> x_var <span class="main">`</span> set <span class="free">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex_new_if_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_vars<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">::</span>x set<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">list</span><span class="main">::</span>var list<span class="main">.</span> length <span class="bound">list</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> x_var<span class="main">`</span> set <span class="bound">list</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> distinct <span class="bound">list</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fresh_var_not_in_list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">var</span><span class="main">#</span><span class="improper">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_x_not_in_vars'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="main">(</span>x_var <span class="main">`</span> set <span class="free">vars'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>x_var <span class="main">`</span> set <span class="free">vars'</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> G <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"x_var <span class="main">`</span> set <span class="free">vars'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_UnI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x_infinite<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> x_var <span class="main">`</span> set <span class="free">vars'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex_new_if_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_ft_length<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">tys</span><span class="main">.</span> lift_opts <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">clk</span> <span class="bound">vark</span><span class="main">.</span> find_type_f <span class="free">P</span> <span class="free">ctx_o</span> <span class="bound">clk</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">tys</span> <span class="main">⟶</span> length <span class="bound">tys</span> <span class="main">=</span> length <span class="free">vds</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> vd.splits option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_mem_has_path'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="free">prefix</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">prefix</span> <span class="main">@</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld'</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">suffix</span><span class="main">.</span> <span class="main">∀</span><span class="bound">prefix'</span><span class="main">.</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">suffix'</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="bound">ctx'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">prefix'</span> <span class="main">=</span> Some <span class="bound">suffix'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ctx</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cl</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">prefix</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> find_path_rec_f.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">aa</span> <span class="bound">ba</span> <span class="bound">aaa</span> <span class="bound">bb</span><span class="main">.</span>
           <span class="main">(</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">aaa</span> <span class="main">∧</span> <span class="improper">b</span> <span class="main">=</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="bound">aaa</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> <span class="bound">bb</span><span class="main">)</span>
           <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">aaa</span> <span class="main">(</span>superclass_name_f <span class="bound">bb</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">aaa</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">aaa</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                           <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld'</span><span class="main">)</span><span class="main">.</span>
                               <span class="main">∀</span><span class="bound">prefix'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">suffix'</span><span class="main">.</span> case_option None <span class="main">(</span>case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">ctx'</span> <span class="bound">cld</span><span class="main">.</span> find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                                   Some <span class="bound">suffix'</span><span class="main">)</span>
                            <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">_</span></span></span></span></span></span></span></span></span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">aa</span> <span class="bound">ba</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
           <span class="main">⟦</span><span class="improper">a</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">∧</span> <span class="improper">b</span> <span class="main">=</span> <span class="bound">ba</span><span class="main">;</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">ba</span><span class="main">⟧</span>
           <span class="main">⟹</span> <span class="main">∀</span><span class="bound">suffix</span><span class="main">.</span>
                 find_path_rec_f <span class="improper">P</span> <span class="bound">aa</span> <span class="main">(</span>superclass_name_f <span class="bound">ba</span><span class="main">)</span> <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
                 Some <span class="main">(</span><span class="improper">path</span> <span class="main">@</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">#</span> <span class="bound">suffix</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="bound">suffix</span><span class="main">.</span>
                     <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span>
                     <span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld'</span><span class="main">)</span> <span class="main">⇒</span>
                       <span class="main">∀</span><span class="bound">prefix'</span><span class="main">.</span>
                          <span class="main">∃</span><span class="bound">suffix'</span><span class="main">.</span>
                             case_option None
                              <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">.</span>
                                  find_path_rec_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>superclass_name_f <span class="bound">cld</span><span class="main">)</span> <span class="main">(</span><span class="bound">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="bound">ctx'</span><span class="main">,</span> <span class="bound">cld</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">(</span>find_cld_f <span class="improper">P</span> <span class="bound">ctx'</span> <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="bound">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                             Some <span class="bound">suffix'</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> path_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tl <span class="improper">suffix</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list1 cl list2 list3<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">fqn</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_cld_name_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cld.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> suffix <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> prefix' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">" <span class="improper">prefix'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="improper">a</span><span class="main">,</span> cld_def <span class="improper">list1</span> <span class="improper">cl</span> <span class="improper">list2</span> <span class="improper">list3</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_same_suffix'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">aa</span><span class="main">,</span> <span class="improper">ba</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fpr_mem_has_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>find_path_f <span class="free">P</span> <span class="free">ctx</span> <span class="free">cl</span> <span class="main">=</span> Some <span class="free">suffix</span><span class="main">;</span> <span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">suffix</span><span class="main">⟧</span> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound">suffix'</span><span class="main">.</span> find_path_rec_f <span class="free">P</span> <span class="free">ctx'</span> <span class="main">(</span>cl_fqn <span class="main">(</span>fqn_def <span class="main">(</span>class_name_f <span class="free">cld'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> Some <span class="bound">suffix'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ctx'</span><span class="main">,</span> <span class="free">cld'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fpr_mem_has_path'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_path_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mtype_to_find_md<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_program <span class="free">P</span><span class="main">;</span> mtype_f <span class="free">P</span> <span class="free">ty_x_s</span> <span class="free">m</span> <span class="main">=</span> Some <span class="main">(</span>mty_def <span class="free">tys</span> <span class="free">ty_r</span><span class="main">)</span><span class="main">;</span> is_sty_one <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">ty_x_s</span> <span class="main">=</span> Some True<span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">ctx</span> <span class="bound">cl_r</span> <span class="bound">vds</span> <span class="bound">ss'</span> <span class="bound">y</span><span class="main">.</span> find_meth_def_f <span class="free">P</span> <span class="free">ty_x_d</span> <span class="free">m</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">ctx</span><span class="main">,</span> meth_def_def <span class="main">(</span>meth_sig_def <span class="bound">cl_r</span> <span class="free">m</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>meth_body_def <span class="bound">ss'</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">∧</span> length <span class="free">tys</span> <span class="main">=</span> length <span class="bound">vds</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits ty.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def find_meth_def_f_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">ty_x_d</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path_d ctx_s dcl_s ctx_d dcl_d<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl_s fds_s mds_s<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fpr_mem_has_path<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> find_path_rec_f.simps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> path <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">path_d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> mty <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"mty_def <span class="free">tys</span> <span class="free">ty_r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> path' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">suffix'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mty_preservation'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> class_name_f_def find_path_f_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mtype_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_split_asm meth_def.splits meth_sig.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> meth_body a b c d e f g<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">meth_body</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_opts_ft_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_meth_def_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_md_m_match<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exist_lifted_values<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>dom <span class="free">Γ</span><span class="main">.</span> wf_object <span class="free">P</span> <span class="free">H</span> <span class="main">(</span><span class="free">L</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Γ</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">y_ty_list</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> sty_option <span class="free">P</span> <span class="main">(</span><span class="free">Γ</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>Some <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">vs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>tr_ss_f <span class="main">(</span>map_of <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span><span class="main">.</span> x_var<span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">(</span>map x_var <span class="free">vars'</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>x_this <span class="main">↦</span> <span class="free">x'</span><span class="main">)</span><span class="main">)</span> <span class="free">ss'</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ss'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> collect_suc_eq_lt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">f</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Suc_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Collect<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_disj_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y_ty_list</span> <span class="bound">vars</span> <span class="bound">vars'</span> <span class="bound">vs</span><span class="main">.</span> length <span class="bound">y_ty_list</span> <span class="main">=</span> length <span class="free">vds</span> <span class="main">∧</span> length <span class="bound">vars</span> <span class="main">=</span> length <span class="free">vds</span> <span class="main">∧</span> length <span class="bound">vars'</span> <span class="main">=</span> length <span class="free">vds</span> <span class="main">∧</span> length <span class="bound">vs</span> <span class="main">=</span> length <span class="free">vds</span> <span class="main">⟶</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> vd_def <span class="bound">cl</span> <span class="bound">var</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="bound">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">vars'</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">vds</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip length_Suc_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> vd.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars'_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y_ty_list</span> <span class="bound">vds</span> <span class="bound">vars</span> <span class="bound">vs</span><span class="main">.</span> length <span class="bound">y_ty_list</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vds</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vars</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vs</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> x_var <span class="bound">var'</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="bound">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">vars</span> <span class="main">(</span>zip <span class="free">vars'</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> x_var <span class="main">`</span> set <span class="free">vars'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vars'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip length_Suc_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y_ty_list</span> <span class="bound">vds</span> <span class="bound">vars</span> <span class="bound">vs</span><span class="main">.</span> length <span class="bound">y_ty_list</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vds</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vars</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vs</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">⟶</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">var'</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="bound">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">vars</span> <span class="main">(</span>zip <span class="free">vars'</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">vars'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vars'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip length_Suc_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y_ty_list</span> <span class="bound">vds</span> <span class="bound">vars</span> <span class="bound">vs</span><span class="main">.</span> length <span class="bound">y_ty_list</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vds</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vars</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">∧</span> length <span class="bound">vs</span> <span class="main">=</span> length <span class="free">vars'</span> <span class="main">⟶</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var</span><span class="main">,</span> x_var <span class="bound">var'</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>zip <span class="main">(</span>map fst <span class="bound">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">vars'</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span><span class="main">.</span> x_var<span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>map x_var <span class="free">vars'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vars'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip length_Suc_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> vd.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">vds</span> <span class="bound">vars</span> <span class="bound">vars'</span> <span class="bound">vs</span><span class="main">.</span> length <span class="bound">vds</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">∧</span> length <span class="bound">vars</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">∧</span> length <span class="bound">vars'</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">∧</span> length <span class="bound">vs</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">⟶</span>
   map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">vars</span> <span class="main">(</span>zip <span class="bound">vars'</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map fst <span class="free">y_ty_list</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip length_Suc_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> lift_opts_mapping<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">vds</span> <span class="bound">vars</span> <span class="bound">vars'</span> <span class="bound">vs</span><span class="main">.</span> length <span class="bound">vds</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">∧</span> length <span class="bound">vars</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">∧</span> length <span class="bound">vars'</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">∧</span> length <span class="bound">vs</span> <span class="main">=</span> length <span class="free">y_ty_list</span> <span class="main">⟶</span>
   lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span> <span class="bound">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">vars'</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="bound">y</span> <span class="main">=</span> Some <span class="bound">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip length_Suc_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> vd.splits option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y1 y_ty_list v2 vs cl1 var1 var'1 v1 vds vars var'2 vars' i cl2 var2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vars</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vars'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> j<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"map fst <span class="improper">y_ty_list</span> <span class="main">!</span> <span class="improper">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">cl</span><span class="main">)</span><span class="main">)</span> <span class="improper">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span> <span class="bound">var</span><span class="main">.</span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span> <span class="improper">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="improper">vars'</span> <span class="improper">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="improper">j</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl1 var1 var'1 v1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var'1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">v1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_y_ty_list_vs<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">vs</span><span class="main">.</span> lift_opts <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">.</span> <span class="free">L</span> <span class="bound">y</span><span class="main">)</span> <span class="free">y_ty_list</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">⟶</span> length <span class="free">y_ty_list</span> <span class="main">=</span> length <span class="bound">vs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y_ty_list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> translation_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>zip <span class="main">(</span>tr_ss_f <span class="main">(</span>map_of <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span><span class="main">.</span> x_var<span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">(</span>map x_var <span class="free">vars'</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>x_this <span class="main">↦</span> <span class="free">x'</span><span class="main">)</span><span class="main">)</span> <span class="free">ss'</span><span class="main">)</span> <span class="free">ss'</span><span class="main">)</span><span class="main">.</span>
             <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s''</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> tr_s <span class="main">(</span>map_of <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>case_vd <span class="main">(</span><span class="main">λ</span><span class="bound">cl</span><span class="main">.</span> x_var<span class="main">)</span><span class="main">)</span> <span class="free">vds</span><span class="main">)</span> <span class="main">(</span>map x_var <span class="free">vars'</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>x_this <span class="main">↦</span> <span class="free">x'</span><span class="main">)</span><span class="main">)</span> <span class="bound">s'</span> <span class="bound">s''</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss'</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_rel_f_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>




<span class="keyword1"><span class="command">theorem</span></span> progress<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_config <span class="free">Γ</span> <span class="main">(</span>config_normal <span class="free">P</span> <span class="free">L</span> <span class="free">H</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">config'</span><span class="main">.</span> r_stmt <span class="main">(</span>config_normal <span class="free">P</span> <span class="free">L</span> <span class="free">H</span> <span class="free">S</span><span class="main">)</span> <span class="bound">config'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s ss<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">s</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span><span class="main"><span class="improper">[</span></span>1<span class="main">-</span>7<span class="main"><span class="improper">]</span></span> wf_configE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="comment1">― ‹block›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> r_blockI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="comment1">― ‹variable assignment›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> type_to_val<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> r_var_assignI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="comment1">― ‹field read›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> r_field_read_npeI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a3.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Some <span class="improper">ty</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_heapE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">oid</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x oid ty_x_s ty_x_d fields_oid fs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> no_field_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> H <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_field_readI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="comment1">― ‹field write›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> r_field_write_npeI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_y ty_f<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> H <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="free">y</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_field_writeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="comment1">― ‹conditional branch›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> type_to_val<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> <span class="improper">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_if_trueI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_if_falseI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> type_to_val<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> <span class="improper">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">w</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_if_trueI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">w</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_if_falseI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="comment1">― ‹object creation›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl ctx ty var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_cl ty_var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sty_one_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> path<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> find_path_fields<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> fresh_oid<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> H <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">H</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> L <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> var <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ss</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">fs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_newI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fields_f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="comment1">― ‹method call›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ss y_ty_list x ty_x_s m ty_r_s var<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> r_mcall_npeI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_r_s ty_var_s ty_x_s ty_x_d fs_x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> mtype_to_find_md<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"length <span class="improper">vds</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fresh_vars<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> vars'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> exist_lifted_values<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> vars' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vars'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fresh_x_not_in_vars'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vars</span><span class="main">.</span> <span class="bound">vars</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">vd</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> <span class="bound">var</span><span class="main">)</span> <span class="improper">vds</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="improper">vars</span> <span class="main">=</span> length <span class="improper">vds</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> length_y_ty_list_vs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">=</span> <span class="main">(</span>map_of <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">vd</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> x_var <span class="bound">var</span><span class="main">)</span> <span class="improper">vds</span><span class="main">)</span> <span class="main">(</span>map x_var <span class="improper">vars'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>x_this <span class="main">↦</span> <span class="improper">x'</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> H <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">H</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> meth <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ctx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ctx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl_r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_x_d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y_cl_var_var'_v_list <span class="main"><span class="main">=</span></span>
                <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="improper">y_ty_list</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">vd</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">vd</span> <span class="keyword1">of</span> vd_def <span class="bound">cl</span> <span class="bound">var</span> <span class="main">⇒</span> <span class="bound">cl</span><span class="main">)</span> <span class="improper">vds</span><span class="main">)</span> <span class="main">(</span>zip <span class="improper">vars</span> <span class="main">(</span>zip <span class="improper">vars'</span> <span class="improper">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s''_s'_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>tr_ss_f <span class="improper">T</span> <span class="improper">ss'</span><span class="main">)</span> <span class="improper">ss'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> var <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ss</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">T</span></span>
                <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> r_mcallI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vars'_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vars'_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> L <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_ty_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> lift_opts_mapping<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vars</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vars'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">vs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> translation_eq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">theorem</span></span> wf_preservation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Γ</span> <span class="bound">config</span><span class="main">.</span>
       <span class="main">⟦</span>wf_config <span class="bound">Γ</span> <span class="bound">config</span><span class="main">;</span> r_stmt <span class="bound">config</span> <span class="free">config'</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ'</span><span class="main">.</span> <span class="bound">Γ</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">Γ'</span> <span class="main">∧</span> wf_config <span class="bound">Γ'</span> <span class="free">config'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> r_stmt.cases<span class="main">)</span>

<span class="comment1">(* s_read_npe, s_write_npe *)</span>

<span class="comment1">(* Γ' = Γ for all cases except for mcall (case 11) *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span><span class="main"><span class="improper">[</span></span>1<span class="main">-</span>10<span class="main"><span class="improper">]</span></span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">Γ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span><span class="main"><span class="improper">[</span></span>1<span class="main">-</span>11<span class="main"><span class="improper">]</span></span> wf_configE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="comment1">(* s_if s_block *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_config_normalI<span class="main">)</span>

<span class="comment1">(* s_ass *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_config_normalI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_subvarstateI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_nullI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty'a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_transitiveI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="comment1">(* s_read *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_config_normalI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> L oid H v s_list ty_oid fs_oid Γ x ty_x P f ty_f var<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_subvarstateI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">v</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_nullI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_f ty_var P oid_v<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_heapE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">oid</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> H P fs_oid<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> L Γ H oid_x ty_x_d ty_x_s P<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ty_x_s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_x_s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_field_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> ftype_preservation<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_f<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> H oid_v ty_f P ty_v fs_v<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_transitiveI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="comment1">(* s_write *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst_thin</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> Γ P H<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_config_normalI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> L oid_x v H ss Γ x ty_x_s f y ty_y_s ty_f P ty_x_d fs_oid<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_heapE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_heapI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">oid_x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">fa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">v</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_nullI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> H P fields_x_d ty_f_d oid_v<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> ftype_preservation<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a4.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Some <span class="improper">ty_y_s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI sty_transitiveI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">fs_oid</span> <span class="improper">fa</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> wf_objectE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_nullI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> H P fields_x_d f ty_f_d oid_v<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">oid</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">fa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_object_heap<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> L oid_x v H ss Γ x ty_x_s f y ty_y_s ty_f P ty_x_d fs_x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_varstateI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> L Γ P H x' y'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_nullI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> H oid_x' ty_x'_s P ty_x'_d fs_x'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(* s_if *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_config_normalI<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_config_normalI<span class="main">)</span>

<span class="comment1">(* s_new *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_config_normalI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> H L ss ctx cl Γ var ty' ty_var P<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_heapE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_heapI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_upd_Some_unfold<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> if_split_asm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> field_has_type<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_nullI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">oida</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty'a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_nullI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> oid_new H L ss ctx cl Γ var ty_new ty_var P<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_varstateI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_nullI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sty_optionI<span class="main">)</span>

<span class="comment1">(* s_call *)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_all_exI<span class="main">)</span>

<span class="comment1">(* setting the new type environment *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">H</span> <span class="improper">oid</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_stmtE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_method_from_find<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Γ'</span><span class="main">.</span> <span class="improper">Γ</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">Γ'</span> <span class="main">⟶</span>
             <span class="main">~</span> <span class="main">(</span>wf_config <span class="bound">Γ'</span> <span class="main">(</span>config_normal <span class="improper">Pa</span> <span class="main">(</span><span class="main">(</span><span class="improper">L</span> <span class="main">++</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">,</span> <span class="bound">cl_XXX</span><span class="main">,</span> <span class="bound">var_XXX</span><span class="main">,</span> <span class="bound">var_'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var_'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="improper">y_cl_var_var'_v_list</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="improper">x'</span> <span class="main">↦</span> v_oid <span class="improper">oid</span><span class="main">)</span><span class="main">)</span> <span class="improper">H</span>
                   <span class="main">(</span>map fst <span class="improper">s''_s'_list</span> <span class="main">@</span>
                    s_ass <span class="improper">vara</span>
                     <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">if</span> <span class="improper">y</span> <span class="main">=</span> x_this <span class="keyword1">then</span> Some <span class="improper">x'</span>
                           <span class="keyword1">else</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y_XXX</span><span class="main">,</span> <span class="bound">cl_XXX</span><span class="main">,</span> <span class="bound">var_XXX</span><span class="main">,</span> <span class="bound">var_'</span><span class="main">,</span> <span class="bound">v_XXX</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var_XXX</span><span class="main">,</span> x_var <span class="bound">var_'</span><span class="main">)</span><span class="main">)</span> <span class="improper">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="improper">y</span> <span class="keyword1">of</span>
                      None <span class="main">⇒</span> <span class="improper">y</span> <span class="main">|</span> Some <span class="bound">x'</span> <span class="main">⇒</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">#</span>
                    <span class="improper">s_list</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contrapos_pp<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> not_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">Γ</span> <span class="main">++</span>
                    map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">ty</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="improper">y_cl_var_var'_v_list</span> <span class="improper">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="main">++</span>
                    Map.empty <span class="main">(</span><span class="improper">x'</span> <span class="main">↦</span> ty_def <span class="improper">ctx</span> <span class="improper">dcl</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_le_def <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> L <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Pa <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">Pa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> H <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">H</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> map_of_map_and_x<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_dom_is_none<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ss ty_x_d fs_x y_ty_list Γ x ty_x_s P meth ty_r var dcl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_r ty_var P<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_varstateE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> L Γ P H<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"x_var <span class="improper">var</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> P H oid<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_x_d ty_x_s P<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"x_var <span class="improper">var</span> <span class="main">∈</span> dom <span class="improper">Γ</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> v_var<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> not_dom_is_none<span class="main">)</span>

 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_config_normalI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> 

  <span class="comment1">(* varstate *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_varstateI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> finite_super_varstate<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst_thin</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k cl_k var_k var'_k v_k y'_k ty_k<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">cl_k</span><span class="main">,</span> <span class="improper">var_k</span><span class="main">,</span> <span class="improper">var'_k</span><span class="main">,</span> <span class="improper">v_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="improper">y_cl_var_var'_v_list</span><span class="main">)</span> <span class="main">(</span>x_var <span class="improper">var'_k</span><span class="main">)</span> <span class="main">=</span> Some <span class="improper">v_k</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_y<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">ty_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ty_y_k ty_k P<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">v_k</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_nullI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> oid_y_k<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a4.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Some <span class="improper">ty_y_k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_transitiveI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_of_is_SomeI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_fst_var'<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_zip_var'_v<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x_G ty_x_G<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x_G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">cl</span><span class="main">,</span> <span class="bound">var</span><span class="main">,</span> <span class="bound">var'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">,</span> <span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>x_var <span class="bound">var'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="improper">y_cl_var_var'_v_list</span> <span class="improper">y_ty_list</span><span class="main">)</span><span class="main">)</span> <span class="improper">x_G</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_of_map_zip_none<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_of_map_zip_some<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> same_el<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">aa</span><span class="main">,</span> <span class="improper">ab</span><span class="main">,</span> <span class="improper">ac</span><span class="main">,</span> <span class="improper">ai</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k cl_k var_k v_k y'_k ty_k var'_k i<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> y_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> cl_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> var_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> var'_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">var'_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">v_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> same_y<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">ty_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k ty_k<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">cl_k</span><span class="main">,</span> <span class="improper">var_k</span><span class="main">,</span> <span class="improper">var'_k</span><span class="main">,</span> <span class="improper">v_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">y_k</span><span class="main">,</span> <span class="improper">cl_k</span><span class="main">,</span> <span class="improper">var_k</span><span class="main">,</span> <span class="improper">var'_k</span><span class="main">,</span> <span class="improper">v_k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?a4.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Some <span class="improper">ty</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_nullI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_objectI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sty_optionI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty'a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_transitiveI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 
 <span class="comment1">(* assignment *)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_var_assignI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_method_from_find<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_methE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ya</span> <span class="main">=</span> x_this"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_optionI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ctx</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ty_r_d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mty_preservation<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_transitiveI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="comment1">(* y != this *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sty_option.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> var_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ya</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty_k <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">tya</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exists_var'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_vd<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"x_var <span class="improper">var'_k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> map_of_SomeD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> y_k cl_k var_k var'_k v_k<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> x'_not_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_SomeD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> cl_k' var_k ty_k<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ctx</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> mty_preservation<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> map_of_vd<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_of_ty_k<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_var</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_optionI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ty' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sty_transitiveI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="comment1">(* wf of translated statements *)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_methE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> map_of_vd<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ctx</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> mty_preservation<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> P dcl cl y meth s'' s'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="improper"><span class="improper"><span class="improper">s''</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="improper"><span class="improper"><span class="improper">s'</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> cl_var_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">cl_var_ty_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y_cl_var_var'_v_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_cl_var_var'_v_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_ty_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
                P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty_x_d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ty_x_d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty_x_m <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"ty_def ctx_def <span class="improper">dcl</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>  x' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s''</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Γ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">Γ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_tr_stmt_in_G'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="comment1">(* wf of non-translated statements *)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> L <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y_cl_var_var'_v_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_cl_var_var'_v_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Γ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">Γ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> H <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">H</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
               y_ty_list <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">y_ty_list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ty <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"ty_def <span class="improper">ctx</span> <span class="improper">dcl</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ss <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">ss</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_stmt_in_G'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_objectE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>