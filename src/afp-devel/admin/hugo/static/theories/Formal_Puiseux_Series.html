<div id="Puiseux_Polynomial_Library">
<div class="head">
<h1>Theory Puiseux_Polynomial_Library</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Puiseux_Polynomial_Library.thy
  Author:  Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary material›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Facts about polynomials›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Puiseux_Polynomial_Library
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span> <span class="quoted">"<a href="../Polynomial_Interpolation/Ring_Hom_Poly.html">Polynomial_Interpolation.Ring_Hom_Poly</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: move a lot of this *)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-poly_sum_mset"><span class="command">lemma</span></span> poly_sum_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span><span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span><span class="free">A</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-poly_prod_mset"><span class="command">lemma</span></span> poly_prod_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="free">A</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-set_mset_subset_singletonD"><span class="command">lemma</span></span> set_mset_subset_singletonD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> replicate_mset <span class="main">(</span>size <span class="free">A</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-inj_idom_hom_compose"><span class="command">lemma</span></span> inj_idom_hom_compose <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_idom_hom <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"inj_idom_hom <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj_idom_hom <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> inj_idom_hom <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> inj_idom_hom <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f.hom_add g.hom_add f.hom_mult g.hom_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Polynomial_Library-coeff_pcompose_linear"><span class="command">lemma</span></span> coeff_pcompose_linear<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1<span class="main">:]</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons coeff_pCons mult_ac <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-degree_cong"><span class="command">lemma</span></span> degree_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> coeff <span class="free">q</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">q</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> degree_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Polynomial_Library-coeff_Abs_poly_If_le"><span class="command">lemma</span></span> coeff_Abs_poly_If_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Abs_poly_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">n</span><span class="main">)</span> cofinite"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MOST_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Polynomial_Library-coeff_Abs_poly"><span class="command">lemma</span></span> coeff_Abs_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Abs_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Abs_poly_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">n</span><span class="main">)</span> cofinite"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MOST_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_idom_hom<span class="main">)</span> inj_idom_hom_map_poly <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_idom_hom <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_inj_idom_hom <span class="quoted"><span class="free">hom</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_idom_hom_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Polynomial_Library-inj_idom_hom_pcompose"><span class="command">lemma</span></span> inj_idom_hom_pcompose <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_idom_hom <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> pcompose <span class="bound">q</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_eq_0<span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-degree_sum_less"><span class="command">lemma</span></span> degree_sum_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_add_less<span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-degree_lessI"><span class="command">lemma</span></span> degree_lessI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-coeff_linear_poly_power"><span class="command">lemma</span></span> coeff_linear_poly_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> <span class="free">a</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">:]</span> <span class="main">=</span> monom <span class="free">b</span> <span class="main">1</span> <span class="main">+</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">…</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">a</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> binomial_ring<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_sum of_nat_poly monom_power poly_const_pow mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Polynomial_Library-pcompose_altdef"><span class="command">lemma</span></span> pcompose_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"pcompose <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-coeff_mult_0"><span class="command">lemma</span></span> coeff_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mult<span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-coeff_pcompose_0"><span class="command">lemma</span></span> coeff_pcompose_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>pcompose <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>coeff <span class="free">q</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mult_0<span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-reducible_polyI"><span class="command">lemma</span></span> reducible_polyI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_def<span class="main">)</span>

<span class="keyword1" id="Puiseux_Polynomial_Library-root_imp_reducible_poly"><span class="command">lemma</span></span> root_imp_reducible_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> Suc <span class="main">(</span>degree <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A typeclass for algebraically closed fields›</span></span>

<span class="comment1">(* TODO: Move! *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the required sort constraints are not available inside the class, we have to resort
  to a somewhat awkward way of writing the definition of algebraically closed fields:
›</span></span>
<span class="keyword1"><span class="command">class</span></span> alg_closed_field <span class="main">=</span> field <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can then however easily show the equivalence to the proper definition:
›</span></span>
<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closed_imp_poly_has_root"><span class="command">lemma</span></span> alg_closed_imp_poly_has_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> alg_closed_field poly<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_closed<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closedI"><span class="command">lemma</span></span> alg_closedI <span class="main">[</span><span class="operator">Pure.intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> lead_coeff <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field<span class="main">,</span> alg_closed_field_class<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> coeff_p<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="skolem">k</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span><span class="main">)</span> cofinite"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MOST_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Abs_poly_inverse<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_degree<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_p<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_p<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> deg_p<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> deg_p <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> deg_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lead_coeff_p' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> deg_p <span class="keyword2"><span class="keyword">and</span></span> deg_p' <span class="keyword2"><span class="keyword">and</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_p coeff_p<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now prove by induction that every polynomial of degree <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> splits into a product of
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> linear factors:
›</span></span>
<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closed_imp_factorization"><span class="command">lemma</span></span> alg_closed_imp_factorization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> alg_closed_field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> size <span class="bound">A</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{#}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> alg_closed_imp_poly_has_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less.prems p_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> Suc <span class="main">(</span>degree <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">A</span> <span class="main">=</span> degree <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less.hyps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈#</span>add_mset <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> smult <span class="main">(</span>lead_coeff <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈#</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_eq lead_coeff_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> A<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> p_eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"add_mset <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">A</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As an alternative characterisation of algebraic closure, one can also say that any
  polynomial of degree at least 2 splits into non-constant factors:
›</span></span>
<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closed_imp_reducible"><span class="command">lemma</span></span> alg_closed_imp_reducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> alg_closed_field poly<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alg_closed_imp_poly_has_root<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> dvd_iff_poly_eq_0<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reducible_polyI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> q<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  When proving algebraic closure through reducibility, we can assume w.l.o.g. that the polynomial
  is monic and has a non-zero constant coefficient:
›</span></span>
<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closedI_reducible"><span class="command">lemma</span></span> alg_closedI_reducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> lead_coeff <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> coeff <span class="bound">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
              <span class="main">¬</span>irreducible <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field<span class="main">,</span> alg_closed_field_class<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_0_coeff_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">:]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span><span class="main">/</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">r</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mult_0<span class="main">)</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r'</span> <span class="main">=</span> degree <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">r'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">r'</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="skolem">r</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r'_def<span class="main">)</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="skolem">r</span> <span class="main">+</span> degree <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>3<span class="main">)</span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">r'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> lc rs nz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using a clever Tschirnhausen transformation mentioned e.g. in the article by
  Nowak~\cite{nowak2000}, we can also assume w.l.o.g. that the coefficient $a_{n-1}$ is zero.
›</span></span>
<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closedI_reducible_coeff_deg_minus_one_eq_0"><span class="command">lemma</span></span> alg_closedI_reducible_coeff_deg_minus_one_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> lead_coeff <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> coeff <span class="bound">p</span> <span class="main">(</span>degree <span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
              coeff <span class="bound">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span>irreducible <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">,</span> alg_closed_field_class<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> alg_closedI_reducible<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> coeff <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">-</span><span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> pcompose <span class="skolem">p</span> <span class="skolem">r</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> r_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">1</span> <span class="main">+</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deg_q<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def r_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lc_q<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_comp<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 deg_q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">i</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span>
            <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def pcompose_altdef poly_altdef r_altdef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_map_poly coeff_map_poly coeff_sum binomial_ring sum_distrib_left poly_const_pow
                  sum_distrib_right mult_ac monom_power coeff_monom_mult of_nat_poly <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">.</span>
                     coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">i</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">.</span>
                     coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">i</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">-</span> of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> binomial_symmetric<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">/</span> of_nat <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def r_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> root_imp_reducible_poly<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> 1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> lc_q <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="skolem">q</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_q<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">v</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 1 deg_q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> pcompose <span class="skolem">q</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def r_def s_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pcompose_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> pcompose <span class="skolem">u</span> <span class="skolem">s</span> <span class="main">*</span> pcompose <span class="skolem">v</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pcompose <span class="skolem">u</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pcompose <span class="skolem">v</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> reducible_polyI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As a consequence of the full factorisation lemma proven above, we can also show that any
  polynomial with at least two different roots splits into two non-constant coprime factors:
›</span></span>
<span class="keyword1" id="Puiseux_Polynomial_Library-alg_closed_imp_poly_splits_coprime"><span class="command">lemma</span></span> alg_closed_imp_poly_splits_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>alg_closed_field<span class="main">}</span> poly<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_0 gr0I n_def not_one_less_zero order_root<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> Polynomial.order <span class="free">x</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_power_n_n<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.order <span class="free">x</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
      <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>degree <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">d</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> alg_closed_imp_poly_has_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dvd_trans poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> d<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dvd_trans poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> p_eq degree_power_eq›</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> complex <span class="main">::</span> <span class="quoted">alg_closed_field</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> constant_degree fundamental_theorem_of_algebra neq0_conv <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Puiseux_Laurent_Library">
<div class="head">
<h1>Theory Puiseux_Laurent_Library</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Puiseux_Laurent_Library.thy
  Author:  Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Facts about Laurent series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Puiseux_Laurent_Library
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-filterlim_at_top_div_const_nat"><span class="command">lemma</span></span> filterlim_at_top_div_const_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_top
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">≥</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">C</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_le_mono div_mult_self_is_m<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">C</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_ge_at_top<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">≥</span> <span class="skolem">C</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_eq_iff"><span class="command">lemma</span></span> fls_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> fls_nth <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> fls_nth <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_shift_eq_1_iff"><span class="command">lemma</span></span> fls_shift_eq_1_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"fls_shift <span class="free">n</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> fls_shift <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fls_shift <span class="free">n</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> fls_shift <span class="free">n</span> <span class="free">f</span> <span class="main">=</span> fls_shift <span class="free">n</span> <span class="main">(</span>fls_shift <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fls_shift_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> fls_shift <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fls_shift_eq_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fps_to_fls_eq_iff"><span class="command">lemma</span></span> fps_to_fls_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="free">f</span> <span class="main">=</span> fps_to_fls <span class="free">g</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="free">f</span> <span class="main">=</span> fps_to_fls <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">f</span> <span class="main">$</span> nat <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="main">$</span> nat <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fps_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fps_to_fls_eq_0_iff"><span class="command">lemma</span></span> fps_to_fls_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fps_to_fls_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fps_to_fls_eq_iff<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fps_to_fls_eq_1_iff"><span class="command">lemma</span></span> fps_to_fls_eq_1_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="free">f</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fps_to_fls_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fps_to_fls_eq_iff<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fps_to_fls_power"><span class="command">lemma</span></span> fps_to_fls_power<span class="main">:</span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fps_to_fls <span class="free">f</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_times_fps_to_fls<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_as_fps"><span class="command">lemma</span></span> fls_as_fps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fls"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">-</span>fls_subdegree <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fls_shift <span class="free">n</span> <span class="main">(</span>fps_to_fls <span class="free">f'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fls_subdegree <span class="main">(</span>fls_shift <span class="main">(</span><span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fls_shift_nonneg_subdegree<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fls_shift <span class="free">n</span> <span class="main">(</span>fps_to_fls <span class="main">(</span>fls_regpart <span class="main">(</span>fls_shift <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fls_regpart_to_fls_trivial<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_as_fps'"><span class="command">lemma</span></span> fls_as_fps'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fls"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">-</span>fls_subdegree <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f'</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> fls_shift <span class="free">n</span> <span class="main">(</span>fps_to_fls <span class="bound">f'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fls_as_fps<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fls_compose_fps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field fls <span class="main">⇒</span> <span class="tfree">'a</span> fps <span class="main">⇒</span> <span class="tfree">'a</span> fls"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fls_compose_fps</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> fls_subdegree <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> fps_to_fls <span class="main">(</span>fps_compose <span class="main">(</span>fls_regpart <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> fps_to_fls <span class="main">(</span>fps_compose <span class="main">(</span>fls_base_factor_to_fps <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">/</span>
             fps_to_fls <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">^</span> nat <span class="main">(</span><span class="main">-</span>fls_subdegree <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_fps_fps"><span class="command">lemma</span></span> fls_compose_fps_fps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fls_compose_fps <span class="main">(</span>fps_to_fls <span class="free">f</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> fps_to_fls <span class="main">(</span>fps_compose <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_compose_fps_def fls_subdegree_fls_to_fps<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_const_transfer"><span class="command">lemma</span></span> fls_const_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun <span class="main">(=)</span> <span class="main">(</span>pcr_fls <span class="main">(=)</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">c</span> <span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> fls_const"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_const_def rel_fun_def pcr_fls_def OO_def cr_fls_def<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_shift_transfer"><span class="command">lemma</span></span> fls_shift_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_fun <span class="main">(</span>pcr_fls <span class="main">(=)</span><span class="main">)</span> <span class="main">(</span>pcr_fls <span class="main">(=)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> fls_shift"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_const_def rel_fun_def pcr_fls_def OO_def cr_fls_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fls_compose_power <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fls <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fls"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">d</span> <span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> int <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> int <span class="bound">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">d</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> int <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">-</span>int <span class="bound">n</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span> <span class="keyword1">div</span> int <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofinite_eq_sequentially<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_at_top_div_const_nat<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> False <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> int <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">-</span>int <span class="bound">n</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span> <span class="keyword1">div</span> int <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zdiv_int dvd_neg_div<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofinite_eq_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_nth_compose_power"><span class="command">lemma</span></span> fls_nth_compose_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fls_nth <span class="main">(</span>fls_compose_power <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> int <span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> fls_nth <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> int <span class="free">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
     

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_0_left"><span class="command">lemma</span></span> fls_compose_power_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">0</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_1_left"><span class="command">lemma</span></span> fls_compose_power_1_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_compose_power <span class="main">1</span> <span class="free">d</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_const_left"><span class="command">lemma</span></span> fls_compose_power_const_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_compose_power <span class="main">(</span>fls_const <span class="free">c</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_shift"><span class="command">lemma</span></span> fls_compose_power_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_compose_power <span class="main">(</span>fls_shift <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_shift <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>fls_compose_power <span class="free">f</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff add_ac mult_ac<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_X_intpow"><span class="command">lemma</span></span> fls_compose_power_X_intpow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_compose_power <span class="main">(</span>fls_X_intpow <span class="free">n</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_X_intpow <span class="main">(</span>int <span class="free">d</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_X"><span class="command">lemma</span></span> fls_compose_power_X <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_compose_power fls_X <span class="free">d</span> <span class="main">=</span> fls_X_intpow <span class="main">(</span>int <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_X_inv"><span class="command">lemma</span></span> fls_compose_power_X_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_compose_power fls_X_inv <span class="free">d</span> <span class="main">=</span> fls_X_intpow <span class="main">(</span><span class="main">-</span>int <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fls_X_inv_conv_shift_1<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_0_right"><span class="command">lemma</span></span> fls_compose_power_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_compose_power <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_add"><span class="command">lemma</span></span> fls_compose_power_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_compose_power <span class="free">f</span> <span class="free">d</span> <span class="main">+</span> fls_compose_power <span class="free">g</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_diff"><span class="command">lemma</span></span> fls_compose_power_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_compose_power <span class="free">f</span> <span class="free">d</span> <span class="main">-</span> fls_compose_power <span class="free">g</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_uminus"><span class="command">lemma</span></span> fls_compose_power_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> <span class="main">-</span>fls_compose_power <span class="free">f</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fps_nth_compose_X_power"><span class="command">lemma</span></span> fps_nth_compose_X_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="main">(</span>fps_X <span class="main">^</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> fps_nth <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="main">(</span>fps_X <span class="main">^</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>fps_X <span class="main">^</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fps_compose_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>fps_X <span class="main">^</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> fps_nth <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_fps_to_fls"><span class="command">lemma</span></span> fls_compose_power_fps_to_fls<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">(</span>fps_to_fls <span class="free">f</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fps_to_fls <span class="main">(</span>fps_compose <span class="free">f</span> <span class="main">(</span>fps_X <span class="main">^</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fls_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_nth_compose_power fps_nth_compose_X_power
                                 pos_imp_zdiv_neg_iff div_neg_pos_less0 nat_div_distrib
                           <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> int_dvd_int_iff<span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_mult"><span class="command">lemma</span></span> fls_compose_power_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom fls<span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_compose_power <span class="free">f</span> <span class="free">d</span> <span class="main">*</span> fls_compose_power <span class="free">g</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">(</span>max <span class="main">0</span> <span class="main">(</span>max <span class="main">(</span><span class="main">-</span> fls_subdegree <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> fls_subdegree <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> n_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>fls_subdegree <span class="free">f</span> <span class="main">≤</span> int <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>fls_subdegree <span class="free">g</span> <span class="main">≤</span> int <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fls_shift <span class="skolem">n</span> <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fls_as_fps<span class="main">[</span><span class="operator">OF</span> n_ge<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> fls_shift <span class="skolem">n</span> <span class="main">(</span>fps_to_fls <span class="skolem">g'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fls_as_fps<span class="main">[</span><span class="operator">OF</span> n_ge<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f' g' fls_shifted_times_simps mult_ac fls_compose_power_fps_to_fls
                  fps_compose_mult_distrib <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fls_times_fps_to_fls<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_compose_power_power"><span class="command">lemma</span></span> fls_compose_power_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fls_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom fls<span class="main">)</span> <span class="free">d</span> <span class="main">=</span> fls_compose_power <span class="free">f</span> <span class="free">d</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Puiseux_Laurent_Library-fls_nth_compose_power'"><span class="command">lemma</span></span> fls_nth_compose_power' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">⟹</span> fls_nth <span class="main">(</span>fls_compose_power <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fls_nth <span class="main">(</span>fls_compose_power <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fls_nth <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="FPS_Hensel">
<div class="head">
<h1>Theory FPS_Hensel</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    FPS_Hensel.thy
  Author:  Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Hensel's lemma for formal power series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> FPS_Hensel
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span> <a href="Puiseux_Polynomial_Library.html">Puiseux_Polynomial_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following proof of Hensel's lemma for formal power series follows the book
  ``Algebraic Geometry for Scientists and Engineers'' by Abhyankar~\cite[p.~90--92]{abhyankar1990}.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fps_poly_swap1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fps poly <span class="main">⇒</span> <span class="tfree">'a</span> poly fps"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fps_poly_swap1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Abs_fps <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fps_nth <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FPS_Hensel-coeff_fps_nth_fps_poly_swap1"><span class="command">lemma</span></span> coeff_fps_nth_fps_poly_swap1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>fps_nth <span class="main">(</span>fps_poly_swap1 <span class="free">p</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fps_nth <span class="main">(</span>coeff <span class="free">p</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MOST_coeff_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">n</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_poly_swap1_def poly.Abs_poly_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fps_poly_swap2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero poly fps <span class="main">⇒</span> <span class="tfree">'a</span> fps poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fps_poly_swap2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> Abs_fps <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> coeff <span class="main">(</span>fps_nth <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FPS_Hensel-fps_nth_coeff_fps_poly_swap2"><span class="command">lemma</span></span> fps_nth_coeff_fps_poly_swap2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span>coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> coeff <span class="main">(</span>fps_nth <span class="free">p</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MOST_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="bound">m</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> coeff_eq_0 le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">n</span><span class="main">.</span> Abs_fps <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="bound">m</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_zero_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span>coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span>
          poly.coeff <span class="main">(</span>Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> Abs_fps <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">$</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_poly_swap2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Abs_fps <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="bound">n</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly.Abs_poly_inverse<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span>coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> coeff <span class="main">(</span>fps_nth <span class="free">p</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FPS_Hensel-degree_fps_poly_swap2_le"><span class="command">lemma</span></span> degree_fps_poly_swap2_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_le<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fps_ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">=</span> poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_eq_0 le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="free">d</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">$</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FPS_Hensel-degree_fps_poly_swap2_eq"><span class="command">lemma</span></span> degree_fps_poly_swap2_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> fps_nth <span class="free">p</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_nth <span class="free">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span>coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> poly.coeff <span class="main">(</span>fps_nth <span class="free">p</span> <span class="free">n</span><span class="main">)</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="main">≥</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_poly_swap2 <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_fps_poly_swap2_le<span class="main">)</span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reduce_fps_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fps poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduce_fps_poly</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> fps_nth <span class="main">(</span>fps_poly_swap1 <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field fps poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">F</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   degree_reduce_fps_poly_monic<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   reduce_fps_poly_monic<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reduce_fps_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> degree <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> reduce_fps_poly_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">≥</span> degree <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_degree<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 eq2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym le_degree degree_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> eq1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>reduce_fps_poly <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> fps_hensel_aux <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd poly fps"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">g</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_g<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g'</span> <span class="free">h'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">≡</span> fst <span class="main">(</span>bezout_coefficients <span class="free">g</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">≡</span> snd <span class="main">(</span>bezout_coefficients <span class="free">g</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hensel_fpxs_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">×</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hensel_fpxs_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="keyword1">else</span>
     <span class="main">(</span><span class="keyword1">let</span>
        <span class="bound">U</span> <span class="main">=</span> fps_nth <span class="free">F</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">i</span></span><span class="main">,</span><span class="bound"><span class="bound">j</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> fst <span class="main">(</span><span class="free">hensel_fpxs_aux</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span><span class="free">hensel_fpxs_aux</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="main">(</span><span class="bound">U</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="bound">U</span> <span class="main">*</span> <span class="free">h'</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">U</span> <span class="main">*</span> <span class="free">h'</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> hensel_fpxs_aux.simps

<span class="keyword1" id="FPS_Hensel-hensel_fpxs_aux_0"><span class="command">lemma</span></span> hensel_fpxs_aux_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hensel_fpxs_aux <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> hensel_fpxs_aux.simps<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hensel_fpxs1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly fps"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hensel_fpxs1</span> <span class="main">=</span> Abs_fps <span class="main">(</span>fst <span class="main">∘</span> hensel_fpxs_aux<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hensel_fpxs2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly fps"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hensel_fpxs2</span> <span class="main">=</span> Abs_fps <span class="main">(</span>snd <span class="main">∘</span> hensel_fpxs_aux<span class="main">)</span>"</span></span>

<span class="keyword1" id="FPS_Hensel-hensel_fpxs1_0"><span class="command">lemma</span></span> hensel_fpxs1_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hensel_fpxs1 <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hensel_fpxs1_def<span class="main">)</span>

<span class="keyword1" id="FPS_Hensel-hensel_fpxs2_0"><span class="command">lemma</span></span> hensel_fpxs2_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hensel_fpxs2 <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hensel_fpxs2_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> fps_hensel_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> fps_nth <span class="free">F</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">F</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≡</span> hensel_fpxs1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> hensel_fpxs2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="free">G</span> <span class="main">*</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">H</span> <span class="main">0</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">G</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">g</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">H</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">H</span> <span class="main">0</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def H_def hensel_fpxs1_def hensel_fpxs2_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> deg_f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> degree <span class="free">g</span> <span class="main">+</span> degree <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> deg_H<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_nth <span class="free">H</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> deg_h <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hensel_fpxs_aux.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span> hensel_fpxs2_def H_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> degree_mod_less'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms deg_h <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> hensel_fpxs2_def›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">H</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">F</span> <span class="skolem">n</span> <span class="main">=</span> fps_nth <span class="main">(</span><span class="free">G</span> <span class="main">*</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> degree <span class="main">(</span>fps_nth <span class="free">G</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> fst <span class="bound">p</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> snd <span class="bound">p</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> fst <span class="bound">p</span> <span class="main">+</span> snd <span class="bound">p</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{..</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span> <span class="main"><span class="main"><span class="main">×</span></span></span> <span class="main"><span class="main"><span class="main">{..</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hensel_fpxs1_def hensel_fpxs2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> fps_nth <span class="free">F</span> <span class="skolem">n</span> <span class="main">-</span>
         <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">i</span></span><span class="main">,</span><span class="bound"><span class="bound">j</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> fst <span class="main">(</span>hensel_fpxs_aux <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g''</span></span> <span class="skolem"><span class="skolem">h''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g''</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">*</span> <span class="free">g'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h''</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">*</span> <span class="free">h'</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="main">(</span><span class="free">G</span> <span class="main">*</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> fst <span class="main">(</span>hensel_fpxs_aux <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hensel_fpxs1_def hensel_fpxs2_def fps_mult_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">i</span></span><span class="main">,</span><span class="bound"><span class="bound">j</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">.</span> fst <span class="main">(</span>hensel_fpxs_aux <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">fst</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> fst <span class="main">(</span>hensel_fpxs_aux <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 fps_nth <span class="free">F</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">U</span> <span class="main">+</span> <span class="main">(</span>fst <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold U_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="skolem">g''</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">h''</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">h''</span> <span class="keyword1">mod</span> <span class="free">h</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hensel_fpxs_aux.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span> U_def g''_def h''_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h''</span> <span class="keyword1">mod</span> <span class="free">h</span> <span class="main">=</span> <span class="skolem">h''</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">h''</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_div_mult_eq_mod<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g''</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">h''</span> <span class="keyword1">div</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">h''</span> <span class="main">-</span> <span class="skolem">h''</span> <span class="keyword1">div</span> <span class="free">h</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="skolem">h''</span> <span class="main">+</span> <span class="skolem">g''</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">*</span> <span class="main">(</span><span class="free">h'</span> <span class="main">*</span> <span class="free">g</span> <span class="main">+</span> <span class="free">g'</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> g''_def h''_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">*</span> <span class="free">g</span> <span class="main">+</span> <span class="free">g'</span> <span class="main">*</span> <span class="free">h</span> <span class="main">=</span> gcd <span class="free">g</span> <span class="free">h</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g'_def h'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_coefficients_fst_snd<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">g</span> <span class="free">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> coprime <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">F</span> <span class="skolem">n</span> <span class="main">=</span> fps_nth <span class="main">(</span><span class="free">G</span> <span class="main">*</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">G</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">G</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> degree <span class="free">h</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">G</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_mult_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G</span> <span class="skolem">n</span> <span class="main">*</span> <span class="free">h</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">-</span> <span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> G_def hensel_fpxs1_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>fps_nth <span class="free">G</span> <span class="skolem">n</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> degree_diff_less<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>local.hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                degree <span class="free">g</span> <span class="main">+</span> degree <span class="main">(</span>snd <span class="main">(</span>local.hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_mult_le<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>snd <span class="main">(</span>local.hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">h</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> deg_H<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_def hensel_fpxs2_def<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">+</span> degree <span class="free">h</span> <span class="main">=</span> degree <span class="free">f</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> deg_f<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">g</span> <span class="main">*</span> snd <span class="main">(</span>local.hensel_fpxs_aux <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">U</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> U_def
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> degree_diff_less degree_sum_less<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">F</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> deg_f <span class="keyword1"><span class="command">using</span></span> deg_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="main">(</span>hensel_fpxs_aux <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>hensel_fpxs_aux <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    degree <span class="main">(</span>fps_nth <span class="free">G</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> fps_nth <span class="free">H</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold G_def H_def hensel_fpxs1_def hensel_fpxs2_def<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> degree <span class="main">(</span>fps_nth <span class="free">G</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> degree <span class="main">(</span>fps_nth <span class="free">H</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_mult_le<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> degree <span class="free">g</span> <span class="main">+</span> degree <span class="free">h</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> z less.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_strict_mono deg_H<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_f<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_f<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> deg_g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fps_nth <span class="free">F</span> <span class="skolem">n</span> <span class="main">=</span> fps_nth <span class="main">(</span><span class="free">G</span> <span class="main">*</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="free">G</span> <span class="main">*</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>fps_nth <span class="free">G</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fps_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> fps_hensel <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd fps poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="free">g</span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monic<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">F</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> reduce_fps_poly <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_splits<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">g</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_g<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">=</span> fps_poly_swap1 <span class="free">F</span>"</span></span> 

<span class="keyword1"><span class="command">sublocale</span></span> fps_hensel_aux <span class="quoted">F'</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">h</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">fact</span> deg_g deg_h coprime<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">G</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> fps_poly_swap2 hensel_fpxs1"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> fps_poly_swap2 hensel_fpxs2"</span></span>

<span class="keyword1" id="FPS_Hensel-deg_f"><span class="command">lemma</span></span> deg_f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> degree <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>degree <span class="free">F</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> monic <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def reduce_fps_poly_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≥</span> <span class="main">(</span>degree <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_degree<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> degree <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def reduce_fps_poly_def coeff_eq_0<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≤</span> degree <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> degree_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FPS_Hensel-F_splits"><span class="command">lemma</span></span>
  F_splits<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> G <span class="main">*</span> H"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  reduce_G<span class="main">:</span>     <span class="quoted"><span class="quoted">"reduce_fps_poly G <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  reduce_H<span class="main">:</span>     <span class="quoted"><span class="quoted">"reduce_fps_poly H <span class="main">=</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  deg_G<span class="main">:</span>        <span class="quoted"><span class="quoted">"degree G <span class="main">=</span> degree <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  deg_H<span class="main">:</span>        <span class="quoted"><span class="quoted">"degree H <span class="main">=</span> degree <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  lead_coeff_G<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff G <span class="main">=</span> fps_const <span class="main">(</span>lead_coeff <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  lead_coeff_H<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff H <span class="main">=</span> fps_const <span class="main">(</span>lead_coeff <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deg_g deg_h <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> degree <span class="free">F</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> deg_f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="skolem">N</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> monic <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def reduce_fps_poly_def N_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≥</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def reduce_fps_poly_def N_def coeff_eq_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> degree_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F' <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F'_def f_def reduce_fps_poly_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> F'0<span class="main">:</span> <span class="quoted"><span class="quoted">"F' <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_splits <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F'_def f_def reduce_fps_poly_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>F' <span class="main">$</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> F'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI degree_lessI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fps_poly_swap1 <span class="free">F</span> <span class="main">$</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n deg_g deg_h f_splits deg_f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F'0 degree_mult_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>F' <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> coeff <span class="free">F</span> <span class="skolem">k</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> monic <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="skolem">N</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def coeff_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>fps_poly_swap1 <span class="free">F</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> degs_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> degree <span class="main">(</span>F' <span class="main">$</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span>F' <span class="main">$</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹F' <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>›</span></span> deg_f<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> hensel <span class="main">=</span> fps_hensel_aux<span class="main">[</span><span class="operator">OF</span> F'0 degs_less<span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> deg_less1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>hensel_fpxs1 <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> hensel<span class="main">(</span>4<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deg_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>hensel_fpxs1 <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hensel_fpxs1 <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hensel_fpxs1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_imp_le deg_less1 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> deg_less2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>hensel_fpxs2 <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> hensel<span class="main">(</span>5<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deg_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>hensel_fpxs2 <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hensel_fpxs2 <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hensel_fpxs2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_imp_le deg_less2 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> G <span class="main">*</span> H"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_iff fps_eq_iff
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="free">F</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">=</span> poly.coeff <span class="main">(</span>F' <span class="main">$</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F' <span class="main">=</span> hensel_fpxs1 <span class="main">*</span> hensel_fpxs2"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hensel<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> hensel_fpxs1 <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> hensel_fpxs2 <span class="main">$</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fps_mult_nth <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">…</span> <span class="skolem">n</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> coeff <span class="main">(</span>hensel_fpxs1 <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="main">(</span>hensel_fpxs2 <span class="main">$</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_sum coeff_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span>hensel_fpxs1 <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> coeff G <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> G_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg_le1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span>hensel_fpxs2 <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> coeff H <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg_le2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> poly.coeff G <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> poly.coeff H <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> poly.coeff G <span class="bound">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">*</span> poly.coeff H <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly.coeff <span class="main">(</span>G <span class="main">*</span> H<span class="main">)</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mult fps_mult_nth fps_sum_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="free">F</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">=</span> poly.coeff <span class="main">(</span>G <span class="main">*</span> H<span class="main">)</span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduce_fps_poly G <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def reduce_fps_poly_def poly_eq_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg_le1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduce_fps_poly H <span class="main">=</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_def reduce_fps_poly_def poly_eq_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg_le2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree G <span class="main">=</span> degree <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_fps_poly_swap2_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> deg_le1 disjI1 deg_g deg_le2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree H <span class="main">=</span> degree <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_fps_poly_swap2_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> deg_le1 disjI1 deg_h deg_le2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="operator">simp_all</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff G <span class="main">=</span> fps_const <span class="main">(</span>lead_coeff <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fps_ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff G <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="main">(</span>hensel_fpxs1 <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>degree G<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> G_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg_le1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> lead_coeff <span class="free">g</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹degree G <span class="main">=</span> degree <span class="free">g</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coeff_eq_0 deg_less1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff G <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> fps_const <span class="main">(</span>lead_coeff <span class="free">g</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff H <span class="main">=</span> fps_const <span class="main">(</span>lead_coeff <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fps_ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff H <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="main">(</span>hensel_fpxs2 <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>degree H<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> H_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fps_nth_coeff_fps_poly_swap2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg_le2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> lead_coeff <span class="free">h</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹degree H <span class="main">=</span> degree <span class="free">h</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coeff_eq_0 deg_less2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff H <span class="main">$</span> <span class="skolem">n</span> <span class="main">=</span> fps_const <span class="main">(</span>lead_coeff <span class="free">h</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Formal_Puiseux_Series">
<div class="head">
<h1>Theory Formal_Puiseux_Series</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Formal_Puiseux_Series.thy
  Author:  Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formal Puiseux Series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Formal_Puiseux_Series
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Puiseux_Laurent_Library.html">Puiseux_Laurent_Library</a> <a href="FPS_Hensel.html">FPS_Hensel</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary facts and definitions›</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-div_dvd_self"><span class="command">lemma</span></span> div_dvd_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semidom_divide<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Formal_Puiseux_Series-quotient_of_int"><span class="command">lemma</span></span> quotient_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rat.of_int_def quotient_of_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-of_int_div_of_int_in_Ints_iff"><span class="command">lemma</span></span> of_int_div_of_int_in_Ints_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">n</span> <span class="main">/</span> of_int <span class="free">m</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">n</span> <span class="main">/</span> of_int <span class="free">m</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">n</span> <span class="main">/</span> of_int <span class="free">m</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">k</span> <span class="main">*</span> of_int <span class="free">m</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-rat_eq_quotientD"><span class="command">lemma</span></span> rat_eq_quotientD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> rat_of_int <span class="free">a</span> <span class="main">/</span> rat_of_int <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fst <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b'_def quotient_of_denom_pos'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a'</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quotient_of_coprime<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a'_def b'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> rat_of_int <span class="skolem">a'</span> <span class="main">/</span> rat_of_int <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a'_def b'_def quotient_of_div<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span><span class="skolem">a'</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_int_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> r<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coprime_dvd_mult_left_iff<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="keyword1">dvd</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coprime_dvd_mult_right_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a'</span> <span class="skolem">b'</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> coprime_commute›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> a'_def b'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-quotient_of_denom_add_dvd"><span class="command">lemma</span></span> quotient_of_denom_add_dvd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> snd <span class="main">(</span>quotient_of <span class="free">x</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def d_def quotient_of_denom_pos'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> rat_of_int <span class="skolem">a</span> <span class="main">/</span> rat_of_int <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> rat_of_int <span class="skolem">c</span> <span class="main">/</span> rat_of_int <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> a_def b_def c_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_of_div<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rat_eq_quotientD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> rat_of_int <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> xy<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-quotient_of_denom_diff_dvd"><span class="command">lemma</span></span> quotient_of_denom_diff_dvd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> snd <span class="main">(</span>quotient_of <span class="free">x</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_add_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rat_uminus_code Let_def case_prod_unfold<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">supp</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-`</span> <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-supp_0"><span class="command">lemma</span></span> supp_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> supp_const<span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> UNIV<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> supp_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-supp_uminus"><span class="command">lemma</span></span> supp_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> group_add<span class="main">)</span> <span class="main">=</span> supp <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly to formal power series $R[[X]]$ and formal Laurent series $R((X))$, we define the ring
  of formal Puiseux series $R\{\{X\}\}$ as functions from the rationals into a ring such that

    <span class="antiquoted"><span class="antiquoted">▸</span></span> the support is bounded from below, and 

    <span class="antiquoted"><span class="antiquoted">▸</span></span> the denominators of the numbers in the support have a common multiple other than 0

  One can also think of a formal Puiseux series in the paramter $X$ as a formal Laurent series
  in the parameter $X^{1/d}$ for some positive integer $d$. This is often written in the
  following suggestive notation:
  \[ R\{\{X\}\} = \bigcup_{d\geq 1} R((X^{1/d})) \]

  Many operations will be defined in terms of this correspondence between Puiseux and Laurent
  series, and many of the simple properties proven that way.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_fpxs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_fpxs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> bdd_below <span class="main">(</span>supp <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> fpxs <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span><span class="main">::</span>rat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero<span class="main">.</span> is_fpxs <span class="bound">f</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> fpxs_nth Abs_fpxs
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def supp_def<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_fpxs

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_ext"><span class="command">lemma</span></span> fpxs_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> fpxs_nth <span class="free">f</span> <span class="bound">r</span> <span class="main">=</span> fpxs_nth <span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_eq_iff"><span class="command">lemma</span></span> fpxs_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">.</span> fpxs_nth <span class="free">f</span> <span class="bound">r</span> <span class="main">=</span> fpxs_nth <span class="free">g</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_supp <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fpxs <span class="main">⇒</span> rat set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">supp</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_supp_altdef"><span class="command">lemma</span></span> fpxs_supp_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_supp <span class="free">f</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> fpxs_nth <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following gives us the ``root order'' of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span>i, i.e. the smallest positive integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span>
  such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> is in $R((X^{1/p}))$.
›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_root_order <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fpxs <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">.</span> nat <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="bound">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_root_order_pos"><span class="command">lemma</span></span> fpxs_root_order_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_root_order <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_root_order_nonzero"><span class="command">lemma</span></span> fpxs_root_order_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_root_order <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_root_order_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Let <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span> denote the root order of a Puiseux series <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span>, i.e. the smallest number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span> such that
  all monomials with non-zero coefficients can be written in the form $X^{n/d}$ for some <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>.
  Then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> can be written as a Laurent series in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X^{1/d}›</span></span></span></span>. The following operation gives us
  this Laurent series.
›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> fls_of_fpxs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fls"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span>of_int <span class="bound">n</span> <span class="main">/</span> of_int <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="bound">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> <span class="skolem">r0</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bdd_below_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">r0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def vimage_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def is_fpxs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">⌊</span><span class="skolem">r0</span> <span class="main">*</span> of_int <span class="skolem">d</span><span class="main">⌋</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">r0</span> <span class="main">*</span> rat_of_int <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> r0<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">⌊</span><span class="skolem">r0</span> <span class="main">*</span> of_int <span class="skolem">d</span><span class="main">⌋</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_gt_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>of_int <span class="main">(</span><span class="main">-</span><span class="bound">n</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>of_int <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> filterlim_int_sequentially<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>of_int <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofinite_eq_sequentially<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_nth_of_fpxs"><span class="command">lemma</span></span> fls_nth_of_fpxs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fls_nth <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>of_int <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>fpxs_root_order <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic algebraic typeclass instances›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_fpxs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span><span class="main">::</span>rat<span class="main">.</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def supp_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_fpxs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span><span class="main">::</span>rat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_of_fpxs_0"><span class="command">lemma</span></span> fls_of_fpxs_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_0"><span class="command">lemma</span></span> fpxs_nth_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">0</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_1"><span class="command">lemma</span></span> fpxs_nth_1<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">1</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_1'"><span class="command">lemma</span></span> fpxs_nth_1'<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">1</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> fpxs_nth <span class="main">1</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_nth_1<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">)</span> <span class="quoted">monoid_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_fpxs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">g</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">g</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_fpxs_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> supp<span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> supp <span class="skolem">f</span> <span class="main">∪</span> supp <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bdd_below_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ supp<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> fg <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_fpxs_def›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span>
            <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span> <span class="main">∪</span> supp <span class="skolem">g</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Lcm_subset image_mono supp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lcm <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">g</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> image_Un Lcm_Un <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span>
                    lcm <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">g</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">g</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fun_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_add</span><span class="main">)</span> <span class="quoted">comm_monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_add"><span class="command">lemma</span></span> fpxs_nth_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="free">r</span> <span class="main">+</span> fpxs_nth <span class="free">g</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_of_fls <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fls <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofinite_eq_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="main">-</span>int <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_fpxs_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">{</span><span class="main">-</span><span class="main">(</span>of_nat <span class="skolem">N</span><span class="main">::</span>rat<span class="main">)</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">::</span>rat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">-</span>of_nat <span class="skolem">N</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">-</span>int <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> N<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>int <span class="skolem">N</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_nat_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>of_nat <span class="skolem">N</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">::</span>rat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bdd_below_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Lcm_least<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">group_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_fpxs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="bound">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_fpxs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minus_fpxs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_fpxs_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_uminus"><span class="command">lemma</span></span> fpxs_nth_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> <span class="main">-</span>fpxs_nth <span class="free">f</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_minus"><span class="command">lemma</span></span> fpxs_nth_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="free">r</span> <span class="main">-</span> fpxs_nth <span class="free">g</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_fpxs_def fpxs_nth_add fpxs_nth_uminus <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_eq_iff"><span class="command">lemma</span></span> fpxs_of_fls_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="free">f</span> <span class="main">=</span> fpxs_of_fls <span class="free">g</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff Ints_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_0"><span class="command">lemma</span></span> fpxs_of_fls_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_1"><span class="command">lemma</span></span> fpxs_of_fls_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_add"><span class="command">lemma</span></span> fpxs_of_fls_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_of_fls <span class="free">f</span> <span class="main">+</span> fpxs_of_fls <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fps_to_fls_sum"><span class="command">lemma</span></span> fps_to_fls_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fps_to_fls <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_sum"><span class="command">lemma</span></span> fpxs_of_fls_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_of_fls"><span class="command">lemma</span></span> fpxs_nth_of_fls<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> fls_nth <span class="free">f</span> <span class="main">⌊</span><span class="free">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_eq_0_iff"><span class="command">lemma</span></span> fpxs_of_fls_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_of_fls_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fpxs_of_fls_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_eq_1_iff"><span class="command">lemma</span></span> fpxs_of_fls_eq_1_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="free">f</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_of_fls_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fpxs_of_fls_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_root_order_of_fls"><span class="command">lemma</span></span> fpxs_root_order_of_fls <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_root_order <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">`</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def Ints_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nat <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The substitution $X \mapsto X^r$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This operation turns a formal Puiseux series $f(X)$ into $f(X^r)$, where
  $r$ can be any positive rational number:
›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_compose_power <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fpxs <span class="main">⇒</span> rat <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="bound">r</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_fpxs_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> inverse <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">`</span> supp <span class="skolem">f</span> <span class="main">=</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="skolem">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def image_iff vimage_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">`</span> supp <span class="skolem">f</span> <span class="main">=</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r'_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">`</span> supp <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bdd_below_image_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def divide_right_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> eq
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_def quotient_of_denom_pos'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_of_div<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Lcm_mono<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rat_times_code case_prod_unfold Let_def Rat.normalize_def
                    quotient_of_denom_pos' div_dvd_self<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> normalize <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"supp <span class="skolem">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Lcm_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> supp <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">dvd</span>
             <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def supp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_as_fls"><span class="command">lemma</span></span> fpxs_as_fls<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>fpxs_root_order <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_fpxs_def d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span>rat_of_int <span class="main">⌊</span>rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">⌋</span> <span class="main">/</span> rat_of_int <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> of_int <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>rat_of_int <span class="main">⌊</span>rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">⌋</span> <span class="main">/</span> rat_of_int <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>rat_of_int <span class="skolem">n</span> <span class="main">/</span> rat_of_int <span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">n</span> <span class="main">/</span> rat_of_int <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> supp <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> supp <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> of_int_divide_in_Ints<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span>rat_of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_mult mult_ac times_divide_eq_right<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fract_of_int_quotient Rat_cases normalize_stable prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> quotient_of_Fract<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_fpxs_def d_def mult_ac fun_eq_iff <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_0"><span class="command">lemma</span></span> fpxs_compose_power_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">0</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_1"><span class="command">lemma</span></span> fpxs_compose_power_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fpxs_compose_power <span class="main">1</span> <span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_of_fpxs_eq_0_iff"><span class="command">lemma</span></span> fls_of_fpxs_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fls_of_fpxs_0 fpxs_as_fls fpxs_compose_power_0 fpxs_of_fls_0<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_compose_power"><span class="command">lemma</span></span> fpxs_of_fls_compose_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span>fls_compose_power <span class="free">f</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f</span> <span class="skolem">d</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">r</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">n</span> <span class="main">/</span> rat_of_int <span class="main">(</span>int <span class="skolem">d</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_int_div_of_int_in_Ints_iff<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">/</span> rat_of_nat <span class="skolem">d</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_add"><span class="command">lemma</span></span> fpxs_compose_power_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> fpxs_compose_power <span class="free">f</span> <span class="free">r</span> <span class="main">+</span> fpxs_compose_power <span class="free">g</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_distrib"><span class="command">lemma</span></span> fpxs_compose_power_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">r2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> 
     fpxs_compose_power <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r1</span><span class="main">)</span> <span class="free">r2</span> <span class="main">=</span> fpxs_compose_power <span class="free">f</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> zero_less_mult_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_divide_right"><span class="command">lemma</span></span> fpxs_compose_power_divide_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">r2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> 
     fpxs_compose_power <span class="free">f</span> <span class="main">(</span><span class="free">r1</span> <span class="main">/</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r1</span><span class="main">)</span> <span class="main">(</span>inverse <span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_distrib <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_1_right"><span class="command">lemma</span></span> fpxs_compose_power_1_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_eq_iff"><span class="command">lemma</span></span> fpxs_compose_power_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="free">f</span> <span class="free">r</span> <span class="main">=</span> fpxs_compose_power <span class="free">g</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">r</span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_eq_1_iff"><span class="command">lemma</span></span> fpxs_compose_power_eq_1_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="free">p</span> <span class="free">l</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="free">p</span> <span class="free">l</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> fpxs_compose_power <span class="free">p</span> <span class="free">l</span> <span class="main">=</span> fpxs_compose_power <span class="main">1</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_compose_power_1<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_compose_power_eq_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_eq_0_iff"><span class="command">lemma</span></span> fpxs_compose_power_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="free">f</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_compose_power_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_of_fpxs_of_fls"><span class="command">lemma</span></span> fls_of_fpxs_of_fls <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_as_fls'"><span class="command">lemma</span></span> fpxs_as_fls'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fpxs_root_order <span class="free">f</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> fpxs_root_order <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fls_of_fpxs <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d'<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">=</span> fls_compose_power <span class="skolem">f'</span> <span class="skolem">d'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f''</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d' D_def f''_def f'_def fpxs_as_fls fpxs_compose_power_distrib<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Mutiplication and ring properties›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_semiring_1</span><span class="main">)</span> <span class="quoted">comm_semiring_1</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_fpxs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span><span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="bound">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="bound">g</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">g</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span><span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="var">?h</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> is_fpxs_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> fg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bnd1</span></span> <span class="skolem"><span class="skolem">bnd2</span></span> <span class="keyword2"><span class="keyword">where</span></span> bnds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">bnd1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">g</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">bnd2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def bdd_below_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="var">?h</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>supp <span class="skolem">f</span> <span class="main">×</span> supp <span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">rat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> supp <span class="var">?h</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> supp <span class="var">?h</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>supp <span class="skolem">f</span> <span class="main">×</span> supp <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">bnd1</span> <span class="main">+</span> <span class="skolem">bnd2</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bnds <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="var">?h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="skolem">g</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="var">?h</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">*</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Lcm_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> supp <span class="var">?h</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span> <span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> supp <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> supp <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">div</span>
              gcd <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="skolem">z</span><span class="main">)</span> <span class="main">+</span>
                   fst <span class="main">(</span>quotient_of <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">=</span> <span class="main">_</span>›</span></span> rat_plus_code case_prod_unfold Let_def
                      Rat.normalize_def quotient_of_denom_pos'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> snd <span class="main">(</span>quotient_of <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_def dvd_div_mult_self gcd_dvd2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="skolem">d1</span> <span class="main">*</span> <span class="skolem">d2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> yz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d1_def d2_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_dvd_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">d1</span> <span class="main">*</span> <span class="skolem">d2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d1_def d2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">*</span> <span class="skolem">d2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d1_def d2_def is_fpxs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="var">?h</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_mult"><span class="command">lemma</span></span> fpxs_nth_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span><span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> fpxs_supp <span class="free">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> fpxs_supp <span class="free">g</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span> fpxs_nth <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> fpxs_nth <span class="free">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_mult"><span class="command">lemma</span></span> fpxs_compose_power_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> fpxs_compose_power <span class="free">f</span> <span class="free">r</span> <span class="main">*</span> fpxs_compose_power <span class="free">g</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">r</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span><span class="main">.</span>
            <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span><span class="main">.</span>
            <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">z</span> <span class="main">/</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">*</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">*</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> supp_def <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_supp_of_fls"><span class="command">lemma</span></span> fpxs_supp_of_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_supp <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">`</span> supp <span class="main">(</span>fls_nth <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_supp_def fpxs_nth_of_fls supp_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_mult"><span class="command">lemma</span></span> fpxs_of_fls_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_of_fls <span class="free">f</span> <span class="main">*</span> fpxs_of_fls <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fpxs_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r</span> <span class="main">=</span> fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="free">f</span> <span class="main">*</span> fpxs_of_fls <span class="free">g</span><span class="main">)</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">⌊</span><span class="bound">x</span><span class="main">::</span>rat<span class="main">⌋</span><span class="main">,</span> <span class="main">⌊</span><span class="bound">y</span><span class="main">::</span>rat<span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="bound">x</span> <span class="main">::</span> rat<span class="main">,</span> of_int <span class="bound">y</span> <span class="main">::</span> rat<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">df</span></span> <span class="skolem"><span class="skolem">dg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">df</span> <span class="main">=</span> fls_subdegree <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dg</span> <span class="main">=</span> fls_subdegree <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="free">f</span> <span class="main">*</span> fpxs_of_fls <span class="free">g</span><span class="main">)</span> <span class="skolem">r</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span><span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> fpxs_supp <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> fpxs_supp <span class="main">(</span>fpxs_of_fls <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> rat_of_int <span class="skolem">n</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> fls_nth <span class="free">f</span> <span class="main">⌊</span><span class="bound">y</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">z</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> fls_nth <span class="free">g</span> <span class="main">⌊</span><span class="bound">z</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_nth_mult fpxs_nth_of_fls<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span><span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="main">(</span>fls_nth <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="main">(</span>fls_nth <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span>
                      fls_nth <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> fls_nth <span class="free">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h2</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h1_def h2_def fpxs_supp_of_fls<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">y</span></span> <span class="main">|</span> <span class="bound">y</span> <span class="main">-</span> fls_subdegree <span class="free">g</span> <span class="main">∈</span> supp <span class="main">(</span>fls_nth <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> fls_subdegree <span class="free">g</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="main">(</span>fls_nth <span class="free">g</span><span class="main">)</span><span class="main">.</span>
                      fls_nth <span class="free">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> fls_subdegree <span class="free">g</span><span class="main">)</span> <span class="main">*</span> fls_nth <span class="free">g</span> <span class="main">(</span>fls_subdegree <span class="free">g</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> fls_subdegree <span class="free"><span class="free"><span class="free">g</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> fls_subdegree <span class="free"><span class="free"><span class="free">g</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">z</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> fst <span class="bound"><span class="bound"><span class="bound">z</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> fls_subdegree <span class="free"><span class="free"><span class="free">g</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> fls_subdegree <span class="free">f</span> <span class="main">+</span> fls_subdegree <span class="free">g</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span>
              fls_nth <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> fls_subdegree <span class="free">g</span><span class="main">)</span> <span class="main">*</span> fls_nth <span class="free">g</span> <span class="main">(</span>fls_subdegree <span class="free">g</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fls_subdegree_leI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> fls_subdegree_leI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_times_nth fpxs_nth_of_fls<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="free">f</span> <span class="main">*</span> fpxs_of_fls <span class="free">g</span><span class="main">)</span> <span class="skolem">r</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound"><span class="bound">y</span></span><span class="main">,</span><span class="bound"><span class="bound">z</span></span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">∈</span> fpxs_supp <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> fpxs_supp <span class="main">(</span>fpxs_of_fls <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">.</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> fls_nth <span class="free">f</span> <span class="main">⌊</span><span class="bound">y</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">z</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> fls_nth <span class="free">g</span> <span class="main">⌊</span><span class="bound">z</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_nth_mult fpxs_nth_of_fls<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral ballI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_nth_of_fls<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fpxs<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff supp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff supp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff supp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="skolem">g</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> supp <span class="skolem">f</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">}</span><span class="main">.</span> fpxs_root_order <span class="bound">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">g'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">h'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f g h mult_ac
             <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_mult fpxs_compose_power_add fpxs_of_fls_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f g h ring_distribs
             <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_mult fpxs_compose_power_add fpxs_of_fls_mult fpxs_of_fls_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_ring_1</span><span class="main">)</span> <span class="quoted">comm_ring_1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">semiring_no_zero_divisors</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> lcm <span class="main">(</span>fpxs_root_order <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>fpxs_root_order <span class="skolem">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lcm_pos_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">g'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> fg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f g <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_mult fpxs_of_fls_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_power"><span class="command">lemma</span></span> fpxs_of_fls_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fpxs_of_fls <span class="free">f</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_power"><span class="command">lemma</span></span> fpxs_compose_power_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fpxs_compose_power <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> fpxs_compose_power <span class="free">f</span> <span class="free">r</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Constant Puiseux series and the series <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_const <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>rat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>rat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_fpxs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_0"><span class="command">lemma</span></span> fpxs_const_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_const <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_1"><span class="command">lemma</span></span> fpxs_const_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_const <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_const"><span class="command">lemma</span></span> fpxs_of_fls_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span>fls_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fpxs_const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff Ints_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_of_fpxs_const"><span class="command">lemma</span></span> fls_of_fpxs_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="main">(</span>fpxs_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> fls_const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fls_of_fpxs_of_fls fpxs_of_fls_const<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_of_fpxs_1"><span class="command">lemma</span></span> fls_of_fpxs_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fls_of_fpxs_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fls_of_fpxs_const<span class="main">)</span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_X <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>one<span class="main">,</span> zero<span class="main">}</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_altdef"><span class="command">lemma</span></span> fpxs_const_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_const <span class="free">x</span> <span class="main">=</span> fpxs_of_fls <span class="main">(</span>fls_const <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_add"><span class="command">lemma</span></span> fpxs_const_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_const <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fpxs_const <span class="free">x</span> <span class="main">+</span> fpxs_const <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_mult"><span class="command">lemma</span></span> fpxs_const_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fpxs_const <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fpxs_const <span class="free">x</span> <span class="main">*</span> fpxs_const <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fpxs_const_altdef fls_const_mult_const<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> fpxs_of_fls_mult <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_eq_iff"><span class="command">lemma</span></span> fpxs_const_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_const <span class="free">x</span> <span class="main">=</span> fpxs_const <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-of_nat_fpxs_eq"><span class="command">lemma</span></span> of_nat_fpxs_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">=</span> fpxs_const <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_uminus"><span class="command">lemma</span></span> fpxs_const_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_const <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fpxs_const <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_const_diff"><span class="command">lemma</span></span> fpxs_const_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_const <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fpxs_const <span class="free">x</span> <span class="main">-</span> fpxs_const <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_fpxs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-of_int_fpxs_eq"><span class="command">lemma</span></span> of_int_fpxs_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="main">=</span> fpxs_const <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_fpxs_eq<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More algebraic typeclass instances›</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_char_0<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">semiring_char_0</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>of_nat <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fpxs<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> injI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_fpxs_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>comm_ring_1<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">ring_char_0</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">idom</span><span class="main">)</span> <span class="quoted">idom</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">field</span><span class="main">)</span> <span class="quoted">field</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_fpxs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inverse_fpxs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
     fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span>inverse <span class="main">(</span>fls_of_fpxs <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>fpxs_root_order <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_fpxs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divide_fpxs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fls_of_fpxs <span class="skolem">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> fpxs_root_order <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def d_def fpxs_as_fls<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span>inverse <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_fpxs_def f'_def d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span>inverse <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span>
             fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span>inverse <span class="skolem">f'</span> <span class="main">*</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">f'</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divide_fpxs_def inverse_fpxs_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">field_char_0</span><span class="main">)</span> <span class="quoted">field_char_0</span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Valuation›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fpxs_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero fpxs <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fpxs_val</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
     of_int <span class="main">(</span>fls_subdegree <span class="main">(</span>fls_of_fpxs <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> rat_of_nat <span class="main">(</span>fpxs_root_order <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_of_fls"><span class="command">lemma</span></span> fpxs_val_of_fls <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>fls_subdegree <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_val_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_compose_power"><span class="command">lemma</span></span> fpxs_nth_compose_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_of_fpxs_uminus"><span class="command">lemma</span></span> fls_of_fpxs_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fls_of_fpxs <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_root_order_uminus"><span class="command">lemma</span></span> fpxs_root_order_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_root_order <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> fpxs_root_order <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_uminus"><span class="command">lemma</span></span> fpxs_val_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fpxs_val_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_minus_commute"><span class="command">lemma</span></span> fpxs_val_minus_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_val_uminus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fpxs_val_uminus<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_const"><span class="command">lemma</span></span> fpxs_val_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span>fpxs_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_val_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_1"><span class="command">lemma</span></span> fpxs_val_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_val_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-of_int_fls_subdegree_of_fpxs"><span class="command">lemma</span></span> of_int_fls_subdegree_of_fpxs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>fls_subdegree <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="free">f</span> <span class="main">*</span> of_nat <span class="main">(</span>fpxs_root_order <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_val_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_val_nonzero"><span class="command">lemma</span></span> fpxs_nth_val_nonzero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> fpxs_root_order <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fls_of_fpxs <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> fls_subdegree <span class="skolem">f'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="free">f</span> <span class="main">=</span> of_int <span class="skolem">M</span> <span class="main">/</span> of_nat <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def fpxs_val_def N_def f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_as_fls N_def f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">…</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">=</span>
             fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">*</span> rat_of_nat <span class="main">(</span>fpxs_root_order <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_nth_compose_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fls_nth <span class="skolem">f'</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_nth_of_fls<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> val N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fls_nth <span class="skolem">f'</span> <span class="skolem">M</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_below_val"><span class="command">lemma</span></span> fpxs_nth_below_val<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> fpxs_val <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> fpxs_root_order <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fls_of_fpxs <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> fls_subdegree <span class="skolem">f'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="free">f</span> <span class="main">=</span> of_int <span class="skolem">M</span> <span class="main">/</span> of_nat <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def fpxs_val_def N_def f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_as_fls N_def f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> rat_of_nat <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fpxs_nth_compose_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rat_of_nat <span class="skolem">N</span> <span class="main">*</span> <span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">n'</span> <span class="main">=</span> rat_of_nat <span class="skolem">N</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">n'</span> <span class="main">&lt;</span> rat_of_nat <span class="skolem">N</span> <span class="main">*</span> fpxs_val <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n' <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> val N_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fls_nth <span class="skolem">f'</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_nth_of_fls<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_nth_of_fls mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_leI"><span class="command">lemma</span></span> fpxs_val_leI<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> fpxs_val <span class="free">f</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_nth_below_val<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="free">f</span>"</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_0"><span class="command">lemma</span></span> fpxs_val_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_val_def<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_geI"><span class="command">lemma</span></span> fpxs_val_geI<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">&lt;</span> <span class="free">r'</span> <span class="main">⟹</span> fpxs_nth <span class="free">f</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_val <span class="free">f</span> <span class="main">≥</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_nth_val_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_compose_power"><span class="command">lemma</span></span> fpxs_val_compose_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="free">f</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r</span><span class="main">)</span> <span class="main">≤</span> fpxs_val <span class="free">f</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fpxs_val_leI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_nth_val_nonzero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="free">f</span> <span class="main">*</span> <span class="free">r</span> <span class="main">≤</span> fpxs_val <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> fpxs_val_geI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">r'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">&lt;</span> fpxs_val <span class="free">f</span> <span class="main">*</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r'</span>
        <span class="keyword1"><span class="command">unfolding</span></span> fpxs_nth_compose_power<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fpxs_nth_below_val<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_add_ge"><span class="command">lemma</span></span> fpxs_val_add_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">+</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?n</span> <span class="main">≥</span> <span class="main">_</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">&lt;</span> fpxs_val <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">&lt;</span> fpxs_val <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">f</span> <span class="var">?n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="free">g</span> <span class="var">?n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fpxs_nth_below_val<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="var">?n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fpxs_nth_val_nonzero assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_diff_ge"><span class="command">lemma</span></span> fpxs_val_diff_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fpxs_val_add_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_mult_val"><span class="command">lemma</span></span> fpxs_nth_mult_val<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">+</span> fpxs_val <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">*</span> fpxs_nth <span class="free">g</span> <span class="main">(</span>fpxs_val <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> fpxs_supp <span class="free">f</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> fpxs_supp <span class="free">g</span> <span class="main">∧</span> fpxs_val <span class="free">f</span> <span class="main">+</span> fpxs_val <span class="free">g</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">}</span> <span class="main">⊆</span>
        <span class="main">{</span><span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">,</span> fpxs_val <span class="free">g</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False fpxs_val_leI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> fpxs_val_leI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_supp_def supp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">+</span> fpxs_val <span class="free">g</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">,</span> fpxs_val <span class="free">g</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> fpxs_nth <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> fpxs_nth <span class="free">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fpxs_nth_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_supp_def supp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_mult"><span class="command">lemma</span></span> fpxs_val_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> fpxs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="free">f</span> <span class="main">+</span> fpxs_val <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym fpxs_val_leI fpxs_val_geI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> fpxs_val <span class="free">f</span> <span class="main">+</span> fpxs_val <span class="free">g</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fpxs_nth_mult <span class="keyword1"><span class="command">using</span></span> assms fpxs_val_leI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> fpxs_val_leI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> fpxs_nth_mult_val fpxs_nth_val_nonzero›</span><span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_val_power"><span class="command">lemma</span></span> fpxs_val_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> fpxs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> fpxs_val <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> power_0_left›</span><span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_power_val"><span class="command">lemma</span></span> fpxs_nth_power_val <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> fpxs"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>rat_of_nat <span class="free">r</span> <span class="main">*</span> fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">^</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">^</span> Suc <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>rat_of_nat <span class="main">(</span>Suc <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">=</span>
          fpxs_nth <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">f</span> <span class="main">^</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">+</span> fpxs_val <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_nth_mult_val ring_distribs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_nth_mult_val<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_nth_1'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpxs_nth_1'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Powers of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span> and shifting›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_X_power <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">,</span> one<span class="main">}</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">n</span> <span class="main">::</span> rat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_X_power_0"><span class="command">lemma</span></span> fpxs_X_power_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_X_power <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_X_power_add"><span class="command">lemma</span></span> fpxs_X_power_add<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_X_power <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> fpxs_X_power <span class="free">a</span> <span class="main">*</span> fpxs_X_power <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="skolem">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
               <span class="bound">z</span> <span class="main">∈</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="skolem">b</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">=</span><span class="bound">y</span><span class="main">+</span><span class="bound">z</span><span class="main">}</span> <span class="main">=</span>
           <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def fun_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff case_prod_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_X_power_mult"><span class="command">lemma</span></span> fpxs_X_power_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_X_power <span class="main">(</span>rat_of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> fpxs_X_power <span class="free">m</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ring_distribs fpxs_X_power_add<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_X_power"><span class="command">lemma</span></span> fpxs_of_fls_X_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span>fls_shift <span class="free">n</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> fpxs_X_power <span class="main">(</span><span class="main">-</span>rat_of_int <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff Ints_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_int_minus<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_X_power_neq_0"><span class="command">lemma</span></span> fpxs_X_power_neq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_X_power <span class="free">r</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero_neq_one fpxs<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_X_power_eq_1_iff"><span class="command">lemma</span></span> fpxs_X_power_eq_1_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_X_power <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero_neq_one fpxs<span class="main">)</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lift_definition</span></span> fpxs_shift <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">f</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"is_fpxs <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-`</span> supp <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-`</span> supp <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">`</span> supp <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_fpxs <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_fpxs_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-`</span> supp <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bdd_below_image_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> f <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_fpxs_def mono_def›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bdd_below <span class="main">(</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bdd_below_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span>
          <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-`</span> supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Lcm_subset image_mono subset<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq image_image o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> Lcm_mono quotient_of_denom_diff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Lcm <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> supp <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> normalize <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>supp <span class="skolem">f</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"supp <span class="skolem">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Lcm_mult<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">r</span><span class="main">∈</span>supp <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> snd <span class="main">(</span>quotient_of <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_fpxs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_nth_shift"><span class="command">lemma</span></span> fpxs_nth_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_shift <span class="free">r</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_0_left"><span class="command">lemma</span></span> fpxs_shift_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">0</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_add_left"><span class="command">lemma</span></span> fpxs_shift_add_left<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> fpxs_shift <span class="free">m</span> <span class="main">(</span>fpxs_shift <span class="free">n</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_diff_left"><span class="command">lemma</span></span> fpxs_shift_diff_left<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> fpxs_shift <span class="free">m</span> <span class="main">(</span>fpxs_shift <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_shift_add_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_0"><span class="command">lemma</span></span> fpxs_shift_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_add"><span class="command">lemma</span></span> fpxs_shift_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_shift <span class="free">r</span> <span class="free">f</span> <span class="main">+</span> fpxs_shift <span class="free">r</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_uminus"><span class="command">lemma</span></span> fpxs_shift_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fpxs_shift <span class="free">r</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_shift_uminus"><span class="command">lemma</span></span> fpxs_shift_shift_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">(</span>fpxs_shift <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_shift_add_left<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_shift_uminus'"><span class="command">lemma</span></span> fpxs_shift_shift_uminus' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">(</span>fpxs_shift <span class="free">r</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_shift_add_left<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_diff"><span class="command">lemma</span></span> fpxs_shift_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> fpxs_shift <span class="free">r</span> <span class="free">f</span> <span class="main">-</span> fpxs_shift <span class="free">r</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_fpxs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_shift_add<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_compose_power"><span class="command">lemma</span></span> fpxs_shift_compose_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">(</span>fpxs_compose_power <span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_shift <span class="main">(</span><span class="free">r</span> <span class="main">/</span> <span class="free">s</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib add_ac <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-rat_of_int_div_dvd"><span class="command">lemma</span></span> rat_of_int_div_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">⟹</span> rat_of_int <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="free">n</span> <span class="main">/</span> rat_of_int <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_of_fls_shift"><span class="command">lemma</span></span> fpxs_of_fls_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span>fls_shift <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fpxs_shift <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span> <span class="main">(</span>fpxs_of_fls <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">rat</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">+</span> rat_of_int <span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟷</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_add Ints_diff Ints_of_int add_diff_cancel_right'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">⌊</span><span class="skolem">r</span><span class="main">⌋</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">+</span> rat_of_int <span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">⌊</span><span class="skolem">r</span> <span class="main">+</span> rat_of_int <span class="skolem">n</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_mult"><span class="command">lemma</span></span> fpxs_shift_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> fpxs_shift <span class="free">r</span> <span class="free">g</span> <span class="main">=</span> fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
                       <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fract_of_int_quotient of_int_of_nat_eq quotient_of_unique zero_less_imp_eq_int<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lcm <span class="skolem">b</span> <span class="main">(</span>lcm <span class="main">(</span>fpxs_root_order <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_root_order <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="skolem">g'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sr_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> rat_of_nat <span class="skolem">s</span> <span class="main">=</span> rat_of_int <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab <span class="dynamic"><span class="dynamic">field_simps</span></span> of_rat_divide of_rat_mult n_def rat_of_int_div_dvd<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> fpxs_shift <span class="free">r</span> <span class="free">g</span> <span class="main">=</span> fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="main">=</span> fpxs_shift <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f g <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_mult fpxs_of_fls_mult fpxs_of_fls_shift
                 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sr_eq fls_shifted_times_simps mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_1"><span class="command">lemma</span></span> fpxs_shift_1<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">r</span> <span class="main">1</span> <span class="main">=</span> fpxs_X_power <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_X_power_conv_shift"><span class="command">lemma</span></span> fpxs_X_power_conv_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_X_power <span class="free">r</span> <span class="main">=</span> fpxs_shift <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_shift_1<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_shift_power"><span class="command">lemma</span></span> fpxs_shift_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="free">n</span> <span class="free">x</span> <span class="main">^</span> <span class="free">m</span> <span class="main">=</span> fpxs_shift <span class="main">(</span>of_nat <span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fpxs_shift_mult <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_shift_add_left<span class="main">)</span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_compose_power_X_power"><span class="command">lemma</span></span> fpxs_compose_power_X_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> fpxs_compose_power <span class="main">(</span>fpxs_X_power <span class="free">r</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> fpxs_X_power <span class="main">(</span><span class="free">r</span> <span class="main">*</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>-th root of a Puiseux series›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we define the formal root of a Puiseux series. This is done using the
  same concept for formal power series. There is still one interesting theorems that is missing
  here, e.g.\ the uniqueness (which could probably be lifted over from FPSs) somehow.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fpxs_radical</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fpxs_radical</span> <span class="free"><span class="bound"><span class="entity">rt</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f'</span> <span class="main">=</span> fls_base_factor_to_fps <span class="main">(</span>fls_of_fpxs <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">;</span>
          <span class="bound">f''</span> <span class="main">=</span> fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="main">(</span>fps_radical <span class="free"><span class="bound"><span class="entity">rt</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span>  fpxs_shift <span class="main">(</span><span class="main">-</span>fpxs_val <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">/</span> rat_of_nat <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>
            <span class="main">(</span>fpxs_compose_power <span class="bound">f''</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="main">(</span>fpxs_root_order <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fpxs_radical_0"><span class="command">lemma</span></span> fpxs_radical_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_radical_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> fpxs_power_radical<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="free">rt</span> <span class="free">r</span> <span class="main">(</span>fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="free">f</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fpxs_radical_lead_coeff<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> fpxs_nth <span class="main">(</span>fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">/</span> rat_of_nat <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
                       <span class="free">rt</span> <span class="free">r</span> <span class="main">(</span>fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> fpxs_root_order <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> fls_base_factor_to_fps <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_nth <span class="skolem">f'</span> <span class="main">0</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def fls_nth_of_fpxs of_int_fls_subdegree_of_fpxs<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">=</span> fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="main">(</span>fps_radical <span class="free">rt</span> <span class="free">r</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"fls_of_fpxs <span class="free">f</span> <span class="main">=</span> fls_shift <span class="main">(</span><span class="main">-</span>fls_subdegree <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fls_conv_base_factor_to_fps_shift_subdegree<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fpxs_as_fls<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> eq1
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span>fls_shift <span class="main">(</span><span class="main">-</span> fls_subdegree <span class="main">(</span>fls_of_fpxs <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             fpxs_shift <span class="main">(</span><span class="main">-</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">*</span> rat_of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_fls_subdegree_of_fpxs q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_compose_power <span class="main">(</span>fpxs_shift <span class="main">(</span><span class="main">-</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">*</span> rat_of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">(</span>fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rt</span> <span class="free">r</span> <span class="main">(</span>fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="free">f</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="main">(</span>fps_radical <span class="free">rt</span> <span class="free">r</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_to_fls_power f''_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_radical <span class="free">rt</span> <span class="free">r</span> <span class="skolem">f'</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> <span class="skolem">f'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> power_radical<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f'</span></span> <span class="quoted"><span class="free">rt</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> r rt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_nth_val_nonzero<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">(</span><span class="main">-</span>fpxs_val <span class="free">f</span> <span class="main">/</span> rat_of_nat <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fpxs_compose_power <span class="skolem">f''</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span>
              fpxs_shift <span class="main">(</span><span class="main">-</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_compose_power <span class="main">(</span><span class="skolem">f''</span> <span class="main">^</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> r
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fpxs_shift_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fpxs_compose_power_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">(</span><span class="main">-</span>fpxs_val <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_compose_power
                   <span class="main">(</span>fpxs_of_fls <span class="main">(</span>fps_to_fls <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="free">f</span> <span class="main">^</span> <span class="free">r</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_radical_def f'_def f''_def q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> r <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_shift <span class="main">(</span><span class="main">-</span>fpxs_val <span class="free">f</span> <span class="main">/</span> of_nat <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fpxs_compose_power <span class="skolem">f''</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">/</span> of_nat <span class="free">r</span><span class="main">)</span> <span class="main">=</span> fpxs_nth <span class="skolem">f''</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_shift <span class="main">(</span><span class="main">-</span>fpxs_val <span class="free">f</span> <span class="main">/</span> of_nat <span class="free">r</span><span class="main">)</span> <span class="main">(</span>fpxs_compose_power <span class="skolem">f''</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_radical_def q_def f'_def f''_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="skolem">f''</span> <span class="main">0</span> <span class="main">=</span> <span class="free">rt</span> <span class="free">r</span> <span class="main">(</span>fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f''_def fpxs_nth_of_fls<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fpxs_nth <span class="main">(</span>fpxs_radical <span class="free">rt</span> <span class="free">r</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="free">f</span> <span class="main">/</span> rat_of_nat <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
                  <span class="free">rt</span> <span class="free">r</span> <span class="main">(</span>fpxs_nth <span class="free">f</span> <span class="main">(</span>fpxs_val <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formal_Puiseux_Series-fls_base_factor_power"><span class="command">lemma</span></span> fls_base_factor_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> fls"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fls_base_factor <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> fls_base_factor <span class="free">f</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> False <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fls_base_factor_mult <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fls_times_both_shifted_simp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(* TODO: Uniqueness of radical. Also: composition and composition inverse *)</span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> supp


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algebraic closedness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We will now show that the field of formal Puiseux series over an algebraically closed field of
  characteristic 0 is again algebraically closed.

  The typeclass constraint <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹field_gcd›</span></span> is a technical constraint that mandates that
  the field has a (trivial) GCD operation defined on it. It comes from some peculiarities of
  Isabelle's typeclass system and can be considered unimportant, since any concrete type of
  class <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹field›</span></span> can easily be made an instance of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹field_gcd›</span></span>.

  It would be possible to get rid of this constraint entirely here, but it is not worth
  the effort.

  The proof is a fairly standard one that uses Hensel's lemma. Some preliminary tricks are
  required to be able to use it, however, namely a number of non-obvious changes of variables
  to turn the polynomial with Puiseux coefficients into one with formal power series coefficients.
  The overall approach was taken from an article by Nowak~\cite{nowak2000}.

  Basically, what we need to show is this: Let 
  \[p(X,Z) = a_n(Z) X^n + a_{n-1}(Z) X^{n-1} + \ldots + a_0(Z)\]
  be a polynomial in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span> of degree at least 2
  with coefficients that are formal Puiseux series in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Z›</span></span></span></span>. Then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> is reducible, i.e. it splits
  into two non-constant factors.

  Due to work we have already done elsewhere, we may assume here that $a_n = 1$, $a_{n-1} = 0$, and
  $a_0 \neq 0$, all of which will come in very useful.
›</span></span>

<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>alg_closed_field<span class="main">,</span> field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">alg_closed_field</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> alg_closedI_reducible_coeff_deg_minus_one_eq_0<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> deg_p<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> lc_p<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> coeff_deg_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">(</span>degree <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Let $a_0, \ldots, a_n$ be the coefficients of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> with $a_n = 1$. Now let <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>r›</span></span></span></span> be the maximum of
    $-\frac{\text{val}(a_i)}{n-i}$ ranging over all $i &lt; n$ such that $a_i \neq 0$.
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="main">::</span> <span class="quoted">rat</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">MAX</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">i</span></span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span>
                  <span class="main">-</span>fpxs_val <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">-</span> rat_of_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We write $r = a / b$ such that all the $a_i$ can be written as Laurent series in
    $X^{1/b}$, i.e. the root orders of all the $a_i$ divide $b$:
  ›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_nat <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="skolem">N</span><span class="main">.</span> fpxs_root_order <span class="main">(</span>coeff <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> lcm <span class="main">(</span>nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> fpxs_root_order <span class="main">(</span>coeff <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span> <span class="keyword1">div</span> nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> int <span class="skolem">x</span>"</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def b_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_eq <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> rat_of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>int <span class="main">(</span>nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> quotient_of_div<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rat_of_int <span class="skolem">a</span> <span class="main">/</span> rat_of_nat <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def b_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> rat_of_int <span class="skolem">a</span> <span class="main">/</span> rat_of_nat <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="skolem">N</span><span class="main">.</span> fpxs_root_order <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We write all the coefficients of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> as Laurent series in $X^{1/b}$:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_root_order <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>3<span class="main">)</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> fpxs_as_fls'<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c_aux</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_aux<span class="main">:</span>
    <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span><span class="skolem">c_aux</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="keyword1">then</span> <span class="skolem">c_aux</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>fpxs_of_fls <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> rat_of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> c_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def N_def coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c_eq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>rat_of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fpxs_compose_power_distrib<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We perform another change of variables and multiply with a suitable power of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span> to turn our
    Laurent coefficients into FPS coefficients:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> fls_X_intpow <span class="main">(</span><span class="main">(</span>int <span class="skolem">N</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c'_def N_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> subdegree_c<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>fls_subdegree <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> rat_of_nat <span class="skolem">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>fls_subdegree <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fpxs_val <span class="main">(</span>fpxs_of_fls <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_of_fls <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> fpxs_compose_power <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>rat_of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> c_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">…</span> <span class="main">=</span> fpxs_val <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> rat_of_nat <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now write all the coefficients as FPSs:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c''</span><span class="main">.</span> <span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">=</span> fps_to_fls <span class="bound">c''</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">=</span> fps_to_fls <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c'_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> r_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≥</span> <span class="main">-</span>fpxs_val <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">-</span> rat_of_nat <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> i that False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max.coboundedI<span class="main">)</span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fls_subdegree <span class="main">(</span><span class="skolem">c'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> fls_subdegree <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="skolem">N</span> <span class="main">-</span> int <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i that False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c'_def fls_X_intpow_times_conv_shift subdegree_c<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">…</span> <span class="main">=</span>
                   fpxs_val <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span>of_nat <span class="skolem">N</span> <span class="main">-</span> of_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> of_int <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i that False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdegree_c<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">N</span> <span class="main">-</span> of_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span>
                        <span class="main">(</span>fpxs_val <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="skolem">N</span> <span class="main">-</span> of_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ab<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r_ge that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fls_subdegree <span class="main">(</span><span class="skolem">c'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c''</span><span class="main">.</span> <span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">=</span> fls_shift <span class="main">0</span> <span class="main">(</span>fps_to_fls <span class="bound">c''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fls_as_fps'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c''_aux</span></span> <span class="keyword2"><span class="keyword">where</span></span> c''_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">=</span> fps_to_fls <span class="main">(</span><span class="skolem">c''_aux</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="keyword1">then</span> <span class="skolem">c''_aux</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">=</span> fps_to_fls <span class="main">(</span><span class="skolem">c''</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c'_def c''_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c''_def c''_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c''_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fps_to_fls <span class="main">(</span><span class="skolem">c''</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> c'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> Abs_poly <span class="skolem">c''</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> coeff_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">c''</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_Abs_poly<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def coeff_eq_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c'_def fls_shift_eq0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We set up some homomorphisms to convert between the two polynomials:
  ›</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> comppow<span class="main">:</span> map_poly_inj_idom_hom <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> fpxs<span class="main">.</span> fpxs_compose_power <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>rat_of_nat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lift_poly</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fps poly <span class="main">⇒</span> <span class="tfree">'a</span> fpxs poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">lift_poly</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> pcompose <span class="bound">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> fpxs_X_power <span class="skolem">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">∘</span>
                  <span class="main">(</span>map_poly <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fpxs_compose_power <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>rat_of_nat <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> fpxs_of_fls <span class="main">∘</span> fps_to_fls<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">lift_poly</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lift_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_map_poly<span class="main">)</span>
  
  <span class="keyword1"><span class="command">interpret</span></span> fps_to_fls<span class="main">:</span> map_poly_inj_idom_hom <span class="quoted">fps_to_fls</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fls_times_fps_to_fls<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> fpxs_of_fls<span class="main">:</span> map_poly_inj_idom_hom <span class="quoted">fpxs_of_fls</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">interpret</span></span> lift_poly<span class="main">:</span> inj_idom_hom <span class="quoted"><span class="skolem">lift_poly</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lift_poly_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_idom_hom_compose inj_idom_hom_pcompose inj_idom_hom.inj_idom_hom_map_poly
              fps_to_fls.base.inj_idom_hom_axioms fpxs_of_fls.base.inj_idom_hom_axioms
              comppow.base.inj_idom_hom_axioms<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">interpret</span></span> lift_poly<span class="main">:</span> map_poly_inj_idom_hom <span class="quoted"><span class="skolem">lift_poly</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> fpxs_X_power <span class="main">(</span><span class="main">-</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Now, finally: the original polynomial and the new polynomial are related through the
    <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">lift_poly</span></span>›</span></span></span></span> homomorphism:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> smult <span class="skolem">C</span> <span class="main">(</span><span class="skolem">lift_poly</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_eqI<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_map_poly coeff_pcompose_linear coeff_p' c c''_eq c'_def C_def
                      ring_distribs fpxs_X_power_conv_shift fpxs_shift_mult lift_poly_def ab<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fpxs_X_power_add fpxs_X_power_mult fpxs_shift_add_left<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lc_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c''_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_p' <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coeff_deg_minus_1 <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq lift_poly_def coeff_map_poly coeff_pcompose_linear<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We reduce $p'(X,Z)$ to $p'(X,0)$:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'_proj</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">=</span> reduce_fps_poly <span class="skolem">p'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'_proj</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_proj_def <span class="keyword1"><span class="command">using</span></span> lc_p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_reduce_fps_poly_monic<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> lc_p'_proj<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p'_proj</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_proj_def <span class="keyword1"><span class="command">using</span></span> lc_p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> reduce_fps_poly_monic<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'_proj</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_proj_def reduce_fps_poly_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now show that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">p'_proj</span></span>›</span></span></span></span> splits into non-trivial coprime factors. To do this, we
    have to show that it has two distinct roots, i.e. that it is not of the form $(X - c)^n$.
  ›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">g</span> <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'_proj</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deg_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> be an arbitrary root of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">p'_proj</span></span>›</span></span></span></span>:›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'_proj</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> alg_closed_imp_poly_has_root<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'_proj</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Assume for the sake of contradiction that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">p'_proj</span></span>›</span></span></span></span> were equal to $(1-x)^n$:›</span></span>
    <span class="keyword1"><span class="command">have</span></span> not_only_one_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">≠</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">N</span>"</span></span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> were non-zero, all the coefficients of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p'_proj›</span></span></span></span> would also be non-zero by the
        Binomial Theorem. Since we know that the coefficient of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n - 1›</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹is›</span></span> zero, this means
        that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> must be zero:
      ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'_proj</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coeff_linear_poly_power<span class="main">)</span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        However, by our choice of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>r›</span></span></span></span>, we know that there is an index <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span> such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c' i›</span></span></span></span> has
        is non-zero and has valuation (i.e. subdegree) 0, which means that the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span>-th coefficient
        of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">p'_proj</span></span>›</span></span></span></span> must also be non-zero.
      ›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">N</span> <span class="main">∧</span> coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> deg_p <span class="quoted"><span class="quoted">‹coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">i</span></span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span>fpxs_val <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">-</span> rat_of_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
              <span class="main">{</span><span class="bound"><span class="bound">i</span></span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">N</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> deg_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_in<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="main">-</span>fpxs_val <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">-</span> rat_of_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span>fls_subdegree <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> rat_of_nat <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subdegree_c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> i <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fpxs_val <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span>rat_of_nat <span class="skolem">N</span> <span class="main">-</span> rat_of_nat <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>fls_subdegree <span class="main">(</span><span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">N</span> <span class="main">-</span> of_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">i</span> <span class="main">=</span> fls_shift <span class="main">(</span><span class="main">(</span>int <span class="skolem">N</span> <span class="main">-</span> int <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c'_def ring_distribs fls_X_intpow_times_conv_shift
                         <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> fls_shifted_times_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fls_subdegree <span class="main">…</span> <span class="main">=</span> fls_subdegree <span class="main">(</span><span class="skolem">c'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="skolem">N</span> <span class="main">-</span> int <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fls_shift_subdegree<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fls_subdegree <span class="main">(</span><span class="skolem">c'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"subdegree <span class="main">(</span>coeff <span class="skolem">p'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> c''_eq <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fls_subdegree_fls_to_fps coeff_p'<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> c' coeff_p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subdegree_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> coeff <span class="skolem">p'_proj</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_proj_def reduce_fps_poly_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> coeff_linear_poly_power<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> i <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      We can thus obtain our second root <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> from the factorisation:
    ›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">∧</span> poly <span class="skolem">p'_proj</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">∧</span> poly <span class="skolem">p'_proj</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">A</span> <span class="main">=</span> degree <span class="skolem">p'_proj</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="skolem">p'_proj</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> alg_closed_imp_factorization<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'_proj</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p'_proj</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lc_p'_proj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> A<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_prod_mset<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> replicate_mset <span class="skolem">N</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_mset_subset_singletonD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> A<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'_proj</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lc_p'_proj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> not_only_one_root <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'_proj</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      It now follows easily that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">p'_proj</span></span>›</span></span></span></span> splits into non-trivial and coprime factors:
    ›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> alg_closed_imp_poly_splits_coprime<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'_proj</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> deg_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'_proj</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'_proj</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    By Hensel's lemma, these factors give rise to corresponding factors of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p'›</span></span></span></span>:
  ›</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> hensel<span class="main">:</span> fps_hensel <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">p'_proj</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">h</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lc_p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> gh <span class="quoted"><span class="quoted">‹coprime <span class="skolem">g</span> <span class="skolem">h</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> p'_proj_def›</span><span class="main">)</span> 

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All that remains now is to undo the variable substitutions we did above:›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">C</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">lift_poly</span> hensel.G <span class="main">*</span> <span class="skolem">lift_poly</span> hensel.H"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> hensel.F_splits<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reducible_polyI<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> hensel.deg_G hensel.deg_H gh <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We do not actually show that this is the algebraic closure since this cannot be stated
  idiomatically in the typeclass setting and is probably not very useful either, but it can
  be motivated like this:

  Suppose we have an algebraically closed extension $L$ of the field of Laurent series. Clearly,
  $X^{a/b}\in L$ for any integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span> and any positive integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span> since
  $(X^{a/b})^b - X^a = 0$. But any Puiseux series $F(X)$ with root order <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span> can
  be written as
  \[F(X) = \sum_{k=0}^{b-1} X^{k/b} F_k(X)\]
  where the Laurent series $F_k(X)$ are defined as follows:
  \[F_k(X) := \sum_{n = n_{0,k}}^\infty [X^{n + k/b}] F(X) X^n\]
  Thus, $F(X)$ can be written as a finite sum of products of elements in $L$ and must therefore
  also be in $L$. Thus, the Puiseux series are all contained in $L$.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Metric and topology›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Formal Puiseux series form a metric space with the usual metric for formal series:
  Two series are ``close'' to one another if they have many initial coefficients in common.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">)</span> <span class="quoted">norm</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">norm_fpxs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"norm <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>of_rat <span class="main">(</span>fpxs_val <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">dist</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">dist_fpxs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs <span class="main">⇒</span> <span class="tfree">'a</span> fpxs <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"dist <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>of_rat <span class="main">(</span>fpxs_val <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">metric_space</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> uniformity_fpxs_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>uniformity <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> fpxs <span class="main">×</span> <span class="tfree">'a</span> fpxs<span class="main">)</span> filter<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> open_fpxs_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> fpxs set<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> uniformity<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fpxs"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">≤</span> dist <span class="skolem">f</span> <span class="skolem">h</span> <span class="main">+</span> dist <span class="skolem">g</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="skolem">h</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">-</span>real_of_rat <span class="main">(</span>min <span class="main">(</span>fpxs_val <span class="main">(</span><span class="skolem">f</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fpxs_val <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fpxs_val_add_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">-</span> <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">-</span> <span class="skolem">g</span>"</span></span><span class="main">]</span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fpxs_val_minus_commute dist_fpxs_def of_rat_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> dist <span class="skolem">f</span> <span class="skolem">h</span> <span class="main">+</span> dist <span class="skolem">g</span> <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_fpxs_def min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_fpxs_def fpxs_val_minus_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uniformity_fpxs_def open_fpxs_def dist_fpxs_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instance</span></span> fpxs <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">dist_norm</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_fpxs_def norm_fpxs_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>