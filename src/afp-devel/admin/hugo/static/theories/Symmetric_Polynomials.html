<div id="Vieta">
<div class="head">
<h1>Theory Vieta</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Vieta.thy
  Author:   Manuel Eberl (TU München)

  Vieta's formulas expressing the coefficients of a factored univariate polynomial in
  terms of its roots.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Vieta's Formulas›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Vieta
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary material›</span></span>

<span class="keyword1" id="Vieta-card_vimage_inter"><span class="command">lemma</span></span> card_vimage_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vieta-bij_betw_image_fixed_card_subset"><span class="command">lemma</span></span> bij_betw_image_fixed_card_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inj_on_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">f</span></span></span> <span class="main"><span class="main"><span class="main">-`</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span> <span class="main"><span class="main"><span class="main">∩</span></span></span> <span class="free"><span class="free"><span class="free">A</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_image card_vimage_inter<span class="main">)</span>

<span class="keyword1" id="Vieta-image_image_fixed_card_subset"><span class="command">lemma</span></span> image_image_fixed_card_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_imp_surj_on<span class="main">[</span><span class="operator">OF</span> bij_betw_image_fixed_card_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Vieta-prod_uminus"><span class="command">lemma</span></span> prod_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> prod_sum_PiE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>PiE <span class="free">A</span> <span class="free">B</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="free">B</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">(</span><span class="bound">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> undefined <span class="keyword1">else</span> <span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext prod.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">(</span><span class="bound">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span> <span class="skolem">x</span> <span class="main">×</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="skolem">A</span> <span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">g</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">g</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">:=</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">g</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">g</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">g</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">:=</span></span></span> undefined<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PiE_def extensional_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="skolem">A</span> <span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cartesian_product<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="skolem">A</span> <span class="free">B</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.swap<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="skolem">A</span> <span class="free">B</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> insert.IH <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> prod_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f1</span> <span class="free">f2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV<span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">f1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_sum_PiE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> UNIV <span class="main">::</span> bool set"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="free">f1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">f2</span> <span class="bound">x</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_bool add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="keyword1">then</span> <span class="free">f1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness
          <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">X</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> <span class="free"><span class="free"><span class="free">A</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> undefined"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">∈</span></span></span><span class="free"><span class="free"><span class="free">A</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="keyword1">then</span> <span class="free">f1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">f2</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f1</span> <span class="skolem">X</span> <span class="main">*</span> prod <span class="free">f2</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> prod <span class="var">?f</span> <span class="skolem">X</span> <span class="main">*</span> prod <span class="var">?f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(*)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> prod.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prod <span class="var">?f</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> prod_diff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f1</span> <span class="free">f2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">-</span><span class="free">f2</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="main">-</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> prod <span class="free">f1</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_add<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> prod <span class="free">f1</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> prod_diff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f1</span> <span class="free">f2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="main">-</span><span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_add<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_uminus mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="bound">X</span><span class="main">.</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> card_Diff_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Main proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Our goal is to determine the coefficients of some fully factored polynomial
  $p(X) = c (X - x_1) \ldots (X - x_n)$ in terms of the $x_i$. It is clear that it is
  sufficient to consider monic polynomials (i.e. $c = 1$), since the general case follows
  easily from this one.

  We start off by expanding the product over the linear factors:
›</span></span>
<span class="keyword1" id="Vieta-poly_from_roots"><span class="command">lemma</span></span> poly_from_roots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> monom <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">-</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> monom <span class="main">1</span> <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_diff1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_altdef mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> monom <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'b</span> poly<span class="main">)</span> <span class="main">^</span> card <span class="skolem">X</span> <span class="main">=</span> <span class="main">[:</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="skolem">X</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_pCons <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Comparing coefficients yields Vieta's formula:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> coeff_poly_from_roots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="free">A</span><span class="main">.</span> monom <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_from_roots fin<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">…</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_sum coeff_monom <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ fin<span class="main">]</span> k card_mono<span class="main">[</span><span class="operator">OF</span> fin<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Diff_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If the roots are all distinct, we can get the following alternative representation:
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> coeff_poly_from_roots'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">∏</span><span class="bound">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_poly_from_roots assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">.</span> <span class="main">∏</span><span class="main">(</span><span class="free">f</span><span class="main">`</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="main">∏</span><span class="bound">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_on_image inj_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">-</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_image_fixed_card_subset inj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Symmetric_Polynomials">
<div class="head">
<h1>Theory Symmetric_Polynomials</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Symmetric_Polynomials.thy
  Author:   Manuel Eberl (TU München)

  The definition of symmetric polynomials and the elementary symmetric polynomials.
  Proof of the fundamental theorem of symmetric polynomials and its corollaries.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Symmetric Polynomials›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Symmetric_Polynomials
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Vieta.html">Vieta</a>
  <span class="quoted">"<a href="../Polynomials/More_MPoly_Type.html">Polynomials.More_MPoly_Type</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Permutations.html">HOL-Library.Permutations</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary facts›</span></span>

<span class="comment1">(*
  TODO: Many of these facts and definitions should be moved elsewhere, especially
  the ones on polynomials (leading monomial, mapping, insertion etc.)
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An infinite set has infinitely many infinite subsets.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-infinite_infinite_subsets"><span class="command">lemma</span></span> infinite_infinite_subsets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> infinite <span class="bound">X</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> infinite <span class="bound">X</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_arbitrarily_large<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> infinite <span class="bound">X</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">A</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">Y</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> infinite <span class="main">(</span><span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">f</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">l</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> injI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> infinite <span class="bound">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> infinite_iff_countable_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An infinite set contains infinitely many finite subsets of any fixed nonzero cardinality.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-infinite_card_subsets"><span class="command">lemma</span></span> infinite_card_subsets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_arbitrarily_large<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> insert <span class="bound">x</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_image_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-comp_bij_eq_iff"><span class="command">lemma</span></span> comp_bij_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_is_surj<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-sum_list_replicate"><span class="command">lemma</span></span> sum_list_replicate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>replicate <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> semiring_1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-ex_subset_of_card"><span class="command">lemma</span></span> ex_subset_of_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">B</span></span><span class="main">⊆</span><span class="skolem">A</span><span class="main">.</span> card <span class="bound">B</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> insert.IH<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">B</span> <span class="main">⊆</span> insert <span class="skolem">x</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert B finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card.insert_remove<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-length_sorted_list_of_set"><span class="command">lemma</span></span> length_sorted_list_of_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sorted_list_of_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> distinct_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Symmetric_Polynomials-upt_add_eq_append'"><span class="command">lemma</span></span> upt_add_eq_append'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="free">j</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> upt_add_eq_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="free">j</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subrings and ring homomorphisms›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ring_closed <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uminus_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Symmetric_Polynomials-minus_closed"><span class="command">lemma</span></span> minus_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span> uminus_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-sum_closed"><span class="command">lemma</span></span> sum_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="free">X</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-power_closed"><span class="command">lemma</span></span> power_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_closed"><span class="command">lemma</span></span> Sum_any_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Sum_any <span class="free">f</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Sum_any.expand_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_closed<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-prod_closed"><span class="command">lemma</span></span> prod_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> prod <span class="free">f</span> <span class="free">X</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-Prod_any_closed"><span class="command">lemma</span></span> Prod_any_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Prod_any <span class="free">f</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Prod_any.expand_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_closed<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-prod_fun_closed"><span class="command">lemma</span></span> prod_fun_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> prod_fun <span class="free">f</span> <span class="free">g</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_fun_def when_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sum_any_closed mult_closed<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-of_nat_closed"><span class="command">lemma</span></span> of_nat_closed <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-of_int_closed"><span class="command">lemma</span></span> of_int_closed <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> ring_homomorphism <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> add<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Symmetric_Polynomials-diff"><span class="command">lemma</span></span> diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-power"><span class="command">lemma</span></span> power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-sum"><span class="command">lemma</span></span> sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>sum <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-prod"><span class="command">lemma</span></span> prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Symmetric_Polynomials-ring_homomorphism_id"><span class="command">lemma</span></span> ring_homomorphism_id <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-ring_homomorphism_id'"><span class="command">lemma</span></span> ring_homomorphism_id' <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-ring_homomorphism_of_int"><span class="command">lemma</span></span> ring_homomorphism_of_int <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism of_int"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Various facts about multivariate polynomials›</span></span>

<span class="keyword1" id="Symmetric_Polynomials-poly_mapping_nat_ge_0"><span class="command">lemma</span></span> poly_mapping_nat_ge_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="main">::</span> nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="free">m</span> <span class="main">≠</span> Poly_Mapping.lookup <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> Poly_Mapping.lookup <span class="free">m</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> LeastI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> Least_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> Poly_Mapping.lookup <span class="free">m</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_poly_mapping_def less_fun_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-poly_mapping_nat_le_0"><span class="command">lemma</span></span> poly_mapping_nat_le_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="main">::</span> nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_poly_mapping_def poly_mapping_eq_iff less_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-of_nat_diff_poly_mapping_nat"><span class="command">lemma</span></span> of_nat_diff_poly_mapping_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="free">m</span> <span class="main">-</span> of_nat <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> poly_mapping_eqI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_of_nat lookup_minus when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_transfer"><span class="command">lemma</span></span> mpoly_coeff_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun cr_mpoly <span class="main">(=)</span> poly_mapping.lookup MPoly_Type.coeff"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MPoly_Type.coeff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

<span class="keyword1" id="Symmetric_Polynomials-mapping_of_sum"><span class="command">lemma</span></span> mapping_of_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> mapping_of <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mapping_of <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_mpoly.rep_eq zero_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mapping_of_eq_0_iff"><span class="command">lemma</span></span> mapping_of_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mapping_of <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_mapping_of"><span class="command">lemma</span></span> Sum_any_mapping_of<span class="main">:</span> <span class="quoted"><span class="quoted">"Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> mapping_of <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mapping_of <span class="main">(</span>Sum_any <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sum_any.expand_set mapping_of_sum<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_parametric_cr_mpoly"><span class="command">lemma</span></span> Sum_any_parametric_cr_mpoly <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="main">(=)</span> cr_mpoly<span class="main">)</span> cr_mpoly<span class="main">)</span> Sum_any Sum_any"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fun_def cr_mpoly_def Sum_any_mapping_of<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_mult_of_nat"><span class="command">lemma</span></span> lookup_mult_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> lookup <span class="free">m</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">…</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lookup <span class="free">m</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> lookup <span class="free">m</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_eqI"><span class="command">lemma</span></span> mpoly_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">mon</span><span class="main">.</span> MPoly_Type.coeff <span class="free">p</span> <span class="bound">mon</span> <span class="main">=</span> MPoly_Type.coeff <span class="free">q</span> <span class="bound">mon</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_mpoly_times"><span class="command">lemma</span></span> coeff_mpoly_times<span class="main">:</span>
  <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">mon</span> <span class="main">=</span> prod_fun <span class="main">(</span>MPoly_Type.coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span>MPoly_Type.coeff <span class="free">q</span><span class="main">)</span> <span class="free">mon</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_mult_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> coeff <span class="free">q</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_times prod_fun_closed<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_notin_vars"><span class="command">lemma</span></span> coeff_notin_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>keys <span class="free">m</span> <span class="main">⊆</span> vars <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-finite_coeff_support"><span class="command">lemma</span></span> finite_coeff_support <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_altdef"><span class="command">lemma</span></span> insertion_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">*</span> Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_fun_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_uminus"><span class="command">lemma</span></span> mpoly_coeff_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">-</span>coeff <span class="free">p</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_uminus"><span class="command">lemma</span></span> Sum_any_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ab_group_add<span class="main">)</span> <span class="main">=</span> <span class="main">-</span>Sum_any <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sum_any.expand_set sum_negf<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_uminus"><span class="command">lemma</span></span> insertion_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 mpoly<span class="main">)</span> <span class="main">=</span> <span class="main">-</span>insertion <span class="free">f</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_altdef Sum_any_uminus<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_lookup"><span class="command">lemma</span></span> Sum_any_lookup<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⟹</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> lookup <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> lookup <span class="main">(</span>Sum_any <span class="free">g</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sum_any.expand_set lookup_sum <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.mono_neutral_left<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_diff"><span class="command">lemma</span></span> Sum_any_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ab_group_add<span class="main">)</span> <span class="main">=</span> Sum_any <span class="free">f</span> <span class="main">-</span> Sum_any <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_Un<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Sum_any.distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_diff"><span class="command">lemma</span></span> insertion_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 mpoly<span class="main">)</span> <span class="main">=</span> insertion <span class="free">f</span> <span class="free">p</span> <span class="main">-</span> insertion <span class="free">f</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion_fun <span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">q</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_fun_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Sum_any_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ fin<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ fin<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insertion_fun <span class="skolem">f</span> <span class="skolem">p</span> <span class="main">-</span> insertion_fun <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"insertion_fun <span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_power"><span class="command">lemma</span></span> insertion_power<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">f</span> <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_mult<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_sum"><span class="command">lemma</span></span> insertion_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>sum <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> insertion <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_add<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_prod"><span class="command">lemma</span></span> insertion_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> insertion <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_mult<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_Var"><span class="command">lemma</span></span> coeff_Var<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Var <span class="free">i</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">when</span> <span class="free">m</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Var<span class="hidden">⇩</span><sub>0</sub>_def lookup_single when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_Var"><span class="command">lemma</span></span> vars_Var<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>Var <span class="free">i</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span> mpoly<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Var.rep_eq Var<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_Var"><span class="command">lemma</span></span> insertion_Var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>Var <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>Var <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">when</span> <span class="bound">m</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
                                       <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_altdef coeff_Var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">^</span> lookup <span class="main">(</span>Poly_Mapping.single <span class="free">i</span> <span class="main">1</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any.expand_superset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span>Poly_Mapping.single <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Prod_any.expand_superset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">i</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def lookup_single<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_Sum_any"><span class="command">lemma</span></span> insertion_Sum_any<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>Sum_any <span class="free">g</span><span class="main">)</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> insertion <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Sum_any.expand_set insertion_sum
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_diff_subset"><span class="command">lemma</span></span> keys_diff_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"keys <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> keys <span class="free">f</span> <span class="main">∪</span> keys <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_empty_iff"><span class="command">lemma</span></span> keys_empty_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_0"><span class="command">lemma</span></span> mpoly_coeff_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">0</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_1"><span class="command">lemma</span></span> lookup_1<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">1</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_1"><span class="command">lemma</span></span> mpoly_coeff_1<span class="main">:</span> <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">1</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MPoly_Type.coeff_def one_mpoly.rep_eq lookup_1<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_Const"><span class="command">lemma</span></span> lookup_Const<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>Const<span class="hidden">⇩</span><sub>0</sub> <span class="free">c</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_single when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_Const"><span class="command">lemma</span></span> mpoly_coeff_Const<span class="main">:</span> <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MPoly_Type.coeff_def Const.rep_eq lookup_Const<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_smult"><span class="command">lemma</span></span> coeff_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> mult_zero<span class="main">)</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_lookup<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-in_keys_mapI"><span class="command">lemma</span></span> in_keys_mapI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> keys <span class="free">m</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span>lookup <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> keys <span class="main">(</span>Poly_Mapping.map <span class="free">f</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_uminus"><span class="command">lemma</span></span> keys_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span><span class="main">-</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> keys <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_uminus"><span class="command">lemma</span></span> vars_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_smult"><span class="command">lemma</span></span> vars_smult<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_0"><span class="command">lemma</span></span> vars_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_1"><span class="command">lemma</span></span> vars_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_sum"><span class="command">lemma</span></span> vars_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> vars <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vars_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_prod"><span class="command">lemma</span></span> vars_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> vars <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vars_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_Sum_any"><span class="command">lemma</span></span> vars_Sum_any<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>Sum_any <span class="free">h</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> vars <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Sum_any.expand_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sum<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_Prod_any"><span class="command">lemma</span></span> vars_Prod_any<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>Prod_any <span class="free">h</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> vars <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Prod_any.expand_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_power"><span class="command">lemma</span></span> vars_power<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vars_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_diff"><span class="command">lemma</span></span> vars_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="free">p1</span> <span class="main">-</span> <span class="free">p2</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p1</span> <span class="main">∪</span> vars <span class="free">p2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer'</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>keys <span class="main">`</span> keys <span class="main">(</span><span class="skolem">p1</span> <span class="main">-</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>keys <span class="main">`</span> <span class="main">(</span>keys <span class="skolem">p1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">⋃</span><span class="main">(</span>keys <span class="main">`</span> <span class="main">(</span>keys <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> keys_diff_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p1</span></span> <span class="quoted"><span class="skolem">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> not_in_keys_iff_lookup_eq_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_smult"><span class="command">lemma</span></span> insertion_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> insertion <span class="free">f</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_right_distrib<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_coeff_support<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_add"><span class="command">lemma</span></span> coeff_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="free">m</span> <span class="main">+</span> coeff <span class="free">q</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_diff"><span class="command">lemma</span></span> coeff_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="free">m</span> <span class="main">-</span> coeff <span class="free">q</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_minus<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_monom"><span class="command">lemma</span></span> insertion_monom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>monom <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> lookup <span class="free">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>monom <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">m'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">when</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">m'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m'</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_def insertion_aux_def insertion_fun_def lookup_single<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="free">m</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any.expand_superset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">m</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_aux_Const"><span class="command">lemma</span></span> insertion_aux_Const<span class="hidden">⇩</span><sub>0</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion_aux <span class="free">f</span> <span class="main">(</span>Const<span class="hidden">⇩</span><sub>0</sub> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion_aux <span class="free">f</span> <span class="main">(</span>Const<span class="hidden">⇩</span><sub>0</sub> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">when</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def insertion_aux_def insertion_fun_def lookup_single<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">when</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.expand_superset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_Const"><span class="command">lemma</span></span> insertion_Const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_def Const.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeffs_0"><span class="command">lemma</span></span> coeffs_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeffs_1"><span class="command">lemma</span></span> coeffs_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeffs_Const"><span class="command">lemma</span></span> coeffs_Const<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const_def Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeffs_subset"><span class="command">lemma</span></span> coeffs_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_Const<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_Const"><span class="command">lemma</span></span> keys_Const<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>Const<span class="hidden">⇩</span><sub>0</sub> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_Const"><span class="command">lemma</span></span> vars_Const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_Const<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-prod_fun_compose_bij"><span class="command">lemma</span></span> prod_fun_compose_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prod_fun <span class="free">m1</span> <span class="free">m2</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> prod_fun <span class="main">(</span><span class="free">m1</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">m2</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_is_inj inj_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_fun <span class="main">(</span><span class="free">m1</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">m2</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
          Sum_any <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="free">m1</span> <span class="bound">l</span> <span class="main">*</span> Sum_any <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="free">m2</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_fun_def f<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="free">m1</span> <span class="bound">l</span> <span class="main">*</span> Sum_any <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="free">m2</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Sum_any.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> refl<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prod_fun <span class="free">m1</span> <span class="free">m2</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-add_nat_poly_mapping_zero_iff"><span class="command">lemma</span></span> add_nat_poly_mapping_zero_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-prod_fun_nat_0"><span class="command">lemma</span></span> prod_fun_nat_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prod_fun <span class="free">f</span> <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> <span class="free">g</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_fun <span class="free">f</span> <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prod_fun_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext Sum_any.expand_superset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">…</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">…</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext Sum_any.expand_superset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_times_0"><span class="command">lemma</span></span> mpoly_coeff_times_0<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mpoly_times prod_fun_nat_0<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_prod_0"><span class="command">lemma</span></span> mpoly_coeff_prod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mpoly_coeff_times_0 mpoly_coeff_1<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_coeff_power_0"><span class="command">lemma</span></span> mpoly_coeff_power_0<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mpoly_coeff_times_0 mpoly_coeff_1<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-prod_fun_max"><span class="command">lemma</span></span> prod_fun_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> ordered_cancel_comm_monoid_add<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">g</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prod_fun <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">g</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fin' <span class="main">=</span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ fin<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ fin<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_fun <span class="free">f</span> <span class="free">g</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_fun_def Sum_any_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_right_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sum_any.cong fin'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> lq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword2"><span class="keyword">and</span></span> zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> leI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> lq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_less_le_mono add_le_less_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> lq<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.cartesian_product<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.expand_superset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">g</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-prod_fun_gt_max_eq_zero"><span class="command">lemma</span></span> prod_fun_gt_max_eq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> ordered_cancel_comm_monoid_add<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">g</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prod_fun <span class="free">f</span> <span class="free">g</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fin' <span class="main">=</span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ fin<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ fin<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_fun <span class="free">f</span> <span class="free">g</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_fun_def Sum_any_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_right_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sum_any.cong fin'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> lq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword2"><span class="keyword">and</span></span> zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> leI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">q</span> <span class="keyword1">when</span> False<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Restricting a monomial to a subset of variables›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> restrictpm <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">A</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_restrictpm"><span class="command">lemma</span></span> lookup_restrictpm<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>restrictpm <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> lookup <span class="free">m</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_restrictpm_in"><span class="command">lemma</span></span> lookup_restrictpm_in <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> lookup <span class="main">(</span>restrictpm <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> lookup <span class="free">m</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lookup_restrict_pm_not_in <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> lookup <span class="main">(</span>restrictpm <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_restrictpm<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_restrictpm"><span class="command">lemma</span></span> keys_restrictpm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>restrictpm <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> keys <span class="free">m</span> <span class="main">∩</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-restrictpm_add"><span class="command">lemma</span></span> restrictpm_add<span class="main">:</span> <span class="quoted"><span class="quoted">"restrictpm <span class="free">X</span> <span class="main">(</span><span class="free">m1</span> <span class="main">+</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> restrictpm <span class="free">X</span> <span class="free">m1</span> <span class="main">+</span> restrictpm <span class="free">X</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-restrictpm_id"><span class="command">lemma</span></span> restrictpm_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="free">m</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> restrictpm <span class="free">X</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-restrictpm_orthogonal"><span class="command">lemma</span></span> restrictpm_orthogonal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="free">m</span> <span class="main">⊆</span> <span class="main">-</span><span class="free">X</span> <span class="main">⟹</span> restrictpm <span class="free">X</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-restrictpm_add_disjoint"><span class="command">lemma</span></span> restrictpm_add_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> restrictpm <span class="free">X</span> <span class="free">m</span> <span class="main">+</span> restrictpm <span class="free">Y</span> <span class="free">m</span> <span class="main">=</span> restrictpm <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-restrictpm_add_complements"><span class="command">lemma</span></span> restrictpm_add_complements<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restrictpm <span class="free">X</span> <span class="free">m</span> <span class="main">+</span> restrictpm <span class="main">(</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"restrictpm <span class="main">(</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="free">m</span> <span class="main">+</span> restrictpm <span class="free">X</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> restrictpm_add_disjoint<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Mapping over a polynomial›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> map_mpoly <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> zero <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> mpoly <span class="main">⇒</span> <span class="tfree">'b</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="bound">p</span> <span class="main">::</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> Poly_Mapping.map <span class="bound">f</span> <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mapm_mpoly <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> mpoly <span class="main">⇒</span> <span class="tfree">'b</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">f</span> <span class="main">::</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="bound">p</span> <span class="main">::</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span><span class="main">.</span>
     Poly_Mapping.mapp <span class="bound">f</span> <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Symmetric_Polynomials-poly_mapping_map_conv_mapp"><span class="command">lemma</span></span> poly_mapping_map_conv_mapp<span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map <span class="free">f</span> <span class="main">=</span> Poly_Mapping.mapp <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Poly_Mapping.mapp_def Poly_Mapping.map_def map_fun_def
                 o_def fun_eq_iff when_def in_keys_iff <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-map_mpoly_conv_mapm_mpoly"><span class="command">lemma</span></span> map_mpoly_conv_mapm_mpoly<span class="main">:</span> <span class="quoted"><span class="quoted">"map_mpoly <span class="free">f</span> <span class="main">=</span> mapm_mpoly <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_mapping_map_conv_mapp<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-map_mpoly_comp"><span class="command">lemma</span></span> map_mpoly_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> map_mpoly <span class="free">f</span> <span class="main">(</span>map_mpoly <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map_mpoly <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mapp_mapp"><span class="command">lemma</span></span> mapp_mapp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> Poly_Mapping.mapp <span class="free">f</span> <span class="main">(</span>Poly_Mapping.mapp <span class="free">g</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
                          Poly_Mapping.mapp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff lookup_mapp in_keys_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mapm_mpoly_comp"><span class="command">lemma</span></span> mapm_mpoly_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> mapm_mpoly <span class="free">f</span> <span class="main">(</span>mapm_mpoly <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mapm_mpoly <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">c</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">(</span><span class="free">g</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapp_mapp<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_map_mpoly"><span class="command">lemma</span></span> coeff_map_mpoly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>map_mpoly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> coeff <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_map_mpoly'"><span class="command">lemma</span></span> coeff_map_mpoly' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> coeff <span class="main">(</span>map_mpoly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coeff_map_mpoly<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_mapm_mpoly"><span class="command">lemma</span></span> coeff_mapm_mpoly<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mapm_mpoly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> coeff <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="free">m</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_mapm_mpoly'"><span class="command">lemma</span></span> coeff_mapm_mpoly' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> coeff <span class="main">(</span>mapm_mpoly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">m</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coeff_mapm_mpoly<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_map_mpoly_subset"><span class="command">lemma</span></span> vars_map_mpoly_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>map_mpoly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_sum"><span class="command">lemma</span></span> coeff_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_Sum_any"><span class="command">lemma</span></span> coeff_Sum_any<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⟹</span> coeff <span class="main">(</span>Sum_any <span class="free">f</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sum_any.expand_set <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.mono_neutral_right<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-Sum_any_zeroI"><span class="command">lemma</span></span> Sum_any_zeroI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> Sum_any <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sum_any.expand_set<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_Prod_any"><span class="command">lemma</span></span> insertion_Prod_any<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> insertion <span class="free">f</span> <span class="main">(</span>Prod_any <span class="free">g</span><span class="main">)</span> <span class="main">=</span> Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> insertion <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Prod_any.expand_set insertion_prod <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.mono_neutral_right<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_insertion"><span class="command">lemma</span></span> insertion_insertion<span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="free">g</span> <span class="main">(</span>insertion <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
     insertion <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> insertion <span class="free">g</span> <span class="main">(</span><span class="free">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_mpoly <span class="main">(</span>insertion <span class="free">g</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">g</span> <span class="main">(</span>insertion <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">.</span> insertion <span class="free">g</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> insertion <span class="free">g</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> insertion_Sum_any<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_coeff_support<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">.</span> insertion <span class="free">g</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> insertion <span class="free">g</span> <span class="main">(</span><span class="free">k</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">g</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> insertion <span class="free">g</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
                  insertion <span class="free">g</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> insertion <span class="free">g</span> <span class="main">(</span><span class="free">k</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> insertion_Prod_any<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_power <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_lookup<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insertion <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> insertion <span class="free">g</span> <span class="main">(</span><span class="free">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_mpoly <span class="main">(</span>insertion <span class="free">g</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"map_mpoly <span class="skolem">f</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">f</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_substitute_linear"><span class="command">lemma</span></span> insertion_substitute_linear<span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>
     insertion <span class="free">f</span> <span class="main">(</span>mapm_mpoly <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">d</span><span class="main">.</span> Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mapm_mpoly <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">(*)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
          MPoly_Type.coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Prod_any.distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_lookup<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-vars_mapm_mpoly_subset"><span class="command">lemma</span></span> vars_mapm_mpoly_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>mapm_mpoly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">using</span></span> keys_mapp_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mapm_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-map_mpoly_cong"><span class="command">lemma</span></span> map_mpoly_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"map_mpoly <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> map_mpoly <span class="free">g</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_mpoly<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The leading monomial and leading coefficient›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The leading monomial of a multivariate polynomial is the one with the largest monomial
  w.\,r.\,t.\ the monomial ordering induced by the standard variable ordering. The
  leading coefficient is the coefficient of the leading monomial.

  As a convention, the leading monomial of the zero polynomial is defined to be the same as
  that of any non-constant zero polynomial, i.\,e.\ the monomial $X_1^0 \ldots X_n^0$.
›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> lead_monom <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero mpoly <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">::</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">.</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_geI"><span class="command">lemma</span></span> lead_monom_geI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_monom_def coeff_def in_keys_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_gt_lead_monom_zero"><span class="command">lemma</span></span> coeff_gt_lead_monom_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lead_monom_geI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_nonzero_eq"><span class="command">lemma</span></span> lead_monom_nonzero_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span> <span class="main">=</span> Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_0"><span class="command">lemma</span></span> lead_monom_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_def zero_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_1"><span class="command">lemma</span></span> lead_monom_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_def one_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_Const"><span class="command">lemma</span></span> lead_monom_Const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_def Const.rep_eq Const<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_uminus"><span class="command">lemma</span></span> lead_monom_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_def uminus_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_mult_const"><span class="command">lemma</span></span> keys_mult_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semiring_0<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>Poly_Mapping.map <span class="main">(</span><span class="main">(*)</span> <span class="free">c</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> keys <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_eq_0_iff"><span class="command">lemma</span></span> lead_monom_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> vars <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Max_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_monom"><span class="command">lemma</span></span> lead_monom_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>monom <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_def monom.rep_eq Const<span class="hidden">⇩</span><sub>0</sub>_def max_def <span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_monom'"><span class="command">lemma</span></span> lead_monom_monom' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lead_monom <span class="main">(</span>monom <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_monom<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_numeral"><span class="command">lemma</span></span> lead_monom_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> monom_numeral<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_monom_monom<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_add"><span class="command">lemma</span></span> lead_monom_add<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max.boundedI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> insert <span class="main">0</span> <span class="main">(</span>keys <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> max <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> keys <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> keys_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff plus_poly_mapping.rep_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_diff"><span class="command">lemma</span></span> lead_monom_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max.boundedI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> insert <span class="main">0</span> <span class="main">(</span>keys <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> max <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>keys <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> keys <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> keys_diff_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lead_coeff</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lead_coeff</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>lead_monom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Symmetric_Polynomials-vars_empty_iff"><span class="command">lemma</span></span> vars_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> Const <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">mon</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">mon</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order.strict_iff_order<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Const <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mpoly_coeff_Const lead_coeff_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Const <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">…</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_0"><span class="command">lemma</span></span> lead_coeff_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_1"><span class="command">lemma</span></span> lead_coeff_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def mpoly_coeff_1<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_Const"><span class="command">lemma</span></span> lead_coeff_Const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def mpoly_coeff_Const<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_monom"><span class="command">lemma</span></span> lead_coeff_monom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>monom <span class="free">p</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def coeff_monom when_def lead_monom_monom<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_nonzero"><span class="command">lemma</span></span> lead_coeff_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lead_coeff <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_def lead_monom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_def max_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> lead_coeff <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> lead_monom_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lead_coeff_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> lead_coeff <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>MPoly_Type.smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> smult_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"MPoly_Type.smult <span class="free">c</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> coeff_smult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>mapping_of <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym Max.coboundedI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def lead_monom_def max_def coeff_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>mapping_of <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> smult.rep_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_keys_mapI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> smult_nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lead_coeff_nonzero<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms * ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_def lead_monom_def max_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>keys <span class="main">(</span>mapping_of <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>mapping_of <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> smult.rep_eq coeff_def in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * ** <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_def max_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> lead_coeff <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_mult_aux"><span class="command">lemma</span></span> lead_coeff_mult_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">p</span> <span class="main">+</span> lead_monom <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span> <span class="main">*</span> lead_coeff <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> lead_monom <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="skolem">a</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_mpoly_times
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_fun_max<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def b_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def b_def lead_coeff_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_mult_le"><span class="command">lemma</span></span> lead_monom_mult_le<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> lead_monom <span class="free">p</span> <span class="main">+</span> lead_monom <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> leI notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span> <span class="main">+</span> lead_monom <span class="free">q</span> <span class="main">&lt;</span> lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_def coeff_mpoly_times <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_fun_gt_max_eq_zero<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_mult"><span class="command">lemma</span></span> lead_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">*</span> lead_coeff <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="free">p</span> <span class="main">+</span> lead_monom <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym lead_monom_mult_le lead_monom_geI<span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_mult_aux<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_mult"><span class="command">lemma</span></span> lead_coeff_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">*</span> lead_coeff <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span> <span class="main">*</span> lead_coeff <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_mult lead_coeff_mult_aux lead_coeff_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_lead_monom_subset"><span class="command">lemma</span></span> keys_lead_monom_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def in_keys_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> lead_monom_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_monom <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> lead_coeff_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?th1</span> <span class="main">∧</span> <span class="var">?th2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> insert.IH<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> nz'<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> insert.prems insert.hyps nz nz' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_monom_mult lead_coeff_mult IH<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sum_le"><span class="command">lemma</span></span> lead_monom_sum_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> lead_monom <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">ub</span><span class="main">)</span> <span class="main">⟹</span> lead_monom <span class="main">(</span>sum <span class="free">h</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lead_monom_add<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The leading monomial of a sum where the leading monomial the summands are distinct is
  simply the maximum of the leading monomials.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sum"><span class="command">lemma</span></span> lead_monom_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>lead_monom <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> Max <span class="main">(</span><span class="main">(</span>lead_monom <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>sum <span class="free">h</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lead_monom_sum_le Max_ge finite_imageI<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="main">(</span>lead_monom <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_in finite_imageI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> lead_monom <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lead_monom <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_ge finite_imageI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lead_monom <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">(</span>lead_monom <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> y inj_onD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">h</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">h</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> x assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lead_coeff <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>sum <span class="free">h</span> <span class="free">X</span><span class="main">)</span> <span class="main">≥</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lead_monom_geI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_eq_0_iff"><span class="command">lemma</span></span> lead_coeff_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> semidom mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> lead_monom_prod' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_monom <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> lead_coeff_prod' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_prod lead_coeff_prod<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   lead_monom_power<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     lead_coeff_power<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lead_monom_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">]</span> lead_coeff_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semidom mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   lead_monom_power' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     lead_coeff_power' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lead_monom_prod'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span>"</span></span><span class="main">]</span> lead_coeff_prod'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Turning a set of variables into a monomial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a finite set $\{X_1,\ldots,X_n\}$ of variables, the following is the monomial
  $X_1\ldots X_n$:
›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> monom_of_set <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">X</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> finite <span class="bound">X</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_monom_of_set"><span class="command">lemma</span></span> lookup_monom_of_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="main">(</span>monom_of_set <span class="free">X</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">X</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_monom_of_set_1"><span class="command">lemma</span></span> lookup_monom_of_set_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> Poly_Mapping.lookup <span class="main">(</span>monom_of_set <span class="free">X</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lookup_monom_of_set_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> <span class="free">X</span> <span class="main">⟹</span> Poly_Mapping.lookup <span class="main">(</span>monom_of_set <span class="free">X</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_monom_of_set<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_monom_of_set"><span class="command">lemma</span></span> keys_monom_of_set<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>monom_of_set <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">X</span> <span class="keyword1">then</span> <span class="free">X</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_monom_of_set_finite"><span class="command">lemma</span></span> keys_monom_of_set_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> keys <span class="main">(</span>monom_of_set <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_monom_of_set<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-monom_of_set_eq_iff"><span class="command">lemma</span></span> monom_of_set_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> finite <span class="free">Y</span> <span class="main">⟹</span> monom_of_set <span class="free">X</span> <span class="main">=</span> monom_of_set <span class="free">Y</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">=</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-monom_of_set_empty"><span class="command">lemma</span></span> monom_of_set_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"monom_of_set <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-monom_of_set_eq_zero_iff"><span class="command">lemma</span></span> monom_of_set_eq_zero_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"monom_of_set <span class="free">X</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> infinite <span class="free">X</span> <span class="main">∨</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-zero_eq_monom_of_set_iff"><span class="command">lemma</span></span> zero_eq_monom_of_set_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> monom_of_set <span class="free">X</span> <span class="main">⟷</span> infinite <span class="free">X</span> <span class="main">∨</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Permuting the variables of a polynomial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we define the operation of permuting the variables of a monomial and polynomial.
›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> permutep <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> bij <span class="bound">f</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">∘</span> <span class="bound">f</span> <span class="keyword1">else</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> bij <span class="skolem">f</span> <span class="keyword1">then</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="keyword1">else</span> <span class="skolem">g</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_vimageI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bij_is_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mpoly_map_vars <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero mpoly <span class="main">⇒</span> <span class="tfree">'a</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">p</span><span class="main">.</span> permutep <span class="main">(</span>permutep <span class="bound">f</span><span class="main">)</span> <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Symmetric_Polynomials-keys_permutep"><span class="command">lemma</span></span> keys_permutep<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> keys <span class="main">(</span>permutep <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">-`</span> keys <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_id''"><span class="command">lemma</span></span> permutep_id'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_id'''"><span class="command">lemma</span></span> permutep_id''' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_0"><span class="command">lemma</span></span> permutep_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_single"><span class="command">lemma</span></span> permutep_single<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> permutep <span class="free">f</span> <span class="main">(</span>Poly_Mapping.single <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Poly_Mapping.single <span class="main">(</span>inv_into UNIV <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff when_def inv_f_f surj_f_inv_f bij_is_inj bij_is_surj<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_id"><span class="command">lemma</span></span> mpoly_map_vars_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_id'"><span class="command">lemma</span></span> mpoly_map_vars_id' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_permutep"><span class="command">lemma</span></span> lookup_permutep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="main">(</span>permutep <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bij <span class="free">f</span> <span class="keyword1">then</span> Poly_Mapping.lookup <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> Poly_Mapping.lookup <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-inj_permutep"><span class="command">lemma</span></span> inj_permutep <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>permutep <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> bij <span class="skolem">f</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="keyword1">else</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bij <span class="skolem">f</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹bij <span class="skolem">f</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_is_surj<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">y</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> eq <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-surj_permutep"><span class="command">lemma</span></span> surj_permutep <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"surj <span class="main">(</span>permutep <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span> <span class="main">::</span> zero<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> surj_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">t</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">f</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bij <span class="skolem">f</span> <span class="keyword1">then</span> <span class="bound">x</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="keyword1">else</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>the_inv <span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">t</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_vimageI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_is_inj bij_betw_the_inv_into<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∘</span> the_inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff the_inv_f_f bij_is_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span> <span class="main"><span class="main"><span class="main">∘</span></span></span> the_inv <span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> fin <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-bij_permutep"><span class="command">lemma</span></span> bij_permutep <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span>permutep <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_permutep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> surj_permutep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_map_mpoly"><span class="command">lemma</span></span> mpoly_map_vars_map_mpoly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>map_mpoly <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map_mpoly <span class="free">g</span> <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_mpoly_map_vars"><span class="command">lemma</span></span> coeff_mpoly_map_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">mon</span> <span class="main">=</span>
             MPoly_Type.coeff <span class="free">p</span> <span class="main">(</span>permutep <span class="free">f</span> <span class="free">mon</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_permutep bij_permutep<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_monom_of_set"><span class="command">lemma</span></span> permutep_monom_of_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="main">(</span>monom_of_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> monom_of_set <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff bij_is_inj finite_vimage_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_comp"><span class="command">lemma</span></span> permutep_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> bij <span class="free">g</span> <span class="main">⟹</span> permutep <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> permutep <span class="free">g</span> <span class="main">∘</span> permutep <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff bij_comp<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_comp'"><span class="command">lemma</span></span> permutep_comp'<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> bij <span class="free">g</span> <span class="main">⟹</span> permutep <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">mon</span> <span class="main">=</span> permutep <span class="free">g</span> <span class="main">(</span>permutep <span class="free">f</span> <span class="free">mon</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff bij_comp<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_comp"><span class="command">lemma</span></span> mpoly_map_vars_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> bij <span class="free">g</span> <span class="main">⟹</span> mpoly_map_vars <span class="free">f</span> <span class="main">(</span>mpoly_map_vars <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mpoly_map_vars <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_permutep permutep_comp<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_id"><span class="command">lemma</span></span> permutep_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep id <span class="free">mon</span> <span class="main">=</span> <span class="free">mon</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_id'"><span class="command">lemma</span></span> permutep_id' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free">mon</span> <span class="main">=</span> <span class="free">mon</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-inv_permutep"><span class="command">lemma</span></span> inv_permutep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inv_into UNIV <span class="main">(</span>permutep <span class="free">f</span><span class="main">)</span> <span class="main">=</span> permutep <span class="main">(</span>inv_into UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv_into UNIV <span class="main">(</span>permutep <span class="free">f</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> permutep <span class="main">(</span>inv_into UNIV <span class="free">f</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> permutep_comp'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv_into UNIV <span class="free">f</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> assms inj_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inv_f_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_imp_bij_inv bij_is_inj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_monom"><span class="command">lemma</span></span> mpoly_map_vars_monom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> mpoly_map_vars <span class="free">f</span> <span class="main">(</span>monom <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">(</span>permutep <span class="main">(</span>inv_into UNIV <span class="free">f</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutep_single bij_permutep<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_mpoly_map_vars"><span class="command">lemma</span></span> vars_mpoly_map_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vars <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vars_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer'</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>inv_into UNIV <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> surj_f_inv_f<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_is_surj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>keys <span class="main">`</span> keys <span class="main">(</span>permutep <span class="main">(</span>permutep <span class="skolem">f</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">⋃</span> <span class="main">(</span>keys <span class="main">`</span> keys <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> keys <span class="main">(</span>permutep <span class="main">(</span>permutep <span class="skolem">f</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> mx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep <span class="skolem">f</span> <span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_permutep bij_permutep f<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> mx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>inv_into UNIV <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>keys <span class="skolem">p</span><span class="main">.</span> keys <span class="bound">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"permutep <span class="skolem">f</span> <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_permutep f eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>keys <span class="skolem">p</span><span class="main">.</span> keys <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> mx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep id <span class="skolem">m</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"id <span class="main">=</span> inv_into UNIV <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_is_inj inv_f_f<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep <span class="main">…</span> <span class="skolem">m</span> <span class="main">=</span> permutep <span class="skolem">f</span> <span class="main">(</span>permutep <span class="main">(</span>inv_into UNIV <span class="skolem">f</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutep_comp f bij_imp_bij_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="skolem">f</span> <span class="main">(</span>permutep <span class="main">(</span>inv_into UNIV <span class="skolem">f</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f mx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span>permutep <span class="main">(</span>inv_into UNIV <span class="skolem">f</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_permutep bij_imp_bij_inv inv_f_f bij_is_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>keys <span class="main">`</span> keys <span class="main">(</span>permutep <span class="main">(</span>permutep <span class="skolem">f</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_permutep bij_permutep<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_eq_monom_of_set_iff"><span class="command">lemma</span></span> permutep_eq_monom_of_set_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="free">mon</span> <span class="main">=</span> monom_of_set <span class="free">A</span> <span class="main">⟷</span> <span class="free">mon</span> <span class="main">=</span> monom_of_set <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="free">mon</span> <span class="main">=</span> monom_of_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep <span class="main">(</span>inv_into UNIV <span class="free">f</span><span class="main">)</span> <span class="main">(</span>permutep <span class="free">f</span> <span class="free">mon</span><span class="main">)</span> <span class="main">=</span> monom_of_set <span class="main">(</span>inv_into UNIV <span class="free">f</span> <span class="main">-`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq bij_imp_bij_inv assms permutep_monom_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into UNIV <span class="free">f</span> <span class="main">-`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_is_surj image_iff inv_f_f bij_is_inj surj_f_inv_f<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep <span class="main">(</span>inv_into UNIV <span class="free">f</span><span class="main">)</span> <span class="main">(</span>permutep <span class="free">f</span> <span class="free">mon</span><span class="main">)</span> <span class="main">=</span> permutep <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> inv_into UNIV <span class="free">f</span><span class="main">)</span> <span class="free">mon</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutep_comp bij_imp_bij_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> inv_into UNIV <span class="free">f</span> <span class="main">=</span> id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> surj_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_is_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">mon</span> <span class="main">=</span> monom_of_set <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutep_monom_of_set inj_vimage_image_eq bij_is_inj<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_monom_of_set_permutes"><span class="command">lemma</span></span> permutep_monom_of_set_permutes <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"permutep <span class="free">π</span> <span class="main">(</span>monom_of_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> monom_of_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_splits fun_eq_iff permutes_in_image<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_0"><span class="command">lemma</span></span> mpoly_map_vars_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_eq_0_iff"><span class="command">lemma</span></span> permutep_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> bij <span class="skolem">f</span> <span class="keyword1">then</span> <span class="skolem">m</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="keyword1">else</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_1"><span class="command">lemma</span></span> mpoly_map_vars_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def fun_eq_iff when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_Const"><span class="command">lemma</span></span> permutep_Const<span class="hidden">⇩</span><sub>0</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> permutep <span class="free">f</span> <span class="main">(</span>Const<span class="hidden">⇩</span><sub>0</sub> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Const<span class="hidden">⇩</span><sub>0</sub> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_add"><span class="command">lemma</span></span> permutep_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="main">(</span><span class="free">m1</span> <span class="main">+</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> permutep <span class="free">f</span> <span class="free">m1</span> <span class="main">+</span> permutep <span class="free">f</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_diff"><span class="command">lemma</span></span> permutep_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="main">(</span><span class="free">m1</span> <span class="main">-</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> permutep <span class="free">f</span> <span class="free">m1</span> <span class="main">-</span> permutep <span class="free">f</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_uminus"><span class="command">lemma</span></span> permutep_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>permutep <span class="free">f</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_mult"><span class="command">lemma</span></span> permutep_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> permutep <span class="free">f</span> <span class="main">(</span><span class="free">m1</span> <span class="main">*</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> permutep <span class="free">f</span> <span class="free">m1</span> <span class="main">*</span> permutep <span class="free">f</span> <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def fun_eq_iff prod_fun_compose_bij<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_Const"><span class="command">lemma</span></span> mpoly_map_vars_Const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Const <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def fun_eq_iff when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_add"><span class="command">lemma</span></span> mpoly_map_vars_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mpoly_map_vars <span class="free">f</span> <span class="free">p</span> <span class="main">+</span> mpoly_map_vars <span class="free">f</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_diff"><span class="command">lemma</span></span> mpoly_map_vars_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mpoly_map_vars <span class="free">f</span> <span class="free">p</span> <span class="main">-</span> mpoly_map_vars <span class="free">f</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_uminus"><span class="command">lemma</span></span> mpoly_map_vars_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_smult"><span class="command">lemma</span></span> permutep_smult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"permutep <span class="main">(</span>permutep <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.map <span class="main">(</span><span class="main">(*)</span> <span class="free">c</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
     Poly_Mapping.map <span class="main">(</span><span class="main">(*)</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>permutep <span class="main">(</span>permutep <span class="free">f</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_smult"><span class="command">lemma</span></span> mpoly_map_vars_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutep_smult<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_mult"><span class="command">lemma</span></span> mpoly_map_vars_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mpoly_map_vars <span class="free">f</span> <span class="free">p</span> <span class="main">*</span> mpoly_map_vars <span class="free">f</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_sum"><span class="command">lemma</span></span> mpoly_map_vars_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>sum <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_prod"><span class="command">lemma</span></span> mpoly_map_vars_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>prod <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_eq_0_iff"><span class="command">lemma</span></span> mpoly_map_vars_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_eq_iff"><span class="command">lemma</span></span> permutep_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> permutep <span class="free">f</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comp_bij_eq_iff<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_Sum_any"><span class="command">lemma</span></span> mpoly_map_vars_Sum_any <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>Sum_any <span class="free">g</span><span class="main">)</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sum_any.expand_set<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_power"><span class="command">lemma</span></span> mpoly_map_vars_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> mpoly_map_vars <span class="free">f</span> <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_monom_single"><span class="command">lemma</span></span> mpoly_map_vars_monom_single <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>monom <span class="main">(</span>Poly_Mapping.single <span class="free">i</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
             monom <span class="main">(</span>Poly_Mapping.single <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mpoly_map_vars_monom permutep_single bij_imp_bij_inv inv_inv_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_mpoly_map_vars"><span class="command">lemma</span></span> insertion_mpoly_map_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="free">g</span> <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">g</span> <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="main">(</span>permutep <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_altdef coeff_mpoly_map_vars<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="main">(</span>permutep <span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="main">*</span>
                    Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.cong arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main">]</span></span>
          Prod_any.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.reindex_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_permutep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def lookup_permutep assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-permutep_cong"><span class="command">lemma</span></span> permutep_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="main">(</span><span class="main">-</span>keys <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">permutes</span> <span class="main">(</span><span class="main">-</span>keys <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> permutep <span class="free">g</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> poly_mapping_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>permutep <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> lookup <span class="main">(</span>permutep <span class="free">g</span> <span class="free">q</span><span class="main">)</span> <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">k</span> <span class="main">∉</span> keys <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">k</span> <span class="main">∉</span> keys <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_in_image<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>keys <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_permutep permutes_bij in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_permutep permutes_bij permutes_not_in<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-mpoly_map_vars_cong"><span class="command">lemma</span></span> mpoly_map_vars_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="main">(</span><span class="main">-</span>vars <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">permutes</span> <span class="main">(</span><span class="main">-</span>vars <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> mpoly_map_vars <span class="free">g</span> <span class="main">(</span><span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero mpoly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_map_vars <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span> coeff <span class="main">(</span>mpoly_map_vars <span class="free">g</span> <span class="free">q</span><span class="main">)</span> <span class="skolem">mon</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">mon</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep <span class="free">f</span> <span class="skolem">mon</span> <span class="main">=</span> permutep <span class="free">g</span> <span class="skolem">mon</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutep_cong assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> permutes_subset<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mpoly_map_vars permutes_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>keys <span class="skolem">mon</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> vars <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>keys <span class="skolem">mon</span> <span class="main">⊆</span> <span class="free">g</span> <span class="main">`</span> vars <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff permutes_not_in<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> coeff_notin_vars<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_notin_vars vars_mpoly_map_vars permutes_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Symmetric polynomials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A polynomial is symmetric on a set of variables if it is invariant under
  any permutation of that set.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symmetric_mpoly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero mpoly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">symmetric_mpoly</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> mpoly_map_vars <span class="bound">π</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_empty"><span class="command">lemma</span></span> symmetric_mpoly_empty <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{}</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_mpoly_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A polynomial is trivially symmetric on any set of variables that do not occur in it.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_orthogonal"><span class="command">lemma</span></span> symmetric_mpoly_orthogonal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that permutes_not_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">π</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span> <span class="main">=</span> mpoly_map_vars id <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_map_vars_cong permutes_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span> permutes_id<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_monom"><span class="command">lemma</span></span> symmetric_mpoly_monom <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">m</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span>monom <span class="free">m</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vars_monom_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_orthogonal<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_subset"><span class="command">lemma</span></span> symmetric_mpoly_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">B</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> permutes_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> symmetric_mpoly_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a polynomial is symmetric over some set of variables, that set must either be a subset
  of the variables occurring in the polynomial or disjoint from it.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_imp_orthogonal_or_subset"><span class="command">lemma</span></span> symmetric_mpoly_imp_orthogonal_or_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> vars <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">=</span> Fun.swap <span class="skolem">x</span> <span class="skolem">y</span> id"</span></span>
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> π_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutes_swap_id<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">π</span> <span class="main">`</span> vars <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def Fun.swap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> π <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> vars <span class="free">p</span> <span class="main">=</span> vars <span class="main">(</span>mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_mpoly_map_vars permutes_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_mpoly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Symmetric polynomials are closed under ring operations.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_add"><span class="command">lemma</span></span> symmetric_mpoly_add <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="free">q</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_diff"><span class="command">lemma</span></span> symmetric_mpoly_diff <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="free">q</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_uminus"><span class="command">lemma</span></span> symmetric_mpoly_uminus <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_uminus_iff"><span class="command">lemma</span></span> symmetric_mpoly_uminus_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_smult"><span class="command">lemma</span></span> symmetric_mpoly_smult <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_mult"><span class="command">lemma</span></span> symmetric_mpoly_mult <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="free">q</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_0"><span class="command">lemma</span></span> symmetric_mpoly_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> symmetric_mpoly_1 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> symmetric_mpoly_Const <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_mpoly_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_power"><span class="command">lemma</span></span> symmetric_mpoly_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> symmetric_mpoly_mult<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_sum"><span class="command">lemma</span></span> symmetric_mpoly_sum <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> symmetric_mpoly_add<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_prod"><span class="command">lemma</span></span> symmetric_mpoly_prod <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> symmetric_mpoly <span class="free">A</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> symmetric_mpoly_mult<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An symmetric sum or product over polynomials yields a symmetric polynomial:
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_symmetric_sum"><span class="command">lemma</span></span> symmetric_mpoly_symmetric_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">permutes</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">π</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> mpoly_map_vars <span class="bound">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong assms π refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">g</span><span class="main">`</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_mpoly_symmetric_prod"><span class="command">lemma</span></span> symmetric_mpoly_symmetric_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">permutes</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">π</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> mpoly_map_vars <span class="bound">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong assms π refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">g</span><span class="main">`</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> prod <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If $p$ is a polynomial that is symmetric on some subset of variables $A$, then for the leading
  monomial of $p$, the exponents of these variables are decreasing w.\,r.\,t.\ the variable
  ordering.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> lookup_lead_monom_decreasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lookup <span class="free">m</span> <span class="free">i</span> <span class="main">≥</span> lookup <span class="free">m</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> leI notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">m</span> <span class="free">i</span> <span class="main">&lt;</span> lookup <span class="free">m</span> <span class="free">j</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">=</span> Fun.swap <span class="free">i</span> <span class="free">j</span> id"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> π_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutes_swap_id<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">π</span> <span class="main">=</span> id"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="free">j</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="skolem">π</span> <span class="bound">k</span> <span class="main">=</span> <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def Fun.swap_def fun_eq_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">=</span> MPoly_Type.coeff <span class="main">(</span>mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>permutep <span class="skolem">π</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def m_def coeff_mpoly_map_vars
                            permutes_bij permutep_comp' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> π assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_mpoly_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permutep <span class="skolem">π</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">m</span> <span class="free">i</span> <span class="main">&lt;</span> lookup <span class="main">(</span>permutep <span class="skolem">π</span> <span class="free">m</span><span class="main">)</span> <span class="free">i</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> lookup <span class="free">m</span> <span class="bound">k</span> <span class="main">=</span> lookup <span class="main">(</span>permutep <span class="skolem">π</span> <span class="free">m</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms π less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_permutep permutes_bij<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> permutep <span class="skolem">π</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_poly_mapping_def less_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The elementary symmetric polynomials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The $k$-th elementary symmetric polynomial for a finite set of variables $A$, with $k$ ranging
  between 1 and $|A|$, is the sum of the product of all subsets of $A$ with cardinality $k$:
›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> sym_mpoly_aux <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero_neq_one<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">X</span> <span class="bound">k</span> <span class="bound">mon</span><span class="main">.</span> <span class="keyword1">if</span> finite <span class="bound">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">mon</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="skolem">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">Y</span></span><span class="main">⊆</span><span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span>
           <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> monom_of_set <span class="main">`</span> Pow <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>monom_of_set <span class="main">`</span> Pow <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_sym_mpoly_aux"><span class="command">lemma</span></span> lookup_sym_mpoly_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="main">(</span>sym_mpoly_aux <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="free">mon</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">mon</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials-lookup_sym_mpoly_aux_monom_of_set"><span class="command">lemma</span></span> lookup_sym_mpoly_aux_monom_of_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="main">(</span>sym_mpoly_aux <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>monom_of_set <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_sym_mpoly_aux<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_sym_mpoly_aux"><span class="command">lemma</span></span> keys_sym_mpoly_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> keys <span class="main">(</span>sym_mpoly_aux <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> keys <span class="free">m</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_monom_of_set<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> sym_mpoly <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>zero_neq_one<span class="main">}</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"sym_mpoly_aux"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Symmetric_Polynomials-vars_sym_mpoly_subset"><span class="command">lemma</span></span> vars_sym_mpoly_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> keys_sym_mpoly_aux <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def sym_mpoly.rep_eq<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_sym_mpoly"><span class="command">lemma</span></span> coeff_sym_mpoly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span>sym_mpoly <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="free">mon</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">mon</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_sym_mpoly_aux<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-sym_mpoly_infinite"><span class="command">lemma</span></span> sym_mpoly_infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">A</span> <span class="main">⟹</span> sym_mpoly <span class="free">A</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-sym_mpoly_altdef"><span class="command">lemma</span></span> sym_mpoly_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"sym_mpoly <span class="free">A</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">.</span> monom <span class="main">(</span>monom_of_set <span class="bound">X</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> infinite <span class="bound">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_infinite_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that infinite_card_subsets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ **<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_mpoly_infinite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">=</span> monom_of_set <span class="bound">X</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly coeff_sum coeff_monom<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> monom_of_set <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">.</span>
               monom <span class="main">(</span>monom_of_set <span class="bound">X</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="skolem">X</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_sum
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">X</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"monom_of_set <span class="skolem">X</span> <span class="main">=</span> monom_of_set <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that finite_subset<span class="main">[</span><span class="operator">OF</span> X<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>monom <span class="main">(</span>monom_of_set <span class="skolem">Y</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> X Y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_monom when_def <span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> X <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_monom<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly coeff_sum coeff_monom<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_sym_mpoly_monom_of_set"><span class="command">lemma</span></span> coeff_sym_mpoly_monom_of_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span>sym_mpoly <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>monom_of_set <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_sym_mpoly_0"><span class="command">lemma</span></span> coeff_sym_mpoly_0<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sym_mpoly <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">X</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"infinite <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sym_mpoly <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>monom_of_set <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coeff_sym_mpoly_monom_of_set<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> monom_of_set_empty <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> finite <span class="bound">Y</span> <span class="main">∧</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> monom_of_set <span class="bound">Y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-symmetric_sym_mpoly"><span class="command">lemma</span></span> symmetric_sym_mpoly <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span>sym_mpoly <span class="free">B</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero_neq_one mpoly<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mpoly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">mon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat"</span></span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> π <span class="keyword1"><span class="command">have</span></span> π'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutes_subset<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> π <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span>mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>sym_mpoly <span class="free">B</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span>
                 MPoly_Type.coeff <span class="main">(</span>sym_mpoly <span class="free">B</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">(</span>permutep <span class="skolem">π</span> <span class="skolem">mon</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mpoly_map_vars permutes_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> MPoly_Type.coeff <span class="main">(</span>sym_mpoly <span class="free">B</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="var">?rhs</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> monom_of_set <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> π' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">-`</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">π</span> <span class="main">-`</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"permutep <span class="skolem">π</span> <span class="skolem">mon</span> <span class="main">=</span> monom_of_set <span class="main">(</span><span class="skolem">π</span> <span class="main">-`</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image card_vimage_inj permutep_monom_of_set
                     permutes_bij permutes_inj permutes_surj<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"permutep <span class="skolem">π</span> <span class="skolem">mon</span> <span class="main">=</span> monom_of_set <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Y<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">π</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_on_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">π</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> π'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Y π' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">π</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> monom_of_set <span class="main">(</span><span class="skolem">π</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image card_image permutep_monom_of_set
               permutes_bij permutes_inj permutes_surj<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="main">(</span>mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>sym_mpoly <span class="free">B</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span>
                  MPoly_Type.coeff <span class="main">(</span>sym_mpoly <span class="free">B</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="skolem">mon</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-insertion_sym_mpoly"><span class="command">lemma</span></span> insertion_sym_mpoly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>sym_mpoly <span class="free">X</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="free">k</span><span class="main">.</span> prod <span class="free">f</span> <span class="bound">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion_fun <span class="skolem">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">mon</span><span class="main">.</span>
            <span class="keyword1">if</span> finite <span class="skolem">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">Y</span></span><span class="main">⊆</span><span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">mon</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> poly_mapping.lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">when</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">Y</span></span><span class="main">⊆</span><span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_fun_def X when_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sum_any.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="main">∃</span><span class="bound">Y</span><span class="main">∈</span>Pow <span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> poly_mapping.lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">when</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">Y</span></span><span class="main">⊆</span><span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sum_any.expand_superset<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> X <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">m</span></span> <span class="main">|</span> <span class="main">∃</span><span class="bound">Y</span><span class="main">∈</span>Pow <span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> poly_mapping.lookup <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> poly_mapping.lookup <span class="main">(</span>monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">monom_of_set</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">keys</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ X<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">.</span> <span class="main">∏</span><span class="bound">v</span><span class="main">∈</span><span class="bound">Y</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong when_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ X<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">^</span> poly_mapping.lookup <span class="main">(</span>monom_of_set <span class="skolem">Y</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Prod_any.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_monom_of_set<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Prod_any.conditionalize <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"insertion_fun <span class="skolem">f</span>
                   <span class="main">(</span><span class="main">λ</span><span class="bound">mon</span><span class="main">.</span> <span class="keyword1">if</span> finite <span class="skolem">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">Y</span></span><span class="main">⊆</span><span class="skolem">X</span><span class="main">.</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="bound">mon</span> <span class="main">=</span> monom_of_set <span class="bound">Y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">.</span> prod <span class="skolem">f</span> <span class="bound">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-sym_mpoly_nz"><span class="command">lemma</span></span> sym_mpoly_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sym_mpoly <span class="free">A</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero_neq_one mpoly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_subset_of_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">(</span>monom_of_set <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_sym_mpoly_monom_of_set<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_sym_mpoly_0_or_1"><span class="command">lemma</span></span> coeff_sym_mpoly_0_or_1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_sym_mpoly"><span class="command">lemma</span></span> lead_coeff_sym_mpoly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> coeff_sym_mpoly_0_or_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sym_mpoly"><span class="command">lemma</span></span> lead_monom_sym_mpoly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>sym_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> zero_neq_one mpoly<span class="main">)</span> <span class="main">=</span>
             monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="free">k</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="var">?p</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lead_monom <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sym<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>sym_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_sym_mpoly<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> distinct_card<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_sym_mpoly<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> monom_of_set <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coeff_sym_mpoly<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ys_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> map <span class="main">(</span>lookup <span class="var">?m</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ys_def <span class="keyword1"><span class="command">using</span></span> X finite_subset<span class="main">[</span><span class="operator">OF</span> X<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> map_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_monom_of_set<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Min <span class="main">(</span>insert <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ys_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Min_in<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">using</span></span> ne <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Min_insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?m</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> lookup <span class="var">?m</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lookup_lead_monom_decreasing<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_nth_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that X finite_subset<span class="main">[</span><span class="operator">OF</span> X<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_monom_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> card <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_on_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_list_sum_nth ys_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="skolem">ys</span> <span class="main">@</span> drop <span class="skolem">i</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">+</span> sum_list <span class="main">(</span>drop <span class="skolem">i</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_list_append<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="skolem">ys</span> <span class="main">=</span> replicate <span class="skolem">i</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> in_X
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> replicate_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ys_def set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">…</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">i</span> <span class="skolem">ys</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="skolem">ys</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> not_in_X
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> replicate_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ys_def set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">xs</span> <span class="main">@</span> drop <span class="skolem">i</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> filter_append
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>take <span class="skolem">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filter_True<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>drop <span class="skolem">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filter_False<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> X <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induction on the leading monomial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We show that the monomial ordering for a fixed set of variables is well-founded,
  so we can perform induction on the leading monomial of a polynomial.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">monom_less_on</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">monom_less_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">m1</span><span class="main">,</span> <span class="bound">m2</span><span class="main">)</span><span class="main">.</span> <span class="bound">m1</span> <span class="main">&lt;</span> <span class="bound">m2</span> <span class="main">∧</span> keys <span class="bound">m1</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> keys <span class="bound">m2</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Symmetric_Polynomials-wf_monom_less_on"><span class="command">lemma</span></span> wf_monom_less_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"wf <span class="main">(</span>monom_less_on <span class="free">A</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">,</span> wellorder<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def less_Suc_eq_le Max_ge_iff<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> map <span class="main">(</span>lookup <span class="bound">m</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>inv_image <span class="main">(</span>lexn <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> wf_inv_image wf_lexn wellorder_class.wf<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monom_less_on <span class="free">A</span> <span class="main">⊆</span> inv_image <span class="main">(</span>lexn <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m1</span><span class="main">,</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">∈</span> monom_less_on <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">&lt;</span> <span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">m1</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">m2</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_less_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m1</span> <span class="skolem">k</span> <span class="main">&lt;</span> lookup <span class="skolem">m2</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> lookup <span class="skolem">m1</span> <span class="bound">i</span> <span class="main">=</span> lookup <span class="skolem">m2</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_poly_mapping_def less_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>lookup <span class="skolem">m1</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> lookup <span class="skolem">m2</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m1</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> lookup <span class="skolem">m2</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m1</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m2</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> k<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_n<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> map <span class="main">(</span>lookup <span class="skolem">m1</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs1</span> <span class="main">=</span> map <span class="main">(</span>lookup <span class="skolem">m1</span><span class="main">)</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs2</span> <span class="main">=</span> map <span class="main">(</span>lookup <span class="skolem">m2</span><span class="main">)</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> drop <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> upt_conv_Cons upt_add_eq_append'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs1</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs2</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as_def bs1_def bs2_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">[</span>lookup <span class="skolem">m1</span> <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">bs1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> decomp<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as_def bs1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">[</span>lookup <span class="skolem">m2</span> <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">bs2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> decomp<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as_def bs2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m1</span><span class="main">,</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">∈</span> inv_image <span class="main">(</span>lexn <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lexn_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_induct"><span class="command">lemma</span></span> lead_monom_induct <span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> less<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> vars <span class="bound">p</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span>
                 <span class="main">(</span><span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> vars <span class="bound">p'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> lead_monom <span class="bound">p'</span> <span class="main">&lt;</span> lead_monom <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="skolem">m</span> <span class="main"><span class="main">≡</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_monom_less_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly"</span></span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">p'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">p'</span> <span class="main">&lt;</span> lead_monom <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> * <span class="quoted">"1.prems"</span> keys_lead_monom_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_less_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_induct'"><span class="command">lemma</span></span> lead_monom_induct' <span class="main">[</span><span class="operator">case_names</span> less<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> vars <span class="bound">p'</span> <span class="main">⊆</span> vars <span class="bound">p</span> <span class="main">⟹</span> lead_monom <span class="bound">p'</span> <span class="main">&lt;</span> lead_monom <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_finite<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lead_monom_induct<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> IH <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The fundamental theorem of symmetric polynomials›</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_coeff_sym_mpoly_powerprod"><span class="command">lemma</span></span> lead_coeff_sym_mpoly_powerprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree">'b</span> mpoly<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_sym_mpoly assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'b</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong eq refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'b</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_prod<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq eq'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">xs</span> <span class="free">n</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">decr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 mpoly <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≡</span> sorted_list_of_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">decr</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟶</span>
                   lookup <span class="main">(</span>lead_monom <span class="bound">p</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≥</span> lookup <span class="main">(</span>lead_monom <span class="bound">p</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The computation of the witness for the fundamental theorem works like this:
  Given some polynomial $p$ (that is assumed to be symmetric in the variables in $A$),
  we inspect its leading monomial, which is of the form $c X_1^{i_1}\ldots X_n{i_n}$ where
  the $A = \{X_1,\ldots, X_n\}$, $c$ contains only variables not in $A$, and the sequence $i_j$
  is decreasing. The latter holds because $p$ is symmetric.

  Now, we form the polynomial $q := c e_1^{i_1 - i_2} e_2^{i_2 - i_3} \ldots e_n^{i_n}$, which
  has the same leading term as $p$. Then $p - q$ has a smaller leading monomial, so by induction,
  we can assume it to be of the required form and obtain a witness for $p - q$.

  Now, we only need to add $c Y_1^{i_1 - i_2} \ldots Y_n^{i_n}$ to that witness and we
  obtain a witness for $p$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fund_sym_step_coeff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly <span class="main">⇒</span> <span class="tfree">'a</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fund_sym_step_coeff</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> monom <span class="main">(</span>restrictpm <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fund_sym_step_monom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fund_sym_step_monom</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>
     <span class="keyword1">let</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> lookup <span class="main">(</span>lead_monom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">in</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> Poly_Mapping.single <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="bound">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fund_sym_step_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly <span class="main">⇒</span> <span class="tfree">'a</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fund_sym_step_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> lookup <span class="main">(</span>lead_monom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
      <span class="keyword1">in</span>  fund_sym_step_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="bound">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following function computes the witness, with the convention that it returns a constant
  polynomial if the input was not symmetric:
›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">fund_sym_poly_wit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 mpoly <span class="main">⇒</span> <span class="tfree">'a</span> mpoly mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fund_sym_poly_wit</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span>symmetric_mpoly <span class="free">A</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∨</span> lead_monom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> vars <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> Const <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span>
        <span class="free">fund_sym_poly_wit</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> fund_sym_step_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">+</span>
        monom <span class="main">(</span>fund_sym_step_monom <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>fund_sym_step_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_fund_sym_step_coeff"><span class="command">lemma</span></span> coeff_fund_sym_step_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>fund_sym_step_coeff <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">{</span>lead_coeff <span class="free">p</span><span class="main">,</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_step_coeff_def coeff_monom when_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials-vars_fund_sym_step_coeff"><span class="command">lemma</span></span> vars_fund_sym_step_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>fund_sym_step_coeff <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_step_coeff_def <span class="keyword1"><span class="command">using</span></span> keys_lead_monom_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_monom_subset<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-keys_fund_sym_step_monom"><span class="command">lemma</span></span> keys_fund_sym_step_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_step_monom_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> keys_sum<span class="main"><span class="main">]</span></span> UN_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> keys_single<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-coeff_fund_sym_step_poly"><span class="command">lemma</span></span> coeff_fund_sym_step_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring_closed <span class="quoted"><span class="free">C</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">x</span><span class="main">)</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
                  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_times mpoly_coeff_1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_fun_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="main">(</span>prod <span class="skolem">f</span> <span class="skolem">X</span><span class="main">)</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">⟹</span> coeff <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">_</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
                  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_times mpoly_coeff_1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_fun_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> C
    <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_step_poly_def Let_def fund_sym_step_coeff_def coeff_mpoly_times
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_fun_closed<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_monom when_def lead_coeff_def coeff_sym_mpoly <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> * **<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now show various relevant properties of the subtracted polynomial:

    <span class="antiquoted"><span class="antiquoted">▸</span></span> Its leading term is the same as that of the input polynomial.

    <span class="antiquoted"><span class="antiquoted">▸</span></span> It contains now new variables.

    <span class="antiquoted"><span class="antiquoted">▸</span></span> It is symmetric in the variables in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-fund_sym_step_poly"><span class="command">lemma</span></span> fund_sym_step_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">decr</span> <span class="free">p</span> <span class="main">⟹</span> lead_monom <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">decr</span> <span class="free">p</span> <span class="main">⟹</span> lead_coeff <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">decr</span> <span class="free">p</span> <span class="main">⟹</span> fund_sym_step_poly <span class="free">p</span> <span class="main">=</span>
             fund_sym_step_coeff <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">x</span> <span class="main">^</span> lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"vars <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span> <span class="main">∪</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> lookup <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> monom <span class="main">(</span>restrictpm <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fund_sym_step_poly <span class="free">p</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fund_sym_step_poly_def fund_sym_step_coeff_def c_def q_def f_def g_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span> <span class="main">∪</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> keys_lead_monom_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
          vars_monom_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"restrictpm <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> c_def q_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_mult<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_power<span class="main"><span class="main">]</span></span>
              Un_least UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sym_mpoly_subset<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span> <span class="main">∪</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def q_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_mult symmetric_mpoly_monom symmetric_mpoly_prod
              symmetric_mpoly_power symmetric_sym_mpoly<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">assume</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">decr</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">c</span> <span class="main">=</span> lead_coeff <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">c</span> <span class="main">=</span> restrictpm <span class="main">(</span><span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def lead_monom_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> f_range <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> f_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def n_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_nth_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="skolem">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">decr</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decr_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span>card <span class="free">A</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def lead_coeff_power<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_prod lead_coeff_power n_def q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_power n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def lead_monom_prod lead_coeff_power n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_monom_power n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
            lead_monom <span class="main">(</span>sym_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_monom_sym_mpoly<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> lead_monom_q<span class="main">:</span>
    <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="skolem">c</span> <span class="main">+</span> lead_monom <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> poly_mapping_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lead_monom <span class="skolem">c</span> <span class="main">+</span> lead_monom <span class="skolem">q</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> lookup <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lead_monom <span class="skolem">c</span> <span class="main">+</span> lead_monom <span class="skolem">q</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> lookup <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lookup <span class="main">(</span>monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?S</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add lead_monom_q lookup_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_monom_of_set <span class="quoted"><span class="quoted">‹set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>›</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_set_takeD<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lead_monom <span class="skolem">c</span> <span class="main">+</span> lead_monom <span class="skolem">q</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lookup <span class="main">(</span>monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add lookup_sum lead_monom_q<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">j</span></span> <span class="main">|</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> m <span class="quoted"><span class="quoted">‹distinct <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth nth_eq_iff_index_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_subtractf_nat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> g_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="skolem">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">j</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">Suc</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="skolem">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="skolem">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_diff_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">m</span><span class="main">&lt;..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> lookup <span class="main">(</span>lead_monom <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def not_less le_Suc_eq f_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="keyword1">then</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">k</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_step_monom_def lookup_sum Let_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def lookup_single when_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">x</span> <span class="main">^</span> lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">x</span> <span class="main">^</span> lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Prod_any.expand_superset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">Suc</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fund_sym_step_poly <span class="free">p</span> <span class="main">=</span>
                  fund_sym_step_coeff <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">x</span> <span class="main">^</span> lookup <span class="main">(</span>fund_sym_step_monom <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def q_def f_def g_def fund_sym_step_monom_def fund_sym_step_coeff_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If the input is well-formed, a single step of the procedure always decreases the leading
  monomial.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-lead_monom_fund_sym_step_poly_less"><span class="command">lemma</span></span> lead_monom_fund_sym_step_poly_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">decr</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">-</span> fund_sym_step_poly <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> lead_monom <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> fund_sym_step_poly <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order.strict_iff_order<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fund_sym_step_poly <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lead_monom <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="var">?m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">≠</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lead_monom_diff<span class="main"><span class="main">]</span></span> max.boundedI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order.strict_iff_order<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we prove that the witness is indeed well-defined for all inputs.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_dom_aux"><span class="command">lemma</span></span> fund_sym_poly_wit_dom_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fund_sym_poly_wit_dom <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lead_monom_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span>symmetric_mpoly <span class="free">A</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> decr <span class="main">=</span> lookup_lead_monom_decreasing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> decr False less.prems less.hyps <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fund_sym_poly_wit_dom <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> local.fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False less.prems less.hyps decr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less.IH fund_sym_step_poly symmetric_mpoly_diff
                lead_monom_fund_sym_step_poly_less<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decr_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fund_sym_poly_wit.domintros <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.domintros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_dom"><span class="command">lemma</span></span> fund_sym_poly_wit_dom <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fund_sym_poly_wit_dom <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  <span class="main">|</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> symmetric_mpoly_imp_orthogonal_or_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fund_sym_poly_wit_dom_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.domintros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">fund_sym_poly_wit</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI fund_sym_poly_wit_dom<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> fund_sym_poly_wit.simps
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we prove that our witness indeed fulfils all the properties stated by the fundamental
  theorem:
    <span class="antiquoted"><span class="antiquoted">▸</span></span> If the original polynomial was in $R[X_1,\ldots,X_n,\ldots, X_m]$ where the $X_1$ to
      $X_n$ are the symmetric variables, then the witness is a polynomial in
      $R[X_{n+1},\ldots,X_m][Y_1,\ldots,Y_n]$. This means that its coefficients are polynomials
      in the variables of the original polynomial, minus the symmetric ones, and
      the (new and independent) variables of the witness polynomial range from $1$ to $n$.
    <span class="antiquoted"><span class="antiquoted">▸</span></span> Substituting the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span>-th symmetric polynomial $e_i(X_1,\ldots,X_n)$ for the $Y_i$
      variable for every <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span> yields the original polynomial.
    <span class="antiquoted"><span class="antiquoted">▸</span></span> The coefficient ring $R$ need not be the entire type; if the coefficients of the original
      polynomial are in some subring, then the coefficients of the coefficients of the witness
      also do.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_coeffs_aux"><span class="command">lemma</span></span> fund_sym_poly_wit_coeffs_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vars <span class="main">(</span>coeff <span class="main">(</span>fund_sym_poly_wit <span class="free">p</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> vars <span class="skolem">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1 False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>coeff <span class="main">(</span>fund_sym_poly_wit <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 1 symmetric_mpoly_diff fund_sym_step_poly<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>coeff <span class="main">(</span>fund_sym_poly_wit <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span>
                monom <span class="main">(</span>fund_sym_step_monom <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>fund_sym_step_coeff <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> coeff_add coeff_monom <span class="keyword1"><span class="command">using</span></span> vars_fund_sym_step_coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="quoted">"1.prems"</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_add<span class="main"><span class="main">]</span></span> Un_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_monom_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> False <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_poly_wit.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted">"1.prems"</span><span class="main"><span class="keyword3">,</span></span>
       <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> mpoly_coeff_Const lead_monom_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_coeffs"><span class="command">lemma</span></span> fund_sym_poly_wit_coeffs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vars <span class="main">(</span>coeff <span class="main">(</span>fund_sym_poly_wit <span class="free">p</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊆</span> vars <span class="free">p</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> fund_sym_poly_wit_coeffs_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> assms
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_finite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> symmetric_mpoly_imp_orthogonal_or_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span> mpoly_coeff_Const<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_vars"><span class="command">lemma</span></span> fund_sym_poly_wit_vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>fund_sym_poly_wit <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> vars <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_finite<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> vars <span class="skolem">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>local.fund_sym_poly_wit <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> local.fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="quoted">"1.prems"</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 1 symmetric_mpoly_diff fund_sym_step_poly<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_monom_eq_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>fund_sym_poly_wit <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span>
              monom <span class="main">(</span>fund_sym_step_monom <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>local.fund_sym_step_coeff <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_add<span class="main"><span class="main">]</span></span> Un_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_monom_subset<span class="main"><span class="main">]</span></span>
                  keys_fund_sym_step_monom<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> False <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_poly_wit.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted">"1.prems"</span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> mpoly_coeff_Const lead_monom_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> symmetric_mpoly_imp_orthogonal_or_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_insertion_aux"><span class="command">lemma</span></span> fund_sym_poly_wit_insertion_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="main">(</span>fund_sym_poly_wit <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">decr</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lookup_lead_monom_decreasing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decr_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> vars <span class="skolem">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="main">(</span>fund_sym_poly_wit <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 1 symmetric_mpoly_diff fund_sym_step_poly<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fund_sym_step_poly <span class="skolem">p</span> <span class="main">=</span>
                    fund_sym_step_coeff <span class="skolem">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">x</span> <span class="main">^</span> lookup <span class="main">(</span>fund_sym_step_monom <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> False <span class="quoted"><span class="quoted">‹<span class="free">decr</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fund_sym_step_poly<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fund_sym_poly_wit.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_add<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_insertion"><span class="command">lemma</span></span> fund_sym_poly_wit_insertion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="main">(</span>fund_sym_poly_wit <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> symmetric_mpoly_imp_orthogonal_or_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> fund_sym_poly_wit_insertion_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-fund_sym_poly_wit_coeff"><span class="command">lemma</span></span> fund_sym_poly_wit_coeff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> coeff <span class="main">(</span>coeff <span class="main">(</span>fund_sym_poly_wit <span class="free">p</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span> <span class="bound">m'</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring_closed <span class="quoted"><span class="free">C</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>symmetric_mpoly <span class="free">A</span> <span class="skolem">p</span> <span class="main">∨</span> lead_monom <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> vars <span class="skolem">p</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> mpoly_coeff_Const<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> coeff <span class="main">(</span>coeff <span class="main">(</span>fund_sym_poly_wit <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span> <span class="bound">m'</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="quoted">"1.prems"</span> assms coeff_fund_sym_step_poly <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span> <span class="skolem">m'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> * False coeff_fund_sym_step_coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">m'</span></span><span class="main">]</span> <span class="quoted">"1.prems"</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> coeff_monom lead_coeff_def when_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniqueness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we show that the polynomial representation of a symmetric polynomial in terms of the
  elementary symmetric polynomials not only exists, but is unique.

  The key property here is that products of powers of elementary symmetric polynomials uniquely
  determine the exponent vectors, i.\,e.\ if $e_1, \ldots, e_n$ are the elementary symmetric
  polynomials, $a = (a_1,\ldots, a_n)$ and $b = (b_1,\ldots,b_n)$ are vectors of natural numbers,
  then:
  \[e_1^{a_1}\ldots e_n^{a_n} = e_1^{b_1}\ldots  e_n^{b_n} \longleftrightarrow a = b\]
  We show this now.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sym_mpoly_prod"><span class="command">lemma</span></span> lead_monom_sym_mpoly_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.neutral allI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_power<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_monom_prod<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> lead_monom <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lead_monom_power<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_power assms n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sym_mpoly_prod_notin"><span class="command">lemma</span></span> lead_monom_sym_mpoly_prod_notin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> lead_monom <span class="main">(</span>sym_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_monom_sym_mpoly_prod<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> xs assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">…</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lookup_sum
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lead_monom_sym_mpoly<span class="main">)</span>
      <span class="main">(</span><span class="operator">insert</span> xs assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs lead_monom_sym_mpoly lookup_monom_of_set set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sym_mpoly_prod_in"><span class="command">lemma</span></span> lead_monom_sym_mpoly_prod_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">h</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">h</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> lead_monom <span class="main">(</span>sym_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_monom_sym_mpoly_prod<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> xs assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">h</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> monom_of_set <span class="main">(</span>set <span class="main">(</span>take <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lead_monom_sym_mpoly<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">…</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">k</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="free">h</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lookup_sum lookup_monom_of_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">k</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">k</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms xs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth Suc_le_eq nth_eq_iff_index_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-lead_monom_sym_poly_powerprod_inj"><span class="command">lemma</span></span> lead_monom_sym_poly_powerprod_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="free">m1</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
             lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="free">m2</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">m1</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">m2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def n_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">m1</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> lookup <span class="free">m2</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">{</span><span class="free">m1</span><span class="main">,</span> <span class="free">m2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">using</span></span> that * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Prod_any.expand_superset subsetI * <span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="free">m1</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
               lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="free">m2</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ** <span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sum_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="free">m1</span><span class="main">)</span> <span class="main">{</span>Suc <span class="skolem">k</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span>lookup <span class="free">m2</span><span class="main">)</span> <span class="main">{</span>Suc <span class="skolem">k</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> ***<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookup <span class="bound">m</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> lead_monom_sym_mpoly_prod_in<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">m1</span> <span class="skolem">k</span> <span class="main">=</span> lookup <span class="free">m2</span> <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">m1</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">m2</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">l</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="free">m1</span><span class="main">)</span> <span class="main">{</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span>lookup <span class="free">m2</span><span class="main">)</span> <span class="main">{</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_eq<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">l</span> <span class="main">{</span>Suc <span class="skolem">l</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="free">m1</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> lookup <span class="free">m1</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="skolem">l</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lookup <span class="free">m1</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="skolem">l</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lookup <span class="free">m1</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="skolem">l</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lookup <span class="free">m2</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong less<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="free">m2</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">l</span> <span class="main">{</span>Suc <span class="skolem">l</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> lookup <span class="free">m2</span> <span class="skolem">l</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="skolem">l</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lookup <span class="free">m2</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">m1</span> <span class="skolem">l</span> <span class="main">=</span> lookup <span class="free">m2</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now show uniqueness by first showing that the zero polynomial has a unique representation.
  We fix some polynomial $p$ with $p(e_1,\ldots, e_n) = 0$ and then show, by contradiction,
  that $p = 0$.

  We have
  \[p(e_1,\ldots,e_n) = \sum c_{a_1,\ldots,a_n} e_1^{a_1}\ldots e_n^{a_n}\]
  and due to the injectivity of products of powers of elementary symmetric polynomials,
  the leading term of that sum is precisely the leading term of the summand with the biggest
  leading monomial, since summands cannot cancel each other.

  However, we also know that $p(e_1,\ldots,e_n) = 0$, so it follows that all summands
  must have leading term 0, and it is then easy to see that they must all be identically 0.
›</span></span>
<span class="keyword1" id="Symmetric_Polynomials-sym_mpoly_representation_unique_aux"><span class="command">lemma</span></span> sym_mpoly_representation_unique_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> vars <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def n_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">maxm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">maxm</span> <span class="main">=</span> Max <span class="main">(</span><span class="main">(</span>lead_monom <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_coeff_support<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> keys_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">m</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">using</span></span> that assms coeff_notin_vars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> lead_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
   <span class="keyword2"><span class="keyword">and</span></span> lead_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> lead_monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">+</span>
                      lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
   <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Prod_any.expand_superset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms keys_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lead_coeff_sym_mpoly_powerprod<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff subset_iff n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_mult<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_monom_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="skolem">M</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef h_def M_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.expand_superset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">…</span> <span class="main">=</span> <span class="skolem">maxm</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> maxm_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lead_monom_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mpoly_eqI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> lead_coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> restrict_lead_monom<span class="main">:</span>
           <span class="quoted"><span class="quoted">"restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_monom restrictpm_add<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> restrictpm_orthogonal order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> keys_lead_monom_subset<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> restrictpm_id order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> keys_lead_monom_subset<span class="main"><span class="main">]</span></span>
                  order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_Prod_any<span class="main"><span class="main">]</span></span> UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_power<span class="main"><span class="main">]</span></span>
                  vars_sym_mpoly_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>lead_monom <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="keyword3"><span class="command">assume</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lead_monom <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">m1</span> <span class="main">=</span> <span class="main">(</span>lead_monom <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">m2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def h_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> restrictpm <span class="free">A</span> <span class="main">(</span>lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m1</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span> <span class="main">=</span>
               lead_monom <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m2</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> mpoly<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_lead_monom<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">m2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lead_monom_sym_poly_powerprod_inj<span class="main">)</span>
           <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> keys_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> keys_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff M_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">maxm</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> only_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lead_monom <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">maxm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maxm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_ge imageI finite_imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">maxm</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> lookup_nzD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> keys_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff subset_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">+</span> <span class="main">0</span> <span class="main">≤</span> lead_monom <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lead_monom<span class="main">[</span><span class="operator">OF</span> nz<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> lead_monom_0<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="skolem">m</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="skolem">m</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>lookup <span class="skolem">m</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> lead_coeff <span class="main">(</span>MPoly_Type.coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>MPoly_Type.coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> coeff <span class="main">(</span><span class="skolem">h</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> coeff <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def mpoly_coeff_times_0<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> sym_mpoly <span class="free">A</span> <span class="bound">i</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Prod_any.expand_superset subsetI lookup_nzD<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">…</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mpoly_coeff_prod_0 mpoly_coeff_power_0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sym_mpoly_0<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">^</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> zero_power<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹sum <span class="main">(</span>lookup <span class="skolem">m</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> keys_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_mapping_eqI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="skolem">M</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> only_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> only_zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The general uniqueness theorem now follows easily. This essentially shows that
  the substitution $Y_i \mapsto e_i(X_1,\ldots,X_n)$ is an isomorphism between the
  ring $R[Y_1,\ldots, Y_n]$ and the ring $R[X_1,\ldots,X_n]^{S_n}$ of symmetric polynomials.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> sym_mpoly_representation_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
          <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">q</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> vars <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> vars <span class="main">(</span>coeff <span class="free">q</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">q</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym_mpoly_representation_unique_aux<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>coeff <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vars_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">q</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms vars_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_diff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> eq_fund_sym_poly_witI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mpoly mpoly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
          <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> vars <span class="main">(</span>coeff <span class="free">q</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="quoted"><span class="quoted">"vars <span class="free">q</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> fund_sym_poly_wit <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fund_sym_poly_wit_insertion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> fund_sym_poly_wit_vars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
        fund_sym_poly_wit_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sym_mpoly_representation_unique<span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fund_sym_poly_wit_insertion<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A recursive characterisation of symmetry›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In a similar spirit to the proof of the fundamental theorem, we obtain a nice
  recursive and executable characterisation of symmetry.
›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span> <span class="main">=</span> disj_cong conj_cong
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">check_symmetric_mpoly</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">check_symmetric_mpoly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟷</span>
     <span class="main">(</span>vars <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span>
      <span class="free">A</span> <span class="main">⊆</span> vars <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">decr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">check_symmetric_mpoly</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> fund_sym_step_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Symmetric_Polynomials-check_symmetric_mpoly_dom_aux"><span class="command">lemma</span></span> check_symmetric_mpoly_dom_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"check_symmetric_mpoly_dom <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lead_monom_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_monom <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">decr</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fund_sym_step_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> False less.prems less.hyps <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"check_symmetric_mpoly_dom <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> local.fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False less.prems less.hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less.IH fund_sym_step_poly symmetric_mpoly_diff
                lead_monom_fund_sym_step_poly_less<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decr_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> check_symmetric_mpoly.domintros <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> check_symmetric_mpoly.domintros <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_monom_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials-check_symmetric_mpoly_dom"><span class="command">lemma</span></span> check_symmetric_mpoly_dom <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"check_symmetric_mpoly_dom <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> vars <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> check_symmetric_mpoly_dom_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vars <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> check_symmetric_mpoly.domintros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">check_symmetric_mpoly</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI check_symmetric_mpoly_dom<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> check_symmetric_mpoly.simps

<span class="keyword1" id="Symmetric_Polynomials-check_symmetric_mpoly_correct"><span class="command">lemma</span></span> check_symmetric_mpoly_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"check_symmetric_mpoly <span class="free">p</span> <span class="main">⟷</span> symmetric_mpoly <span class="free">A</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> check_symmetric_mpoly.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">⟷</span> symmetric_mpoly <span class="free">A</span> <span class="skolem">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_diff fund_sym_step_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> fund_sym_step_poly <span class="skolem">p</span> <span class="main">+</span> fund_sym_step_poly <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_add fund_sym_step_poly<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">decr</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lookup_lead_monom_decreasing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decr_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"check_symmetric_mpoly <span class="skolem">p</span> <span class="main">⟷</span> symmetric_mpoly <span class="free">A</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 symmetric_mpoly_imp_orthogonal_or_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def check_symmetric_mpoly.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symmetric_mpoly_orthogonal<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Symmetric functions of roots of a univariate polynomial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Consider a factored polynomial
  \[p(X) = c_n X^n + c_{n-1} X^{n-1} + \ldots + c_1X + c_0 = (X - x_1)\ldots(X - x_n)\ .\]
  where $c_n$ is a unit.

  Then any symmetric polynomial expression $q(x_1, \ldots, x_n)$ in the roots $x_i$ can
  be written as a polynomial expression $q'(c_0,\ldots, c_{n-1})$ in the $c_i$.

  Moreover, if the coefficients of $q$ and the inverse of $c_n$ all lie in some
  subring, the coefficients of $q'$ do as well.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">::</span> comm_ring_1 set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> mpoly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_closed <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">q</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sym<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">q</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ring_closed <span class="quoted"><span class="free">C</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">interpretation</span></span> ring_homomorphism <span class="quoted"><span class="free">l</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

<span class="keyword1"><span class="command">theorem</span></span> symmetric_poly_of_roots_conv_poly_of_coeffs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cinv</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">q'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">q'</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="free">q'</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> fund_sym_poly_wit <span class="free">A</span> <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q''</span> <span class="main">=</span>
     mapm_mpoly <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> insertion <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">q'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">reindex</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">reindex</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="main">-</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="skolem">reindex</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">reindex</span></span></span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">reindex</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reindex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">q'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q'_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fund_sym_poly_wit_vars<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">q''</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q''_def <span class="keyword1"><span class="command">using</span></span> vars_mapm_mpoly_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="main">(</span>insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">=</span>
          insertion <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>map_mpoly <span class="main">(</span>insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insertion_insertion<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span>sym_mpoly <span class="free">A</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fund_sym_poly_wit_insertion sym<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>map_mpoly <span class="main">(</span>insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">=</span>
             insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">l</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>map_mpoly <span class="main">(</span>insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> insertion_irrelevant_vars<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> vars <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vars_map_mpoly_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q'_def n_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fund_sym_poly_wit_vars<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="main">(</span>sym_mpoly <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
             <span class="free">l</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">.</span> prod <span class="free">root</span> <span class="bound">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_sym_mpoly<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">.</span> prod <span class="free">root</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult mult.assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">Y</span></span> <span class="main">|</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">.</span> prod <span class="free">root</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> poly.coeff <span class="free">p</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coeff_poly_from_roots<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">root</span></span><span class="main">]</span> i assms finite
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def minus_one_power_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_mpoly <span class="main">(</span>insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">=</span> map_mpoly <span class="main">(</span>insertion <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fund_sym_poly_wit_coeffs<span class="main">[</span><span class="operator">OF</span> sym<span class="main">]</span> vars
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> map_mpoly_cong insertion_irrelevant_vars<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">l</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span>
               insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">l</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q''</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> insertion_substitute_linear map_mpoly_conv_mapm_mpoly q''_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mapm_mpoly_comp<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span>mpoly_map_vars <span class="skolem">reindex</span> <span class="skolem">q''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="skolem">reindex</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars <span class="skolem">q''</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> insertion_mpoly_map_vars<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def reindex_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> insertion_irrelevant_vars<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span>
                  insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span>mpoly_map_vars <span class="skolem">reindex</span> <span class="skolem">q''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_map_vars <span class="skolem">reindex</span> <span class="skolem">q''</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">unfolding</span></span> q''_def q'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="skolem">reindex</span>›</span></span> fund_sym_poly_wit_coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> C <span class="quoted"><span class="quoted">‹<span class="free">cinv</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_map_vars
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_closed Prod_any_closed power_closed Sum_any_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>mpoly_map_vars <span class="skolem">reindex</span> <span class="skolem">q''</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="skolem">reindex</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vars <span class="skolem">q''</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> vars_mpoly_map_vars<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reindex_def subset_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">reindex</span> <span class="skolem">q''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> symmetric_poly_of_roots_conv_poly_of_coeffs_monic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">q'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">q'</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="free">q'</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">q'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">q'</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_conv_poly_of_coeffs<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As a corollary, we obtain the following: Let $R, S$ be rings with $R\subseteq S$.
  Consider a polynomial $p\in R[X]$ whose leading coefficient $c$ is a unit in $R$ and
  that has a full set of roots $x_1,\ldots, x_n \in S$,
  i.\,e.\ $p(X) = c(X - x_1) \ldots (X - x_n)$. Let $q \in R[X_1,\ldots, X_n]$ be some
  symmetric polynomial expression in the roots. Then $q(x_1, \ldots, x_n) \in R$.

  A typical use case is $R = \mathbb{Q}$ and $S = \mathbb{C}$, i.\,e.\ any symmetric
  polynomial expression with rational coefficients in the roots of a rational polynomial is
  again rational. Similarly, any symmetric polynomial expression with integer coefficients
  in the roots of a monic integer polynomial is agan an integer.

  This is remarkable, since the roots themselves are usually not rational (possibly not
  even real). This particular fact is a key ingredient used in the standard proof
  that $\pi$ is transcendental.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> symmetric_poly_of_roots_in_subring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cinv</span> <span class="main">*</span> <span class="free">l</span> <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cinv</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">l</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">l</span> <span class="main">(</span><span class="free">root</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">q'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">q'</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
              <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_conv_poly_of_coeffs<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">cinv</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C assms <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any_closed mult_closed q' Prod_any_closed power_closed<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> poly.coeff <span class="free">p</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">=</span> insertion <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">root</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> symmetric_poly_of_roots_in_subring_monic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">l</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">l</span> <span class="main">(</span><span class="free">root</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring_closed <span class="quoted"><span class="free">C</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring_homomorphism <span class="quoted"><span class="free">l</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Symmetric_Polynomials_Code">
<div class="head">
<h1>Theory Symmetric_Polynomials_Code</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Symmetric_Polynomials_Code.thy
  Author:   Manuel Eberl (TU München)

  Code equations for symmetric polynomials (albeit not very efficient ones)
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Executable Operations for Symmetric Polynomials›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Symmetric_Polynomials_Code
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Symmetric_Polynomials.html">Symmetric_Polynomials</a> <span class="quoted">"<a href="../Polynomials/MPoly_Type_Class_FMap.html">Polynomials.MPoly_Type_Class_FMap</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: Quite a few of these code equations should probably be moved to the Polynomials entry. *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we shall provide some code equations to get executable code for operations related
  to symmetric polynomials, including, most notably, the fundamental theorem of symmetric
  polynomials and the recursive symmetry check.
›</span></span>

<span class="keyword1" id="Symmetric_Polynomials_Code-Ball_subset_right"><span class="command">lemma</span></span> Ball_subset_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">-</span><span class="free">T</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* This is a fairly simple theorem, but the automation somehow has a lot of problems with it *)</span>
<span class="keyword1" id="Symmetric_Polynomials_Code-compute_less_pp"><span class="command">lemma</span></span> compute_less_pp<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">ys</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> linorder <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>zero<span class="main">,</span> linorder<span class="main">}</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span>keys <span class="free">xs</span> <span class="main">∪</span> keys <span class="free">ys</span><span class="main">.</span> lookup <span class="free">xs</span> <span class="bound">i</span> <span class="main">&lt;</span> lookup <span class="free">ys</span> <span class="bound">i</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>keys <span class="free">xs</span> <span class="main">∪</span> keys <span class="free">ys</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> lookup <span class="free">xs</span> <span class="bound">j</span> <span class="main">=</span> lookup <span class="free">ys</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"less_fun <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">g</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k'</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">k'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_fun_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?dom</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="var">?dom</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iff_exI conj_cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">g</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?dom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k'</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">k'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k'</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k'</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">k'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Ball_subset_right<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k'</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">k'</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="var">?dom</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="var">?dom</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="var">?dom</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="var">?dom</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bex_def conj_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"less_fun <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="var">?dom</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="var">?dom</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials_Code-compute_le_pp"><span class="command">lemma</span></span> compute_le_pp<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≤</span> <span class="free">ys</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">∨</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">ys</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order.order_iff_strict<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials_Code-vars_code"><span class="command">lemma</span></span> vars_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vars <span class="main">(</span>MPoly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>keys <span class="free">p</span><span class="main">.</span> keys <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials_Code-mpoly_coeff_code"><span class="command">lemma</span></span> mpoly_coeff_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>MPoly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lookup <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">simp</span>

<span class="keyword1" id="Symmetric_Polynomials_Code-sym_mpoly_code"><span class="command">lemma</span></span> sym_mpoly_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sym_mpoly <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Set.filter <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Pow <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> monom <span class="main">(</span>monom_of_set <span class="bound">X</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_mpoly_altdef Set.filter_def<span class="main">)</span>

<span class="keyword1" id="Symmetric_Polynomials_Code-monom_of_set_code"><span class="command">lemma</span></span> monom_of_set_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"monom_of_set <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Pm_fmap <span class="main">(</span>fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> poly_mapping_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?lhs</span> <span class="skolem">k</span> <span class="main">=</span> lookup <span class="var">?rhs</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_monom_of_set fmlookup_default_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Symmetric_Polynomials_Code-restrictpm_code"><span class="command">lemma</span></span> restrictpm_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"restrictpm <span class="free">A</span> <span class="main">(</span>Pm_fmap <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Pm_fmap <span class="main">(</span>fmrestrict_set <span class="free">A</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_restrictpm fmlookup_default_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> check_symmetric_mpoly_correct <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">notepad</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> Var <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> Var <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> Var <span class="numeral">3</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int mpoly mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> Var <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">=</span> Var <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym_mpoly <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">*</span> <span class="skolem">Y</span> <span class="main">+</span> <span class="skolem">X</span> <span class="main">*</span> <span class="skolem">Z</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">*</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> X_Y_Z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">}</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> X_Y_Z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fund_sym_poly_wit <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">}</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">e1</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="main">*</span> <span class="skolem">e2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> X_Y_Z_def e1_e2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>