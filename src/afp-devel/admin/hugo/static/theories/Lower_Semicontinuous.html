<div id="Lower_Semicontinuous">
<div class="head">
<h1>Theory Lower_Semicontinuous</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:     thys/Lower_Semicontinuous/Lower_Semicontinuous.thy
    Author:    Bogdan Grechuk, University of Edinburgh
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lower semicontinuous functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lower_Semicontinuous
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Relative interior in one dimension›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_interior_ereal_semiline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> ereal <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> ereal <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real <span class="skolem">r</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_interior_real_semiline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast_def greaterThan_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> PInf <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel_interior_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> MInf <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel_interior_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> closed_ereal_semiline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> ereal <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real <span class="skolem">r</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_real_atLeast <span class="keyword1"><span class="command">unfolding</span></span> atLeast_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ereal_semiline_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> ereal <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">b</span> <span class="main">≤</span> ereal <span class="bound">y</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq ereal_le_real order_antisym<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lower and upper semicontinuity›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">lsc_at</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>order_topology<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lsc_at</span> <span class="free"><span class="bound"><span class="entity">x0</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⇢</span> <span class="free"><span class="bound"><span class="entity">x0</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∘</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⇢</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x0</span></span></span> <span class="main">≤</span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">usc_at</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>order_topology<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">usc_at</span> <span class="free"><span class="bound"><span class="entity">x0</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⇢</span> <span class="free"><span class="bound"><span class="entity">x0</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∘</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⇢</span> <span class="bound">l</span> <span class="main">⟶</span> <span class="bound">l</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x0</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lsc_at_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lsc_at_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> usc_at_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms usc_at_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lsc_at_open<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>first_countable_topology <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>complete_linorder<span class="main">,</span> linorder_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S_def<span class="main">:</span>
     <span class="quoted"><span class="quoted">"open <span class="skolem">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">T</span><span class="main">.</span> <span class="main">(</span>open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x'</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x'</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="skolem">S</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="keyword1">islimpt</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> islimpt_def <span class="keyword1"><span class="command">using</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> islimpt_sequential<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="free">f</span> <span class="free">x0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lim_explicit <span class="keyword1"><span class="command">using</span></span> X_def S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compact_complete_linorder<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r_def<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">r</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">:</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">N</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> r_def lim_explicit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span> <span class="main">∘</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> x_def X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> l_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∉</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="skolem">l</span><span class="main">≤</span><span class="free">f</span> <span class="free">x0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_def x_def X_def Lim_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span> <span class="main">∘</span> <span class="skolem">r</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> l_prop S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="bound">l</span> <span class="main">∧</span> <span class="main">~</span><span class="main">(</span><span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∘</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> r_def x_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_assoc LIMSEQ_subseq_LIMSEQ<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
 <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">x0</span>"</span></span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> SV_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">S</span> <span class="main">∧</span> open <span class="skolem">V</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">:</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="keyword1">Int</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hausdorff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N1</span><span class="main">.</span> <span class="skolem">x</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_def lim_explicit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">x0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N1</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> SV_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N2</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lim_explicit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="main">(</span>max <span class="skolem">N1</span> <span class="skolem">N2</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SV_def * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="main">(</span>max <span class="skolem">N1</span> <span class="skolem">N2</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lim_bounded2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"max <span class="skolem">N1</span> <span class="skolem">N2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span>"</span></span><span class="main">]</span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_at_open_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>first_countable_topology <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>complete_linorder<span class="main">,</span> linorder_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"open <span class="free">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">T</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="free">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lsc_at_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_at_MInfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_at_PInfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_open continuous_at_open <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_at_real<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="free">x0</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> ereal <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span> <span class="main">::</span> ereal<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="main">{</span><span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;..&lt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms ereal_between <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;..&lt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">}</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lsc_at_open_mem<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x0</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="main"><span class="main">&lt;..&lt;</span></span> <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x0</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">e</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> lsc e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">&gt;</span>  <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_def <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">:</span><span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">&gt;</span><span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">&gt;</span>  <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">{</span><span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">&lt;..&lt;</span><span class="free">f</span> <span class="free">x0</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">}</span> <span class="main">≤</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ereal_open_cont_interval<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> assms e_def ereal_between<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x0</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">e</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_def T_def <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_at_open <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_at_ereal<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">C</span></span><span class="main">&lt;</span><span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="bound">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lsc_at_MInfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> pinf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">&lt;</span><span class="free">f</span> <span class="free">x0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span><span class="skolem">C</span><span class="main">&lt;..}</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="main">{</span><span class="skolem">C</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">C</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> pinf lsc lsc_at_PInfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_open <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">∧</span> <span class="main">{</span>ereal <span class="skolem">C</span><span class="main">&lt;..}</span> <span class="main">≤</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pinf open_PInfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">C</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_at_open <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">&lt;</span><span class="free">f</span> <span class="free">x0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span><span class="main">-</span><span class="skolem">C</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin ereal_less_minus_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">x0</span><span class="main">-</span><span class="skolem">C</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> lsc_at_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x0</span></span><span class="main">]</span> lsc fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">x0</span><span class="main">-</span><span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">C</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted">ereal</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_at_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x0</span></span><span class="main">]</span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lst_at_ball<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">=&gt;</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">C</span></span><span class="main">&lt;</span><span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>ball <span class="free">x0</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">C</span><span class="main">&lt;</span><span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted">ereal</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">&lt;</span><span class="free">f</span> <span class="free">x0</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">T</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lsc lsc_at_ereal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>ball <span class="free">x0</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_contains_ball<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted">ereal</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">&lt;</span><span class="free">f</span> <span class="free">x0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>ball <span class="free">x0</span> <span class="skolem">d</span><span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Elementary_Metric_Spaces.open_ball centre_in_ball<span class="main">)</span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">using</span></span> lsc_at_ereal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lst_at_delta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">C</span></span><span class="main">&lt;</span><span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="free">x0</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">C</span></span><span class="main">&lt;</span><span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>ball <span class="free">x0</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lst_at_ball<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_liminf_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lst_at_ball le_Liminf_iff eventually_at
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">All</span></span></span><span class="main"><span class="main">]</span></span> imp_cong refl ext ex_cong<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_commute zero_less_dist_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_liminf_at_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> min <span class="main">(</span><span class="free">f</span> <span class="free">x0</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_ereal_def le_iff_inf lsc_liminf_at<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_imp_liminf<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> PInf <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms lsc_at_PInfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x0</span></span><span class="main">]</span> lim_imp_Liminf<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="free">x</span>"</span></span><span class="main">]</span>
    continuous_at_sequentially<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span> <span class="main">::</span> ereal<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T_def<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span> <span class="main">∧</span> <span class="free">x0</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="skolem">T</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> lsc_at_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x0</span></span><span class="main">]</span> real assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">x</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_obtains_N<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x0</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">T</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">-</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Liminf_bounded<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">N</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ereal_minus_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ereal_le_epsilon <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lsc_liminf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> lim_imp_Liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> lsc_imp_liminf <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_sequentially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span><span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">≤</span><span class="bound">c</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Lim_MInfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="skolem">x</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl refl _ <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_def N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> ereal <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span> <span class="main">::</span> ereal<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;..&lt;</span> <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_obtains_N<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">l</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="main"><span class="main">&lt;..&lt;</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">e</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> fin e_def ereal_between <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="skolem">x</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl refl _ <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_def N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_le_epsilon <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> xc_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limsup_bounded<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F <span class="main"><span class="main">=</span></span> <span class="quoted">sequentially</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> C <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
        Liminf_le_Limsup<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc xc_def lsc_imp_liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_sequentially_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">c</span> <span class="bound">c0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">⇢</span> <span class="bound">c0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span><span class="bound">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">≤</span><span class="bound">c0</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">c0</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">c0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⇢</span> <span class="skolem">c0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">≤</span><span class="skolem">c0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">c0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> a c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_sequentially<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">c</span> <span class="skolem">c0</span> <span class="keyword3"><span class="command">assume</span></span> xc_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">⇢</span> <span class="skolem">c0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span><span class="skolem">c</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Liminf_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted">sequentially</span><span class="main">]</span> lim_imp_Liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">c0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc xc_def lsc_imp_liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_sequentially_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⇢</span> <span class="free">c0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span><span class="free">c</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x0</span><span class="main">)</span><span class="main">≤</span><span class="free">c0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lsc_sequentially_gen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_uminus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> usc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lsc<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">-</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tendsto_uminus_ereal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">-</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lsc_at_mem<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x0</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">-</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> lsc x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> usc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> usc<span class="main">:</span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">-</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tendsto_uminus_ereal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">-</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> <span class="main">-</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> usc_at_mem<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x0</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> usc x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ereal_uminus_le_reorder<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> usc_limsup<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="free">x0</span> <span class="main">⟶</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lsc_uminus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> lsc_liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> <span class="main">-</span>limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> ereal_Liminf_uminus<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span> <span class="free">x0</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> usc_imp_limsup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms usc_limsup<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> usc_limsup_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">≥</span> Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">⟷</span> lsc_at <span class="free">x0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsc_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="free">x0</span><span class="main">)</span> <span class="main">≤</span> Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsc_liminf_at<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="free">x0</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span>Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_Liminf_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> continuous_iff_lsc_usc<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span>lsc_at <span class="free">x0</span> <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>usc_at <span class="free">x0</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a continuous_imp_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">∧</span> limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x0</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> lim_imp_Liminf<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span><span class="main">]</span> lim_imp_Limsup<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="free">f</span> <span class="main">∧</span> usc_at <span class="free">x0</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_liminf usc_limsup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_at <span class="free">x0</span> <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>usc_at <span class="free">x0</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> usc_limsup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_liminf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x0</span> <span class="main">∧</span> liminf <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Liminf_le_Limsup<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="free">x0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Liminf_eq_Limsup<span class="main">[</span><span class="operator">of</span> <span class="quoted">sequentially</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_iff_Liminf_eq_Limsup<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> continuous_at_sequentially<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> continuous_lsc_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="main">(</span><span class="free">g</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="free">x0</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">L</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="free">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">L</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="free">x0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lsc_at_mem<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span> <span class="free"><span class="free">x0</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span> <span class="main"><span class="main">∘</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">L</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> assms continuous_imp_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x0</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> continuous_isCont<span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟷</span> isCont <span class="free">f</span> <span class="free">x0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> continuous_at isCont_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> isCont_iff_lsc_usc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">x0</span> <span class="main">⟷</span> <span class="main">(</span>lsc_at <span class="free">x0</span> <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>usc_at <span class="free">x0</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> continuous_iff_lsc_usc continuous_isCont<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">lsc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>order_topology<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lsc</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> lsc_at <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">usc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>order_topology<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">usc</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> usc_at <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> continuous_UNIV_iff_lsc_usc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>lsc <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>usc <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> continuous_iff_lsc_usc lsc_def usc_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Epigraphs›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Epigraph</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">_</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xy</span><span class="main">.</span> fst <span class="bound">xy</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>fst <span class="bound">xy</span><span class="main">)</span> <span class="main">≤</span> ereal<span class="main">(</span>snd <span class="bound">xy</span><span class="main">)</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mem_Epigraph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Epigraph <span class="free">S</span> <span class="free">f</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> ereal <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> ereal_closed_levels<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">.</span> closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span>ereal <span class="bound">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">ereal</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">-</span><span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> Inter <span class="main">{</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span>ereal <span class="bound">r</span><span class="main">}</span> <span class="main">|</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">:</span> UNIV<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_Inter <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_iff<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="bound">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lsc <span class="free">f</span> <span class="main">⟷</span> closed <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">z0</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">z</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">⇢</span> <span class="skolem">z0</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="skolem">n</span> <span class="main">:</span> <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>fst <span class="main">(</span><span class="skolem">z</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ereal<span class="main">(</span>snd <span class="main">(</span><span class="skolem">z</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xn</span> <span class="bound">cn</span><span class="main">.</span> <span class="skolem">z</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xn</span><span class="main">,</span> <span class="bound">cn</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span><span class="main">(</span><span class="bound">xn</span><span class="main">)</span><span class="main">≤</span>ereal <span class="bound">cn</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">z</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">z</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> xc_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">z</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">,</span> <span class="skolem">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span>ereal <span class="main">(</span><span class="skolem">c</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x0</span> <span class="bound">c0</span><span class="main">.</span> <span class="skolem">z0</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x0</span><span class="main">,</span> <span class="bound">c0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">⇢</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">⇢</span> <span class="bound">c0</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="skolem">z0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="skolem">z0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> tendsto_fst<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">z0</span></span><span class="main">]</span> tendsto_snd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">z0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="skolem"><span class="skolem">c0</span></span> <span class="keyword2"><span class="keyword">where</span></span> xc0_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x0</span><span class="main">,</span> <span class="skolem">c0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">⇢</span> <span class="skolem">x0</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">⇢</span> <span class="skolem">c0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x0</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">c0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lsc_sequentially_mem<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="main"><span class="main">∘</span></span> <span class="skolem"><span class="skolem">c</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem">c0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lsc <span class="free">f</span>›</span></span> xc_def <span class="keyword1"><span class="command">unfolding</span></span> lsc_def <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">:</span> <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> xc0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_sequential_limits<span class="main">)</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="main">(</span><span class="bound">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ereal<span class="main">(</span>snd <span class="main">(</span><span class="bound">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⇢</span> <span class="bound">l</span> <span class="main">⟶</span>
     <span class="free">f</span> <span class="main">(</span>fst <span class="bound">l</span><span class="main">)</span> <span class="main">≤</span> ereal<span class="main">(</span>snd <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def closed_sequential_limits <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">z0</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">z</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">⇢</span> <span class="skolem">z0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">z0</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">z</span> <span class="bound">n</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z0</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span><span class="main">]</span>
         tendsto_Pair<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">z0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_sequential_limits<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_closed_levels <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x0</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⇢</span> <span class="skolem">x0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> mi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted">real</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">B</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> mi <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>›</span></span> Lim_MInfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">::</span>real<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="keyword2"><span class="keyword">where</span></span> N1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N1</span><span class="main">.</span> dist <span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x0</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⇢</span> <span class="skolem">x0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">y</span> <span class="skolem">x0</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">:</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">B</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span>max <span class="skolem">N</span> <span class="skolem">N1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">:</span> closure <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span>ereal <span class="skolem">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> closure_approachable<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span> <span class="main">≤</span> ereal <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_bot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span> <span class="main">::</span> ereal<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="main">:</span> <span class="main">{</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">&lt;..&lt;</span> <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">}</span>"</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_obtains_N<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">l</span></span> <span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="main"><span class="main">&lt;..&lt;</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">e</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command">using</span></span> fin e_def ereal_between <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="skolem">x</span> <span class="bound">n</span> <span class="main">:</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">l</span><span class="main">+</span><span class="skolem">e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">::</span>real<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N1</span></span> <span class="keyword2"><span class="keyword">where</span></span> N1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N1</span><span class="main">.</span> dist <span class="main">(</span><span class="skolem">x</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x0</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⇢</span> <span class="skolem">x0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lim_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">y</span> <span class="skolem">x0</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">:</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">l</span><span class="main">+</span><span class="skolem">e</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span>max <span class="skolem">N</span> <span class="skolem">N1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">:</span> closure <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">≤</span><span class="skolem">l</span><span class="main">+</span><span class="skolem">e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> closure_approachable<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">+</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_le_epsilon <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="skolem">x0</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lsc_hull</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lsc_hull</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">g</span><span class="main">.</span> Epigraph UNIV <span class="bound">g</span> <span class="main">=</span> closure<span class="main">(</span>Epigraph UNIV <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> epigraph_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span> <span class="main">∧</span> <span class="free">y</span><span class="main">≤</span><span class="free">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">using</span></span> ereal_less_eq<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> order_trans_rules<span class="main">(</span>23<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



<span class="keyword1"><span class="command">lemma</span></span> closed_epigraph_lines<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">*</span> <span class="tfree">'b</span><span class="main">::</span>metric_space<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed <span class="free">S</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">:</span> closure <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span> <span class="main">∧</span> dist <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> closure_approachable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span>"</span></span><span class="main">]</span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> dist <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dist_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> dist <span class="bound">s</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_approachable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closure <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span> <span class="main">≤</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> closure_subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mono_epigraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">*</span> real<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">S</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≤</span><span class="bound">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">:</span><span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Epigraph UNIV <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closed <span class="free">S</span>›</span></span> closed_epigraph_lines <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> ereal <span class="bound">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mono_closed_ereal<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">≤</span> ereal <span class="bound">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">:</span><span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span>fst <span class="skolem">s</span><span class="main">,</span> snd <span class="skolem">s</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">g</span><span class="main">(</span>fst <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span>snd <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">:</span><span class="free">S</span> <span class="main">⟷</span> <span class="skolem">g</span><span class="main">(</span>fst <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span>snd <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Epigraph UNIV <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> Epigraph UNIV <span class="bound">g</span> <span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">:</span>closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">≤</span><span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ya</span><span class="main">∈</span>Epigraph UNIV <span class="free">f</span><span class="main">.</span> dist <span class="bound">ya</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy closure_approachable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span> <span class="main">∧</span> dist <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> dist <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">+</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dist_prod_def dist_norm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">+</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> epigraph_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ab xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">∈</span>Epigraph UNIV <span class="free">f</span><span class="main">.</span> dist <span class="bound">w</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span>closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closure_approachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≤</span><span class="bound">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mono_epigraph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> epigraph_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span> <span class="main">=</span> Epigraph UNIV <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">=</span><span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">C</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">C</span><span class="main">)</span> <span class="main">:</span> Epigraph UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">C</span><span class="main">)</span> <span class="main">:</span> Epigraph UNIV <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">C</span> <span class="main">⟷</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_le_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> ereal_le_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_ex_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">g</span><span class="main">.</span> Epigraph UNIV <span class="bound">g</span> <span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> lsc_hull_exists epigraph_invertible <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1"><span class="command">lemma</span></span> epigraph_lsc_hull<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">=</span> closure<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> Epigraph UNIV <span class="bound">g</span> <span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_hull_def
   <span class="keyword1"><span class="command">using</span></span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Epigraph UNIV <span class="bound">g</span> <span class="main">=</span> closure<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_expl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">=</span> lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>Epigraph UNIV <span class="free">g</span> <span class="main">=</span> closure<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">g</span> <span class="main">=</span> closure<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_hull <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lsc_hull_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> some1_equality<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> lsc_hull_ex_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> epigraph_lsc_hull <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_lsc_hull<span class="main">:</span> <span class="quoted"><span class="quoted">"lsc <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> epigraph_lsc_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> lsc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lsc_hull <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> epigraph_subset_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span> <span class="main">≤</span> Epigraph UNIV <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> epi<span class="main">:</span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span> <span class="main">≤</span> Epigraph UNIV <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">∈</span>Epigraph UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">∈</span>Epigraph UNIV <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ereal_le_real<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> epigraph_lsc_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> closure_subset epigraph_subset_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"lsc_hull <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_greatest<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closure<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> Epigraph UNIV <span class="free">g</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> lsc_iff epigraph_subset_iff assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> closure_minimal<span class="main">)</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> epigraph_subset_iff lsc_hull_expl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_iff_greatest<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">=</span> lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span>
  lsc <span class="free">g</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">.</span> lsc <span class="bound">h</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_lsc_hull lsc_hull_le lsc_hull_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> lsc_lsc_hull lsc_hull_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> lsc_hull_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>lsc_hull <span class="free">g</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lsc_hull_greatest<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> lsc_lsc_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_lsc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"lsc <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">f</span> <span class="main">=</span> lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> lsc_hull_iff_greatest<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_liminf_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> xz_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">z</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="bound">e</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def min_Liminf_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="keyword2"><span class="keyword">where</span></span> e1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span><span class="main">&lt;</span><span class="skolem">e</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">e1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="bound">e</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">e1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SUP_upper<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">z</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">e1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xz_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span>ereal <span class="skolem">z</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> ball <span class="skolem">x</span> <span class="skolem">e1</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bex_def Inf_le_iff_less<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">:</span> ball <span class="skolem">x</span> <span class="skolem">e1</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">t</span> <span class="main">≤</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e1_def *<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> epi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e1</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">e1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t_def <span class="keyword1"><span class="command">unfolding</span></span> ball_def dist_norm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="skolem">e1</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> dist <span class="skolem">x</span> <span class="skolem">t</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e1_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_sum_squares_less<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e1</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="skolem">e1</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> dist <span class="skolem">x</span> <span class="skolem">t</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dist_prod_def dist_norm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>Epigraph UNIV <span class="free">f</span><span class="main">.</span> dist <span class="bound">y</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> epi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">:</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> closure_approachable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> xz_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span>closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> dist <span class="skolem">y</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> closure_approachable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span>"</span></span><span class="main">]</span> xz_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="main">(</span>dist <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>dist <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> real_sqrt_sum_squares_ge1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">&lt;</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_def <span class="keyword1"><span class="command">unfolding</span></span> dist_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span><span class="main">:</span>ball <span class="skolem">x</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ball_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="main">(</span>dist <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>dist <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> real_sqrt_sum_squares_ge2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">&lt;</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_def <span class="keyword1"><span class="command">unfolding</span></span> dist_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">e</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span><span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_lower<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">≤</span>ereal<span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_def <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command">unfolding</span></span> dist_norm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">e</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="bound">e</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span><span class="main">::</span>real<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">::</span>real<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="skolem">d</span><span class="main">&lt;</span><span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ball <span class="skolem">x</span> <span class="skolem">e</span> <span class="main">≤</span> ball <span class="skolem">x</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">e</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> INF_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="skolem">d</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> ereal<span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="skolem">z</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_Liminf_at <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SUP_least<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_le_epsilon2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lsc_hull <span class="free">f</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> epigraph_invertible epigraph_lsc_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_same_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> lsc_hull <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span>ball <span class="skolem">x</span> <span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> INF_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_Liminf_at <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SUP_upper<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span><span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_liminf_at<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> lsc_hull <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> INF_greatest<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> lsc_hull <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> INF_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Convex Functions›</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">convex_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">convex_on</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">u</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">v</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">u</span> <span class="main">+</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span>
  <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="bound">u</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">+</span> ereal <span class="bound">v</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">:</span><span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">+</span><span class="free">v</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="free">u</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> ereal <span class="free">v</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_on <span class="free">t</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> convex_on <span class="free">s</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_univ<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> convex_on <span class="bound">S</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> convex_on_ereal_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ereal_pos_sum_distrib_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sum <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_pos_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_ereal_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span><span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_pos_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span>
      <span class="main">≤</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> convex_ereal_cmul<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">c</span><span class="main">::</span>ereal<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ereal_mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span>  <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_le_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ereal <span class="skolem">u</span> <span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span>
      <span class="main">≤</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> convex_ereal_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> max <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> max.mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">≤</span>ereal <span class="skolem">u</span> <span class="main">*</span> max <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> max <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> max.boundedI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ereal_mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> ereal <span class="skolem">u</span> <span class="main">*</span> max <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> max <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">C</span> <span class="free">f</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m</span> <span class="main">::</span> real<span class="main">.</span> <span class="bound">m</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="main">1</span>
      <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>ereal <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ereal_minus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> asms<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_on <span class="free">C</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">:</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> convex_on_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">+</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="free">f</span> <span class="main">(</span><span class="bound">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="bound">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="bound">v</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> asms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span>
          <span class="main">≤</span> <span class="main">(</span>ereal <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="main">1</span>
      <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> lasm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ereal <span class="skolem">u</span> <span class="main">=</span> ereal <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ereal_minus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> asm<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="skolem">v</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lasm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">C</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_alt_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">C</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">:</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>ereal <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_on_ereal_alt<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> ereal_add_right_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>ereal<span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">+</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">+</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mono order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_sum_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="free">a</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ereal <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult.commute eq_divide_eq ereal_minus<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms
            one_ereal_def less_le times_ereal.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_vector"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">C</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">s</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟶</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟶</span> <span class="free">y</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">s</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">s</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5-<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_ne_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>singleton <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹convex_on <span class="free">C</span> <span class="free">f</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_on_ereal_alt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹convex <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">∈</span> <span class="skolem">s</span> <span class="main">⟶</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>1-3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> yai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="skolem">i</span> <span class="main">:</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> ai1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_nonneg_leq_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">i</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_minus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_minus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="free">j</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="free">j</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i0 insert
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff divide_nonneg_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum.insert insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_divide_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> asum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">:</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert convex_sum<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">s</span>›</span></span>
        <span class="quoted"><span class="quoted">‹convex <span class="free">C</span>›</span></span> a1 a_nonneg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> asum_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> ereal <span class="main">(</span><span class="var">?a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_nonneg a1 insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">a</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∉</span> <span class="skolem">s</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">a</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">j</span> <span class="main">*</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">a</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scaleR_right.sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span>"</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">a</span> <span class="skolem">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">i</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> yai<span class="main">(</span>1<span class="main">)</span> asum yai<span class="main">(</span>2<span class="main">)</span> ai1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> ereal <span class="main">(</span><span class="var">?a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ereal_add_right_mono<span class="main">[</span><span class="operator">OF</span> ereal_mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">OF</span> asum_le less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="main">(</span><span class="var">?a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ereal_pos_sum_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="var">?a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i1<span class="main"><span class="main">]</span></span> i2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i0 convex_on_ereal_sum_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">j</span> <span class="main">:</span> insert <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> sum_2<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">u</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">..</span><span class="numeral">2</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">u</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">..</span><span class="numeral">2</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_ereal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">u</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> sum <span class="bound">u</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span>
   <span class="free">f</span> <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">k</span><span class="main">}</span> <span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="bound">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">k</span><span class="main">}</span> <span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⟷</span> <span class="var">?lhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">u</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">k</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">u</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">)</span>
      <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>ereal <span class="main">(</span><span class="skolem">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_on_ereal_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> xys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="free">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> uv1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">uv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uv</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="keyword1">else</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">uv</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xy</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy_def uv_def <span class="keyword1"><span class="command">using</span></span> xys uv1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">uv</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">uv</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> uv_def <span class="keyword1"><span class="command">using</span></span> uv1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">.</span> <span class="skolem">uv</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">xy</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">uv</span> <span class="bound">i</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">xy</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> xy_def uv_def <span class="keyword1"><span class="command">using</span></span> xys uv1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUM</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">uv</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">xy</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">uv</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">xy</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> xy_def uv_def <span class="keyword1"><span class="command">using</span></span> xys uv1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lhs</span>›</span></span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">uv</span></span> <span class="quoted"><span class="skolem">xy</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_Epigraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex<span class="main">(</span>Epigraph <span class="free">S</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> convex_on <span class="free">S</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> rhs<span class="main">:</span> <span class="quoted"><span class="quoted">"convex<span class="main">(</span>Epigraph <span class="free">S</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="main">0</span> <span class="main">|</span> <span class="skolem">v</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">)</span> <span class="main">∧</span> <span class="main">~</span><span class="main">(</span><span class="skolem">u</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> ereal <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span><span class="main">::</span><span class="quoted">real</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> a xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> rhs convexD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">u</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> uv yz a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">∧</span> <span class="main">~</span><span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> xz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span><span class="main">::</span><span class="quoted">real</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> a xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> rhs convexD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> uv xz a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fx</span></span> <span class="skolem"><span class="skolem">fy</span></span> <span class="keyword2"><span class="keyword">where</span></span> fxy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> ereal <span class="skolem">fx</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> ereal <span class="skolem">fy</span>"</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">fx</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">fy</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">fx</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">*</span> <span class="skolem">fy</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> rhs convexD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">fx</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">fy</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> fxy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> lhs<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_on <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">fx</span> <span class="skolem">fy</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">fx</span><span class="main">)</span><span class="main">:</span>Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">fy</span><span class="main">)</span><span class="main">:</span>Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="skolem">fx</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> ereal <span class="skolem">fy</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="free">S</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">:</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">:</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms uv convexD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="skolem">v</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lhs convex_on_ereal_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>ereal <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="skolem">fx</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ereal <span class="skolem">v</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ereal <span class="skolem">fy</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ereal_mult_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ereal_mult_left_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> le uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">fx</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">*</span> <span class="skolem">fy</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">fx</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">*</span> <span class="skolem">fy</span><span class="main">)</span> <span class="main">:</span> Epigraph <span class="free">S</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def <span class="keyword1"><span class="command">using</span></span> inS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex<span class="main">(</span>Epigraph <span class="free">S</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_EpigraphI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"convex_on <span class="free">s</span> <span class="free">f</span> <span class="main">⟹</span> convex <span class="free">s</span> <span class="main">⟹</span> convex<span class="main">(</span>Epigraph <span class="free">s</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> convex_Epigraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">concave_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">concave_on</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> convex_on <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">finite_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_on</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">affine_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">affine_on</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span>convex_on <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> concave_on <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> finite_on <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">domain</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">_</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> domain_Epigraph_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">x</span><span class="main">≤</span>ereal <span class="bound">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> domain_Epigraph<span class="main">:</span>
  <span class="quoted"><span class="quoted">"domain <span class="free">f</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> Epigraph UNIV <span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> domain_def Epigraph_def <span class="keyword1"><span class="command">using</span></span> domain_Epigraph_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> domain_Epigraph_fst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"domain <span class="free">f</span> <span class="main">=</span> fst <span class="main">`</span> <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>domain <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> domain_Epigraph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>fst <span class="main">`</span> <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> domain_Epigraph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_domain<span class="main">:</span>
  <span class="quoted"><span class="quoted">"convex_on <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟷</span> convex_on UNIV <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> lhs<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_on <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_ereal_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> domain <span class="free">f</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">:</span> domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lhs <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> convex_on_ereal_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_on_domain2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"convex_on <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> convex_on <span class="bound">S</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_on_domain convex_on_ereal_univ<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_domain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms convex_Epigraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_Epigraph_fst
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> convex_linear_image<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> linear_fst linear_conv_bounded_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> infinite_convex_domain_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span> <span class="main">⟷</span> convex <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>domain <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span>domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">:</span> domain <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">unfolding</span></span> convex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_on <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_on_domain2<span class="main">)</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_domain<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_PInfty_outside<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">:</span><span class="free">S</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span><span class="main">:</span><span class="free">S</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">∞</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">::</span>ereal<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> infinite_convex_domain_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">:</span><span class="free">S</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> max <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fun_eq_iff<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> convex_ereal_max assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">proper_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proper_on</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">proper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proper</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> proper_on UNIV <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> proper_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proper <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proper_def proper_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> improper_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proper_iff<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> ereal_MInf_plus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="keyword1">then</span> <span class="main">∞</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">∞</span><span class="main">::</span>ereal<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> convex_improper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>rel_interior<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"domain <span class="free">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel_interior_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> nemp<span class="main">:</span> <span class="quoted"><span class="quoted">"domain <span class="free">f</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms improper_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> udom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">:</span>domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>rel_interior<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">:</span> domain <span class="free">f</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> convex_rel_interior_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"domain <span class="free">f</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> nemp convex_domain<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms udom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> v01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">v</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">u</span><span class="main">+</span><span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v_def y_def <span class="keyword1"><span class="command">using</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span>ereal <span class="skolem">v</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">u</span><span class="main">+</span>ereal <span class="skolem">v</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_on_ereal_alt_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"UNIV"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> assms convex_UNIV v01
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_def y_def <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">-</span> ereal <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v01
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_gt_0_iff_gt ereal_less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ereal_minus<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> one_ereal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span>ereal <span class="skolem">v</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_improper2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">|</span> <span class="free">x</span> <span class="main">:</span> rel_frontier <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">:</span> domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> closure <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closure_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms convex_improper a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> rel_frontier <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_frontier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_lsc_improper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lsc_at <span class="skolem">x</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> lsc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span> domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> closure <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closure_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> closure <span class="main">(</span>rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> convex_closure_rel_interior convex_domain<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">&lt;</span><span class="free">f</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="skolem">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> lst_at_delta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹lsc_at <span class="skolem">x</span> <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span>rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> dist <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> x_def closure_approachable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> convex_improper<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_lsc_hull<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_EpigraphI convex_UNIV<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>Epigraph UNIV <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_closure epigraph_lsc_hull<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_Epigraph convex_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> improper_lsc_hull<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> UNIV_I lsc_at_open lsc_def open_UNIV<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsc_hull_lsc<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_infty_less_eq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lsc_hull_le<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_infty_less_eq2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lsc_hull_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> improper_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_convex_improper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>rel_interior<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_improper ereal_infty_less_eq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lsc_hull_le<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_with_rel_open_domain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_open <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>proper <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> proper_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proper_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>rel_interior<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> convex_improper<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>domain <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_open_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">|</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_with_UNIV_domain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"domain <span class="free">f</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_improper ereal_MInfty_lessI proper_iff rel_interior_UNIV UNIV_I<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> rel_interior_Epigraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">)</span> <span class="main">:</span> rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">x</span> <span class="main">:</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x</span> <span class="main">&lt;</span> ereal <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_interior_projection<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">:</span></span> Epigraph UNIV <span class="free"><span class="free">f</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_EpigraphI convex_UNIV convex_on_ereal_univ<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> domain_Epigraph Epigraph_def <span class="keyword1"><span class="command">using</span></span> rel_interior_ereal_semiline <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> rel_interior_EpigraphI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">:</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> ereal <span class="bound">z</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span>rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">:</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> ereal <span class="skolem">z</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> rel_interior_Epigraph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> convex_less_ri_domain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">,</span><span class="bound">m</span><span class="main">)</span><span class="main">|</span><span class="bound">x</span> <span class="bound">m</span><span class="main">.</span> ereal <span class="bound">m</span><span class="main">&lt;</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> ereal <span class="skolem">z</span> <span class="main">∧</span> ereal <span class="skolem">z</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_dense2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span><span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span><span class="main">:</span>Epigraph UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def Epigraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="keyword1">Int</span> <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def Epigraph_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> real <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> inner <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="bound">y</span> <span class="main">&lt;</span> real_of_ereal <span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> open_halfspace_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> PInf <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> MInf <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="keyword1">Int</span> rel_interior<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> convex_Epigraph convex_UNIV
       open_Int_closure_eq_empty open_inter_closure_rel_interior<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="skolem"><span class="skolem">z0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x0</span><span class="main">,</span><span class="skolem">z0</span><span class="main">)</span><span class="main">:</span><span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">x0</span> <span class="main">:</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x0</span> <span class="main">&lt;</span> ereal <span class="skolem">z0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_interior_Epigraph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> rel_interior_eq_between<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'m</span><span class="main">::</span>euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_interior <span class="free">S</span> <span class="main">=</span> rel_interior <span class="free">T</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>rel_interior <span class="free">S</span> <span class="main">≤</span> <span class="free">T</span> <span class="main">∧</span> <span class="free">T</span> <span class="main">≤</span> closure <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms closure_eq_between convex_closure_rel_interior convex_rel_interior_closure<span class="main">)</span>



<span class="keyword1"><span class="command">lemma</span></span> convex_less_in_riS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="free">S</span> <span class="main">≤</span> domain <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>closure <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>rel_interior <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span><span class="main">:</span>closure <span class="free">S</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> convg<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> convex_PInfty_outside<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms convex_closure <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>rel_interior <span class="main">(</span>domain <span class="skolem">g</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> convex_less_ri_domain<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>domain <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convg convex_domain<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="free">S</span> <span class="main">≤</span> domain <span class="skolem">g</span> <span class="main">∧</span> domain <span class="skolem">g</span> <span class="main">≤</span> closure <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g_def assms rel_interior_subset_closure <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>domain <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> rel_interior <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_interior_eq_between<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> g_def less_ereal.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> convex_less_inS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≤</span> domain <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>closure <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> convex_less_in_riS<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> rel_interior_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_finite_geq_on_closure<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite_on <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>closure <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≤</span> domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> finite_on_def domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>closure <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>closure <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> convex_less_inS<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> assms <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">≤</span> domain <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_convex_determined<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">=</span> rel_interior <span class="main">(</span>domain <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc_hull <span class="free">f</span> <span class="main">=</span> lsc_hull <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">=</span> rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_interior_EpigraphI<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_EpigraphI convex_UNIV convex_closure_rel_interior<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsc_hull_expl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> domain_lsc_hull_between<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"domain <span class="free">f</span> <span class="main">≤</span> domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>
       <span class="main">∧</span> domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> closure <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>domain <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">using</span></span> lsc_hull_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">using</span></span> lsc_hull_liminf_at<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z_def<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dense<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="free">f</span> <span class="main">`</span> ball <span class="skolem">x</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">≤</span> min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> min_Liminf_at <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> SUP_upper<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> ball <span class="skolem">x</span> <span class="skolem">e</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Inf_le_iff_less <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"ball <span class="skolem">x</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span><span class="main">]</span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bex_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> dist <span class="skolem">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def ball_def <span class="keyword1"><span class="command">using</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>closure<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> closure_approachable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> domain_vs_domain_lsc_hull<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_interior<span class="main">(</span>domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rel_interior<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>
         <span class="main">∧</span> closure<span class="main">(</span>domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> closure<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>
         <span class="main">∧</span> aff_dim<span class="main">(</span>domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> aff_dim<span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_domain<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_domain convex_lsc_hull<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>
                 <span class="main">∧</span> domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> closure <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domain_lsc_hull_between rel_interior_subset subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> closure_eq_between rel_interior_aff_dim rel_interior_eq_between<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> vertical_line_affine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"affine <span class="main">{</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="bound">m</span><span class="main">::</span>real<span class="main">)</span><span class="main">|</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">:</span>UNIV<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> affine_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pth_8<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_convex_agrees_onRI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> cEpi<span class="main">:</span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_EpigraphI convex_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">using</span></span> rel_interior_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">:</span>rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms x_def rel_interior_Epigraph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_dense2<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">m</span><span class="main">::</span>real<span class="main">)</span><span class="main">|</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">:</span>UNIV<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"affine <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vertical_line_affine <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="keyword1">Int</span> <span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_def M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="keyword1">Int</span> <span class="skolem">M</span> <span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span> <span class="keyword1">Int</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convex_affine_closure_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span>"</span></span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> cEpi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Epigraph UNIV <span class="free">f</span> <span class="keyword1">Int</span> <span class="skolem">M</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="bound">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed<span class="main">(</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">≤</span> ereal <span class="bound">m</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> closed_Times<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> closed_ereal_semiline <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="bound">m</span><span class="main">}</span> <span class="main">=</span> closure <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span> <span class="keyword1">Int</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> Int_commute closure_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span>Epigraph UNIV <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="keyword1">Int</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute epigraph_lsc_hull<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="bound">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Epigraph_def M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="bound">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> lsc_hull <span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> ereal <span class="bound">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_semiline_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_convex_agrees_outside<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> closure <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> closure <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> domain <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_lsc_hull_between <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_convex_agrees<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">:</span> rel_frontier <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI assms lsc_hull_of_convex_agrees_onRI lsc_hull_of_convex_agrees_outside rel_frontier_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_proper_convex_proper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"proper <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proper <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span>rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_less_ri_domain ereal_less_PInfty proper_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_of_convex_agrees<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms
     <span class="keyword1"><span class="command">unfolding</span></span> rel_frontier_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">∞</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> assms proper_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">∧</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> convex_lsc_improper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lsc_hull <span class="free">f</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    lsc_lsc_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms convex_lsc_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_proper_convex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"proper <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> proper <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> convex_on UNIV <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">:</span> rel_frontier <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms convex_lsc_hull lsc_hull_of_convex_agrees lsc_hull_of_proper_convex_proper lsc_lsc_hull<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> affine_no_rel_frontier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"affine <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_frontier <span class="free">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_frontier_def <span class="keyword1"><span class="command">using</span></span> assms affine_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span>
  closure_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> affine_rel_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> rel_open_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_with_affine_domain_is_lsc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"affine <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms affine_no_rel_frontier emptyE lsc_def lsc_hull_liminf_at
          lsc_hull_of_convex_agrees lsc_liminf_at_eq<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> convex_finite_is_lsc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lsc <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"affine <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms affine_UNIV <span class="keyword1"><span class="command">unfolding</span></span> finite_on_def domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> convex_with_affine_domain_is_lsc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> always_eventually_within<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> eventually <span class="free">P</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_filter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> ereal_divide_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>ereal<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">/</span><span class="main">(</span>ereal <span class="free">b</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PInfty_eq_infinity assms ereal.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ereal_less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ereal_less_divide_pos ereal_mult_zero<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> real_interval_limpt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> cball <span class="free">b</span> <span class="skolem">e</span> <span class="main">≤</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> open_contains_cball<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="skolem">e</span><span class="main">)</span><span class="main">:</span>cball <span class="free">b</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cball_def dist_norm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≥</span><span class="free">b</span><span class="main">-</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span>cball <span class="free">b</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cball_def dist_norm <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="free">a</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="skolem">e</span><span class="main">)</span><span class="main">:</span>cball <span class="free">b</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max.absorb1 max.absorb2 linear<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"max <span class="free">a</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="skolem">e</span><span class="main">)</span><span class="main">:</span><span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="free">a</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="skolem">e</span><span class="main">)</span><span class="main">:</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_def <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">:</span> <span class="skolem">T</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> islimpt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_convex_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">*</span><span class="free">a</span><span class="main">+</span><span class="bound">m</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nontr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>trivial_limit <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="main">1</span><span class="main">::</span>real<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> trivial_limit_within<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> real_interval_limpt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">*</span><span class="free">a</span><span class="main">+</span><span class="bound">m</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lim_ereal <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lim_imp_Limsup<span class="main">[</span><span class="operator">OF</span> nontr this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lsc_hull_of_convex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex_on UNIV <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> rel_interior <span class="main">(</span>domain <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="bound">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
         <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">⤏</span> <span class="main">_</span> <span class="free">y</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?g</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">=</span><span class="free">x</span>›</span></span> assms lsc_hull_of_convex_agrees_onRI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">y</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="bound">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> min <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="free">y</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsc_hull_liminf_at<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_Liminf_at <span class="keyword1"><span class="command">unfolding</span></span> Liminf_within
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> SUP_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">n</span><span class="main">/</span>norm<span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> INF_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="improper">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="improper">m</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command">unfolding</span></span> ball_def dist_norm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">≠</span><span class="free">x</span>›</span></span> less_divide_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span> <span class="main">≤</span> Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">b</span><span class="main">≥</span><span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> yb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">:</span>closure<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> epigraph_lsc_hull mem_Epigraph UNIV_I<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> domain <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_interior_subset rev_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span><span class="quoted"><span class="quoted">"ereal <span class="skolem">a</span><span class="main">&gt;</span><span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_dense2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">:</span>rel_interior<span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rel_interior_Epigraph<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> rel_interior <span class="main">(</span>Epigraph UNIV <span class="free">f</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_interior_closure_convex_shrink<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> convex_Epigraph convex_UNIV convex_on_ereal_univ<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> yb xa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">)</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> rel_interior_Epigraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">m</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">m</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">*</span><span class="skolem">a</span><span class="main">+</span><span class="bound">m</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> always_eventually_within<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span> <span class="main">≤</span> Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">*</span><span class="skolem">a</span><span class="main">+</span><span class="bound">m</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Limsup_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> ereal <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lsc_hull_of_convex_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span> <span class="main">≤</span>ereal <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span> <span class="main">≤</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ereal_le_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> nontr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>trivial_limit <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> trivial_limit_within<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> real_interval_limpt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span> <span class="main">≤</span> Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Liminf_le_Limsup<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Limsup <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span>
                   <span class="main">∧</span> Liminf <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">(</span>lsc_hull <span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Liminf_eq_Limsup<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> nontr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>