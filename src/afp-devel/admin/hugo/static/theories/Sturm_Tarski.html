<div id="PolyMisc">
<div class="head">
<h1>Theory PolyMisc</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> PolyMisc <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> coprime_poly_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_common_divisor<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_pCons_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smult_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> smult<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_self smult_diff_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dvd_monic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> monic<span class="main">:</span><span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> degree <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_poly_dvd_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span><span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">q</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_zero_right smult_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> deg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">=</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> degree_0 degree_mult_eq degree_smult_eq k<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c_dvd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span>degree <span class="skolem">k</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">dvd</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> degree <span class="skolem">k</span> "</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">+</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> coeff_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> k coeff_smult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">-</span><span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">+</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> deg_eq <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> sum <span class="skolem">T</span> <span class="main">{</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">}</span><span class="main">+</span> 
                  sum <span class="skolem">T</span> <span class="main">{</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">≡</span><span class="main">{</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>degree <span class="free">p</span><span class="main">}</span><span class="main">,</span><span class="main">{</span>degree <span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">..</span>degree <span class="free">p</span><span class="main">+</span>degree <span class="skolem">k</span><span class="main">-</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> finite <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">T</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span>sum <span class="skolem">T</span><span class="main">)</span> <span class="skolem">C</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sum.Union_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">C</span><span class="main">=</span><span class="main">{..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> degree <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"sum <span class="main">(</span>sum <span class="skolem">T</span><span class="main">)</span> <span class="skolem">C</span><span class="main">=</span> sum <span class="skolem">T</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span> <span class="main">+</span> sum <span class="skolem">T</span> <span class="main">{</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> 
                  sum <span class="skolem">T</span> <span class="main">{</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span><span class="main">≠</span><span class="main">{</span>degree <span class="free">p</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeast0LessThan insertI1 lessThan_iff less_imp_not_eq<span class="main">)</span>  
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>degree <span class="free">p</span><span class="main">}</span><span class="main">≠</span><span class="main">{</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add_diff_cancel_right' atLeastAtMost_singleton_iff 
                  diff_self_eq_0 eq_imp_le not_one_le_zero<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span><span class="main">≠</span><span class="main">{</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">k</span><span class="main">≥</span><span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span>  coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> coeff_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">T</span> <span class="main">{</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">}</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">=</span>coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> monic <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> c_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> sum <span class="skolem">T</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span> 
              <span class="main">+</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span><span class="main">⟹</span><span class="free">c</span> <span class="keyword1">dvd</span> sum <span class="skolem">T</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_sum<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">-</span>degree <span class="free">p</span><span class="main">)</span><span class="main">≤</span>degree <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> degree <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> degree <span class="free">p</span> <span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">-</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' deg_eq diff_diff_left dvd_0_right le_degree 
                  le_diff_conv add.commute ordered_cancel_comm_monoid_diff_class.diff_diff_right<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="skolem">T</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span><span class="var">?case</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="free">p</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> coeff_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> coeff <span class="skolem">k</span> <span class="main">(</span>degree <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c_coeff <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvdI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_add_right_iff dvd_triv_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">dvd</span> coeff <span class="skolem">k</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_diff_cancel dvd_0_right le_add2 le_add_diff_inverse le_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">n</span><span class="main">=</span>coeff <span class="skolem">k</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> "</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> MOST_coeff_eq_0 MOST_mono assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> f mult_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="main">(</span>Abs_poly <span class="skolem">f</span><span class="main">)</span><span class="main">=</span><span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> f smult.abs_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"Abs_poly <span class="skolem">f</span>"</span></span><span class="main">]</span> Abs_poly_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> coeff_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="free">p</span><span class="main">*</span> Abs_poly <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> smult_cancel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_power_n_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main">=</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_power_n_odd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">a</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main">&gt;</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">≥</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span>poly <span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">x</span> <span class="main">≥</span><span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> poly_power <span class="keyword1"><span class="command">using</span></span> zero_le_odd_power<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹odd <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">x</span> <span class="main">≥</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">≥</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">≥</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">≥</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">=</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> poly_power_n_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms even_zero<span class="main">)</span>    
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gcd_coprime_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">p'</span> <span class="main">*</span> gcd <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">q'</span> <span class="main">*</span> gcd <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p'</span> <span class="free">q'</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> gcd_coprime nz p' q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_mod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sturm_Tarski">
<div class="head">
<h1>Theory Sturm_Tarski</h1>
</div>
<pre class="source"><span class="comment1">(*  Title: Sturm-Tarski Theorem
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Sturm-Tarski Theorem"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sturm_Tarski
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> <a href="PolyMisc.html">PolyMisc</a> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Field_as_Ring.html">HOL-Computational_Algebra.Field_as_Ring</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_at_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>archimedean_field<span class="main">,</span>linorder_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex_less_of_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eventually_at_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&gt;</span><span class="free">x</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_at_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>archimedean_field<span class="main">,</span>linorder_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&lt;</span><span class="free">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="bound">b</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> linordered_field_no_lb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eventually_at_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&lt;</span><span class="free">x</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> eve<span class="main">:</span><span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> False<span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eventually_conj<span class="main">[</span><span class="operator">OF</span> eve<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span> eventually_False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_tendsto<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="main">⤏</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="main">⤏</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="main">⤏</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isCont_def<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poly <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>filterlim_at_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_eq_pos_or_neg_iff_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">⟷</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lb</span><span class="main">&lt;</span><span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">≤</span><span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z1</span><span class="main">≤</span><span class="main">0</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lb</span><span class="main">&lt;</span><span class="skolem">z2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span><span class="main">≤</span><span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z2</span><span class="main">≥</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="free">ub</span><span class="main">∧</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="skolem">z2</span> <span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">z1</span><span class="main">=</span><span class="skolem">z2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z1 z2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">≠</span><span class="skolem">z2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z1<span class="main">(</span>3<span class="main">)</span> z2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="skolem">z1</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">z2</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="skolem">z2</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">z1</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg poly_IVT_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> linorder_class.neq_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> z2<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def order.strict_trans2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_eq_pos_or_neg_iff_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> 
    <span class="main">⟷</span><span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span><span class="main">⟷</span><span class="var">?P</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lb</span><span class="main">≤</span><span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">&lt;</span><span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z1</span><span class="main">≤</span><span class="main">0</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lb</span><span class="main">≤</span><span class="skolem">z2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span><span class="main">&lt;</span><span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z2</span><span class="main">≥</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">∧</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="skolem">z2</span> <span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">z1</span><span class="main">=</span><span class="skolem">z2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z1 z2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">≠</span><span class="skolem">z2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z1<span class="main">(</span>3<span class="main">)</span> z2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="skolem">z1</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">z2</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="skolem">z2</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">z1</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg poly_IVT_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> linorder_class.neq_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> z2<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.strict_trans not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> next_non_root_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ub</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ub</span><span class="main">&gt;</span><span class="free">lb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">&gt;</span><span class="free">lb</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">lb</span></span></span><span class="main"><span class="main"><span class="main">+</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span><span class="main">≡</span>Min <span class="main">{</span><span class="bound">r</span> <span class="main">.</span> poly <span class="free">p</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">&gt;</span><span class="free">lb</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">lr</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span><span class="main">&gt;</span><span class="free">lb</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> True lr_def poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">lb</span><span class="main">+</span><span class="skolem">lr</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_non_root_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">lb</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lb</span><span class="main">&lt;</span><span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">ub</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mr</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">mr</span><span class="main">≡</span>Max <span class="main">{</span><span class="bound">r</span> <span class="main">.</span> poly <span class="free">p</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">mr</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mr</span><span class="main">&lt;</span><span class="free">ub</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> True mr_def poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mr</span><span class="main">+</span><span class="free">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">mr</span><span class="main">&lt;</span><span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Bound of polynomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sgn_pos_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> poly <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">sgn_pos_inf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> sgn <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sgn_neg_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> poly <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">sgn_neg_inf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">then</span> sgn <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span>sgn <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_inf_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn_pos_inf <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span> sgn <span class="main">(</span>lead_coeff <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> degree <span class="free">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_comp<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_neg_inf_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.right_neutral mult_minus1_right neg_one_even_power neg_one_odd_power sgn_minus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_pinfty_gt_lc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">x</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≥</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">a</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span><span class="skolem">p</span><span class="main">=</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> gte_lcoeff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">n1</span><span class="main">.</span> lead_coeff <span class="skolem">p</span> <span class="main">≤</span> poly <span class="skolem">p</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that pCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> gt_0<span class="main">:</span><span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pCons<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≡</span>max <span class="skolem">n1</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span> <span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span><span class="main">/</span><span class="main">(</span>lead_coeff <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">≤</span> poly <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> gte_lcoeff <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span><span class="main">/</span><span class="main">(</span>lead_coeff <span class="skolem">p</span><span class="main">)</span> <span class="main">≥</span> <span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span><span class="main">/</span><span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gt_0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> frac_le<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≥</span><span class="main">1</span><span class="main">+</span> <span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span><span class="main">/</span><span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≤</span><span class="skolem">x</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> n_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> poly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="skolem">p</span> <span class="main">≤</span> poly <span class="skolem">p</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_sgn_eventually_at_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="free">p</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> that poly_pinfty_gt_lc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_minus
      <span class="keyword1"><span class="command">using</span></span> leading_coeff_neq_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>not_less_iff_gr_or_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> lead_coeff <span class="free">p</span> <span class="main">≥</span> poly <span class="free">p</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_pinfty_gt_lc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">p</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_sgn_eventually_at_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
<span class="keyword1"><span class="command">using</span></span> 
  poly_sgn_eventually_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span><span class="main">,</span><span class="operator">unfolded</span> poly_pcompose sgn_inf_sym<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
  eventually_filtermap<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted">uminus</span> <span class="quoted"><span class="quoted">"at_bot<span class="main">::</span>real filter"</span></span><span class="main">,</span><span class="operator">folded</span> at_top_mirror<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
<span class="keyword1"><span class="command">lemma</span></span> root_ub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ub</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">ub</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">≡</span>Max <span class="main">{</span><span class="bound">x</span> <span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">≤</span><span class="skolem">max_r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add_strict_increasing zero_less_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub2</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> poly_sgn_eventually_at_top<span class="main">[</span><span class="operator">unfolded</span> eventually_at_top_linorder<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">≡</span>max <span class="skolem">ub1</span> <span class="skolem">ub2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub1 ub_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff less_eq_real_def less_linear max.bounded_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">]</span> ub2 ub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_lb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">lb</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="free">lb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="free">lb</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb1</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">min_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span><span class="main">≡</span>Min <span class="main">{</span><span class="bound">x</span> <span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">≥</span><span class="skolem">min_r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lt_ex order.strict_trans2 that<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb2</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb2</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> poly_sgn_eventually_at_bot<span class="main">[</span><span class="operator">unfolded</span> eventually_at_bot_linorder<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">≡</span>min <span class="skolem">lb1</span> <span class="skolem">lb2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lb1 lb_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> less_not_sym min_less_iff_conj neq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">]</span> lb2 lb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Sign›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sign</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> sign <span class="free">x</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> sign <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟹</span> sign <span class="free">x</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sign_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sign_cases <span class="main">[</span><span class="operator">case_names</span> neg zero pos<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>sign <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sign <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sign <span class="free">x</span> <span class="main">=</span><span class="main">1</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>  
<span class="keyword1"><span class="command">unfolding</span></span> Sturm_Tarski.sign_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>   

<span class="keyword1"><span class="command">lemma</span></span> sign_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_ring_strict"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> sign <span class="free">x</span> <span class="main">*</span> sign <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Sturm_Tarski.sign_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zero_less_mult_iff<span class="main">)</span>
   
<span class="keyword1"><span class="command">lemma</span></span> sign_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="free">n</span> <span class="keyword1">then</span> <span class="main">¦</span>sign <span class="free">x</span><span class="main">¦</span> <span class="keyword1">else</span> sign <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sturm_Tarski.sign_def zero_less_power_eq<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> sgn_sign_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_idom<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> of_int <span class="main">(</span>sign <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Variation and cross›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">variation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>  real <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">variation</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">≥</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cross</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cross</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">=</span>variation <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variation_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"variation <span class="main">0</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"variation <span class="free">x</span> <span class="main">0</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> variation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> variation_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"variation <span class="free">x</span> <span class="free">y</span><span class="main">=</span> <span class="main">-</span> variation <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> variation_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> cross_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cross <span class="main">0</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> variation_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> variation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> variation_def  
    <span class="keyword1"><span class="command">using</span></span> mult_pos_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> variation_def 
    <span class="keyword1"><span class="command">using</span></span> mult_neg_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span><span class="free">y</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span><span class="main">⟹</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> variation_def 
    <span class="keyword1"><span class="command">using</span></span> mult_neg_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variation_congr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span><span class="main">=</span>sgn <span class="free">x'</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">y</span><span class="main">=</span>sgn <span class="free">y'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"variation <span class="free">x</span> <span class="free">y</span><span class="main">=</span>variation <span class="free">x'</span> <span class="free">y'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span>  <span class="main">(</span><span class="main">0</span><span class="main">≤</span> <span class="free">x'</span> <span class="main">*</span> <span class="free">y'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Real_Vector_Spaces.sgn_mult zero_le_sgn_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span><span class="main">≤</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x'</span> <span class="main">&lt;</span> <span class="free">y'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def mult_nonneg_nonneg mult_nonpos_nonpos not_le order.strict_trans2 
      zero_le_sgn_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> variation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variation_mult_pos<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"variation <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span>variation <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"variation <span class="free">x</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span>variation <span class="free">x</span> <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Real_Vector_Spaces.sgn_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"variation <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span>variation <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> variation_congr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> sgn <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Real_Vector_Spaces.sgn_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"variation <span class="free">x</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span>variation <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> variation_congr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variation_mult_neg_1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"variation <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span>variation <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> sign <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 
    variation_cases mult_neg_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span>  mult_neg_neg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> variation_mult_neg_2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"variation <span class="free">x</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> variation <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">-</span> sign <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> variation_comm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">*</span><span class="free">y</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> variation_mult_neg_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> variation_comm<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cross_no_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_root<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross <span class="free">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span>poly <span class="free">p</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> no_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span>poly <span class="free">p</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> no_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">*</span> poly <span class="free">p</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def linorder_neqE_linordered_idom mult_less_0_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_def variation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Tarski query›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">taq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom set <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">taq</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> sign <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sign at the right›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_r_pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real <span class="main">⇒</span> bool "</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sign_r_pos</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≡</span> <span class="main">(</span>eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">else</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> sign_r_pos <span class="free">p</span> <span class="free">x</span>›</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z</span><span class="main">≤</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">z'</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="bound">z'</span> <span class="main">&lt;</span> <span class="skolem">z</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_MVT<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">&gt;</span><span class="free">x</span>›</span></span><span class="main">]</span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_0_right<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">z'</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="bound">z'</span> <span class="main">&lt;</span> <span class="skolem">z</span> <span class="main">∧</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z'</span> <span class="main">≤</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">z</span><span class="main">≤</span><span class="main">0</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD le_iff_diff_le_0 mult_le_0_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> dual_order.strict_trans not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟹</span> sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_add_class.add.right_neutral monom_0 monom_eq_0 mult_zero_right 
          pderiv_iszero poly_0 poly_pCons<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">⟶</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">⟶</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">unfolded</span> not_eq_pos_or_neg_iff_1<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.strict_implies_order<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">⟶</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟹</span> False"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">⟶</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ub'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sign_r_pos <span class="free">p</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="skolem">z'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">(</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> z'<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">+</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">+</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="skolem">z'</span>"</span></span>       
        <span class="keyword1"><span class="command">using</span></span> poly_MVT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">+</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ub'<span class="main">[</span><span class="operator">THEN</span> HOL.spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">(</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="skolem">z'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="skolem">z'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> zero_less_mult_pos<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="skolem">z'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">(</span>min <span class="skolem">ub'</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">⟶</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ub</span><span class="main">+</span><span class="free">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">x</span>›</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">ub</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">ub</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def
    <span class="keyword1"><span class="command">using</span></span> order_tendstoD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> poly_tendsto<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> eventually_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="main">0</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> eventually_False<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">∨</span> sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right 
    <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">unfolded</span> not_eq_pos_or_neg_iff_1<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> le_less minus_zero neg_less_iff_less poly_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def 
    <span class="keyword1"><span class="command">using</span></span> eventually_neg<span class="main">[</span><span class="operator">OF</span> trivial_limit_at_right_real<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> poly_minus 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> eventually_mono less_asym neg_less_0_iff_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">¬</span> sign_r_pos <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_smult<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> mult_pos_pos zero_less_mult_pos<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">c</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> linorder_neqE_linordered_idom mult_neg_neg mult_zero_right 
      neg_0_less_iff_less poly_minus zero_less_mult_pos2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span>sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sign_r_pos_minus<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span> <span class="main">(</span>sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> sign_r_pos <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">unfolded</span> not_eq_pos_or_neg_iff_1<span class="main">]</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.strict_implies_order<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> ub'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> poly <span class="free">q</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">unfolded</span> not_eq_pos_or_neg_iff_1<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.strict_implies_order<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">q</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">using</span></span> eventually_conj_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def poly_mult 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> eventually_mono mult_pos_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span> 
      <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">q</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">using</span></span> eventually_conj_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def poly_mult 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> eventually_mono mult_pos_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_minus <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_mult_left no_zero_divisors<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span>
      <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">using</span></span> eventually_conj_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def poly_mult 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> eventually_mono mult_pos_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_minus <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_mult_right no_zero_divisors<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span> 
      <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">ub'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">q</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub'</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def <span class="keyword1"><span class="command">using</span></span> eventually_conj_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def poly_mult poly_minus
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_right <span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>mult_neg_neg<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_minus <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ub ub' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span>sign_r_pos <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">+</span><span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">+</span><span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> False poly_add <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> poly_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span>sign_r_pos <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> poly_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> poly_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_mult_mod_eq sign_r_pos_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> monoid_add_class.add.right_neutral mult_zero_right pCons_0_0 
      pderiv_iszero poly_0 poly_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span>sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟷</span> sign_r_pos <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">(</span>sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟷</span> sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> gt_ex<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span>real<span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pderiv.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pderiv_power_Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_cancel_left1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>                                                                                    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> old.nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> poly_power_n_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> sign_r_pos <span class="main">(</span>smult <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> calculation pderiv_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> sign_r_pos  <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Jump›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jump_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>real <span class="main">⇒</span> int"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">" <span class="free">jump_poly</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> odd<span class="main">(</span><span class="main">(</span>order <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>order <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="keyword1">then</span> 
                  <span class="keyword1">if</span> sign_r_pos <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span>
                <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> jump_poly_not_root<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span><span class="main">⟹</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> even_zero order_root zero_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> jump_poly0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"jump_poly <span class="main">0</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"jump_poly <span class="free">q</span> <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> jump_poly_smult_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">(</span>smult <span class="free">c</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span><span class="main">=</span> sign <span class="free">c</span> <span class="main">*</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def
     <span class="keyword1"><span class="command">using</span></span> order_smult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> sign_r_pos_smult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="free">p</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> jump_poly_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">p'</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">(</span><span class="free">p'</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">p'</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span>sign_r_pos <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> sign_r_pos_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> eventually_subst<span class="main"><span class="keyword3">,</span></span><span class="operator">unfold</span> eventually_at_right<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p'</span><span class="main">)</span> <span class="bound">z</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> poly <span class="free">p'</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span><span class="main">&gt;</span><span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span><span class="main">≡</span>Min <span class="main">{</span><span class="bound">r</span> <span class="main">.</span> poly <span class="free">p'</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">&gt;</span><span class="free">x</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="skolem">lr</span><span class="main">⟶</span>poly <span class="free">p'</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> True lr_def poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">lr</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p'</span><span class="main">)</span> <span class="bound">z</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_real_square_gt_zero poly_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lr</span><span class="main">&gt;</span><span class="free">x</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">⟶</span>poly <span class="free">p'</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> False poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">+</span><span class="main">1</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p'</span><span class="main">)</span> <span class="bound">z</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_real_square_gt_zero poly_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">&gt;</span><span class="free">x</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">z</span></span><span class="main">&gt;</span><span class="free">x</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="free">x</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span>poly <span class="main">(</span><span class="free">p'</span><span class="main">*</span><span class="free">p'</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="main">0</span><span class="main">&lt;</span>poly <span class="main">(</span><span class="free">p'</span><span class="main">*</span><span class="free">p'</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">*</span> poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute mult.left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span><span class="main">(</span><span class="main">0</span><span class="main">&lt;</span>poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span>poly <span class="main">(</span><span class="free">p'</span><span class="main">*</span><span class="free">p'</span><span class="main">)</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_pos_pos zero_less_mult_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" odd <span class="main">(</span>order <span class="free">x</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> odd <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  False <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> mult_eq_0_iff order_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> mult_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> jump_poly_1_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p1</span> <span class="free">p2</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p1</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> poly <span class="free">p2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">p1</span><span class="main">*</span><span class="free">p2</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span> sign <span class="main">(</span>poly <span class="free">p2</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="free">p1</span> <span class="free">x</span> 
            <span class="main">+</span> sign <span class="main">(</span>poly <span class="free">p1</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="free">p2</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p1</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">p2</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span><span class="main">*</span><span class="free">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p1</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">simpL</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">simpL</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">p2</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> odd <span class="main">(</span>order <span class="free">x</span> <span class="free">p2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">(</span>poly <span class="free">p1</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
    <span class="main">⟷</span>  sign_r_pos <span class="free">p2</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>int <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="skolem">simpL</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> simpL_def jump_poly_def  
      <span class="keyword1"><span class="command">using</span></span> order_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p1</span><span class="main">*</span><span class="free">p2</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
        sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p2</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p1</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p1</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p1</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">simpL</span> <span class="main">=</span><span class="var">?R</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> simpL_def jump_poly_def <span class="keyword1"><span class="command">using</span></span> jump_poly_not_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p1</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p1</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">simpL</span> <span class="main">=</span><span class="var">?R</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> simpL_def jump_poly_def <span class="keyword1"><span class="command">using</span></span> jump_poly_not_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p1</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p1</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_neqE_linordered_idom<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">simpL</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">simpL</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">p1</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> odd <span class="main">(</span>order <span class="free">x</span> <span class="free">p1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">(</span>poly <span class="free">p2</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
    <span class="main">⟷</span>  sign_r_pos <span class="free">p1</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>int <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="skolem">simpL</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> simpL_def jump_poly_def  
      <span class="keyword1"><span class="command">using</span></span> order_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p1</span><span class="main">*</span><span class="free">p2</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
        sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p2</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p2</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p2</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">simpL</span> <span class="main">=</span><span class="var">?R</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> simpL_def jump_poly_def <span class="keyword1"><span class="command">using</span></span> jump_poly_not_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p2</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">simpL</span> <span class="main">=</span><span class="var">?R</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> simpL_def jump_poly_def <span class="keyword1"><span class="command">using</span></span> jump_poly_not_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_neqE_linordered_idom<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> jump_poly_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">x</span><span class="main">=</span> jump_poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≡</span>min <span class="main">(</span>order <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> q'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">q'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_def  power_le_dvd<span class="main">[</span><span class="operator">OF</span> order_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvdE min.cobounded2 min.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_def  power_le_dvd<span class="main">[</span><span class="operator">OF</span> order_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvdE min.cobounded2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q' p' <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">q'</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> order <span class="free">x</span> <span class="skolem">p'</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>order <span class="free">x</span> <span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> order <span class="free">x</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">q'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">p'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">q</span><span class="main">&gt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span><span class="main">&gt;</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q' p' 
      <span class="keyword1"><span class="command">using</span></span> order_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> q'<span class="main"><span class="main">]</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> order_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> p'<span class="main"><span class="main">]</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
          order_power_n_n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> cond<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="main">(</span>order <span class="free">x</span> <span class="skolem">p'</span> <span class="main">-</span> order <span class="free">x</span> <span class="skolem">q'</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> odd<span class="main">(</span>order <span class="free">x</span> <span class="skolem">p'</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">p'</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> even_zero zero_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">q'</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹order <span class="free">x</span> <span class="skolem">q'</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> order <span class="free">x</span> <span class="skolem">p'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">q'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> order_root poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_root poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_mod_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> order_root poly_eq_0_iff_dvd<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span>›</span></span> dvd_0_right<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹order <span class="free">x</span> <span class="skolem">q'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>  
      <span class="main">⟹</span> sign_r_pos <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span> sign_r_pos <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q'</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹order <span class="free">x</span> <span class="skolem">q'</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> order <span class="free">x</span> <span class="skolem">p'</span><span class="main">=</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> order_root<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">q'</span> <span class="free">x</span><span class="main">=</span> sign_r_pos <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_mod<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> jump_poly <span class="skolem">q'</span> <span class="skolem">p'</span> <span class="free">x</span> <span class="main">=</span> jump_poly <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">p'</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def
      <span class="keyword1"><span class="command">using</span></span> cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> 
        <span class="main">⟹</span> <span class="main">¬</span> odd <span class="main">(</span>order <span class="free">x</span> <span class="skolem">p'</span> <span class="main">-</span> order <span class="free">x</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> odd<span class="main">(</span>order <span class="free">x</span> <span class="skolem">p'</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> even_zero order_root zero_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" jump_poly <span class="skolem">q'</span> <span class="skolem">p'</span> <span class="free">x</span> <span class="main">=</span> jump_poly <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">mod</span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">p'</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p' q' jump_poly_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> jump_poly_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">x</span><span class="main">=</span> jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coprime_poly_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">x</span> <span class="free">q</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> order_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
<span class="keyword1"><span class="command">qed</span></span>    
 
<span class="keyword1"><span class="command">lemma</span></span> jump_poly_sgn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_poly_0_left sign_r_pos_0 sign_r_pos_pderiv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> elim_p_order<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">=</span><span class="main">1</span> <span class="main">-</span> order <span class="free">x</span> <span class="free">q</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">-</span> order <span class="free">x</span> <span class="free">q</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> order_mult <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_diff_left mult_eq_0_iff<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> order_pderiv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> order_root<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> elim_p_sign_r_pos<span class="main">:</span><span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span>sign_r_pos <span class="free">q</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>sign_r_pos <span class="main">(</span>pderiv <span class="free">p</span><span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟷</span> sign_r_pos <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> no_zero_divisors sign_r_pos_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sign_r_pos_pderiv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">simpleL</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">simpleL</span><span class="main">≡</span><span class="keyword1">if</span> pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="main">(</span><span class="main">1</span> <span class="main">-</span> order <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">then</span> 
      <span class="keyword1">if</span> sign_r_pos <span class="free">q</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>int <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" jump_poly <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span><span class="skolem">simpleL</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> simpleL_def jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> elim_p_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> elim_p_sign_r_pos<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">simpleL</span><span class="main">=</span>sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span>order <span class="free">x</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_one not_gr0 order_root zero_less_diff<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">simpleL</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simpleL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span><span class="main">⟹</span> <span class="skolem">simpleL</span><span class="main">=</span>sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="main">1</span> <span class="main">-</span> order <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> no_zero_divisors<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">simpleL</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simpleL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cauchy index›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindex_poly</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> int"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">cindex_poly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">≡</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> jump_poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_cross<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="free">p</span> <span class="main">=</span> cross <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span><span class="main">≠</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">roots</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots</span><span class="main">≡</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span>  poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">roots</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def <span class="keyword1"><span class="command">using</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">≡</span>Max <span class="skolem">roots</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">max_r</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">]</span> <span class="quoted">"1.prems"</span>  <span class="keyword1"><span class="command">unfolding</span></span> roots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_rp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_rp</span><span class="main">≡</span><span class="main">[:</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span>order <span class="skolem">max_r</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">p'</span><span class="main">*</span><span class="skolem">max_rp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_dvd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p'</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> mult.commute order_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_r_sign</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r_sign</span><span class="main">≡</span><span class="keyword1">if</span> odd<span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">::</span>int"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">roots'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots'</span><span class="main">≡</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots</span><span class="main">=</span><span class="skolem">roots'</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">max_rp</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> roots_def roots'_def p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span>  poly <span class="skolem">max_rp</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">}</span><span class="main">=</span><span class="main">{</span><span class="skolem">max_r</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">max_r</span><span class="main">=</span><span class="main">0</span>›</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq0_conv order_root<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots'</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">max_rp</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> roots'_def  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p'</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Int_insert_right_if0 inf_bot_right mem_Collect_eq poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">roots'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  p' <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite_Un<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.union_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> refl<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">roots'</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">max_r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_dvd <span class="keyword1"><span class="command">unfolding</span></span> roots'_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq poly_eq_0_iff_dvd <span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_power_n_eq <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">max_rp</span><span class="main">=</span><span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_root<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jump_poly_not_root<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">roots</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">roots'</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def roots'_def p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">max_r</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">max_r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> max_r_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">max_r_sign</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def max_rp_def sign_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linorder_class.not_less zero_less_power_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="skolem">p'</span> <span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> jump_poly_1_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">max_rp</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">unfolding</span></span> p' 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">roots'</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots'_def <span class="keyword1"><span class="command">using</span></span> cross_no_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def degree_linear_power 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">max_r</span> <span class="main">=</span> <span class="main">0</span>›</span></span> order_root<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p' degree_mult_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span> <span class="main">=</span> cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> roots'_def 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span> <span class="main">=</span> sum <span class="main">(</span>jump_poly <span class="main">1</span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">roots'</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def roots'_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r_sign</span> <span class="main">*</span> cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span> <span class="main">=</span> cross <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> poly_power_n_odd<span class="main">[</span><span class="operator">OF</span> True<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">max_r</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&gt;</span><span class="free">a</span>›</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_power_n_odd<span class="main">[</span><span class="operator">OF</span> True<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">max_r</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span><span class="main">=</span>cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p' cross_def poly_mult
        <span class="keyword1"><span class="command">using</span></span> variation_mult_neg_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> mult.commute<span class="main">]</span>
          variation_mult_pos<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> mult.commute<span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="main">-</span> cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" sign_r_pos <span class="skolem">p'</span> <span class="skolem">max_r</span> <span class="main">=</span> <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span> <span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> not_dvd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_eq_0_iff_dvd<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>             
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">max_r</span> <span class="main">*</span> poly <span class="skolem">p'</span> <span class="free">b</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> not_dvd<span class="main">[</span><span class="operator">folded</span> poly_eq_0_iff_dvd<span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> linorder_neqE_linordered_idom mult_less_0_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="skolem">max_r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">r</span><span class="main">=</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> poly_IVT<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="skolem">roots</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def p' <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="skolem">max_r</span>›</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">max_rp</span> <span class="skolem">max_r</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sign_r_pos_power <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def  p' jump_poly_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"variation <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">a</span><span class="main">)</span> 
          <span class="main">=</span> <span class="main">-</span> variation <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">a</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>variation_cases <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def poly_power 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>  <span class="quoted">"1.prems"</span><span class="main">(</span>1-2<span class="main">)</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">max_r</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> zero_less_power_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def poly_power
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> False max_rp_def poly_power 
          zero_le_even_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"order <span class="skolem">max_r</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="skolem">max_r</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span><span class="main">=</span>cross <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p' mult.commute cross_def<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> variation_mult_pos
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def jump_poly_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>jump_poly <span class="main">1</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">roots</span> <span class="main">=</span> cross <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def cindex_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross <span class="free">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cross_no_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sum.empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">p'</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span><span class="main">≠</span> <span class="main">0</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">)</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_cong_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_poly_mult jump_poly_not_root assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> jump_poly_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_smult_1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>  <span class="main">(</span>sign <span class="free">c</span><span class="main">)</span> <span class="main">*</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def
<span class="keyword1"><span class="command">using</span></span> sum_distrib_left<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"sign <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="bound">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span><span class="main">]</span> jump_poly_smult_1
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">=</span>  cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def <span class="keyword1"><span class="command">using</span></span> jump_poly_mod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_inverse_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">+</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span><span class="main">=</span>cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">≡</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">≡</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">A</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def cindex_poly_def
      <span class="keyword1"><span class="command">using</span></span> jump_poly_coprime<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">q</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def cindex_poly_def
      <span class="keyword1"><span class="command">using</span></span> jump_poly_coprime <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="main">_</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_mult A_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span><span class="main">≠</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_1 poly_eq_0_iff_dvd gcd_greatest zero_neq_one<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> A_def B_def <span class="keyword1"><span class="command">using</span></span> poly_roots_finite <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">+</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span> 
      <span class="main">=</span> sum <span class="main">(</span>jump_poly <span class="main">1</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.union_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_inverse_add_cross<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">+</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> cross <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≡</span>gcd <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span> <span class="skolem">p'</span><span class="main">*</span><span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="skolem">q'</span><span class="main">*</span><span class="skolem">g</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> gcd_dvd1 gcd_dvd2 dvd_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> mult.commute<span class="main">]</span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p'</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd_coprime <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p' q' <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span>cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="skolem">q'</span> <span class="skolem">p'</span> <span class="main">+</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="skolem">p'</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p' q' mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> cindex_poly_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> cindex_poly_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  cindex_poly_inverse_add<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p'</span> <span class="skolem">q'</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cross <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_poly_cross<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span><span class="main">*</span><span class="skolem">p'</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p' q' 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> poly <span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="free">a</span> <span class="main">*</span> poly <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span> <span class="free">a</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">b</span> <span class="main">=</span> poly <span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="free">b</span> <span class="main">*</span> poly <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="skolem">q'</span><span class="main">)</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p' q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> not_real_square_gt_zero poly_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> not_real_square_gt_zero poly_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cross_def <span class="keyword1"><span class="command">using</span></span> variation_mult_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>  <span class="main">=</span> cross <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>  <span class="main">+</span>  cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> cindex_poly_inverse_add_cross<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_poly_mod cindex_poly_smult_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_congr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span><span class="main">&lt;</span><span class="free">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">≤</span><span class="free">a'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b'</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span><span class="main">=</span>cindex_poly <span class="free">a'</span> <span class="free">b'</span> <span class="free">q</span> <span class="free">p</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>    
  
<span class="keyword1"><span class="command">lemma</span></span> greaterThanLessThan_unfold<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_taq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="free">q</span><span class="main">=</span>cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≥</span><span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> taq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> S_def<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_Ioo<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> greaterThanLessThan_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> taq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> S_def<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def taq_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>jump_poly_sgn<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Signed remainder sequence›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">smods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> <span class="main">(</span>real poly<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">smods</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> Cons <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">smods</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">.</span><span class="keyword1">if</span> <span class="bound">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">q</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="numeral">2</span><span class="main">+</span>degree <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> degree_mod_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> smods_nil_eq<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> smods_singleton<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> smods <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="main">=</span><span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.discI list.inject smods.elims<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> smods_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"smods <span class="main">0</span> <span class="free">q</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> no_0_in_smods<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>set <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> list.inject neq_Nil_conv set_ConsD smods.elims<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">changes</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> list <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">changes</span> <span class="main">[</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">+</span><span class="free">changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> 
                          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free">changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> 
                          <span class="keyword1">else</span> <span class="free">changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> changes_map_sgn_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"changes <span class="free">xs</span> <span class="main">=</span> changes <span class="main">(</span>map sgn <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>changes.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">*</span><span class="skolem">x2</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟷</span> sgn <span class="skolem">x1</span> <span class="main">*</span> sgn <span class="skolem">x2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mult_less_0_iff sgn_less sgn_greater<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> sgn <span class="skolem">x2</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sgn_0_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_poly_at</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> poly list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_poly_at</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">=</span> changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_poly_pos_inf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> poly list <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_poly_pos_inf</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> changes <span class="main">(</span>map sgn_pos_inf <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_poly_neg_inf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> poly list <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_poly_neg_inf</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> changes <span class="main">(</span>map sgn_neg_inf <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> changes_poly_at_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">[]</span> <span class="free">a</span> <span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_itv_smods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_itv_smods</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_gt_smods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_gt_smods</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> changes_poly_pos_inf <span class="bound">ps</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_le_smods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_le_smods</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_neg_inf <span class="bound">ps</span> <span class="main">-</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_R_smods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_R_smods</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_neg_inf <span class="bound">ps</span> <span class="main">-</span> changes_poly_pos_inf <span class="bound">ps</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> changes_R_smods_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"changes_R_smods <span class="main">0</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"changes_R_smods <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> changes_R_smods_def changes_poly_neg_inf_def changes_poly_pos_inf_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> changes_itv_smods_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="main">0</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_def 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> changes_itv_smods_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span>  <span class="main">=</span> cross <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_def changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> HOL.disjE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_def changes_poly_at_def cross_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> neq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> variation_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span><span class="main">=</span><span class="free">p</span><span class="main">#</span><span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"smods <span class="free">q</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">changes_diff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">changes_diff</span><span class="main">≡</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> changes_poly_at <span class="main">(</span><span class="free">p</span><span class="main">#</span><span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="bound">x</span> 
    <span class="main">-</span> changes_poly_at <span class="main">(</span><span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">*</span>poly <span class="free">q</span> <span class="bound">x</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">changes_diff</span> <span class="bound">x</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> changes_diff_def changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">*</span>poly <span class="free">q</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="skolem">changes_diff</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> changes_diff_def changes_poly_at_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">changes_diff</span> <span class="free">a</span> <span class="main">-</span> <span class="skolem">changes_diff</span> <span class="free">b</span><span class="main">=</span>cross <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> cross_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>neqE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>neqE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>variation_cases<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_def changes_diff_def changes_poly_at_def 
    <span class="keyword1"><span class="command">using</span></span> ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> changes_smods_congr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">a'</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">≤</span><span class="free">a'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a'</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">a'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">≡</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a_a'_rel<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pp</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">pp</span> <span class="free">a</span> <span class="main">*</span> poly <span class="bound">pp</span> <span class="free">a'</span> <span class="main">≥</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">pp</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> poly <span class="bound">pp</span> <span class="free">a</span> <span class="main">*</span> poly <span class="bound">pp</span> <span class="free">a'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> pp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" poly <span class="skolem">pp</span> <span class="free">a</span> <span class="main">*</span> poly <span class="skolem">pp</span> <span class="free">a'</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def linorder_neqE_linordered_idom<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">a'</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> poly_IVT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a'</span></span> <span class="quoted"><span class="skolem">pp</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span><span class="main">&lt;</span><span class="free">a</span><span class="main">⟹</span>False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pp<span class="main">[</span><span class="operator">unfolded</span> mult.commute<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">of</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="skolem"><span class="skolem">pp</span></span> <span class="free"><span class="free">a</span></span>"</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> poly_IVT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a'</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">pp</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">a'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">q</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span>poly <span class="skolem">q</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>     
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">≡</span><span class="main">-</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">mod</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> poly <span class="skolem">r1</span> <span class="free">a</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="free">a</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span> add.inverse_inverse add.left_neutral div_mult_mod_eq 
            mult_zero_right poly_add poly_minus poly_mult r1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r1</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">*</span>poly <span class="skolem">r1</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> mult_less_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r1</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">=</span><span class="skolem">r1</span><span class="main">#</span><span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> r1_def r2_def smods.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">&lt;</span>length <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a'</span> <span class="main">∨</span> <span class="free">a'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span> <span class="free">a'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r1</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">+</span>changes_poly_at <span class="main">(</span>smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ps changes_poly_at_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">*</span>poly <span class="skolem">r1</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">a'</span> <span class="main">=</span> <span class="main">1</span><span class="main">+</span>changes_poly_at <span class="main">(</span>smods <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span> <span class="free">a'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="free">a'</span> <span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r1</span> <span class="free">a</span><span class="main">*</span>poly <span class="skolem">r1</span> <span class="free">a'</span><span class="main">≥</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a_a'_rel <span class="keyword1"><span class="command">unfolding</span></span> ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">a'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r1</span> <span class="free">a'</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> ps<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">a'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">*</span>poly <span class="skolem">r1</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ps changes_poly_at_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_mult_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">q</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span>poly <span class="skolem">q</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">q</span> <span class="skolem">r1</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> r1_def smods.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>smods <span class="skolem">q</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">q</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a'</span> <span class="main">∨</span> <span class="free">a'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="skolem">q</span> <span class="skolem">r1</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>smods <span class="skolem">q</span> <span class="skolem">r1</span><span class="main">)</span> <span class="free">a'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">a'</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> ps<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">a'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="free">a'</span> <span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">a</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="free">a'</span><span class="main">≥</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a_a'_rel <span class="keyword1"><span class="command">unfolding</span></span> ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ps changes_poly_at_def <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_mult_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> changes_itv_smods_congr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span><span class="main">&lt;</span><span class="free">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_root<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">≤</span><span class="free">a'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b'</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span><span class="main">=</span>changes_itv_smods <span class="free">a'</span> <span class="free">b'</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">a'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> changes_smods_congr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order.strict_implies_not_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">a'</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_eq_real_def less_irrefl less_trans no_root<span class="main">)</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">b</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">b'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> changes_smods_congr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order.strict_implies_not_eq<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">b'</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="main"><span class="main">,</span></span></span> 
        <span class="operator">symmetric</span><span class="main"><span class="main"><span class="main">]</span></span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_eq_real_def less_trans no_root<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_poly_changes_itv_mods<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> smods_nil_eq<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x1</span> <span class="skolem">xs</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&lt;</span><span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> no_root<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">a'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">b'</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">thesis</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">≡</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">≡</span><span class="main">1</span><span class="main">/</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">&lt;</span> <span class="skolem">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def b'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a'</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">=</span> smods <span class="skolem">p</span> <span class="skolem">q</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x1</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≡</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">=</span> smods <span class="skolem">p</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smods.simps <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smods.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">a1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">&lt;</span> <span class="skolem">b1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
          a1_b1_no_root<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a1</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹smods <span class="skolem">q</span> <span class="skolem">r</span><span class="main">=</span><span class="skolem">xs</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹smods <span class="skolem">q</span> <span class="skolem">r</span><span class="main">=</span><span class="skolem">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="skolem">a2</span> <span class="main">⟶</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b2</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">⟶</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> last_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">≡</span> <span class="keyword1">if</span> <span class="skolem">b2</span><span class="main">&gt;</span><span class="skolem">a</span> <span class="keyword1">then</span> Min<span class="main">{</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">,</span> <span class="skolem">a2</span><span class="main">}</span> <span class="keyword1">else</span> min <span class="skolem">a1</span> <span class="skolem">a2</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">≡</span><span class="keyword1">if</span> <span class="skolem">a2</span> <span class="main">&lt;</span><span class="skolem">b</span> <span class="keyword1">then</span> Max<span class="main">{</span> <span class="skolem">b1</span><span class="main">,</span> <span class="skolem">a2</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">}</span> <span class="keyword1">else</span> max <span class="skolem">b1</span> <span class="skolem">b2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">&lt;</span> <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def b'_def 
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">a1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main">&lt;</span> <span class="skolem">b1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">a2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b2</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a'</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1_b1_no_root <span class="keyword1"><span class="command">unfolding</span></span> a'_def b'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">a'</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 b2 <span class="keyword1"><span class="command">unfolding</span></span> a'_def b'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≡</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">q</span> <span class="skolem">r</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">=</span> smods <span class="skolem">p</span> <span class="skolem">q</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.inject smods.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">a'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">a'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> no_root<span class="main">[</span><span class="operator">unfolded</span> ps<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> 
          <span class="quoted"><span class="quoted">"changes_itv_smods <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> cross <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="main">+</span> changes_itv_smods <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">q</span> <span class="skolem">r</span>"</span></span>
          <span class="quoted"><span class="quoted">"cindex_poly <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">q</span> <span class="skolem">p</span> <span class="main">=</span> cross <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="main">+</span> cindex_poly <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">r</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> changes_itv_smods_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">,</span><span class="operator">folded</span> r_def<span class="main">]</span> 
          cindex_poly_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">,</span><span class="operator">folded</span> r_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_itv_smods <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">=</span> cindex_poly <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">r</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  Cons.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">a'</span></span> <span class="quoted"><span class="skolem">b'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">&lt;</span> <span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">ps</span>›</span></span> ps<span class="main">(</span>2<span class="main">)</span>
          <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">a'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_itv_smods <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> cindex_poly <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">q</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> 
          changes_itv_smods_congr<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> Cons<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
          no_root cindex_poly_congr<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="main">]</span> ps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_list_ub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ps</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real poly<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ub</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ub</span><span class="main">&gt;</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">ub1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ub1_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub1</span><span class="main">&gt;</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">ub2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> ub2_sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub2</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_ub<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">≡</span>max <span class="skolem">ub1</span> <span class="skolem">ub2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub1 ub2 ub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ub1_sgn ub2_sgn ub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub1</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> ub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_list_lb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ps</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real poly<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">lb</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="free">lb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="free">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lb</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb1</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">lb1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      lb1_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb1</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb2</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">lb2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> lb2_sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb2</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_lb<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">≡</span>min <span class="skolem">lb1</span> <span class="skolem">lb2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">lb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lb1 lb2 lb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> lb1_sgn lb2_sgn lb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb1</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> lb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_tarski_interval<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cindex_poly_taq cindex_poly_changes_itv_mods<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_tarski_above<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> changes_gt_smods <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ub_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_ub<span class="main">[</span><span class="operator">OF</span> no_0_in_smods<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">}</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> taq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">insert</span> ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_gt_smods <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods <span class="free">a</span> <span class="skolem">ub</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ub_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">ub</span><span class="main">=</span>changes_poly_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_pos_inf_def changes_poly_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_gt_smods_def changes_itv_smods_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_tarski_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_tarski_below<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> changes_le_smods <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lb_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_lb<span class="main">[</span><span class="operator">OF</span> no_0_in_smods<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">lb</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> taq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">insert</span> lb <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_le_smods <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods <span class="skolem">lb</span> <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">lb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lb_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">lb</span><span class="main">=</span>changes_poly_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def changes_poly_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_le_smods_def changes_itv_smods_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lb <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_tarski_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> _ assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_tarski_R<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> changes_R_smods <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> taq_def <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_char_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>sum.infinite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ps_def <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lb_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_lb<span class="main">[</span><span class="operator">OF</span> no_0_in_smods<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ub_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_ub<span class="main">[</span><span class="operator">OF</span> no_0_in_smods<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> <span class="free">q</span> <span class="main">=</span> taq <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">lb</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">}</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> taq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">insert</span> lb ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_R_smods <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">lb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_neg_inf <span class="skolem">ps</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lb_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> ub_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">lb</span><span class="main">=</span>changes_poly_neg_inf <span class="skolem">ps</span>
          <span class="main">∧</span> changes_poly_at <span class="skolem">ps</span> <span class="skolem">ub</span><span class="main">=</span>changes_poly_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def changes_poly_at_def changes_poly_pos_inf_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span>  changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_R_smods_def changes_itv_smods_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lb ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_tarski_interval <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sturm_tarski_interval<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">unfolded</span> taq_def<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> changes_gt_smods <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sturm_tarski_above<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">unfolded</span> taq_def<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_below<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> changes_le_smods <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sturm_tarski_below<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">unfolded</span> taq_def<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_R<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span>  changes_R_smods <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>    
<span class="keyword1"><span class="command">using</span></span> sturm_tarski_R<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">unfolded</span> taq_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>