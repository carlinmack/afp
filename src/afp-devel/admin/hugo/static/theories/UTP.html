<div id="utp_parser_utils">
<div class="head">
<h1>Theory utp_parser_utils</h1>
</div>
<pre class="source"><span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* Project: The Isabelle/UTP Proof System                                     *)</span>
<span class="comment1">(* File: utp_parser_utils.thy                                                 *)</span>
<span class="comment1">(* Authors: Frank Zeyda and Simon Foster (University of York, UK)             *)</span>
<span class="comment1">(* Emails: frank.zeyda@york.ac.uk and simon.foster@york.ac.uk                 *)</span>
<span class="comment1">(******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Parser Utilities›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_parser_utils
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_id_string"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> string"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">IDSTR'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">UTP_PARSER_UTILS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> mk_nib <span class="main">:</span> int <span class="main">-&gt;</span> Ast.ast
  <span class="keyword1"><span class="keyword">val</span></span> mk_char <span class="main">:</span> string <span class="main">-&gt;</span> Ast.ast
  <span class="keyword1"><span class="keyword">val</span></span> mk_string <span class="main">:</span> string list <span class="main">-&gt;</span> Ast.ast
  <span class="keyword1"><span class="keyword">val</span></span> string_ast_tr <span class="main">:</span> Ast.ast list <span class="main">-&gt;</span> Ast.ast
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Utp_Parser_Utils</span> <span class="main">:</span> <span class="entity">UTP_PARSER_UTILS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mk_nib</span> <span class="main">=</span>
  Ast.Constant o Lexicon.mark_const o
    fst o Term.dest_Const o <span class="entity">HOLogic.mk_char</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_char</span> <span class="entity">s</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">if</span></span> Symbol.is_ascii <span class="entity">s</span> <span class="keyword2"><span class="keyword">then</span></span>
    Ast.Appl <span class="main">[</span>Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> Char<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">mk_nib</span> <span class="main">(</span>ord <span class="entity">s</span> div <span class="inner_numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="entity">mk_nib</span> <span class="main">(</span>ord <span class="entity">s</span> mod <span class="inner_numeral">16</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">else</span></span> error <span class="main">(</span><span class="inner_quoted">"Non-ASCII symbol: "</span> ^ quote <span class="entity">s</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_string</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> Nil<span class="antiquote">}</span></span>
  <span class="main">|</span> <span class="entity">mk_string</span> <span class="main">(</span><span class="entity">c</span> :: <span class="entity">cs</span><span class="main">)</span> <span class="main">=</span>
      Ast.Appl <span class="main">[</span>Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> List.Cons<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">mk_char</span> <span class="entity">c</span><span class="main">,</span> <span class="entity">mk_string</span> <span class="entity">cs</span><span class="main">]</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">string_ast_tr</span> <span class="main">[</span>Ast.Variable <span class="entity">str</span><span class="main">]</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> Lexicon.explode_str <span class="main">(</span><span class="entity">str</span><span class="main">,</span> Position.none<span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
        <span class="main">[</span><span class="main">]</span> <span class="main">=&gt;</span>
          Ast.Appl
            <span class="main">[</span>Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_constrain"<span class="antiquote">}</span></span><span class="main">,</span>
              Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> Nil<span class="antiquote">}</span></span><span class="main">,</span> Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> string<span class="antiquote">}</span></span><span class="main">]</span>
      <span class="main">|</span> <span class="entity">ss</span> <span class="main">=&gt;</span> <span class="entity">mk_string</span> <span class="main">(</span>map Symbol_Pos.symbol <span class="entity">ss</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">string_ast_tr</span> <span class="main">[</span>Ast.Appl <span class="main">[</span>Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_constrain"<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">ast1</span><span class="main">,</span> <span class="entity">ast2</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span>
      Ast.Appl <span class="main">[</span>Ast.Constant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_constrain"<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">string_ast_tr</span> <span class="main">[</span><span class="entity">ast1</span><span class="main">]</span><span class="main">,</span> <span class="entity">ast2</span><span class="main">]</span>
  <span class="main">|</span> <span class="entity">string_ast_tr</span> <span class="entity">asts</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> Ast.AST <span class="main">(</span><span class="inner_quoted">"string_tr"</span><span class="main">,</span> <span class="entity">asts</span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">NAME_UTILS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> deep_unmark_const <span class="main">:</span> term <span class="main">-&gt;</span> term
  <span class="keyword1"><span class="keyword">val</span></span> right_crop_by <span class="main">:</span> int <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string
  <span class="keyword1"><span class="keyword">val</span></span> last_char_str <span class="main">:</span> string <span class="main">-&gt;</span> string
  <span class="keyword1"><span class="keyword">val</span></span> repeat_char <span class="main">:</span> char <span class="main">-&gt;</span> int <span class="main">-&gt;</span> string
  <span class="keyword1"><span class="keyword">val</span></span> mk_id <span class="main">:</span> string <span class="main">-&gt;</span> term
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Name_Utils</span> <span class="main">:</span> <span class="entity">NAME_UTILS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">unmark_const_term</span> <span class="main">(</span>Const <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="entity">typ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    Const <span class="main">(</span>Lexicon.unmark_const <span class="entity">name</span><span class="main">,</span> <span class="entity">typ</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">unmark_const_term</span> <span class="entity">term</span> <span class="main">=</span> <span class="entity">term</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">deep_unmark_const</span> <span class="main">=</span>
    <span class="main">(</span>map_aterms <span class="entity">unmark_const_term</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">right_crop_by</span> <span class="entity">n</span> <span class="entity">s</span> <span class="main">=</span>
    String.substring <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="main">(</span>String.size <span class="entity">s</span><span class="main">)</span> - <span class="entity">n</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">last_char_str</span> <span class="entity">s</span> <span class="main">=</span>
    String.str <span class="main">(</span>String.sub <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="main">(</span>String.size <span class="entity">s</span><span class="main">)</span> - <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">repeat_char</span> <span class="entity">c</span> <span class="entity">n</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">n</span> &gt; <span class="inner_numeral">0</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span>String.str <span class="entity">c</span><span class="main">)</span> ^ <span class="main">(</span><span class="entity">repeat_char</span> <span class="entity">c</span> <span class="main">(</span><span class="entity">n</span> - <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">""</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_id</span> <span class="entity">name</span> <span class="main">=</span> Free <span class="main">(</span><span class="entity">name</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">parse_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">id_string_tr</span> <span class="main">[</span>Free <span class="main">(</span><span class="entity">full_name</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="entity">HOLogic.mk_string</span> <span class="entity">full_name</span>
    <span class="main">|</span> <span class="entity">id_string_tr</span> <span class="main">[</span>Const <span class="main">(</span><span class="entity">full_name</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="entity">HOLogic.mk_string</span> <span class="entity">full_name</span>
    <span class="main">|</span> <span class="entity">id_string_tr</span> <span class="main">_</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> Match<span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_id_string"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="entity">id_string_tr</span><span class="main">)</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>
›</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_var">
<div class="head">
<h1>Theory utp_var</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ UTP Variables ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_var
  <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../UTP-Toolkit/utp_toolkit.html">UTP-Toolkit.utp_toolkit</a>"</span>
  <a href="utp_parser_utils.html">utp_parser_utils</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In this first UTP theory we set up variables, which are are built on lenses~\cite{Foster09,Foster16a}. 
  A large part of this theory is setting up the parser for UTP variable syntax. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Initial syntax setup ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We will overload the square order relation with refinement and also the lattice operators so
  we will turn off these notations. ›</span></span>

<span class="keyword1"><span class="command">purge_notation</span></span>
  Order.le <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊑</span>ı"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Lattice.sup <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span>ı_"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Lattice.inf <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span>ı_"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Lattice.join <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>ı"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Lattice.meet <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>ı"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Set.member <span class="main">(</span><span class="quoted">"<span class="keyword1">op</span> <span class="keyword1">:</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Set.member <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">:</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  disj  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">|</span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  conj  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">&amp;</span>"</span> 35<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> fst_vwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> snd_vwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> comp_vwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> lens_indep_left_ext <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> lens_indep_right_ext <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> lens_comp_quotient <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> plus_lens_distr <span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Variable foundations ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This theory describes the foundational structure of UTP variables, upon which the rest      
  of our model rests. We start by defining alphabets, which following~\cite{Feliachi2010,Feliachi2012}
  in this shallow model are simply represented as types <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, though by convention usually a record
  type where each field corresponds to a variable. UTP variables in this frame are simply modelled 
  as lenses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">⟹</span></span> <span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where the view type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the variable type, and the 
  source type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'α›</span></span></span></span> is the alphabet or state-space type.

  We define some lifting functions for variables to create input and output variables.
  These simply lift the alphabet to a tuple type since relations will ultimately be defined
  by a tuple alphabet. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">in_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">lens_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">in_var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">out_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">lens_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">out_var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Variables can also be used to effectively define sets of variables. Here we define the
  the universal alphabet ($\Sigma$) to be the bijective lens <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This characterises
  the whole of the source type, and thus is effectively the set of all alphabet variables. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">univ_alpha</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Σ</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">univ_alpha</span> <span class="main">≡</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next construct is vacuous and simply exists to help the parser distinguish predicate
  variables from input and output variables. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pr_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">lens_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pr_var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Variable lens properties ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can now easily show that our UTP variable construction are various classes of 
  well-behaved lens .›</span></span>

<span class="keyword1" id="utp_var-in_var_weak_lens"><span class="command">lemma</span></span> in_var_weak_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span> <span class="main">⟹</span> weak_lens <span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_weak_lens in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-in_var_semi_uvar"><span class="command">lemma</span></span> in_var_semi_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> mwb_lens <span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_mwb_lens in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-pr_var_weak_lens"><span class="command">lemma</span></span> pr_var_weak_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span> <span class="main">⟹</span> weak_lens <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-pr_var_mwb_lens"><span class="command">lemma</span></span> pr_var_mwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> mwb_lens <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_var-pr_var_vwb_lens"><span class="command">lemma</span></span> pr_var_vwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> vwb_lens <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_var-in_var_uvar"><span class="command">lemma</span></span> in_var_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> vwb_lens <span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_var_weak_lens"><span class="command">lemma</span></span> out_var_weak_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span> <span class="main">⟹</span> weak_lens <span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_weak_lens out_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_var_semi_uvar"><span class="command">lemma</span></span> out_var_semi_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> mwb_lens <span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_mwb_lens out_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_var_uvar"><span class="command">lemma</span></span> out_var_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> vwb_lens <span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Moreover, we can show that input and output variables are independent, since they refer
  to different sections of the alphabet. ›</span></span>
    
<span class="keyword1" id="utp_var-in_out_indep"><span class="command">lemma</span></span> in_out_indep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_var <span class="free">x</span> <span class="main">⨝</span> out_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_def in_var_def out_var_def fst_lens_def snd_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_in_indep"><span class="command">lemma</span></span> out_in_indep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"out_var <span class="free">x</span> <span class="main">⨝</span> in_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_def in_var_def out_var_def fst_lens_def snd_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_var-in_var_indep"><span class="command">lemma</span></span> in_var_indep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> in_var <span class="free">x</span> <span class="main">⨝</span> in_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def out_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_var_indep"><span class="command">lemma</span></span> out_var_indep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> out_var <span class="free">x</span> <span class="main">⨝</span> out_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-pr_var_indeps"><span class="command">lemma</span></span> pr_var_indeps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> pr_var <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⨝</span> pr_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_var-prod_lens_indep_in_var"><span class="command">lemma</span></span> prod_lens_indep_in_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span> <span class="main">⨝</span> in_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_var_def in_var_indep out_in_indep out_var_def plus_pres_lens_indep prod_as_plus<span class="main">)</span>

<span class="keyword1" id="utp_var-prod_lens_indep_out_var"><span class="command">lemma</span></span> prod_lens_indep_out_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⨝</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span> <span class="main">⨝</span> out_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_out_indep in_var_def out_var_def out_var_indep plus_pres_lens_indep prod_as_plus<span class="main">)</span>

<span class="keyword1" id="utp_var-in_var_pr_var"><span class="command">lemma</span></span> in_var_pr_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_var <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span> <span class="main">=</span> in_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_var_pr_var"><span class="command">lemma</span></span> out_var_pr_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"out_var <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span> <span class="main">=</span> out_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-pr_var_idem"><span class="command">lemma</span></span> pr_var_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"pr_var <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span> <span class="main">=</span> pr_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_var-pr_var_lens_plus"><span class="command">lemma</span></span> pr_var_lens_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"pr_var <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_var-pr_var_lens_comp_1"><span class="command">lemma</span></span> pr_var_lens_comp_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"pr_var <span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">=</span> pr_var <span class="main">(</span><span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_var-in_var_plus"><span class="command">lemma</span></span> in_var_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"in_var <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> in_var <span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> in_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_var-out_var_plus"><span class="command">lemma</span></span> out_var_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"out_var <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> out_var <span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> out_var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Similar properties follow for sublens ›</span></span>
  
<span class="keyword1" id="utp_var-in_var_sublens"><span class="command">lemma</span></span> in_var_sublens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span> <span class="main">⟹</span> in_var <span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> in_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> in_var_def lens_comp_assoc sublens_def<span class="main">)</span>
     
<span class="keyword1" id="utp_var-out_var_sublens"><span class="command">lemma</span></span> out_var_sublens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span> <span class="main">⟹</span> out_var <span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> out_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> out_var_def lens_comp_assoc sublens_def<span class="main">)</span>

<span class="keyword1" id="utp_var-pr_var_sublens"><span class="command">lemma</span></span> pr_var_sublens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span> <span class="main">⟹</span> pr_var <span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> pr_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lens simplifications ›</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also define some lookup abstraction simplifications. ›</span></span>

<span class="keyword1" id="utp_var-var_lookup_in"><span class="command">lemma</span></span> var_lookup_in <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lens_get <span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span> <span class="main">=</span> lens_get <span class="free">x</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def fst_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_var-var_lookup_out"><span class="command">lemma</span></span> var_lookup_out <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lens_get <span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span> <span class="main">=</span> lens_get <span class="free">x</span> <span class="free">A'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def snd_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_var-var_update_in"><span class="command">lemma</span></span> var_update_in <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lens_put <span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>lens_put <span class="free">x</span> <span class="free">A</span> <span class="free">v</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def fst_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_var-var_update_out"><span class="command">lemma</span></span> var_update_out <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lens_put <span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">A'</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> lens_put <span class="free">x</span> <span class="free">A'</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def snd_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_var-get_lens_plus"><span class="command">lemma</span></span> get_lens_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span></sub><span class="hidden">⇙</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="free">s</span><span class="main">,</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Syntax translations ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In order to support nice syntax for variables, we here set up some translations. The first
  step is to introduce a collection of non-terminals. ›</span></span>
  
<span class="keyword1"><span class="command">nonterminal</span></span> svid <span class="keyword2"><span class="keyword">and</span></span> svids <span class="keyword2"><span class="keyword">and</span></span> svar <span class="keyword2"><span class="keyword">and</span></span> svars <span class="keyword2"><span class="keyword">and</span></span> salpha

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ These non-terminals correspond to the following syntactic entities. Non-terminal 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"svid"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an atomic variable identifier, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"svids"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a list of identifier. 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"svar"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a decorated variable, such as an input or output variable, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"svars"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is 
  a list of decorated variables. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"salpha"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an alphabet or set of variables. Such sets can 
  be constructed only through lens composition due to typing restrictions. Next we introduce some 
  syntax constructors. ›</span></span>
   
<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Identifiers ›</span>
  <span class="quoted">"_svid"</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> svid"</span></span> <span class="main">(</span><span class="quoted">"_"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_svid_unit"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svids"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_svid_list"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svids <span class="main">⇒</span> svids"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_svid_alpha"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"svid"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>v</b></span>"</span><span class="main">)</span>
  <span class="quoted">"_svid_dot"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svid <span class="main">⇒</span> svid"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">:</span>_"</span> <span class="main">[</span>998<span class="main">,</span>999<span class="main">]</span> 998<span class="main">)</span>
  <span class="quoted">"_mk_svid_list"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"svids <span class="main">⇒</span> logic"</span></span> <span class="comment1">― ‹ Helper function for summing a list of identifiers ›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A variable identifier can either be a HOL identifier, the complete set of variables in the
  alphabet $\textbf{v}$, or a composite identifier separated by colons, which
  corresponds to a sort of qualification. The final option is effectively a lens composition. ›</span></span>
  
<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Decorations ›</span>
  <span class="quoted">"_spvar"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svar"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">&amp;</span>_"</span> <span class="main">[</span>990<span class="main">]</span> 990<span class="main">)</span>
  <span class="quoted">"_sinvar"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svar"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">$</span>_"</span> <span class="main">[</span>990<span class="main">]</span> 990<span class="main">)</span>
  <span class="quoted">"_soutvar"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svar"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">$</span>_<span class="keyword1">´</span>"</span> <span class="main">[</span>990<span class="main">]</span> 990<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A variable can be decorated with an ampersand, to indicate it is a predicate variable, with 
  a dollar to indicate its an unprimed relational variable, or a dollar and ``acute'' symbol to 
  indicate its a primed relational variable. Isabelle's parser is extensible so additional
  decorations can be and are added later. ›</span></span>
  
<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Variable sets ›</span>
  <span class="quoted">"_salphaid"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> salpha"</span></span> <span class="main">(</span><span class="quoted">"_"</span> <span class="main">[</span>990<span class="main">]</span> 990<span class="main">)</span>
  <span class="quoted">"_salphavar"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"svar <span class="main">⇒</span> salpha"</span></span> <span class="main">(</span><span class="quoted">"_"</span> <span class="main">[</span>990<span class="main">]</span> 990<span class="main">)</span>
  <span class="quoted">"_salphaparen"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> salpha"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_salphacomp"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> salpha <span class="main">⇒</span> salpha"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 75<span class="main">)</span>
  <span class="quoted">"_salphaprod"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> salpha <span class="main">⇒</span> salpha"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">×</span>"</span> 85<span class="main">)</span>
  <span class="quoted">"_salpha_all"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Σ</span>"</span><span class="main">)</span>
  <span class="quoted">"_salpha_none"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∅</span>"</span><span class="main">)</span>
  <span class="quoted">"_svar_nil"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"svar <span class="main">⇒</span> svars"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_svar_cons"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"svar <span class="main">⇒</span> svars <span class="main">⇒</span> svars"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_salphaset"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"svars <span class="main">⇒</span> salpha"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{</span>_<span class="keyword1">}</span>"</span><span class="main">)</span>
  <span class="quoted">"_salphamk"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> salpha"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The terminals of an alphabet are either HOL identifiers or UTP variable identifiers. 
  We support two ways of constructing alphabets; by composition of smaller alphabets using
  a semi-colon or by a set-style construction $\{a,b,c\}$ with a list of UTP variables. ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Quotations ›</span>
  <span class="quoted">"_ualpha_set"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"svars <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{</span>_<span class="keyword1">}<span class="hidden">⇩</span><sub>α</sub></span>"</span><span class="main">)</span>  
  <span class="quoted">"_svar"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"svar <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>v</sub></span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ For various reasons, the syntax constructors above all yield specific grammar categories and
  will not parser at the HOL top level (basically this is to do with us wanting to reuse the syntax
  for expressions). As a result we provide some quotation constructors above. 

  Next we need to construct the syntax translations rules. First we need a few polymorphic constants. ›</span></span>
 
<span class="keyword1"><span class="command">consts</span></span>
  svar <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'e</span>"</span></span>
  ivar <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'e</span>"</span></span>
  ovar <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'e</span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  svar <span class="quoted">pr_var</span> <span class="keyword2"><span class="keyword">and</span></span> ivar <span class="quoted">in_var</span> <span class="keyword2"><span class="keyword">and</span></span> ovar <span class="quoted">out_var</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The functions above turn a representation of a variable (type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), including
  its name and type, into some lens type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'e</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"svar"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> constructs a predicate variable,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ivar"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and input variables, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ovar"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and output variable. The functions bridge 
  between the model and encoding of the variable and its interpretation as a lens in order to integrate it 
  into the general lens-based framework. Overriding these functions is then all we need to make 
  use of any kind of variables in terms of interfacing it with the system. Although in core UTP
  variables are always modelled using record field, we can overload these constants to allow other
  kinds of variables, such as deep variables with explicit syntax and type information.

  Finally, we set up the translations rules. ›</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="comment1">― ‹ Identifiers ›</span>
  <span class="quoted">"_svid <span class="free">x</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span>"</span>
  <span class="quoted">"_svid_alpha"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">Σ</span>"</span>
  <span class="quoted">"_svid_dot <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">y</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span>
  <span class="quoted">"_mk_svid_list <span class="main">(</span>_svid_unit <span class="free">x</span><span class="main">)</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span>"</span>
  <span class="quoted">"_mk_svid_list <span class="main">(</span>_svid_list <span class="free">x</span> <span class="free">xs</span><span class="main">)</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> _mk_svid_list <span class="free">xs</span>"</span>

  <span class="comment1">― ‹ Decorations ›</span>
  <span class="quoted">"_spvar <span class="keyword1">Σ</span>"</span>  <span class="main">↽</span>  <span class="quoted">"<span class="keyword1">CONST</span> svar <span class="keyword1">CONST</span> id_lens"</span>
  <span class="quoted">"_sinvar <span class="keyword1">Σ</span>"</span>  <span class="main">↽</span> <span class="quoted">"<span class="keyword1">CONST</span> ivar <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span>
  <span class="quoted">"_soutvar <span class="keyword1">Σ</span>"</span> <span class="main">↽</span> <span class="quoted">"<span class="keyword1">CONST</span> ovar <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span>
  <span class="quoted">"_spvar <span class="main">(</span>_svid_dot <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span> <span class="main">↽</span> <span class="quoted">"<span class="keyword1">CONST</span> svar <span class="main">(</span><span class="keyword1">CONST</span> lens_comp <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_sinvar <span class="main">(</span>_svid_dot <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span> <span class="main">↽</span> <span class="quoted">"<span class="keyword1">CONST</span> ivar <span class="main">(</span><span class="keyword1">CONST</span> lens_comp <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_soutvar <span class="main">(</span>_svid_dot <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span> <span class="main">↽</span> <span class="quoted">"<span class="keyword1">CONST</span> ovar <span class="main">(</span><span class="keyword1">CONST</span> lens_comp <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_svid_dot <span class="main">(</span>_svid_dot <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span> <span class="main">↽</span> <span class="quoted">"_svid_dot <span class="main">(</span><span class="keyword1">CONST</span> lens_comp <span class="free">y</span> <span class="free">x</span><span class="main">)</span> <span class="free">z</span>"</span>

  <span class="quoted">"_spvar <span class="free">x</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> svar <span class="free">x</span>"</span>
  <span class="quoted">"_sinvar <span class="free">x</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> ivar <span class="free">x</span>"</span>
  <span class="quoted">"_soutvar <span class="free">x</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> ovar <span class="free">x</span>"</span>

  <span class="comment1">― ‹ Alphabets ›</span>
  <span class="quoted">"_salphaparen <span class="free">a</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">a</span>"</span>
  <span class="quoted">"_salphaid <span class="free">x</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span>"</span>
  <span class="quoted">"_salphacomp <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span>
  <span class="quoted">"_salphaprod <span class="free">a</span> <span class="free">b</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="free">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span>"</span>
  <span class="quoted">"_salphavar <span class="free">x</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span>"</span>
  <span class="quoted">"_svar_nil <span class="free">x</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span>"</span>
  <span class="quoted">"_svar_cons <span class="free">x</span> <span class="free">xs</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">xs</span>"</span>
  <span class="quoted">"_salphaset <span class="free">A</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">A</span>"</span>  
  <span class="quoted">"<span class="main">(</span>_svar_cons <span class="free">x</span> <span class="main">(</span>_salphamk <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span> <span class="main">↽</span> <span class="quoted">"_salphamk <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span>"</span> 
  <span class="quoted">"<span class="free">x</span>"</span> <span class="main">↽</span> <span class="quoted">"_salphamk <span class="free">x</span>"</span>
  <span class="quoted">"_salpha_all"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span>
  <span class="quoted">"_salpha_none"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>L</sub></span>"</span>

  <span class="comment1">― ‹ Quotations ›</span>
  <span class="quoted">"_ualpha_set <span class="free">A</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">A</span>"</span>
  <span class="quoted">"_svar <span class="free">x</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">x</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The translation rules mainly convert syntax into lens constructions, using a mixture
  of lens operators and the bespoke variable definitions. Notably, a colon variable identifier
  qualification becomes a lens composition, and variable sets are constructed using len sum. 
  The translation rules are carefully crafted to ensure both parsing and pretty printing. 

  Finally we create the following useful utility translation function that allows us to construct a 
  UTP variable (lens) type given a return and alphabet type. ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uvar_ty"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> type <span class="main">⇒</span> type"</span></span>

<span class="keyword1"><span class="command">parse_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">uvar_ty_tr</span> <span class="main">[</span><span class="entity">ty</span><span class="main">]</span> <span class="main">=</span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> lens<span class="antiquote">}</span></span> $ <span class="entity">ty</span> $ Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> dummy<span class="antiquote">}</span></span>
    <span class="main">|</span> <span class="entity">uvar_ty_tr</span> <span class="entity">ts</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"uvar_ty_tr"</span><span class="main">,</span> <span class="entity">ts</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_uvar_ty"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="entity">uvar_ty_tr</span><span class="main">)</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_expr">
<div class="head">
<h1>Theory utp_expr</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ UTP Expressions ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_expr
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="utp_var.html">utp_var</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Expression type ›</span></span>
  
<span class="keyword1"><span class="command">purge_notation</span></span> BNF_Def.convol <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span><span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword1">⟩</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Before building the predicate model, we will build a model of expressions that generalise
  alphabetised predicates. Expressions are represented semantically as mapping from
  the alphabet <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to the expression's type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This general model will allow us to unify
  all constructions under one type. The majority definitions in the file are given using
  the \emph{lifting} package~\cite{Huffman13}, which allows us to reuse much of the existing
  library of HOL functions. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'t</span><span class="main">)</span> set"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_uexpr
    
<span class="keyword1"><span class="command">notation</span></span> Rep_uexpr <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Abs_uexpr <span class="main">(</span><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span>"</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-uexpr_eq_iff"><span class="command">lemma</span></span> uexpr_eq_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="free">e</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">f</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_uexpr_inject<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⟦</span></span><span class="free"><span class="free">e</span></span><span class="keyword1"><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span></span> <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> effectively refers to the semantic interpretation of the expression
  under the state-space valuation (or variables binding) <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. It can be used, in concert
  with the lifting package, to interpret UTP constructs to their HOL equivalents. We create some
  theorem sets to store such transfer theorems. ›</span></span>
    
<span class="keyword1"><span class="command">named_theorems</span></span> uexpr_defs <span class="keyword2"><span class="keyword">and</span></span> ueval <span class="keyword2"><span class="keyword">and</span></span> lit_simps <span class="keyword2"><span class="keyword">and</span></span> lit_norm

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Core expression constructs ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A variable expression corresponds to the lens $get$ function associated with a variable. 
  Specifically, given a lens the expression always returns that portion of the state-space
  referred to by the lens. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> var <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">lens_get</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A literal is simply a constant function expression, always returning the same value
  for any binding. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> lit <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">«</span>_<span class="keyword1">»</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">v</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define lifting for unary, binary, ternary, and quaternary expression constructs, that 
  simply take a HOL function with correct number of arguments and apply it function to all possible 
  results of the expressions. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> uop <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">e</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">e</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> bop <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">u</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="bound">v</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> trop <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">u</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="bound">v</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="bound">w</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> qtop <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'e</span><span class="main">)</span> <span class="main">⇒</span>
   <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span>
   <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span> <span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">u</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="bound">v</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="bound">w</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also define a UTP expression version of function ($\lambda$) abstraction, that takes
  a function producing an expression and produces an expression producing a function. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ulambda <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">A</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up syntax for the conditional. This is effectively an infix version of
  if-then-else where the condition is in the middle. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uIf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uIf</span> <span class="main">=</span> If"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cond</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_ <span class="keyword1">◃</span> _ <span class="keyword1">▹</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>52<span class="main">,</span>0<span class="main">,</span>53<span class="main">]</span> 52<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">◃</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">▹</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> trop uIf <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ UTP expression is equality is simply HOL equality lifted using the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bop</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> binary 
  expression constructor. ›</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eq_upred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eq_upred</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> bop HOL.eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A literal is the expression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">«</span></span><span class="free"><span class="free">v</span></span><span class="main"><span class="main">»</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is any HOL term. Actually, the
  literal construct is very versatile and also allows us to refer to HOL variables within UTP
  expressions, and has a variety of other uses. It can therefore also be considered as a kind
  of quotation mechanism. 

  We also set up syntax for UTP variable expressions. ›</span></span>
  
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uuvar"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"svar <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_uuvar <span class="free">x</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> var <span class="free">x</span>"</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Since we already have a parser for variables, we can directly reuse it and simply apply
  the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">var</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> expression construct to lift the resulting variable to an expression. ›</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Type class instantiations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Isabelle/HOL of course provides a large hierarchy of type classes that provide constructs
  such as numerals and the arithmetic operators. Fortunately we can directly make use of these
  for UTP expressions, and thus we now perform a long list of appropriate instantiations. We
  first lift the core arithemtic constants and operators using a mixture of literals, unary, and binary
  expression constructors. ›</span></span>
  
<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> zero_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> lit <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">one</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> one_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> lit <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">plus</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> plus_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> bop <span class="main">(+)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">semigroup_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def zero_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following instantiation sets up numerals. This will allow us to have Isabelle number
  representations (i.e. 3,7,42,198 etc.) to UTP expressions directly. ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">numeral</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">numeral</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
     
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can also define the order relation on expressions. Now, unlike the previous group and ring 
  constructs, the order relations <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(≤)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(≤)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> return a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> bool<span class="antiquote"><span class="antiquote">}</span></span></span></span> type.
  This order is not therefore the lifted order which allows us to compare the valuation of two
  expressions, but rather the order on expressions themselves. Notably, this instantiation will
  later allow us to talk about predicate refinements and complete lattices. ›</span></span>
     
<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">ord</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">A</span> <span class="main">≤</span> <span class="bound">Q</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_uexpr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">less_uexpr</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ UTP expressions whose return type is a partial ordered type, are also partially ordered
  as the following instantiation demonstrates. ›</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_uexpr_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order.trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

      
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Syntax translations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The follows a large number of translations that lift HOL functions to UTP expressions
  using the various expression constructors defined above. Much of the time we try to keep
  the HOL syntax but add a "u" subscript. ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This operator allows us to get the characteristic set of a type. Essentially this is 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"UNIV"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but it retains the type syntactically for pretty printing. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> itself <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> UNIV"</span></span>
      
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We add new non-terminals for UTP tuples and maplets. ›</span></span>
  
<span class="keyword1"><span class="command">nonterminal</span></span> utuple_args <span class="keyword2"><span class="keyword">and</span></span> umaplet <span class="keyword2"><span class="keyword">and</span></span> umaplets

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Core expression constructs ›</span>
  <span class="quoted">"_ucoerce"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">:<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_ulambda"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">λ</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ulens_ovrd"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> salpha <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊕</span> _ <span class="keyword1">on</span> _"</span> <span class="main">[</span>85<span class="main">,</span> 0<span class="main">,</span> 86<span class="main">]</span> 86<span class="main">)</span>
  <span class="quoted">"_ulens_get"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> svar <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">:</span>_"</span> <span class="main">[</span>900<span class="main">,</span>901<span class="main">]</span> 901<span class="main">)</span>
  <span class="quoted">"_umem"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">λ</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">p</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> ulambda <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">p</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">:<span class="hidden">⇩</span><sub>u</sub></span> <span class="tfree"><span class="free">'a</span></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> uexpr"</span>
  <span class="quoted">"_ulens_ovrd <span class="free">f</span> <span class="free">g</span> <span class="free">a</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> lens_override <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>"</span>
  <span class="quoted">"_ulens_ovrd <span class="free">f</span> <span class="free">g</span> <span class="free">a</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="free">y</span><span class="main">.</span> <span class="keyword1">CONST</span> lens_override <span class="free">x1</span> <span class="free">y1</span> <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>"</span>
  <span class="quoted">"_ulens_get <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="main">(</span><span class="keyword1">CONST</span> lens_get <span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(∈)</span> <span class="free">x</span> <span class="free">A</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Tuples ›</span>
  <span class="quoted">"_utuple"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> utuple_args <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">'(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>u</sub></span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_utuple_arg"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> utuple_args"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_utuple_args"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">=&gt;</span> utuple_args <span class="main">⇒</span> utuple_args"</span></span>     <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_uunit"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(')<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_ufst"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>1</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_usnd"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>2</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">()<span class="hidden">⇩</span><sub>u</sub></span>"</span>      <span class="main">==</span> <span class="quoted">"<span class="main">«</span><span class="main">()</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> Pair<span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"_utuple <span class="free">x</span> <span class="main">(</span>_utuple_args <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"_utuple <span class="free">x</span> <span class="main">(</span>_utuple_arg <span class="main">(</span>_utuple <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>1</sub>(</span><span class="free">x</span><span class="main">)</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> fst <span class="free">x</span>"</span>
  <span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>2</sub>(</span><span class="free">x</span><span class="main">)</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> snd <span class="free">x</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Orders ›</span>
  <span class="quoted">"_uless"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_uleq"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_ugreat"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&gt;<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_ugeq"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≥<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(&lt;)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(≤)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">&gt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">≥<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Evaluation laws for expressions ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following laws show how to evaluate the core expressions constructs in terms of which
  the above definitions are defined. Thus, using these theorems together, we can convert any UTP 
  expression into a pure HOL expression. All these theorems are marked as \emph{ueval} theorems
  which can be used for evaluation. ›</span></span>
  
<span class="keyword1" id="utp_expr-lit_ueval"><span class="command">lemma</span></span> lit_ueval <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">«</span><span class="free">x</span><span class="main">»</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-var_ueval"><span class="command">lemma</span></span> var_ueval <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>var <span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span> <span class="main">=</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-uop_ueval"><span class="command">lemma</span></span> uop_ueval <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>uop <span class="free">f</span> <span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-bop_ueval"><span class="command">lemma</span></span> bop_ueval <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-trop_ueval"><span class="command">lemma</span></span> trop_ueval <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>trop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free">z</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-qtop_ueval"><span class="command">lemma</span></span> qtop_ueval <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>qtop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">w</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free">z</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free">w</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Misc laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also prove a few useful algebraic and expansion laws for expressions. ›</span></span>
  
<span class="keyword1" id="utp_expr-uop_const"><span class="command">lemma</span></span> uop_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uop id <span class="free">u</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-bop_const_1"><span class="command">lemma</span></span> bop_const_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bop <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-bop_const_2"><span class="command">lemma</span></span> bop_const_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bop <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-uexpr_fst"><span class="command">lemma</span></span> uexpr_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>1</sub>(</span><span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr-uexpr_snd"><span class="command">lemma</span></span> uexpr_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>2</sub>(</span><span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Literalise tactics ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following tactic converts literal HOL expressions to UTP expressions and vice-versa
        via a collection of simplification rules. The two tactics are called "literalise", which
        converts UTP to expressions to HOL expressions -- i.e. it pushes them into literals --
        and unliteralise that reverses this. We collect the equations in a theorem attribute
        called "lit\_simps". ›</span></span>
        
<span class="keyword1" id="utp_expr-lit_fun_simps"><span class="command">lemma</span></span> lit_fun_simps <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">i</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">u</span><span class="main">»</span> <span class="main">=</span> qtop <span class="free">i</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span> <span class="main">«</span><span class="free">z</span><span class="main">»</span> <span class="main">«</span><span class="free">u</span><span class="main">»</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">h</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">»</span> <span class="main">=</span> trop <span class="free">h</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span> <span class="main">«</span><span class="free">z</span><span class="main">»</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">g</span> <span class="free">x</span> <span class="free">y</span><span class="main">»</span> <span class="main">=</span> bop <span class="free">g</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">f</span> <span class="free">x</span><span class="main">»</span> <span class="main">=</span> uop <span class="free">f</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following two theorems also set up interpretation of numerals, meaning a UTP numeral
  can always be converted to a HOL numeral. ›</span></span>
    
<span class="keyword1" id="utp_expr-numeral_uexpr_rep_eq"><span class="command">lemma</span></span> numeral_uexpr_rep_eq <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>numeral <span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">b</span> <span class="main">=</span> numeral <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lit.rep_eq one_uexpr_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bop.rep_eq numeral_Bit0 plus_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bop.rep_eq lit.rep_eq numeral_code<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> one_uexpr_def plus_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_expr-numeral_uexpr_simp"><span class="command">lemma</span></span> numeral_uexpr_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"numeral <span class="free">x</span> <span class="main">=</span> <span class="main">«</span>numeral <span class="free">x</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uexpr_eq_iff numeral_uexpr_rep_eq lit.rep_eq<span class="main">)</span>

<span class="keyword1" id="utp_expr-lit_zero"><span class="command">lemma</span></span> lit_zero <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="main">0</span><span class="main">»</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main">)</span>
<span class="keyword1" id="utp_expr-lit_one"><span class="command">lemma</span></span> lit_one <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="main">1</span><span class="main">»</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main">)</span>
<span class="keyword1" id="utp_expr-lit_plus"><span class="command">lemma</span></span> lit_plus <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">+</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr-lit_numeral"><span class="command">lemma</span></span> lit_numeral <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span>numeral <span class="free">n</span><span class="main">»</span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_uexpr_simp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In general unliteralising converts function applications to corresponding expression
  liftings. Since some operators, like + and *, have specific operators we also have to
  use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> <span class="dynamic"><span class="dynamic"><span class="dynamic"><span class="dynamic">uexpr_defs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in reverse to correctly interpret these. Moreover, numerals must be handled
  separately by first simplifying them and then converting them into UTP expression numerals;
  hence the following two simplification rules. ›</span></span>

<span class="keyword1" id="utp_expr-lit_numeral_1"><span class="command">lemma</span></span> lit_numeral_1<span class="main">:</span> <span class="quoted"><span class="quoted">"uop numeral <span class="free">x</span> <span class="main">=</span> Abs_uexpr <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> numeral <span class="main">(</span><span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uop_def<span class="main">)</span>

<span class="keyword1" id="utp_expr-lit_numeral_2"><span class="command">lemma</span></span> lit_numeral_2<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_uexpr <span class="main">(</span><span class="main">λ</span> <span class="bound">b</span><span class="main">.</span> numeral <span class="free">v</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lit.abs_eq lit_numeral<span class="main">)</span>
  
<span class="keyword1"><span class="command">method</span></span> literalise <span class="main">=</span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">lit_simps</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> unliteralise <span class="main">=</span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">lit_simps</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span>
                     <span class="main">(</span><span class="operator">unfold</span> lit_numeral_1 <span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> <span class="dynamic"><span class="dynamic">ueval</span></span><span class="main">)</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> lit_numeral_2<span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                   
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following tactic can be used to evaluate literal expressions. It first literalises UTP 
  expressions, that is pushes as many operators into literals as possible. Then it tries to simplify,
  and final unliteralises at the end. ›</span></span>

<span class="keyword1"><span class="command">method</span></span> uexpr_simp <span class="keyword2"><span class="keyword">uses</span></span> simps <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="operator">literalise</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lit_norm</span></span> <span class="dynamic"><span class="dynamic">simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">unliteralise</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="comment1">(* Example *)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span>int<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">+</span> <span class="main">«</span><span class="numeral">2</span><span class="main">»</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">⟷</span> <span class="main">«</span><span class="numeral">3</span><span class="main">»</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">literalise</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">uexpr_simp</span><span class="main">)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_expr_insts">
<div class="head">
<h1>Theory utp_expr_insts</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Expression Type Class Instantiations ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_expr_insts
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_expr.html">utp_expr</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ It should be noted that instantiating the unary minus class, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> uminus<span class="antiquote"><span class="antiquote">}</span></span></span></span>, will also 
  provide negation UTP predicates later. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">uminus</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> uminus_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> uop uminus <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">minus</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> minus_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> bop <span class="main">(-)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">times</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> times_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> bop times <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">Rings.dvd</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">Rings.dvd</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">divide</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">divide</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_uexpr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">divide_uexpr</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> bop divide <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">inverse</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_uexpr</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">inverse_uexpr</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> uop inverse <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">modulo</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">modulo</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> mod_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> bop <span class="keyword1">(mod)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">sgn</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">sgn</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> sgn_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> uop sgn <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">abs</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">abs</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> abs_uexpr_def <span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> uop abs <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Once we've set up all the core constructs for arithmetic, we can also instantiate the 
  type classes for various algebras, including groups and rings. The proofs are done by 
  definitional expansion, the \emph{transfer} tactic, and then finally the theorems of the underlying
  HOL operators. This is mainly routine, so we don't comment further. ›</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">semigroup_mult</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">semigroup_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_uexpr_def one_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_mult</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">monoid_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_uexpr_def one_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">monoid_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def zero_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_semigroup_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ab_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">cancel_semigroup_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">cancel_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">cancel_ab_semigroup_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">cancel_ab_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def minus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff add.commute cancel_ab_semigroup_add_class.diff_diff_add<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">group_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def uminus_uexpr_def minus_uexpr_def zero_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ab_group_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def uminus_uexpr_def minus_uexpr_def zero_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">semiring</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def times_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff add.commute semiring_class.distrib_right semiring_class.distrib_left<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">ring_1</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ring_1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def uminus_uexpr_def minus_uexpr_def times_uexpr_def zero_uexpr_def one_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also lift the properties from certain ordered groups. ›</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">ordered_ab_group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ordered_ab_group_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">ordered_ab_group_add_abs</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ordered_ab_group_add_abs</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_uexpr_def zero_uexpr_def plus_uexpr_def uminus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_ge_self abs_le_iff abs_triangle_ineq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ab_group_add_class.ab_diff_conv_add_uminus abs_ge_minus_self abs_ge_self add_mono_thms_linordered_semiring<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next theorem lifts powers. ›</span></span>

<span class="keyword1" id="utp_expr_insts-power_rep_eq"><span class="command">lemma</span></span> power_rep_eq <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">^</span> <span class="free">n</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lit.rep_eq one_uexpr_def bop.rep_eq times_uexpr_def<span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-of_nat_uexpr_rep_eq"><span class="command">lemma</span></span> of_nat_uexpr_rep_eq <span class="main">[</span><span class="operator">ueval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>of_nat <span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">b</span> <span class="main">=</span> of_nat <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> <span class="dynamic"><span class="dynamic">ueval</span></span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-lit_uminus"><span class="command">lemma</span></span> lit_uminus <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="main">-</span> <span class="free">x</span><span class="main">»</span> <span class="main">=</span> <span class="main">-</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_insts-lit_minus"><span class="command">lemma</span></span> lit_minus <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">-</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_insts-lit_times"><span class="command">lemma</span></span> lit_times <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">*</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_insts-lit_divide"><span class="command">lemma</span></span> lit_divide <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">/</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_insts-lit_div"><span class="command">lemma</span></span> lit_div <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">div</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_insts-lit_power"><span class="command">lemma</span></span> lit_power <span class="main">[</span><span class="operator">lit_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lit.rep_eq power_rep_eq uexpr_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Expression construction from HOL terms ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Sometimes it is convenient to cast HOL terms to UTP expressions, and these simplifications
  automate this process. ›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> mkuexpr

<span class="keyword1" id="utp_expr_insts-mkuexpr_lens_get"><span class="command">lemma</span></span> mkuexpr_lens_get <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">&amp;</span>x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_zero"><span class="command">lemma</span></span> mkuexpr_zero <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_one"><span class="command">lemma</span></span> mkuexpr_one <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_numeral"><span class="command">lemma</span></span> mkuexpr_numeral <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lit_numeral_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_lit"><span class="command">lemma</span></span> mkuexpr_lit <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">«</span><span class="free">k</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_pair"><span class="command">lemma</span></span> mkuexpr_pair <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">,</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">f</span><span class="main">,</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">g</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_plus"><span class="command">lemma</span></span> mkuexpr_plus <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">f</span> <span class="main">+</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_uminus"><span class="command">lemma</span></span> mkuexpr_uminus <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_minus"><span class="command">lemma</span></span> mkuexpr_minus <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">f</span> <span class="main">-</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_times"><span class="command">lemma</span></span> mkuexpr_times <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">f</span> <span class="main">*</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_insts-mkuexpr_divide"><span class="command">lemma</span></span> mkuexpr_divide <span class="main">[</span><span class="operator">mkuexpr</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">f</span> <span class="main">/</span> <span class="keyword1">mk<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_uexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_expr_funcs">
<div class="head">
<h1>Theory utp_expr_funcs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> utp_expr_funcs
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_expr_insts.html">utp_expr_insts</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Polymorphic constructs ›</span>
  <span class="quoted">"_uceil"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_ufloor"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_umin"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">min<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_umax"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">max<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_ugcd"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">gcd<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="comment1">― ‹ Type-class polymorphic constructs ›</span>
  <span class="quoted">"<span class="keyword1">min<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> min<span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="keyword1">max<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> max<span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="keyword1">gcd<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> gcd<span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="main">⌈</span><span class="free">x</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> ceiling <span class="free">x</span>"</span>
  <span class="quoted">"<span class="main">⌊</span><span class="free">x</span><span class="keyword1">⌋<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> floor <span class="free">x</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Lists / Sequences ›</span>
  <span class="quoted">"_ucons"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub></span>"</span> 65<span class="main">)</span>
  <span class="quoted">"_unil"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨⟩</span>"</span><span class="main">)</span>
  <span class="quoted">"_ulist"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>    <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">⟩</span>"</span><span class="main">)</span>
  <span class="quoted">"_uappend"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">^<span class="hidden">⇩</span><sub>u</sub></span>"</span> 80<span class="main">)</span>
  <span class="quoted">"_udconcat"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">⇧</span><sup>⌢</sup><span class="hidden">⇩</span><sub>u</sub></span>"</span> 90<span class="main">)</span>
  <span class="quoted">"_ulast"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">last<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_ufront"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">front<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_uhead"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">head<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_utail"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">tail<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_utake"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">take<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_udrop"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">drop<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_ufilter"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>u</sub></span>"</span> 75<span class="main">)</span>
  <span class="quoted">"_uextract"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↿<span class="hidden">⇩</span><sub>u</sub></span>"</span> 75<span class="main">)</span>
  <span class="quoted">"_uelems"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">elems<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_usorted"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">sorted<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_udistinct"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">distinct<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_uupto"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">..</span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span>
  <span class="quoted">"_uupt"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">..&lt;</span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span>
  <span class="quoted">"_umap"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">map<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uzip"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">zip<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">ys</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(#)</span> <span class="free">x</span> <span class="free">ys</span>"</span>
  <span class="quoted">"<span class="main">⟨⟩</span>"</span>       <span class="main">==</span> <span class="quoted">"<span class="main">«</span><span class="main">[]</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">xs</span><span class="main">⟩</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟨</span><span class="free">xs</span><span class="main">⟩</span>"</span>
  <span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span>      <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="main">[]</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(@)</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1"><span class="hidden">⇧</span><sup>⌢</sup><span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(<span class="hidden">⇧</span><sup>⌢</sup>)</span> <span class="free">A</span> <span class="free">B</span>"</span>
  <span class="quoted">"<span class="keyword1">last<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> last <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">front<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> butlast <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">head<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> hd <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">tail<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> tl <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">drop<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> drop <span class="free">n</span> <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">take<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> take <span class="free">n</span> <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">elems<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> set <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">sorted<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> sorted <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">distinct<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> distinct <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="free">xs</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> seq_filter <span class="free">xs</span> <span class="free">A</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">↿<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">xs</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">(↿<span class="hidden">⇩</span><sub>l</sub>)</span> <span class="free">A</span> <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="main">⟨</span><span class="free">n</span><span class="main">..</span><span class="free">k</span><span class="main">⟩</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> upto <span class="free">n</span> <span class="free">k</span>"</span>
  <span class="quoted">"<span class="main">⟨</span><span class="free">n</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">⟩</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> upt <span class="free">n</span> <span class="free">k</span>"</span>
  <span class="quoted">"<span class="keyword1">map<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">f</span> <span class="free">xs</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> map <span class="free">f</span> <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">zip<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">xs</span> <span class="free">ys</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> zip <span class="free">xs</span> <span class="free">ys</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Sets ›</span>
  <span class="quoted">"_ufinite"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">finite<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_uempset"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uset"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uunion"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span>"</span> 65<span class="main">)</span>
  <span class="quoted">"_uinter"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∩<span class="hidden">⇩</span><sub>u</sub></span>"</span> 70<span class="main">)</span>
  <span class="quoted">"_uinsert"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">insert<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uimage"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">⦇</span>_<span class="keyword1">⦈<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">[</span>10<span class="main">,</span>0<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_usubset"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊂<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_usubseteq"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊆<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_uconverse"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>~</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_ucarrier"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>T</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uid"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">id[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="quoted">"_uproduct"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">×<span class="hidden">⇩</span><sub>u</sub></span>"</span> 80<span class="main">)</span>
  <span class="quoted">"_urelcomp"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">;<span class="hidden">⇩</span><sub>u</sub></span>"</span> 75<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">finite<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">x</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="main">(</span><span class="keyword1">CONST</span> finite<span class="main">)</span> <span class="free">x</span>"</span>
  <span class="quoted">"<span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span>"</span>      <span class="main">==</span> <span class="quoted">"<span class="main">«</span><span class="main">{}</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="keyword1">insert<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span> <span class="free">xs</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> insert <span class="free">x</span> <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">xs</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">insert<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span> <span class="main">{</span><span class="free">xs</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="keyword1">insert<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span> <span class="main">«</span><span class="main">{}</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(∪)</span> <span class="free">A</span> <span class="free">B</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(∩)</span> <span class="free">A</span> <span class="free">B</span>"</span>
  <span class="quoted">"<span class="free">f</span><span class="main">⦇</span><span class="free">A</span><span class="keyword1">⦈<span class="hidden">⇩</span><sub>u</sub></span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> image <span class="free">f</span> <span class="free">A</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">⊂<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(⊂)</span> <span class="free">A</span> <span class="free">B</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊂<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">g</span>"</span>   <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">(⊂<span class="hidden">⇩</span><sub>p</sub>)</span> <span class="free">f</span> <span class="free">g</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊂<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">g</span>"</span>   <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">(⊂<span class="hidden">⇩</span><sub>f</sub>)</span> <span class="free">f</span> <span class="free">g</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(⊆)</span> <span class="free">A</span> <span class="free">B</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">g</span>"</span>   <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">(⊆<span class="hidden">⇩</span><sub>p</sub>)</span> <span class="free">f</span> <span class="free">g</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">g</span>"</span>   <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">(⊆<span class="hidden">⇩</span><sub>f</sub>)</span> <span class="free">f</span> <span class="free">g</span>"</span>
  <span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>~</sup></span>"</span>        <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> converse <span class="free">P</span>"</span>
  <span class="quoted">"<span class="main">[</span><span class="tfree"><span class="free">'a</span></span><span class="keyword1">]<span class="hidden">⇩</span><sub>T</sub></span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="main">«</span><span class="keyword1">CONST</span> set_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main">)</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="keyword1">id[</span><span class="tfree"><span class="free">'a</span></span><span class="main">]</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="main">«</span><span class="keyword1">CONST</span> Id_on <span class="main">(</span><span class="keyword1">CONST</span> set_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main">)</span><span class="main">)</span><span class="main">»</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> Product_Type.Times <span class="free">A</span> <span class="free">B</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> relcomp <span class="free">A</span> <span class="free">B</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Partial functions ›</span>
  <span class="quoted">"_umap_plus"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕<span class="hidden">⇩</span><sub>u</sub></span>"</span> 85<span class="main">)</span>
  <span class="quoted">"_umap_minus"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊖<span class="hidden">⇩</span><sub>u</sub></span>"</span> 85<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">g</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> pfun<span class="main">,</span> <span class="main">_</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">+</span> <span class="free">g</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊖<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">g</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> pfun<span class="main">,</span> <span class="main">_</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">-</span> <span class="free">g</span>"</span>
  
<span class="keyword1"><span class="command">syntax</span></span> <span class="comment1">― ‹ Sum types ›</span>
  <span class="quoted">"_uinl"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inl<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_uinr"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inr<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">inl<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">x</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> Inl <span class="free">x</span>"</span>
  <span class="quoted">"<span class="keyword1">inr<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">x</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> Inr <span class="free">x</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lifting set collectors ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We provide syntax for various types of set collectors, including intervals and the Z-style
  set comprehension which is purpose built as a new lifted definition. ›</span></span>
  
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uset_atLeastAtMost"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_<span class="keyword1">..</span>_<span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_uset_atLeastLessThan"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_<span class="keyword1">..&lt;</span>_<span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_uset_compr"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_ <span class="keyword1">|</span><span class="keyword3">/ </span>_ <span class="keyword1">∙</span><span class="keyword3">/ </span>_<span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_uset_compr_nset"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_ <span class="keyword1">|</span><span class="keyword3">/ </span>_ <span class="keyword1">∙</span><span class="keyword3">/ </span>_<span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> ZedSetCompr <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">×</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">A</span> <span class="bound">PF</span> <span class="bound">b</span><span class="main">.</span> <span class="main">{</span> snd <span class="main">(</span><span class="bound">PF</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">b</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="bound">b</span> <span class="main">∧</span> fst <span class="main">(</span><span class="bound">PF</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> atLeastAtMost <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">..&lt;</span><span class="free">y</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> atLeastLessThan <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> ZedSetCompr <span class="main">(</span><span class="keyword1">CONST</span> lit <span class="keyword1">CONST</span> UNIV<span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">,</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span> <span class="main">:</span> <span class="free">A</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> ZedSetCompr <span class="free">A</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">,</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lifting limits ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also lift the following functions on topological spaces for taking function limits,
  and describing continuity. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ulim_left</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order_topology <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>t2_space"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ulim_left</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">f</span><span class="main">.</span> Lim <span class="main">(</span>at_left <span class="bound">p</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ulim_right</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order_topology <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>t2_space"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ulim_right</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">f</span><span class="main">.</span> Lim <span class="main">(</span>at_right <span class="bound">p</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ucont_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>topological_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">uexpr_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ucont_on</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span> <span class="bound">A</span><span class="main">.</span> continuous_on <span class="bound">A</span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ulim_left"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">lim<span class="hidden">⇩</span><sub>u</sub>'(</span>_ <span class="keyword1">→</span> _<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup>')'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_ulim_right"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">lim<span class="hidden">⇩</span><sub>u</sub>'(</span>_ <span class="keyword1">→</span> _<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup>')'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_ucont_on"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">cont-on<span class="hidden">⇩</span><sub>u</sub></span>"</span> 90<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">lim<span class="hidden">⇩</span><sub>u</sub>(</span>x <span class="main">→</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup>)(</span><span class="free">e</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> ulim_left <span class="free">p</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">e</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="keyword1">lim<span class="hidden">⇩</span><sub>u</sub>(</span>x <span class="main">→</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>+</sup>)(</span><span class="free">e</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> ulim_right <span class="free">p</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">e</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">cont-on<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> continuous_on <span class="free">A</span> <span class="free">f</span>"</span>

<span class="keyword1" id="utp_expr_funcs-uset_minus_empty"><span class="command">lemma</span></span> uset_minus_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-uinter_empty_1"><span class="command">lemma</span></span> uinter_empty_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-uinter_empty_2"><span class="command">lemma</span></span> uinter_empty_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-uunion_empty_1"><span class="command">lemma</span></span> uunion_empty_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-uunion_insert"><span class="command">lemma</span></span> uunion_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bop insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span> <span class="main">=</span> bop insert <span class="free">x</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-ulist_filter_empty"><span class="command">lemma</span></span> ulist_filter_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">⟨⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-tail_cons"><span class="command">lemma</span></span> tail_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">tail<span class="hidden">⇩</span><sub>u</sub>(</span><span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_funcs-uconcat_units"><span class="command">lemma</span></span> uconcat_units <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨⟩</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟨⟩</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_unrest">
<div class="head">
<h1>Theory utp_unrest</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_unrest
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_expr_insts.html">utp_expr_insts</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Definitions and Core Syntax ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction is an encoding of semantic freshness that allows us to reason about the
  presence of variables in predicates without being concerned with abstract syntax trees.
  An expression $p$ is unrestricted by lens $x$, written $x \mathop{\sharp} p$, if
  altering the value of $x$ has no effect on the valuation of $p$. This is a sufficient
  notion to prove many laws that would ordinarily rely on an \emph{fv} function. 

  Unrestriction was first defined in the work of Marcel Oliveira~\cite{Oliveira2005-PHD,Oliveira07} in his
  UTP mechanisation in \emph{ProofPowerZ}. Our definition modifies his in that our variables
  are semantically characterised as lenses, and supported by the lens laws, rather than named 
  syntactic entities. We effectively fuse the ideas from both Feliachi~\cite{Feliachi2010} and 
  Oliveira's~\cite{Oliveira07} mechanisations of the UTP, the former being also purely semantic
  in nature.

  We first set up overloaded syntax for unrestriction, as several concepts will have this
  defined. ›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  unrest <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_unrest"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">♯</span>"</span> 20<span class="main">)</span>
  
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_unrest <span class="free">x</span> <span class="free">p</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> unrest <span class="free">x</span> <span class="free">p</span>"</span>                                           
  <span class="quoted">"_unrest <span class="main">(</span>_salphaset <span class="main">(</span>_salphamk <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span>  <span class="main">&lt;=</span> <span class="quoted">"_unrest <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="free">P</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Our syntax translations support both variables and variable sets such that we can write down 
  predicates like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">&amp;</span></span>x <span class="main"><span class="main">♯</span></span> <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and also <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">&amp;</span></span>x<span class="main"><span class="main">,</span></span><span class="main"><span class="main">&amp;</span></span>y<span class="main"><span class="main">,</span></span><span class="main"><span class="main">&amp;</span></span>z<span class="main"><span class="main">}</span></span> <span class="main"><span class="main">♯</span></span> <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 

  We set up a simple tactic for discharging unrestriction conjectures using a simplification set. ›</span></span>
  
<span class="keyword1"><span class="command">named_theorems</span></span> unrest
<span class="keyword1"><span class="command">method</span></span> unrest_tac <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction for expressions is defined as a lifted construct using the underlying lens
  operations. It states that lens $x$ is unrestricted by expression $e$ provided that, for any
  state-space binding $b$ and variable valuation $v$, the value which the expression evaluates
  to is unaltered if we set $x$ to $v$ in $b$. In other words, we cannot effect the behaviour
  of $e$ by changing $x$. Thus $e$ does not observe the portion of state-space characterised
  by $x$. We add this definition to our overloaded constant. ›</span></span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> unrest_uexpr <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">e</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">e</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  unrest <span class="quoted">unrest_uexpr</span>

<span class="keyword1" id="utp_unrest-unrest_expr_alt_def"><span class="command">lemma</span></span> unrest_expr_alt_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>x <span class="main">♯</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">b</span> <span class="bound">b'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">b'</span> <span class="keyword1">on</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lens_override_def weak_lens.put_get<span class="main">)</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction laws ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We now prove unrestriction laws for the key constructs of our expression model. Many
  of these depend on lens properties and so variously employ the assumptions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">mwb_lens</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">vwb_lens</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, depending on the number of assumptions from the lenses theory is required.

  Firstly, we prove a general property -- if $x$ and $y$ are both unrestricted in $P$, then their composition
  is also unrestricted in $P$. One can interpret the composition here as a union -- if the two sets
  of variables $x$ and $y$ are unrestricted, then so is their union. ›</span></span>
  
<span class="keyword1" id="utp_unrest-unrest_var_comp"><span class="command">lemma</span></span> unrest_var_comp <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> y <span class="main">♯</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> x<span class="main">;</span>y <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_svar"><span class="command">lemma</span></span> unrest_svar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">&amp;</span>x <span class="main">♯</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>x <span class="main">♯</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ No lens is restricted by a literal, since it returns the same value for any state binding. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_lit"><span class="command">lemma</span></span> unrest_lit <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If one lens is smaller than another, then any unrestriction on the larger lens implies
  unrestriction on the smaller. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_sublens"><span class="command">lemma</span></span> unrest_sublens<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lens.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lens_comp_def sublens_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If two lenses are equivalent, and thus they characterise the same state-space regions,
  then clearly unrestrictions over them are equivalent. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_equiv"><span class="command">lemma</span></span> unrest_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms lens_equiv_def sublens_pres_mwb sublens_put_put unrest_uexpr.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If we can show that an expression is unrestricted on a bijective lens, then is unrestricted
  on the entire state-space. ›</span></span>

<span class="keyword1" id="utp_unrest-bij_lens_unrest_all"><span class="command">lemma</span></span> bij_lens_unrest_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_lens <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"X <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms bij_lens_equiv_id lens_equiv_def unrest_sublens <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_unrest-bij_lens_unrest_all_eq"><span class="command">lemma</span></span> bij_lens_unrest_all_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_lens <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>X <span class="main">♯</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms bij_lens_equiv_id lens_equiv_def unrest_sublens<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If an expression is unrestricted by all variables, then it is unrestricted by any variable ›</span></span>

<span class="keyword1" id="utp_unrest-unrest_all_var"><span class="command">lemma</span></span> unrest_all_var<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms id_lens_def lens.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> unrest_uexpr.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can split an unrestriction composed by lens plus ›</span></span>

<span class="keyword1" id="utp_unrest-unrest_plus_split"><span class="command">lemma</span></span> unrest_plus_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unrest <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="free">P</span> <span class="main">⟷</span> <span class="main">(</span>x <span class="main">♯</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>y <span class="main">♯</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lens_plus_right_sublens lens_plus_ub sublens_refl unrest_sublens unrest_var_comp vwb_lens_wb<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following laws demonstrate the primary motivation for lens independence: a variable
  expression is unrestricted by another variable only when the two variables are independent. 
  Lens independence thus effectively allows us to semantically characterise when two variables,
  or sets of variables, are different. ›</span></span>

<span class="keyword1" id="utp_unrest-unrest_var"><span class="command">lemma</span></span> unrest_var <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> y <span class="main">♯</span> var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_unrest-unrest_iuvar"><span class="command">lemma</span></span> unrest_iuvar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">$</span>y <span class="main">♯</span> <span class="main">$</span>x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_var<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_ouvar"><span class="command">lemma</span></span> unrest_ouvar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">$</span>y<span class="main">´</span> <span class="main">♯</span> <span class="main">$</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_var<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following laws follow automatically from independence of input and output variables. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_iuvar_ouvar"><span class="command">lemma</span></span> unrest_iuvar_ouvar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="main">$</span>y<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse unrest_uexpr.rep_eq var.rep_eq var_lookup_out var_update_in<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_ouvar_iuvar"><span class="command">lemma</span></span> unrest_ouvar_iuvar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="main">$</span>y"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse unrest_uexpr.rep_eq var.rep_eq var_lookup_in var_update_out<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction distributes through the various function lifting expression constructs;
  this allows us to prove unrestrictions for the majority of the expression language. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_uop"><span class="command">lemma</span></span> unrest_uop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">e</span> <span class="main">⟹</span> x <span class="main">♯</span> uop <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_bop"><span class="command">lemma</span></span> unrest_bop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> bop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_trop"><span class="command">lemma</span></span> unrest_trop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">w</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> trop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_qtop"><span class="command">lemma</span></span> unrest_qtop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">w</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> qtop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ For convenience, we also prove unrestriction rules for the bespoke operators on equality,
  numbers, arithmetic etc. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_eq"><span class="command">lemma</span></span> unrest_eq <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">u</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_upred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_zero"><span class="command">lemma</span></span> unrest_zero <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_lit zero_uexpr_def<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_one"><span class="command">lemma</span></span> unrest_one <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_uexpr_def unrest_lit<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_numeral"><span class="command">lemma</span></span> unrest_numeral <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_uexpr_simp unrest_lit<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_sgn"><span class="command">lemma</span></span> unrest_sgn <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">u</span> <span class="main">⟹</span> x <span class="main">♯</span> sgn <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_uexpr_def unrest_uop<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_abs"><span class="command">lemma</span></span> unrest_abs <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">u</span> <span class="main">⟹</span> x <span class="main">♯</span> abs <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_uexpr_def unrest_uop<span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_plus"><span class="command">lemma</span></span> unrest_plus <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_uminus"><span class="command">lemma</span></span> unrest_uminus <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">u</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">-</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_minus"><span class="command">lemma</span></span> unrest_minus <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">u</span> <span class="main">-</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_times"><span class="command">lemma</span></span> unrest_times <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_divide"><span class="command">lemma</span></span> unrest_divide <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">u</span> <span class="main">/</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_unrest-unrest_case_prod"><span class="command">lemma</span></span> unrest_case_prod <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> case_prod <span class="free">P</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.split_sel_asm<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ For a $\lambda$-term we need to show that the characteristic function expression does
  not restrict $v$ for any input value $x$. ›</span></span>
    
<span class="keyword1" id="utp_unrest-unrest_ulambda"><span class="command">lemma</span></span> unrest_ulambda <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> v <span class="main">♯</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> v <span class="main">♯</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_usedby">
<div class="head">
<h1>Theory utp_usedby</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Used-by ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_usedby
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_unrest.html">utp_unrest</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The used-by predicate is the dual of unrestriction. It states that the given lens is an 
  upper-bound on the size of state space the given expression depends on. It is similar to stating
  that the lens is a valid alphabet for the predicate. For convenience, and because the predicate
  uses a similar form, we will reuse much of unrestriction's infrastructure. ›</span></span>
  
<span class="keyword1"><span class="command">consts</span></span>
  usedBy <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_usedBy"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">♮</span>"</span> 20<span class="main">)</span>
  
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_usedBy <span class="free">x</span> <span class="free">p</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> usedBy <span class="free">x</span> <span class="free">p</span>"</span>                                           
  <span class="quoted">"_usedBy <span class="main">(</span>_salphaset <span class="main">(</span>_salphamk <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span>  <span class="main">&lt;=</span> <span class="quoted">"_usedBy <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="free">P</span>"</span>

<span class="keyword1"><span class="command">lift_definition</span></span> usedBy_uexpr <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">b</span> <span class="bound">b'</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="bound">b'</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">b</span> <span class="keyword1">on</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">e</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span> usedBy <span class="quoted">usedBy_uexpr</span>
  
<span class="keyword1" id="utp_usedby-usedBy_lit"><span class="command">lemma</span></span> usedBy_lit <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_sublens"><span class="command">lemma</span></span> usedBy_sublens<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♮</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Lens_Order.lens_override_idem lens_override_def sublens_obs_get vwb_lens_mwb<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_svar"><span class="command">lemma</span></span> usedBy_svar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">&amp;</span>x <span class="main">♮</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>
    
<span class="keyword1" id="utp_usedby-usedBy_lens_plus_1"><span class="command">lemma</span></span> usedBy_lens_plus_1 <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">P</span> <span class="main">⟹</span> x<span class="main">;</span>y <span class="main">♮</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_lens_plus_2"><span class="command">lemma</span></span> usedBy_lens_plus_2 <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span><span class="main">;</span> y <span class="main">♮</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> x<span class="main">;</span>y <span class="main">♮</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span> lens_indep_comm<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Linking used-by to unrestriction: if x is used-by P, and x is independent of y, then
  P cannot depend on any variable in y. ›</span></span>
    
<span class="keyword1" id="utp_usedby-usedBy_indep_uses"><span class="command">lemma</span></span> usedBy_indep_uses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lens_indep_get lens_override_def<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_var"><span class="command">lemma</span></span> usedBy_var <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> var <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> pr_var_def<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> lens_override_def sublens_obs_get vwb_lens_def wb_lens.get_put<span class="main">)</span>    
  
<span class="keyword1" id="utp_usedby-usedBy_uop"><span class="command">lemma</span></span> usedBy_uop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">e</span> <span class="main">⟹</span> x <span class="main">♮</span> uop <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_bop"><span class="command">lemma</span></span> usedBy_bop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> bop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_trop"><span class="command">lemma</span></span> usedBy_trop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">w</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> trop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_qtop"><span class="command">lemma</span></span> usedBy_qtop <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">w</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> qtop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ For convenience, we also prove used-by rules for the bespoke operators on equality,
  numbers, arithmetic etc. ›</span></span>
    
<span class="keyword1" id="utp_usedby-usedBy_eq"><span class="command">lemma</span></span> usedBy_eq <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="free">u</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_upred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_zero"><span class="command">lemma</span></span> usedBy_zero <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usedBy_lit zero_uexpr_def<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_one"><span class="command">lemma</span></span> usedBy_one <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_uexpr_def usedBy_lit<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_numeral"><span class="command">lemma</span></span> usedBy_numeral <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_uexpr_simp usedBy_lit<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_sgn"><span class="command">lemma</span></span> usedBy_sgn <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">u</span> <span class="main">⟹</span> x <span class="main">♮</span> sgn <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_uexpr_def usedBy_uop<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_abs"><span class="command">lemma</span></span> usedBy_abs <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">u</span> <span class="main">⟹</span> x <span class="main">♮</span> abs <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_uexpr_def usedBy_uop<span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_plus"><span class="command">lemma</span></span> usedBy_plus <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_uminus"><span class="command">lemma</span></span> usedBy_uminus <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♮</span> <span class="free">u</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">-</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_minus"><span class="command">lemma</span></span> usedBy_minus <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="free">u</span> <span class="main">-</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_times"><span class="command">lemma</span></span> usedBy_times <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_usedby-usedBy_divide"><span class="command">lemma</span></span> usedBy_divide <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">u</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="free">u</span> <span class="main">/</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_uexpr_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>
    
<span class="keyword1" id="utp_usedby-usedBy_ulambda"><span class="command">lemma</span></span> usedBy_ulambda <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> v <span class="main">♮</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> v <span class="main">♮</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>      

<span class="keyword1" id="utp_usedby-unrest_var_sep"><span class="command">lemma</span></span> unrest_var_sep <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">&amp;</span>x<span class="main">:</span>y"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_subst">
<div class="head">
<h1>Theory utp_subst</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Substitution ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_subst
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="utp_expr.html">utp_expr</a>
  <a href="utp_unrest.html">utp_unrest</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution definitions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Variable substitution, like unrestriction, will be characterised semantically using lenses
  and state-spaces. Effectively a substitution $\sigma$ is simply a function on the state-space which
  can be applied to an expression $e$ using the syntax $\sigma \mathop{\dagger} e$.  We introduce 
  a polymorphic constant that will be used to represent application of a substitution, and also a 
  set of theorems to represent laws. ›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  usubst <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">†</span>"</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">named_theorems</span></span> usubst

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A substitution is simply a transformation on the alphabet; it shows how variables
  should be mapped to different values. Most of the time these will be homogeneous functions 
  but for flexibility we also allow some operations to be heterogeneous. ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> psubst <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'β</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> usubst <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'α</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Application of a substitution simply applies the function $\sigma$ to the state binding
  $b$ before it is handed to $e$ as an input. This effectively ensures all variables are updated
  in $e$. ›</span></span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> subst <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> psubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">σ</span> <span class="bound">e</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="bound">σ</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  usubst <span class="quoted">subst</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Substitutions can be updated by associating variables with expressions. We thus create an 
  additional polymorphic constant to represent updating the value of a variable to an expression 
  in a substitution, where the variable is modelled by type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This again allows us
  to support different notions of variables, such as deep variables, later. ›</span></span>

<span class="keyword1"><span class="command">consts</span></span> subst_upd <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> psubst <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> psubst"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following function takes a substitution form state-space <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'β</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, a
  lens with source <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'β</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and view "'a", and an expression over <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and returning
  a value of type "<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and produces an updated substitution. It does this by constructing
  a substitution function that takes state binding $b$, and updates the state first by applying
  the original substitution $\sigma$, and then updating the part of the state associated with lens
  $x$ with expression evaluated in the context of $b$. This effectively means that $x$ is now
  associated with expression $v$. We add this definition to our overloaded constant. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_upd_uvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> psubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> psubst"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst_upd_uvar</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  subst_upd <span class="quoted">subst_upd_uvar</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next function looks up the expression associated with a variable in a substitution
  by use of the \emph{get} lens function. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> usubst_lookup <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> psubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">σ</span> <span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">σ</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Substitutions also exhibit a natural notion of unrestriction which states that $\sigma$
  does not restrict $x$ if application of $\sigma$ to an arbitrary state $\rho$ will not effect
  the valuation of $x$. Put another way, it requires that \emph{put} and the substitution commute. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unrest_usubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> usubst <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">unrest_usubst</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">ρ</span> <span class="bound">v</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">ρ</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">ρ</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  unrest <span class="quoted">unrest_usubst</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A conditional substitution deterministically picks one of the two substitutions based on a
  Booolean expression which is evaluated on the present state-space. It is analogous to a functional
  if-then-else. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond_subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="tfree">'α</span> usubst"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_ <span class="keyword1">◃</span> _ <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>52<span class="main">,</span>0<span class="main">,</span>53<span class="main">]</span> 52<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cond_subst</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">(</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">(</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Parallel substitutions allow us to divide the state space into three segments using two
  lens, A and B. They correspond to the part of the state that should be updated by the 
  respective substitution. The two lenses should be independent. If any part of the state
  is not covered by either lenses then this area is left unchanged (framed). ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">par_subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="tfree">'α</span> usubst"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">par_subst</span> <span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Syntax translations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We support two kinds of syntax for substitutions, one where we construct a substitution
  using a maplet-style syntax, with variables mapping to expressions. Such a constructed substitution
  can be applied to an expression. Alternatively, we support the more traditional notation, 
  $P \llbracket v / x \rrbracket$, which also support multiple simultaneous substitutions. We 
  have to use double square brackets as the single ones are already well used. 

  We set up non-terminals to represent a single substitution maplet, a sequence of maplets, a
  list of expressions, and a list of alphabets. The parser effectively uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">subst_upd</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  to construct substitutions from multiple variables. 
›</span></span>
  
<span class="keyword1"><span class="command">nonterminal</span></span> smaplet <span class="keyword2"><span class="keyword">and</span></span> smaplets <span class="keyword2"><span class="keyword">and</span></span> uexp <span class="keyword2"><span class="keyword">and</span></span> uexprs <span class="keyword2"><span class="keyword">and</span></span> salphas

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_smaplet"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>salpha<span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> smaplet"</span></span>             <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">""</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"smaplet <span class="main">=&gt;</span> smaplets"</span></span>            <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_SMaplets"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>smaplet<span class="main">,</span> smaplets<span class="main">]</span> <span class="main">=&gt;</span> smaplets"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_SubstUpd"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'m</span> usubst<span class="main">,</span> smaplets<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'m</span> usubst"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/</span><span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span> <span class="main">[</span>900<span class="main">,</span>0<span class="main">]</span> 900<span class="main">)</span>
  <span class="quoted">"_Subst"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"smaplets <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span>"</span></span>            <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_psubst"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>logic<span class="main">,</span> svars<span class="main">,</span> uexprs<span class="main">]</span> <span class="main">⇒</span> logic"</span></span>
  <span class="quoted">"_subst"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> uexprs <span class="main">⇒</span> salphas <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">⟦</span>_<span class="keyword1">'/</span>_<span class="keyword1">⟧</span><span class="keyword3">)</span>"</span> <span class="main">[</span>990<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 991<span class="main">)</span>
  <span class="quoted">"_uexp_l"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_"</span> <span class="main">[</span>64<span class="main">]</span> 64<span class="main">)</span>
  <span class="quoted">"_uexprs"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>uexp<span class="main">,</span> uexprs<span class="main">]</span> <span class="main">=&gt;</span> uexprs"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">""</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">=&gt;</span> uexprs"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_salphas"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>salpha<span class="main">,</span> salphas<span class="main">]</span> <span class="main">=&gt;</span> salphas"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">""</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">=&gt;</span> salphas"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_par_subst"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> salpha <span class="main">⇒</span> salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">[</span>_<span class="keyword1">|</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> _"</span> <span class="main">[</span>100<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>101<span class="main">]</span> 101<span class="main">)</span>
    
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_SubstUpd <span class="free">m</span> <span class="main">(</span>_SMaplets <span class="free">xy</span> <span class="free">ms</span><span class="main">)</span>"</span>     <span class="main">==</span> <span class="quoted">"_SubstUpd <span class="main">(</span>_SubstUpd <span class="free">m</span> <span class="free">xy</span><span class="main">)</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_SubstUpd <span class="free">m</span> <span class="main">(</span>_smaplet <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span>        <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> subst_upd <span class="free">m</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"_Subst <span class="free">ms</span>"</span>                         <span class="main">==</span> <span class="quoted">"_SubstUpd <span class="main">(</span><span class="keyword1">CONST</span> id<span class="main">)</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_Subst <span class="main">(</span>_SMaplets <span class="free">ms1</span> <span class="free">ms2</span><span class="main">)</span>"</span>        <span class="main">&lt;=</span> <span class="quoted">"_SubstUpd <span class="main">(</span>_Subst <span class="free">ms1</span><span class="main">)</span> <span class="free">ms2</span>"</span>
  <span class="quoted">"_SMaplets <span class="free">ms1</span> <span class="main">(</span>_SMaplets <span class="free">ms2</span> <span class="free">ms3</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_SMaplets <span class="main">(</span>_SMaplets <span class="free">ms1</span> <span class="free">ms2</span><span class="main">)</span> <span class="free">ms3</span>"</span>
  <span class="quoted">"_subst <span class="free">P</span> <span class="free">es</span> <span class="free">vs</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> subst <span class="main">(</span>_psubst <span class="main">(</span><span class="keyword1">CONST</span> id<span class="main">)</span> <span class="free">vs</span> <span class="free">es</span><span class="main">)</span> <span class="free">P</span>"</span>
  <span class="quoted">"_psubst <span class="free">m</span> <span class="main">(</span>_salphas <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>_uexprs <span class="free">v</span> <span class="free">vs</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"_psubst <span class="main">(</span>_psubst <span class="free">m</span> <span class="free">x</span> <span class="free">v</span><span class="main">)</span> <span class="free">xs</span> <span class="free">vs</span>"</span>
  <span class="quoted">"_psubst <span class="free">m</span> <span class="free">x</span> <span class="free">v</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> subst_upd <span class="free">m</span> <span class="free">x</span> <span class="free">v</span>"</span>
  <span class="quoted">"_subst <span class="free">P</span> <span class="free">v</span> <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> usubst <span class="main">(</span><span class="keyword1">CONST</span> subst_upd <span class="main">(</span><span class="keyword1">CONST</span> id<span class="main">)</span> <span class="free">x</span> <span class="free">v</span><span class="main">)</span> <span class="free">P</span>"</span>
  <span class="quoted">"_subst <span class="free">P</span> <span class="free">v</span> <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_subst <span class="free">P</span> <span class="main">(</span>_spvar <span class="free">x</span><span class="main">)</span> <span class="free">v</span>"</span>
  <span class="quoted">"_par_subst <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span> <span class="free">B</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> par_subst <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span> <span class="free">B</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span>
  <span class="quoted">"_uexp_l <span class="free">e</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">e</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Thus we can write things like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">σ</span></span><span class="main"><span class="main">(</span></span>x <span class="keyword1"><span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="free">v</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to update a variable $x$ in $\sigma$ with
  expression $v$, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>x <span class="keyword1"><span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="free">e</span></span><span class="main"><span class="main">,</span></span> y <span class="keyword1"><span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="free">f</span></span><span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to construct a substitution with two variables,
  and finally <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span><span class="main"><span class="main">⟦</span></span><span class="free"><span class="free">v</span></span><span class="main"><span class="main">/</span></span>x<span class="main"><span class="main">⟧</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the traditional syntax.

  We can now express deletion of a substitution maplet. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_del</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> usubst"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span>"</span> 85<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst_del</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>x<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution Application Laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up a simple substitution tactic that applies substitution and unrestriction laws ›</span></span>

<span class="keyword1"><span class="command">method</span></span> subst_tac <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Evaluation of a substitution expression involves application of the substitution to different
  variables. Thus we first prove laws for these cases. The simplest substitution, $id$, when applied
  to any variable $x$ simply returns the variable expression, since $id$ has no effect. ›</span></span>
  
<span class="keyword1" id="utp_subst-usubst_lookup_id"><span class="command">lemma</span></span> usubst_lookup_id <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>id<span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_upd_id_lam"><span class="command">lemma</span></span> subst_upd_id_lam <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subst_upd <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free">x</span> <span class="free">v</span> <span class="main">=</span> subst_upd id <span class="free">x</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A substitution update naturally yields the given expression. ›</span></span>
    
<span class="keyword1" id="utp_subst-usubst_lookup_upd"><span class="command">lemma</span></span> usubst_lookup_upd <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_lookup_upd_pr_var"><span class="command">lemma</span></span> usubst_lookup_upd_pr_var <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def pr_var_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Substitution update is idempotent. ›</span></span>
    
<span class="keyword1" id="utp_subst-usubst_upd_idem"><span class="command">lemma</span></span> usubst_upd_idem <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def assms comp_def<span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_upd_idem_sub"><span class="command">lemma</span></span> usubst_upd_idem_sub <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def assms comp_def fun_eq_iff sublens_put_put<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Substitution updates commute when the lenses are independent. ›</span></span>
    
<span class="keyword1" id="utp_subst-usubst_upd_comm"><span class="command">lemma</span></span> usubst_upd_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">,</span> x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def assms comp_def lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_upd_comm2"><span class="command">lemma</span></span> usubst_upd_comm2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">s</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def assms comp_def lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_upd_pr_var"><span class="command">lemma</span></span> subst_upd_pr_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">(</span><span class="main">&amp;</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A substitution which swaps two independent variables is an injective function. ›</span></span>
    
<span class="keyword1" id="utp_subst-swap_usubst_inj"><span class="command">lemma</span></span> swap_usubst_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>y<span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>x<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> injI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>y<span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>x<span class="main">]</span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>y<span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>x<span class="main">]</span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="main">⟦</span><span class="main">&amp;</span>y<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="main">&amp;</span>x<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">⟦</span><span class="main">&amp;</span>y<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">⟦</span><span class="main">&amp;</span>x<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="bound">a</span> <span class="bound">c</span><span class="main">)</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lens_indep.lens_put_irr2 lens_indep_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pr_var_def var.rep_eq vwb_lens.source_determination vwb_lens_def wb_lens_def weak_lens.put_get<span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_subst-usubst_upd_var_id"><span class="command">lemma</span></span> usubst_upd_var_id <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> var <span class="free">x</span><span class="main">]</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_subst-usubst_upd_pr_var_id"><span class="command">lemma</span></span> usubst_upd_pr_var_id <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> var <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def pr_var_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="utp_subst-usubst_upd_comm_dash"><span class="command">lemma</span></span> usubst_upd_comm_dash <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">,</span> <span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> out_in_indep usubst_upd_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_subst-subst_upd_lens_plus"><span class="command">lemma</span></span> subst_upd_lens_plus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"subst_upd <span class="free">σ</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">«</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">»</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">,</span> x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">u</span><span class="main">»</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_upd_in_lens_plus"><span class="command">lemma</span></span> subst_upd_in_lens_plus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"subst_upd <span class="free">σ</span> <span class="main">(</span>ivar <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">«</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">»</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span><span class="main">$</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">,</span> <span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">u</span><span class="main">»</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_upd_out_lens_plus"><span class="command">lemma</span></span> subst_upd_out_lens_plus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"subst_upd <span class="free">σ</span> <span class="main">(</span>ovar <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">«</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">»</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span><span class="main">$</span>y<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">,</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">u</span><span class="main">»</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span>
    
<span class="keyword1" id="utp_subst-usubst_lookup_upd_indep"><span class="command">lemma</span></span> usubst_lookup_upd_indep <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_upd_plus"><span class="command">lemma</span></span> subst_upd_plus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> subst_upd <span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="free">e</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">π<span class="hidden">⇩</span><sub>1</sub>(</span><span class="free">e</span><span class="main">)</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">π<span class="hidden">⇩</span><sub>2</sub>(</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff prod.case_eq_if lens_indep_comm<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If a variable is unrestricted in a substitution then it's application has no effect. ›</span></span>

<span class="keyword1" id="utp_subst-usubst_apply_unrest"><span class="command">lemma</span></span> usubst_apply_unrest <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_usubst_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put wb_lens_weak weak_lens.put_get<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ There follows various laws about deleting variables from a substitution. ›</span></span>
    
<span class="keyword1" id="utp_subst-subst_del_id"><span class="command">lemma</span></span> subst_del_id <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> id <span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_del_def subst_upd_uvar_def pr_var_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_del_upd_same"><span class="command">lemma</span></span> subst_del_upd_same <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">σ</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_del_def subst_upd_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_del_upd_diff"><span class="command">lemma</span></span> subst_del_upd_diff <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_del_def subst_upd_uvar_def lens_indep_comm<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If a variable is unrestricted in an expression, then any substitution of that variable
  has no effect on the expression .›</span></span>
    
<span class="keyword1" id="utp_subst-subst_unrest"><span class="command">lemma</span></span> subst_unrest <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_unrest_2"><span class="command">lemma</span></span> subst_unrest_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lens_indep.lens_put_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_unrest_3"><span class="command">lemma</span></span> subst_unrest_3 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_unrest_4"><span class="command">lemma</span></span> subst_unrest_4 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">e</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">f</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">g</span><span class="main">,</span> u <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">h</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">f</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">g</span><span class="main">,</span> u <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">h</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_unrest_5"><span class="command">lemma</span></span> subst_unrest_5 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">e</span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">f</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">g</span><span class="main">,</span> u <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">h</span><span class="main">,</span> v <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">i</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">f</span><span class="main">,</span> z <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">g</span><span class="main">,</span> u <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">h</span><span class="main">,</span> v <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">i</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_compose_upd"><span class="command">lemma</span></span> subst_compose_upd <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">∘</span> <span class="free">ρ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">∘</span> <span class="free">ρ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_usubst_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Any substitution is a monotonic function. ›</span></span>
    
<span class="keyword1" id="utp_subst-subst_mono"><span class="command">lemma</span></span> subst_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>subst <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_uexpr.rep_eq mono_def subst.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution laws ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We now prove the key laws that show how a substitution should be performed for every 
  expression operator, including the core function operators, literals, variables, and the 
  arithmetic operators. They are all added to the \emph{usubst} theorem attribute so that
  we can apply them using the substitution tactic. ›</span></span>
    
<span class="keyword1" id="utp_subst-id_subst"><span class="command">lemma</span></span> id_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"id <span class="main">†</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_lit"><span class="command">lemma</span></span> subst_lit <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_var"><span class="command">lemma</span></span> subst_var <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> var <span class="free">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_ulambda"><span class="command">lemma</span></span> usubst_ulambda <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-unrest_usubst_del"><span class="command">lemma</span></span> unrest_usubst_del <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span>  x <span class="main">♯</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_del_def subst_upd_uvar_def unrest_uexpr_def unrest_usubst_def subst.rep_eq usubst_lookup.rep_eq<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We add the symmetric definition of input and output variables to substitution laws
        so that the variables are correctly normalised after substitution. ›</span></span>

<span class="keyword1" id="utp_subst-subst_uop"><span class="command">lemma</span></span> subst_uop <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> uop <span class="free">f</span> <span class="free">v</span> <span class="main">=</span> uop <span class="free">f</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_bop"><span class="command">lemma</span></span> subst_bop <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> bop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> bop <span class="free">f</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_trop"><span class="command">lemma</span></span> subst_trop <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> trop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">=</span> trop <span class="free">f</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_qtop"><span class="command">lemma</span></span> subst_qtop <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> qtop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="free">x</span> <span class="main">=</span> qtop <span class="free">f</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_case_prod"><span class="command">lemma</span></span> subst_case_prod <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'j</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> case_prod <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> case_prod <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_plus"><span class="command">lemma</span></span> subst_plus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">x</span> <span class="main">+</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_uexpr_def subst_bop<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_times"><span class="command">lemma</span></span> subst_times <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">x</span> <span class="main">*</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_uexpr_def subst_bop<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_mod"><span class="command">lemma</span></span> subst_mod <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_uexpr_def <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_div"><span class="command">lemma</span></span> subst_div <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_uexpr_def <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_minus"><span class="command">lemma</span></span> subst_minus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">x</span> <span class="main">-</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_uexpr_def subst_bop<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_uminus"><span class="command">lemma</span></span> subst_uminus <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_uexpr_def subst_uop<span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_sgn"><span class="command">lemma</span></span> usubst_sgn <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> sgn <span class="free">x</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_uexpr_def subst_uop<span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_abs"><span class="command">lemma</span></span> usubst_abs <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> abs <span class="free">x</span> <span class="main">=</span> abs <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_uexpr_def subst_uop<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_zero"><span class="command">lemma</span></span> subst_zero <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_uexpr_def subst_lit<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_one"><span class="command">lemma</span></span> subst_one <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_uexpr_def subst_lit<span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_eq_upred"><span class="command">lemma</span></span> subst_eq_upred <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">σ</span> <span class="main">†</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_upred_def <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This laws shows the effect of applying one substitution after another -- we simply
  use function composition to compose them. ›</span></span>
    
<span class="keyword1" id="utp_subst-subst_subst"><span class="command">lemma</span></span> subst_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="free">ρ</span> <span class="main">†</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∘</span> <span class="free">σ</span><span class="main">)</span> <span class="main">†</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next law is similar, but shows how such a substitution is to be applied to every
  updated variable additionally. ›</span></span>
    
<span class="keyword1" id="utp_subst-subst_upd_comp"><span class="command">lemma</span></span> subst_upd_comp <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">∘</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∘</span> <span class="free">σ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">uexpr_defs</span></span> subst_upd_uvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-subst_singleton"><span class="command">lemma</span></span> subst_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> subst_to_singleton <span class="main">=</span> subst_singleton id_subst

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Ordering substitutions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A simplification procedure to reorder substitutions maplets lexicographically by variable syntax ›</span></span>

<span class="keyword1"><span class="command">simproc_setup</span></span> subst_order <span class="main">(</span><span class="quoted"><span class="quoted">"subst_upd_uvar <span class="main">(</span>subst_upd_uvar <span class="free">σ</span> <span class="free">x</span> <span class="free">u</span><span class="main">)</span> <span class="free">y</span> <span class="free">v</span>"</span></span><span class="main">)</span> <span class="main">=</span>
  <span class="quoted">‹<span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ct</span> <span class="main">=&gt;</span> 
        <span class="keyword2"><span class="keyword">case</span></span> <span class="main">(</span>Thm.term_of <span class="entity">ct</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
          Const <span class="main">(</span><span class="inner_quoted">"utp_subst.subst_upd_uvar"</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">(</span>Const <span class="main">(</span><span class="inner_quoted">"utp_subst.subst_upd_uvar"</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">s</span> $ <span class="entity">x</span> $ <span class="entity">u</span><span class="main">)</span> $ <span class="entity">y</span> $ <span class="entity">v</span>
            <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span>YXML.content_of <span class="main">(</span>Syntax.string_of_term <span class="entity">ctxt</span> <span class="entity">x</span><span class="main">)</span> &gt; YXML.content_of<span class="main">(</span>Syntax.string_of_term <span class="entity">ctxt</span> <span class="entity">y</span><span class="main">)</span><span class="main">)</span>
               <span class="keyword2"><span class="keyword">then</span></span> SOME <span class="main">(</span><span class="entity">mk_meta_eq</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> usubst_upd_comm<span class="antiquote">}</span></span></span><span class="main">)</span>
               <span class="keyword2"><span class="keyword">else</span></span> NONE  <span class="main">|</span>
          <span class="main">_</span> <span class="main">=&gt;</span> NONE<span class="main">)</span> 
›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ These are the key unrestriction theorems for substitutions and expressions involving substitutions. ›</span></span>
  
<span class="keyword1" id="utp_subst-unrest_usubst_single"><span class="command">lemma</span></span> unrest_usubst_single <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def unrest_uexpr_def<span class="main">)</span>

<span class="keyword1" id="utp_subst-unrest_usubst_id"><span class="command">lemma</span></span> unrest_usubst_id <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> x <span class="main">♯</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_usubst_def<span class="main">)</span>

<span class="keyword1" id="utp_subst-unrest_usubst_upd"><span class="command">lemma</span></span> unrest_usubst_upd <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_upd_uvar_def unrest_usubst_def unrest_uexpr.rep_eq lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_subst-unrest_subst"><span class="command">lemma</span></span> unrest_subst <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_usubst_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conditional Substitution Laws ›</span></span>
  
<span class="keyword1" id="utp_subst-usubst_cond_upd_1"><span class="command">lemma</span></span> usubst_cond_upd_1 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_subst_def subst_upd_uvar_def <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_subst-usubst_cond_upd_2"><span class="command">lemma</span></span> usubst_cond_upd_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">ρ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">&amp;</span>x<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_subst_def subst_upd_uvar_def unrest_usubst_def <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> id_apply pr_var_def subst_upd_uvar_def usubst_upd_pr_var_id var.rep_eq<span class="main">)</span>
 
<span class="keyword1" id="utp_subst-usubst_cond_upd_3"><span class="command">lemma</span></span> usubst_cond_upd_3 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">&amp;</span>x <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_subst_def subst_upd_uvar_def unrest_usubst_def <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> id_apply pr_var_def subst_upd_uvar_def usubst_upd_pr_var_id var.rep_eq<span class="main">)</span>
    
<span class="keyword1" id="utp_subst-usubst_cond_id"><span class="command">lemma</span></span> usubst_cond_id <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_subst_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Parallel Substitution Laws ›</span></span>
    
<span class="keyword1" id="utp_subst-par_subst_id"><span class="command">lemma</span></span> par_subst_id <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">A</span><span class="main">;</span> vwb_lens <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> id <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_def id_def<span class="main">)</span>

<span class="keyword1" id="utp_subst-par_subst_left_empty"><span class="command">lemma</span></span> par_subst_left_empty <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">[</span><span class="main">∅</span><span class="main">|</span>A<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span> <span class="main">=</span> id <span class="main">[</span><span class="main">∅</span><span class="main">|</span>A<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_def pr_var_def<span class="main">)</span>

<span class="keyword1" id="utp_subst-par_subst_right_empty"><span class="command">lemma</span></span> par_subst_right_empty <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span><span class="main">∅</span><span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span><span class="main">∅</span><span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_def pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_subst-par_subst_comm"><span class="command">lemma</span></span> par_subst_comm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">⨝</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">[</span>B<span class="main">|</span>A<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_def lens_override_def lens_indep_comm<span class="main">)</span>
      
<span class="keyword1" id="utp_subst-par_subst_upd_left_in"><span class="command">lemma</span></span> par_subst_upd_left_in <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">⨝</span> <span class="free">B</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_def subst_upd_uvar_def lens_override_put_right_in<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_comm lens_override_def sublens_pres_indep<span class="main">)</span>

<span class="keyword1" id="utp_subst-par_subst_upd_left_out"><span class="command">lemma</span></span> par_subst_upd_left_out <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">A</span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_def subst_upd_uvar_def lens_override_put_right_out<span class="main">)</span>
     
<span class="keyword1" id="utp_subst-par_subst_upd_right_in"><span class="command">lemma</span></span> par_subst_upd_right_in <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">B</span><span class="main">;</span> <span class="free">A</span> <span class="main">⨝</span> <span class="free">B</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lens_indep_sym par_subst_comm par_subst_upd_left_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="utp_subst-par_subst_upd_right_out"><span class="command">lemma</span></span> par_subst_upd_right_out <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">B</span><span class="main">;</span> <span class="free">A</span> <span class="main">⨝</span> <span class="free">B</span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">[</span>A<span class="main">|</span>B<span class="keyword1">]<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ρ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_subst_comm par_subst_upd_left_out<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>


  </pre>
</div><div id="utp_tactics">
<div class="head">
<h1>Theory utp_tactics</h1>
</div>
<pre class="source"><span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* Project: The Isabelle/UTP Proof System                                     *)</span>
<span class="comment1">(* File: utp_tactics.thy                                                      *)</span>
<span class="comment1">(* Authors: Simon Foster &amp; Frank Zeyda (University of York, UK)               *)</span>
<span class="comment1">(* Emails: simon.foster@york.ac.uk frank.zeyda@york.ac.uk                     *)</span>
<span class="comment1">(******************************************************************************)</span>

<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹ \newpage ›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ UTP Tactics ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_tactics
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="utp_expr.html">utp_expr</a> <a href="utp_unrest.html">utp_unrest</a> <a href="utp_usedby.html">utp_usedby</a>
<span class="keyword2"><span class="keyword">keywords</span></span> <span class="quoted">"update_uexpr_rep_eq_thms"</span> <span class="main">::</span> thy_decl
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> image_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this theory, we define several automatic proof tactics that use transfer
  techniques to re-interpret proof goals about UTP predicates and relations in
  terms of pure HOL conjectures. The fundamental tactics to achieve this are
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_simp›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_simp›</span></span></span></span>; a more detailed explanation of their
  behaviour is given below. The tactics can be given optional arguments to
  fine-tune their behaviour. By default, they use a weaker but faster form of
  transfer using rewriting; the option <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>robust›</span></span></span></span>, however, forces them to
  use the slower but more powerful transfer of Isabelle's lifting package. A
  second option <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>no_interp›</span></span></span></span> suppresses the re-interpretation of state
  spaces in order to eradicate record for tuple types prior to automatic proof.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In addition to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_simp›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_simp›</span></span></span></span>, we also provide the
  tactics <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_auto›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_auto›</span></span></span></span>, as well as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_blast›</span></span></span></span>
  and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_blast›</span></span></span></span>; they, in essence, sequence the simplification tactics
  with the methods <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> auto<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> blast<span class="antiquote"><span class="antiquote">}</span></span></span></span>, respectively.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Theorem Attributes ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following named attributes have to be introduced already here since our
  tactics must be able to see them. Note that we do not want to import the
  theories <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>utp_pred›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>utp_rel›</span></span></span></span> here, so that both can
  potentially already make use of the tactics we define in this theory.
›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> upred_defs <span class="quoted">"upred definitional theorems"</span>
<span class="keyword1"><span class="command">named_theorems</span></span> urel_defs <span class="quoted">"urel definitional theorems"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Generic Methods ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We set up several automatic tactics that recast theorems on UTP predicates
  into equivalent HOL predicates, eliminating artefacts of the mechanisation
  as much as this is possible. Our approach is first to unfold all relevant
  definition of the UTP predicate model, then perform a transfer, and finally
  simplify by using lens and variable definitions, the split laws of alphabet
  records, and interpretation laws to convert record-based state spaces into
  products. The definition of the respective methods is facilitated by the
  Eisbach tool: we define generic methods that are parametrised by the tactics
  used for transfer, interpretation and subsequent automatic proof. Note that
  the tactics only apply to the head goal.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ \textsf{Generic Predicate Tactics} ›</span></span>

<span class="keyword1"><span class="command">method</span></span> gen_pred_tac <span class="keyword2"><span class="keyword">methods</span></span> transfer_tac interp_tac prove_tac <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">upred_defs</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span>
  <span class="main">(</span><span class="operator">transfer_tac</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff
    <span class="dynamic"><span class="dynamic">lens_defs</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> <span class="dynamic"><span class="dynamic">alpha_splits</span></span> Product_Type.split_beta<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
  <span class="main">(</span><span class="operator">interp_tac</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">;</span></span>
  <span class="main">(</span><span class="operator">prove_tac</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ \textsf{Generic Relational Tactics} ›</span></span>

<span class="keyword1"><span class="command">method</span></span> gen_rel_tac <span class="keyword2"><span class="keyword">methods</span></span> transfer_tac interp_tac prove_tac <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> <span class="dynamic"><span class="dynamic">urel_defs</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span>
  <span class="main">(</span><span class="operator">transfer_tac</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff relcomp_unfold OO_def
    <span class="dynamic"><span class="dynamic">lens_defs</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> <span class="dynamic"><span class="dynamic">alpha_splits</span></span> Product_Type.split_beta<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
  <span class="main">(</span><span class="operator">interp_tac</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">;</span></span>
  <span class="main">(</span><span class="operator">prove_tac</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Transfer Tactics ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Next, we define the component tactics used for transfer. ›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Robust Transfer ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Robust transfer uses the transfer method of the lifting package. ›</span></span>

<span class="keyword1"><span class="command">method</span></span> slow_uexpr_transfer <span class="main">=</span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Faster Transfer ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Fast transfer side-steps the use of the (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> transfer<span class="antiquote"><span class="antiquote">}</span></span></span></span>) method in favour
  of plain rewriting with the underlying <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rep_eq_...›</span></span></span></span> laws of lifted
  definitions. For moderately complex terms, surprisingly, the transfer step
  turned out to be a bottle-neck in some proofs; we observed that faster
  transfer resulted in a speed-up of approximately 30\% when building the UTP
  theory heaps. On the downside, tactics using faster transfer do not always
  work but merely in about 95\% of the cases. The approach typically works well
  when proving predicate equalities and refinements conjectures.

  A known limitation is that the faster tactic, unlike lifting transfer, does
  not turn free variables into meta-quantified ones. This can, in some cases,
  interfere with the interpretation step and cause subsequent application of
  automatic proof tactics to fail. A fix is in progress [TODO].
›</span></span>
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹ Attribute Setup ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first configure a dynamic attribute <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>uexpr_rep_eq_thms›</span></span></span></span> to
  automatically collect all <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rep_eq_›</span></span></span></span> laws of lifted definitions on the
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> uexpr<span class="antiquote"><span class="antiquote">}</span></span></span></span> type.
›</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"uexpr_rep_eq.ML"</span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹
  Global_Theory.add_thms_dynamic <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> uexpr_rep_eq_thms<span class="antiquote">}</span></span></span><span class="main">,</span>
    <span class="entity">uexpr_rep_eq.get_uexpr_rep_eq_thms</span> o Context.theory_of<span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We next configure a command <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> update_uexpr_rep_eq_thms<span class="antiquote"><span class="antiquote">}</span></span></span></span> in order to
  update the content of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>uexpr_rep_eq_thms›</span></span></span></span> attribute. Although the
  relevant theorems are collected automatically, for efficiency reasons, the
  user has to manually trigger the update process. The command must hence be
  executed whenever new lifted definitions for type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> uexpr<span class="antiquote"><span class="antiquote">}</span></span></span></span> are created.
  The updating mechanism uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> find_theorems<span class="antiquote"><span class="antiquote">}</span></span></span></span> under the hood.
›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
  <span class="entity">Outer_Syntax.command</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">command_keyword</span> <span class="keyword1">update_uexpr_rep_eq_thms</span><span class="antiquote">}</span></span></span>
    <span class="inner_quoted">"reread and update content of the uexpr_rep_eq_thms attribute"</span>
    <span class="main">(</span>Scan.succeed <span class="main">(</span><span class="entity">Toplevel.theory</span> <span class="entity">uexpr_rep_eq.read_uexpr_rep_eq_thms</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span> <span class="comment1">― ‹ Read <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> [source] <span class="dynamic"><span class="dynamic">uexpr_rep_eq_thms</span></span><span class="antiquote">}</span></span> here. ›</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we require several named-theorem attributes to record the manual
  transfer laws and extra simplifications, so that the user can dynamically
  extend them in child theories.
›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> uexpr_transfer_laws <span class="quoted">"uexpr transfer laws"</span>

<span class="keyword1"><span class="command">declare</span></span> uexpr_eq_iff <span class="main">[</span><span class="operator">uexpr_transfer_laws</span><span class="main">]</span>
<span class="comment1">(*&lt;*)</span><span class="comment1">(* declare uexpr_ref_iff [uexpr_transfer_laws] *)</span><span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">named_theorems</span></span> uexpr_transfer_extra <span class="quoted">"extra simplifications for uexpr transfer"</span>
  
<span class="keyword1"><span class="command">declare</span></span> unrest_uexpr.rep_eq <span class="main">[</span><span class="operator">uexpr_transfer_extra</span><span class="main">]</span>
  usedBy_uexpr.rep_eq <span class="main">[</span><span class="operator">uexpr_transfer_extra</span><span class="main">]</span>
  utp_expr.numeral_uexpr_rep_eq <span class="main">[</span><span class="operator">uexpr_transfer_extra</span><span class="main">]</span>
  utp_expr.less_eq_uexpr.rep_eq <span class="main">[</span><span class="operator">uexpr_transfer_extra</span><span class="main">]</span>
  Abs_uexpr_inverse <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">uexpr_transfer_extra</span><span class="main">]</span>
  Rep_uexpr_inverse <span class="main">[</span><span class="operator">uexpr_transfer_extra</span><span class="main">]</span>
  
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹ Tactic Definition ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We have all ingredients now to define the fast transfer tactic as a single
  simplification step.
›</span></span>

<span class="keyword1"><span class="command">method</span></span> fast_uexpr_transfer <span class="main">=</span>
  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_transfer_laws</span></span> <span class="dynamic"><span class="dynamic">uexpr_rep_eq_thms</span></span> <span class="dynamic"><span class="dynamic">uexpr_transfer_extra</span></span><span class="main">)</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Interpretation ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The interpretation of record state spaces as products is done using the laws
  provided by the utility theory \emph{Interp}. Note that this step can be
  suppressed by using the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>no_interp›</span></span></span></span> option.
›</span></span>

<span class="keyword1"><span class="command">method</span></span> uexpr_interp_tac <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_interp_laws</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ User Tactics ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we finally set-up the six user tactics: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_simp›</span></span></span></span>,
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_simp›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_auto›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_auto›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred_blast›</span></span></span></span>
  and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rel_blast›</span></span></span></span>. For this, we first define the proof strategies that
  are to be applied \emph{after} the transfer steps.
›</span></span>

<span class="keyword1"><span class="command">method</span></span> utp_simp_tac <span class="main">=</span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>
<span class="keyword1"><span class="command">method</span></span> utp_auto_tac <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> utp_blast_tac <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The ML file below provides ML constructor functions for tactics that process
  arguments suitable and invoke the generic methods <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> gen_pred_tac<span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> gen_rel_tac<span class="antiquote"><span class="antiquote">}</span></span></span></span> with suitable arguments.
›</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">"utp_tactics.ML"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we execute the relevant outer commands for method setup. Sadly,
  this cannot be done at the level of Eisbach since the latter does not
  provide a convenient mechanism to process symbolic flags as arguments.
  It may be worth to put in a feature request with the developers of the
  Eisbach tool.
›</span></span>

<span class="keyword1"><span class="command">method_setup</span></span> pred_simp <span class="main">=</span> <span class="quoted">‹
  <span class="main">(</span>Scan.lift <span class="entity">UTP_Tactics.scan_args</span><span class="main">)</span> &gt;&gt;
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">args</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prove_tac</span> <span class="main">=</span> <span class="entity">Basic_Tactics.utp_simp_tac</span> <span class="keyword2"><span class="keyword">in</span></span>
      <span class="main">(</span><span class="entity">UTP_Tactics.inst_gen_pred_tac</span> <span class="entity">args</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> rel_simp <span class="main">=</span> <span class="quoted">‹
  <span class="main">(</span>Scan.lift <span class="entity">UTP_Tactics.scan_args</span><span class="main">)</span> &gt;&gt;
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">args</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prove_tac</span> <span class="main">=</span> <span class="entity">Basic_Tactics.utp_simp_tac</span> <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">UTP_Tactics.inst_gen_rel_tac</span> <span class="entity">args</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> pred_auto <span class="main">=</span> <span class="quoted">‹
  <span class="main">(</span>Scan.lift <span class="entity">UTP_Tactics.scan_args</span><span class="main">)</span> &gt;&gt;
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">args</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prove_tac</span> <span class="main">=</span> <span class="entity">Basic_Tactics.utp_auto_tac</span> <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">UTP_Tactics.inst_gen_pred_tac</span> <span class="entity">args</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> rel_auto <span class="main">=</span> <span class="quoted">‹
  <span class="main">(</span>Scan.lift <span class="entity">UTP_Tactics.scan_args</span><span class="main">)</span> &gt;&gt;
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">args</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prove_tac</span> <span class="main">=</span> <span class="entity">Basic_Tactics.utp_auto_tac</span> <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">UTP_Tactics.inst_gen_rel_tac</span> <span class="entity">args</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> pred_blast <span class="main">=</span> <span class="quoted">‹
  <span class="main">(</span>Scan.lift <span class="entity">UTP_Tactics.scan_args</span><span class="main">)</span> &gt;&gt;
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">args</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prove_tac</span> <span class="main">=</span> <span class="entity">Basic_Tactics.utp_blast_tac</span> <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">UTP_Tactics.inst_gen_pred_tac</span> <span class="entity">args</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> rel_blast <span class="main">=</span> <span class="quoted">‹
  <span class="main">(</span>Scan.lift <span class="entity">UTP_Tactics.scan_args</span><span class="main">)</span> &gt;&gt;
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">args</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prove_tac</span> <span class="main">=</span> <span class="entity">Basic_Tactics.utp_blast_tac</span> <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">UTP_Tactics.inst_gen_rel_tac</span> <span class="entity">args</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
›</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Simpler, one-shot versions of the above tactics, but without the possibility of dynamic arguments. ›</span></span>
  
<span class="keyword1"><span class="command">method</span></span> rel_simp' 
  <span class="keyword2"><span class="keyword">uses</span></span> simp 
  <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> <span class="dynamic"><span class="dynamic">urel_defs</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span> prod.case_eq_if relcomp_unfold <span class="dynamic"><span class="dynamic">uexpr_transfer_laws</span></span> <span class="dynamic"><span class="dynamic">uexpr_transfer_extra</span></span> <span class="dynamic"><span class="dynamic">uexpr_rep_eq_thms</span></span> <span class="dynamic"><span class="dynamic">simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> rel_auto' 
  <span class="keyword2"><span class="keyword">uses</span></span> simp intro elim dest
  <span class="main">=</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">intro</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">elim</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">dest</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> <span class="dynamic"><span class="dynamic">urel_defs</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span> relcomp_unfold <span class="dynamic"><span class="dynamic">uexpr_transfer_laws</span></span> <span class="dynamic"><span class="dynamic">uexpr_transfer_extra</span></span> <span class="dynamic"><span class="dynamic">uexpr_rep_eq_thms</span></span> <span class="dynamic"><span class="dynamic">simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> rel_blast' 
  <span class="keyword2"><span class="keyword">uses</span></span> simp intro elim dest
  <span class="main">=</span> <span class="main">(</span><span class="operator">rel_simp'</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">intro</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">elim</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">dest</span></span><span class="main">)</span>
  
<span class="keyword1"><span class="command">text_raw</span></span> <span class="quoted"><span class="plain_text">‹ \newpage ›</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="files/uexpr_rep_eq.ML">
<div class="head">
<h1>File ‹uexpr_rep_eq.ML›</h1>
</div>
<pre class="source"><span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* Project: The Isabelle/UTP Proof System                                     *)</span>
<span class="comment1">(* File: uexpr_rep_eq.ML                                                      *)</span>
<span class="comment1">(* Authors: Simon Foster &amp; Frank Zeyda (University of York, UK)               *)</span>
<span class="comment1">(* Emails: simon.foster@york.ac.uk frank.zeyda@york.ac.uk                     *)</span>
<span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* LAST REVIEWED: 2 Mar 2017 *)</span>

<span class="comment1">(* UEXPR_REP_EQ Signature *)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">UEXPR_REP_EQ</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> get_uexpr_rep_eq_thms <span class="main">:</span> theory <span class="main">-&gt;</span> thm list
  <span class="keyword1"><span class="keyword">val</span></span> read_uexpr_rep_eq_thms <span class="main">:</span> theory <span class="main">-&gt;</span> theory
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="comment1">(* uexpr_rep_eq Structure *)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">uexpr_rep_eq</span> <span class="main">:</span> <span class="entity">UEXPR_REP_EQ</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>
  <span class="comment1">(* Theory Data to store the relevant transfer laws. *)</span>

  <span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">UTP_Tactics_Data</span> <span class="main">=</span> Theory_Data <span class="main">(</span>
    <span class="keyword1"><span class="keyword">type</span></span> <span class="entity">T</span> <span class="main">=</span> thm list<span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">empty</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">extend</span> <span class="main">=</span> I<span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">merge</span> <span class="main">=</span> Thm.merge_thms<span class="main">;</span>
  <span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">get_uexpr_rep_eq_thms</span> <span class="main">=</span> UTP_Tactics_Data.get<span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">put_uexpr_rep_eq_thms</span> <span class="main">=</span> UTP_Tactics_Data.put<span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">uexpr_rep_eq_query</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">query_string</span> <span class="main">=</span> <span class="inner_quoted">"name:\"rep_eq\" \"Rep_uexpr ?e = ?t\""</span> <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">Find_Theorems.read_query</span> Position.none <span class="entity">query_string</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">read_uexpr_rep_eq_thms</span> <span class="entity">thy</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt</span> <span class="main">=</span> Proof_Context.init_global <span class="entity">thy</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">facts</span> <span class="main">=</span> <span class="entity">Find_Theorems.find_theorems_cmd</span>
        <span class="entity">ctxt</span> NONE NONE true <span class="entity">uexpr_rep_eq_query</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="main">(</span><span class="entity">put_uexpr_rep_eq_thms</span> <span class="main">(</span>map snd <span class="main">(</span>snd <span class="entity">facts</span><span class="main">)</span><span class="main">)</span> <span class="entity">thy</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span></pre>
</div><div id="files/utp_tactics.ML">
<div class="head">
<h1>File ‹utp_tactics.ML›</h1>
</div>
<pre class="source"><span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* Project: The Isabelle/UTP Proof System                                     *)</span>
<span class="comment1">(* File: utp_tactics.ML                                                       *)</span>
<span class="comment1">(* Authors: Simon Foster &amp; Frank Zeyda (University of York, UK)               *)</span>
<span class="comment1">(* Emails: simon.foster@york.ac.uk frank.zeyda@york.ac.uk                     *)</span>
<span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* LAST REVIEWED: 3 Mar 2017 *)</span>

<span class="comment1">(* Structure List_Util *)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">List_Extra</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">contains</span> <span class="entity">y</span> <span class="main">=</span> List.exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">y</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="comment1">(* Signature BASIC_TACTICS *)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">BASIC_TACTICS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> fast_transfer <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span>
  <span class="keyword1"><span class="keyword">val</span></span> interp_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span>
  <span class="keyword1"><span class="keyword">val</span></span> slow_transfer <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span>
  <span class="keyword1"><span class="keyword">val</span></span> utp_auto_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span>
  <span class="keyword1"><span class="keyword">val</span></span> utp_blast_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span>
  <span class="keyword1"><span class="keyword">val</span></span> utp_simp_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="comment1">(* Structure Basic_Tactics *)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Basic_Tactics</span> <span class="main">:</span> <span class="entity">BASIC_TACTICS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>
  <span class="keyword2"><span class="keyword">local</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">apply_method_noargs</span> <span class="entity">name</span> <span class="entity">ctxt</span> <span class="main">=</span>
      <span class="entity">Method_Closure.apply_method</span> <span class="entity">ctxt</span> <span class="entity">name</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">ctxt</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">slow_transfer</span> <span class="main">=</span> <span class="main">(</span><span class="entity">apply_method_noargs</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> slow_uexpr_transfer<span class="antiquote">}</span></span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fast_transfer</span> <span class="main">=</span> <span class="main">(</span><span class="entity">apply_method_noargs</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> fast_uexpr_transfer<span class="antiquote">}</span></span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">interp_tac</span> <span class="main">=</span> <span class="main">(</span><span class="entity">apply_method_noargs</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> uexpr_interp_tac<span class="antiquote">}</span></span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">utp_simp_tac</span> <span class="main">=</span> <span class="main">(</span><span class="entity">apply_method_noargs</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> utp_simp_tac<span class="antiquote">}</span></span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">utp_auto_tac</span> <span class="main">=</span> <span class="main">(</span><span class="entity">apply_method_noargs</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> utp_auto_tac<span class="antiquote">}</span></span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">utp_blast_tac</span> <span class="main">=</span> <span class="main">(</span><span class="entity">apply_method_noargs</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> utp_blast_tac<span class="antiquote">}</span></span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="comment1">(* Signature UTP_TACTICS *)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">UTP_TACTICS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">type</span></span> <span class="entity">utp_tac_args</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> robustN <span class="main">:</span> string<span class="main">;</span> <span class="keyword1"><span class="keyword">val</span></span> no_interpN <span class="main">:</span> string<span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> scan_args <span class="main">:</span> <span class="entity">utp_tac_args</span> parser
  <span class="keyword1"><span class="keyword">val</span></span> inst_gen_pred_tac <span class="main">:</span> <span class="entity">utp_tac_args</span> <span class="main">-&gt;</span>
    <span class="main">(</span><span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span><span class="main">)</span> <span class="main">-&gt;</span>
    <span class="main">(</span><span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> inst_gen_rel_tac <span class="main">:</span> <span class="entity">utp_tac_args</span> <span class="main">-&gt;</span>
    <span class="main">(</span><span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span><span class="main">)</span> <span class="main">-&gt;</span>
    <span class="main">(</span><span class="entity">Proof.context</span> <span class="main">-&gt;</span> thm list <span class="main">-&gt;</span> <span class="entity">context_tactic</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="comment1">(* Structure UTP_Methods *)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">UTP_Tactics</span> <span class="main">:</span> <span class="entity">UTP_TACTICS</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>
  <span class="keyword1"><span class="keyword">type</span></span> <span class="entity">utp_tac_args</span> <span class="main">=</span> <span class="main">{</span>robust <span class="main">:</span> bool<span class="main">,</span> no_interp <span class="main">:</span> bool<span class="main">}</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">robustN</span> <span class="main">=</span> <span class="inner_quoted">"robust"</span><span class="main">;</span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">no_interpN</span> <span class="main">=</span> <span class="inner_quoted">"no_interp"</span><span class="main">;</span>

  <span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">parse_args</span> <span class="main">(</span><span class="entity">args</span> <span class="main">:</span> string list<span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span>robust <span class="main">=</span> <span class="main">(</span><span class="entity">List_Extra.contains</span> <span class="entity">robustN</span> <span class="entity">args</span><span class="main">)</span><span class="main">,</span>
     no_interp <span class="main">=</span> <span class="main">(</span><span class="entity">List_Extra.contains</span> <span class="entity">no_interpN</span> <span class="entity">args</span><span class="main">)</span><span class="main">}</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">scan_args</span> <span class="main">=</span>
    <span class="main">(</span>Scan.repeat <span class="main">(</span><span class="main">(</span>Args.$$$ <span class="entity">robustN</span><span class="main">)</span> || <span class="main">(</span>Args.$$$ <span class="entity">no_interpN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> &gt;&gt; <span class="entity">parse_args</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">inst_gen_pred_tac</span> <span class="main">(</span><span class="entity">args</span> <span class="main">:</span> <span class="entity">utp_tac_args</span><span class="main">)</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">transfer_tac</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="main">#</span>robust <span class="entity">args</span>
        <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span><span class="entity">Basic_Tactics.slow_transfer</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">Basic_Tactics.fast_transfer</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">interp_tac</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="main">#</span>no_interp <span class="entity">args</span>
        <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span>K <span class="entity">Method.succeed</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">Basic_Tactics.interp_tac</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="entity">Method_Closure.apply_method</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> gen_pred_tac<span class="antiquote">}</span></span>
        <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="entity">transfer_tac</span><span class="main">,</span> <span class="entity">interp_tac</span><span class="main">,</span> <span class="entity">prove_tac</span><span class="main">]</span> <span class="entity">ctxt</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">inst_gen_rel_tac</span> <span class="main">(</span><span class="entity">args</span> <span class="main">:</span> <span class="entity">utp_tac_args</span><span class="main">)</span> <span class="entity">prove_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">transfer_tac</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="main">#</span>robust <span class="entity">args</span>
        <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span><span class="entity">Basic_Tactics.slow_transfer</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">Basic_Tactics.fast_transfer</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">interp_tac</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="main">#</span>no_interp <span class="entity">args</span>
        <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span>K <span class="entity">Method.succeed</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">Basic_Tactics.interp_tac</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="entity">Method_Closure.apply_method</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">method</span> gen_rel_tac<span class="antiquote">}</span></span>
        <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="entity">transfer_tac</span><span class="main">,</span> <span class="entity">interp_tac</span><span class="main">,</span> <span class="entity">prove_tac</span><span class="main">]</span> <span class="entity">ctxt</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span></pre>
</div><div id="utp_meta_subst">
<div class="head">
<h1>Theory utp_meta_subst</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Meta-level Substitution ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_meta_subst
<span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_subst.html">utp_subst</a> <a href="utp_tactics.html">utp_tactics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Meta substitution substitutes a HOL variable in a UTP expression for another UTP expression.
  It is analogous to UTP substitution, but acts on functions. ›</span></span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> msubst <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">F</span> <span class="bound">v</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">F</span> <span class="main">(</span><span class="bound">v</span> <span class="bound">b</span><span class="main">)</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span> <span class="comment1">― ‹ Reread <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">rep_eq</span><span class="antiquote">}</span></span> theorems. ›</span>
    
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_msubst"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">⟦</span>_<span class="keyword1">→</span>_<span class="keyword1">⟧</span><span class="keyword3">)</span>"</span> <span class="main">[</span>990<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 991<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_msubst <span class="free">P</span> <span class="free">x</span> <span class="free">v</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> msubst <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="free">v</span>"</span>
     
<span class="keyword1" id="utp_meta_subst-msubst_lit"><span class="command">lemma</span></span> msubst_lit <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="bound">x</span><span class="main">»</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_const"><span class="command">lemma</span></span> msubst_const <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span> 

<span class="keyword1" id="utp_meta_subst-msubst_pair"><span class="command">lemma</span></span> msubst_pair <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span> <span class="main">→</span> <span class="free">e</span><span class="main">⟧</span><span class="main">⟦</span><span class="bound">y</span> <span class="main">→</span> <span class="free">f</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_lit_2_1"><span class="command">lemma</span></span> msubst_lit_2_1 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="bound">x</span><span class="main">»</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">⟧</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_lit_2_2"><span class="command">lemma</span></span> msubst_lit_2_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="bound">y</span><span class="main">»</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">⟧</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_lit'"><span class="command">lemma</span></span> msubst_lit' <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">y</span><span class="main">»</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_lit'_2"><span class="command">lemma</span></span> msubst_lit'_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">z</span><span class="main">»</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">«</span><span class="free">z</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
 
<span class="keyword1" id="utp_meta_subst-msubst_uop"><span class="command">lemma</span></span> msubst_uop <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uop <span class="free">f</span> <span class="main">(</span><span class="free">v</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span> <span class="main">=</span> uop <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_uop_2"><span class="command">lemma</span></span> msubst_uop_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uop <span class="free">f</span> <span class="main">(</span><span class="free">v</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span> <span class="main">=</span> uop <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">pred_simp</span><span class="main">)</span>
 
<span class="keyword1" id="utp_meta_subst-msubst_bop"><span class="command">lemma</span></span> msubst_bop <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bop <span class="free">f</span> <span class="main">(</span><span class="free">v</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span> <span class="main">=</span> bop <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_bop_2"><span class="command">lemma</span></span> msubst_bop_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bop <span class="free">f</span> <span class="main">(</span><span class="free">v</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span> <span class="main">=</span> bop <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_var"><span class="command">lemma</span></span> msubst_var <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>utp_expr.var <span class="free">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">y</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span> <span class="main">=</span> utp_expr.var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_meta_subst-msubst_var_2"><span class="command">lemma</span></span> msubst_var_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>utp_expr.var <span class="free">x</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">→</span><span class="free">u</span><span class="main">⟧</span> <span class="main">=</span> utp_expr.var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        
<span class="keyword1" id="utp_meta_subst-msubst_unrest"><span class="command">lemma</span></span> msubst_unrest <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">v</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">v</span><span class="main">)</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">v</span><span class="main">)</span><span class="main">⟦</span><span class="bound">v</span><span class="main">→</span><span class="free">k</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_pred">
<div class="head">
<h1>Theory utp_pred</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Alphabetised Predicates ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_pred
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="utp_expr_funcs.html">utp_expr_funcs</a>
  <a href="utp_subst.html">utp_subst</a>
  <a href="utp_meta_subst.html">utp_meta_subst</a>
  <a href="utp_tactics.html">utp_tactics</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In this theory we begin to create an Isabelle version of the alphabetised predicate calculus
  that is described in Chapter 1 of the UTP book~\cite{Hoare&amp;98}. ›</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Predicate type and syntax ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ An alphabetised predicate is a simply a boolean valued expression. ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> upred <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'α</span></span> upred"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree"><span class="free">'α</span></span><span class="main">)</span> uexpr"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We want to remain as close as possible to the mathematical UTP syntax, but also
        want to be conservative with HOL. For this reason we chose not to steal syntax
        from HOL, but where possible use polymorphism to allow selection of the appropriate
        operator (UTP vs. HOL). Thus we will first remove the standard syntax for conjunction,
        disjunction, and negation, and replace these with adhoc overloaded definitions. We
        similarly use polymorphic constants for the other predicate calculus operators. ›</span></span>

<span class="keyword1"><span class="command">purge_notation</span></span>
  conj <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧</span>"</span> 35<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  disj <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨</span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Not <span class="main">(</span><span class="quoted">"<span class="keyword1">¬</span> _"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span>

<span class="keyword1"><span class="command">consts</span></span>
  utrue  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">true</span>"</span><span class="main">)</span>
  ufalse <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">false</span>"</span><span class="main">)</span>
  uconj  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧</span>"</span> 35<span class="main">)</span>
  udisj  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨</span>"</span> 30<span class="main">)</span>
  uimpl  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⇒</span>"</span> 25<span class="main">)</span>
  uiff   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⇔</span>"</span> 25<span class="main">)</span>
  unot   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">¬</span> _"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span>
  uex    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span>
  uall   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span>
  ushEx  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'p</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span>
  ushAll <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'p</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span>
  
<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  uconj <span class="quoted">conj</span> <span class="keyword2"><span class="keyword">and</span></span>
  udisj <span class="quoted">disj</span> <span class="keyword2"><span class="keyword">and</span></span>
  unot <span class="quoted">Not</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up two versions of each of the quantifiers: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> uex<span class="antiquote"><span class="antiquote">}</span></span></span></span> / <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> uall<span class="antiquote"><span class="antiquote">}</span></span></span></span> and
        <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ushEx<span class="antiquote"><span class="antiquote">}</span></span></span></span> / <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ushAll<span class="antiquote"><span class="antiquote">}</span></span></span></span>. The former pair allows quantification of UTP variables,
        whilst the latter allows quantification of HOL variables in concert with the literal
        expression constructor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">«</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">»</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Both varieties will be needed at various points. 
        Syntactically they are distinguished by a boldface quantifier
        for the HOL versions (achieved by the "bold" escape in Isabelle). ›</span></span>

<span class="keyword1"><span class="command">nonterminal</span></span> idt_list

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_idt_el"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> idt_list"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_idt_list"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> idt_list <span class="main">⇒</span> idt_list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 1<span class="main">]</span><span class="main">)</span>
  <span class="quoted">"_uex"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∃</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_uall"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∀</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushEx"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∃</b></span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushAll"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushBEx"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∃</b></span> _ <span class="keyword1">∈</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushBAll"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span> _ <span class="keyword1">∈</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushGAll"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushGtAll"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span> _ <span class="keyword1">&gt;</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_ushLtAll"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span> _ <span class="keyword1">&lt;</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_uvar_res"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> salpha <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span>"</span> 90<span class="main">)</span>
  
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_uex <span class="free">x</span> <span class="free">P</span>"</span>                   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uex <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_uex <span class="main">(</span>_salphaset <span class="main">(</span>_salphamk <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span>  <span class="main">&lt;=</span> <span class="quoted">"_uex <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="free">P</span>"</span>
  <span class="quoted">"_uall <span class="free">x</span> <span class="free">P</span>"</span>                  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uall <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_uall <span class="main">(</span>_salphaset <span class="main">(</span>_salphamk <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span>  <span class="main">&lt;=</span> <span class="quoted">"_uall <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span> <span class="free">P</span>"</span>
  <span class="quoted">"_ushEx <span class="free">x</span> <span class="free">P</span>"</span>                 <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> ushEx <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">P</span>"</span>                <span class="main">=&gt;</span> <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="free">x</span> <span class="main">∙</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">P</span>"</span>
  <span class="quoted">"_ushAll <span class="free">x</span> <span class="free">P</span>"</span>                <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> ushAll <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">P</span>"</span>                <span class="main">=&gt;</span> <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">∙</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span> <span class="main">⇒</span> <span class="free">P</span>"</span>
  <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Q</span>"</span>                <span class="main">=&gt;</span> <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span>"</span>
  <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">P</span>"</span>                <span class="main">=&gt;</span> <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">∙</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">&gt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span> <span class="main">⇒</span> <span class="free">P</span>"</span>
  <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">P</span>"</span>                <span class="main">=&gt;</span> <span class="quoted">"<span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="free">x</span> <span class="main">∙</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span> <span class="main">⇒</span> <span class="free">P</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Predicate operators ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We chose to maximally reuse definitions and laws built into HOL. For this reason,
        when introducing the core operators we proceed by lifting operators from the
        polymorphic algebraic hierarchy of HOL. Thus the initial definitions take
        place in the context of type class instantiations. We first introduce our own
        class called \emph{refine} that will add the refinement operator syntax to
        the HOL partial order class. ›</span></span>

<span class="keyword1"><span class="command">class</span></span> refine <span class="main">=</span> order

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">refineBy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refine <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> less_eq <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Since, on the whole, lattices in UTP are the opposite way up to the standard definitions
        in HOL, we syntactically invert the lattice operators. This is the one exception where
        we do steal HOL syntax, but I think it makes sense for UTP. Indeed we make this
        inversion for all of the lattice operators. ›</span></span>

<span class="keyword1"><span class="command">purge_notation</span></span> Lattices.inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Lattices.inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 70<span class="main">)</span>
<span class="keyword1"><span class="command">purge_notation</span></span> Lattices.sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Lattices.sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 65<span class="main">)</span>
  
<span class="keyword1"><span class="command">purge_notation</span></span> Inf <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Inf <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
<span class="keyword1"><span class="command">purge_notation</span></span> Sup <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Sup <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
  
<span class="keyword1"><span class="command">purge_notation</span></span> Orderings.bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Orderings.bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">purge_notation</span></span> Orderings.top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Orderings.top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">purge_syntax</span></span>
  <span class="quoted">"_INF1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_INF"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_SUP1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_SUP"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_INF1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_INF"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_SUP1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_SUP"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We trivially instantiate our refinement class ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">refine</span> <span class="keyword1"><span class="command">..</span></span>

<span class="comment1">― ‹ Configure transfer law for refinement for the fast relational tactics. ›</span>

<span class="keyword1"><span class="command">theorem</span></span> upred_ref_iff <span class="main">[</span><span class="operator">uexpr_transfer_laws</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span> <span class="main">⟶</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Next we introduce the lattice operators, which is again done by lifting. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">lattice</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span> <span class="bound">Q</span> <span class="bound">A</span><span class="main">.</span> Lattices.sup <span class="main">(</span><span class="bound">P</span> <span class="bound">A</span><span class="main">)</span> <span class="main">(</span><span class="bound">Q</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span> <span class="bound">Q</span> <span class="bound">A</span><span class="main">.</span> Lattices.inf <span class="main">(</span><span class="bound">P</span> <span class="bound">A</span><span class="main">)</span> <span class="main">(</span><span class="bound">Q</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">bounded_lattice</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> Orderings.bot"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> Orderings.top"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="utp_pred-top_uexpr_rep_eq"><span class="command">lemma</span></span> top_uexpr_rep_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Orderings.bot<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">b</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-bot_uexpr_rep_eq"><span class="command">lemma</span></span> bot_uexpr_rep_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Orderings.top<span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">b</span> <span class="main">=</span> True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">distrib_lattice</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">distrib_lattice</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Finally we show that predicates form a Boolean algebra (under the lattice operators),
  a complete lattice, a completely distribute lattice, and a complete boolean algebra. This
  equip us with a very complete theory for basic logical propositions. ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">boolean_algebra</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">boolean_algebra</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1 diff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">instantiation</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">complete_lattice</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">complete_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">Inf_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">PS</span> <span class="bound">A</span><span class="main">.</span> <span class="keyword1">INF</span> <span class="bound">P</span><span class="main">∈</span><span class="bound">PS</span><span class="main">.</span> <span class="bound">P</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">Sup_uexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">PS</span> <span class="bound">A</span><span class="main">.</span> <span class="keyword1">SUP</span> <span class="bound">P</span><span class="main">∈</span><span class="bound">PS</span><span class="main">.</span> <span class="bound">P</span><span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> INF_lower SUP_upper <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_greatest SUP_least<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">complete_distrib_lattice</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">complete_distrib_lattice</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_SUP_set<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> uexpr <span class="main">::</span> <span class="main">(</span><span class="quoted">complete_boolean_algebra</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">complete_boolean_algebra</span> <span class="keyword1"><span class="command">..</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ From the complete lattice, we can also define and give syntax for the fixed-point operators. 
  Like the lattice operators, these are reversed in UTP. ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_mu"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">μ</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_nu"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ν</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> gfp <span class="main">(</span><span class="quoted">"<span class="keyword1">μ</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> lfp <span class="main">(</span><span class="quoted">"<span class="keyword1">ν</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">ν</span> <span class="free">X</span> <span class="main">∙</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="keyword1">μ</span> <span class="free">X</span> <span class="main">∙</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> gfp <span class="main">(</span><span class="main">λ</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ With the lattice operators defined, we can proceed to give definitions for the
        standard predicate operators in terms of them. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">true_upred</span>  <span class="main">=</span> <span class="main">(</span>Orderings.top <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">false_upred</span> <span class="main">=</span> <span class="main">(</span>Orderings.bot <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">conj_upred</span>  <span class="main">=</span> <span class="main">(</span>Lattices.inf <span class="main">::</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">disj_upred</span>  <span class="main">=</span> <span class="main">(</span>Lattices.sup <span class="main">::</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">not_upred</span>   <span class="main">=</span> <span class="main">(</span>uminus <span class="main">::</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">diff_upred</span>  <span class="main">=</span> <span class="main">(</span>minus <span class="main">::</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Conj_upred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred set <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⋀</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⋀</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">⨆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Disj_upred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred set <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⋁</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⋁</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">⨅</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  conj_upred <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧<span class="hidden">⇩</span><sub>p</sub></span>"</span> 35<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  disj_upred <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨<span class="hidden">⇩</span><sub>p</sub></span>"</span> 30<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Perhaps slightly confusingly, the UTP infimum is the HOL supremum and vice-versa. This is
  because, again, in UTP the lattice is inverted due to the definition of refinement and a desire
  to have miracle at the top, and abort at the bottom. ›</span></span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> UINF <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>complete_lattice<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">F</span> <span class="bound">b</span><span class="main">.</span> Sup <span class="main">{</span><span class="main">⟦</span><span class="bound">F</span> <span class="bound">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="bound">b</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">P</span> <span class="bound">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> USUP <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>complete_lattice<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">F</span> <span class="bound">b</span><span class="main">.</span> Inf <span class="main">{</span><span class="main">⟦</span><span class="bound">F</span> <span class="bound">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="bound">b</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">P</span> <span class="bound">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_USup"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>            <span class="main">(</span><span class="quoted">"<span class="keyword1">⋀</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_USup"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>            <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_USup_mem"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⋀</span> _ <span class="keyword1">∈</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_USup_mem"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span> _ <span class="keyword1">∈</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_USUP"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⋀</span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_USUP"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_UInf"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>            <span class="main">(</span><span class="quoted">"<span class="keyword1">⋁</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_UInf"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>            <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_UInf_mem"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⋁</span> _ <span class="keyword1">∈</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_UInf_mem"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span> _ <span class="keyword1">∈</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_UINF"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⋁</span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_UINF"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> UINF <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">F</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">F</span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="keyword1">true</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">F</span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="keyword1">true</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> UINF <span class="main">(</span><span class="main">λ</span> <span class="free">y</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">F</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⨅</span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> UINF <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> USUP <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">F</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">F</span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">|</span> <span class="keyword1">true</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">|</span> <span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">|</span> <span class="main">«</span><span class="free">y</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">∙</span> <span class="free">F</span>"</span>
  <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> USUP <span class="main">(</span><span class="main">λ</span> <span class="free">y</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">F</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⨆</span> <span class="free">x</span> <span class="main">|</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> USUP <span class="main">(</span><span class="main">λ</span> <span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="free">F</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also define the other predicate operators ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> impl<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">A</span> <span class="main">⟶</span> <span class="bound">Q</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> iff_upred <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">A</span> <span class="main">⟷</span> <span class="bound">Q</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> ex <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">P</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">P</span><span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> shEx <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span> <span class="main">⇒</span><span class="tfree">'α</span> upred<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">A</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> all <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">P</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">P</span><span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> shAll <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span> <span class="main">⇒</span><span class="tfree">'α</span> upred<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">A</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define the following operator which is dual of existential quantification. It hides the
  valuation of variables other than $x$ through existential quantification. ›</span></span>
    
<span class="keyword1"><span class="command">lift_definition</span></span> var_res <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b'</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">b'</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">b</span> <span class="keyword1">on</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_uvar_res <span class="free">P</span> <span class="free">a</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> var_res <span class="free">P</span> <span class="free">a</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We have to add a u subscript to the closure operator as I don't want to override the syntax
        for HOL lists (we'll be using them later). ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> closure<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">A'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> taut <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">`</span>_<span class="keyword1">`</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Configuration for UTP tactics ›</span></span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span> <span class="comment1">― ‹ Reread <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">rep_eq</span><span class="antiquote">}</span></span> theorems. ›</span>

<span class="keyword1"><span class="command">declare</span></span> utp_pred.taut.rep_eq <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  utrue <span class="quoted"><span class="quoted">"true_upred"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  ufalse <span class="quoted"><span class="quoted">"false_upred"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  unot <span class="quoted"><span class="quoted">"not_upred"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  uconj <span class="quoted"><span class="quoted">"conj_upred"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  udisj <span class="quoted"><span class="quoted">"disj_upred"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  uimpl <span class="quoted">impl</span> <span class="keyword2"><span class="keyword">and</span></span>
  uiff <span class="quoted">iff_upred</span> <span class="keyword2"><span class="keyword">and</span></span>
  uex <span class="quoted">ex</span> <span class="keyword2"><span class="keyword">and</span></span>
  uall <span class="quoted">all</span> <span class="keyword2"><span class="keyword">and</span></span>
  ushEx <span class="quoted">shEx</span> <span class="keyword2"><span class="keyword">and</span></span>
  ushAll <span class="quoted">shAll</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uneq"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≠<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_unmem"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∉<span class="hidden">⇩</span><sub>u</sub></span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">≠<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> unot <span class="main">(</span><span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="free">x</span> <span class="keyword1">∉<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> unot <span class="main">(</span><span class="keyword1">CONST</span> bop <span class="main">(∈)</span> <span class="free">x</span> <span class="free">A</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">declare</span></span> true_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> false_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> conj_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> disj_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> not_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> diff_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> subst_upd_uvar_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> cond_subst_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> par_subst_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> subst_del_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> unrest_usubst_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>

<span class="keyword1" id="utp_pred-true_alt_def"><span class="command">lemma</span></span> true_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="main">=</span> <span class="main">«</span>True<span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-false_alt_def"><span class="command">lemma</span></span> false_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="main">=</span> <span class="main">«</span>False<span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> true_alt_def<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> false_alt_def<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction Laws ›</span></span>

<span class="keyword1" id="utp_pred-unrest_allE"><span class="command">lemma</span></span> unrest_allE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> <span class="free">P</span> <span class="main">=</span> <span class="keyword1">true</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">;</span> <span class="free">P</span> <span class="main">=</span> <span class="keyword1">false</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
  
<span class="keyword1" id="utp_pred-unrest_true"><span class="command">lemma</span></span> unrest_true <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_false"><span class="command">lemma</span></span> unrest_false <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_conj"><span class="command">lemma</span></span> unrest_conj <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_disj"><span class="command">lemma</span></span> unrest_disj <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_UINF"><span class="command">lemma</span></span> unrest_UINF <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_USUP"><span class="command">lemma</span></span> unrest_USUP <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_UINF_mem"><span class="command">lemma</span></span> unrest_UINF_mem <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_USUP_mem"><span class="command">lemma</span></span> unrest_USUP_mem <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_impl"><span class="command">lemma</span></span> unrest_impl <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_iff"><span class="command">lemma</span></span> unrest_iff <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span> <span class="main">⇔</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_not"><span class="command">lemma</span></span> unrest_not <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The sublens proviso can be thought of as membership below. ›</span></span>

<span class="keyword1" id="utp_pred-unrest_ex_in"><span class="command">lemma</span></span> unrest_ex_in <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> sublens_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> lens_plus_ub <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> lens_plus_right_sublens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> comp_wb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> comp_mwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> plus_mwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="utp_pred-unrest_ex_diff"><span class="command">lemma</span></span> unrest_ex_diff <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lens_indep_comm 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  
<span class="keyword1" id="utp_pred-unrest_all_in"><span class="command">lemma</span></span> unrest_all_in <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_all_diff"><span class="command">lemma</span></span> unrest_all_diff <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_var_res_diff"><span class="command">lemma</span></span> unrest_var_res_diff <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> x<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_var_res_in"><span class="command">lemma</span></span> unrest_var_res_in <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> x<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mwb_lens_weak weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred-unrest_shEx"><span class="command">lemma</span></span> unrest_shEx <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_shAll"><span class="command">lemma</span></span> unrest_shAll <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-unrest_closure"><span class="command">lemma</span></span> unrest_closure <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">[</span><span class="free">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Used-by laws ›</span></span>

<span class="keyword1" id="utp_pred-usedBy_not"><span class="command">lemma</span></span> usedBy_not <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred-usedBy_conj"><span class="command">lemma</span></span> usedBy_conj <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-usedBy_disj"><span class="command">lemma</span></span> usedBy_disj <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-usedBy_impl"><span class="command">lemma</span></span> usedBy_impl <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-usedBy_iff"><span class="command">lemma</span></span> usedBy_iff <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♮</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♮</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♮</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇔</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution Laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Substitution is monotone ›</span></span>

<span class="keyword1" id="utp_pred-subst_mono"><span class="command">lemma</span></span> subst_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_true"><span class="command">lemma</span></span> subst_true <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_false"><span class="command">lemma</span></span> subst_false <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="keyword1">false</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_not"><span class="command">lemma</span></span> subst_not <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_impl"><span class="command">lemma</span></span> subst_impl <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">⇒</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_iff"><span class="command">lemma</span></span> subst_iff <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇔</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">⇔</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_disj"><span class="command">lemma</span></span> subst_disj <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">∨</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_conj"><span class="command">lemma</span></span> subst_conj <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred-subst_sup"><span class="command">lemma</span></span> subst_sup <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">⊓</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_inf"><span class="command">lemma</span></span> subst_inf <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">⊔</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_UINF"><span class="command">lemma</span></span> subst_UINF <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_USUP"><span class="command">lemma</span></span> subst_USUP <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_closure"><span class="command">lemma</span></span> subst_closure <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">[</span><span class="free">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">[</span><span class="free">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_shEx"><span class="command">lemma</span></span> subst_shEx <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_shAll"><span class="command">lemma</span></span> subst_shAll <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ TODO: Generalise the quantifier substitution laws to n-ary substitutions ›</span></span>

<span class="keyword1" id="utp_pred-subst_ex_same"><span class="command">lemma</span></span> subst_ex_same <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_ex_same'"><span class="command">lemma</span></span> subst_ex_same' <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="main">∃</span> <span class="main">&amp;</span>x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">∃</span> <span class="main">&amp;</span>x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred-subst_ex_indep"><span class="command">lemma</span></span> subst_ex_indep <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lens_indep_comm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred-subst_ex_unrest"><span class="command">lemma</span></span> subst_ex_unrest <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_all_same"><span class="command">lemma</span></span> subst_all_same <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_subst subst_unrest unrest_all_in<span class="main">)</span>

<span class="keyword1" id="utp_pred-subst_all_indep"><span class="command">lemma</span></span> subst_all_indep <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_true"><span class="command">lemma</span></span> msubst_true <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_false"><span class="command">lemma</span></span> msubst_false <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
<span class="keyword1" id="utp_pred-msubst_not"><span class="command">lemma</span></span> msubst_not <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_not_2"><span class="command">lemma</span></span> msubst_not_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred-msubst_disj"><span class="command">lemma</span></span> msubst_disj <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_disj_2"><span class="command">lemma</span></span> msubst_disj_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred-msubst_conj"><span class="command">lemma</span></span> msubst_conj <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_conj_2"><span class="command">lemma</span></span> msubst_conj_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred-msubst_implies"><span class="command">lemma</span></span> msubst_implies <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⇒</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_implies_2"><span class="command">lemma</span></span> msubst_implies_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⇒</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred-msubst_shAll"><span class="command">lemma</span></span> msubst_shAll <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="bound">y</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟦</span><span class="bound">y</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred-msubst_shAll_2"><span class="command">lemma</span></span> msubst_shAll_2 <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span><span class="main">⟦</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sandbox for conjectures ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">utp_sandbox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">TRY'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">TRY(</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> undefined<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">P</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> utp_sandbox <span class="free">P</span>"</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_alphabet">
<div class="head">
<h1>Theory utp_alphabet</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet Manipulation ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_alphabet
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="utp_pred.html">utp_pred</a> <a href="utp_usedby.html">utp_usedby</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Preliminaries ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alphabets are simply types that characterise the state-space of an expression. Thus
  the Isabelle type system ensures that predicates cannot refer to variables not in the alphabet
  as this would be a type error. Often one would like to add or remove additional variables, for 
  example if we wish to have a predicate which ranges only a smaller state-space, and then
  lift it into a predicate over a larger one. This is useful, for example, when dealing with
  relations which refer only to undashed variables (conditions) since we can use the type system
  to ensure well-formedness. 

  In this theory we will set up operators for extending and contracting and alphabet. 
  We first set up a theorem attribute for alphabet laws and a tactic. ›</span></span>
  
<span class="keyword1"><span class="command">named_theorems</span></span> alpha

<span class="keyword1"><span class="command">method</span></span> alpha_tac <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">alpha</span></span> <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet Extrusion ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alter an alphabet by application of a lens that demonstrates how the smaller alphabet
  ($\beta$) injects into the larger alphabet ($\alpha$). This changes the type of the expression
  so it is parametrised over the large alphabet. We do this by using the lens \emph{get}
  function to extract the smaller state binding, and then apply this to the expression. 

  We call this "extrusion" rather than "extension" because if the extension lens is bijective
  then it does not extend the alphabet. Nevertheless, it does have an effect because the type
  will be different which can be useful when converting predicates with equivalent alphabets. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> aext <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> lens <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span>"</span> 95<span class="main">)</span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Next we prove some of the key laws. Extending an alphabet twice is equivalent to extending
  by the composition of the two lenses. ›</span></span>
  
<span class="keyword1" id="utp_alphabet-aext_twice"><span class="command">lemma</span></span> aext_twice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The bijective <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> lens identifies the source and view types. Thus an alphabet
  extension using this has no effect. ›</span></span>
    
<span class="keyword1" id="utp_alphabet-aext_id"><span class="command">lemma</span></span> aext_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Literals do not depend on any variables, and thus applying an alphabet extension only
  alters the predicate's type, and not its valuation .›</span></span>
    
<span class="keyword1" id="utp_alphabet-aext_lit"><span class="command">lemma</span></span> aext_lit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_zero"><span class="command">lemma</span></span> aext_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_one"><span class="command">lemma</span></span> aext_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_numeral"><span class="command">lemma</span></span> aext_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_true"><span class="command">lemma</span></span> aext_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_false"><span class="command">lemma</span></span> aext_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_not"><span class="command">lemma</span></span> aext_not <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_and"><span class="command">lemma</span></span> aext_and <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_or"><span class="command">lemma</span></span> aext_or <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">∨</span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_imp"><span class="command">lemma</span></span> aext_imp <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">⇒</span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_iff"><span class="command">lemma</span></span> aext_iff <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇔</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">⇔</span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_alphabet-aext_shAll"><span class="command">lemma</span></span> aext_shAll <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_UINF_ind"><span class="command">lemma</span></span> aext_UINF_ind <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span><span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_UINF_mem"><span class="command">lemma</span></span> aext_UINF_mem <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span><span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet extension distributes through the function liftings. ›</span></span>
    
<span class="keyword1" id="utp_alphabet-aext_uop"><span class="command">lemma</span></span> aext_uop <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uop <span class="free">f</span> <span class="free">u</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> uop <span class="free">f</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_bop"><span class="command">lemma</span></span> aext_bop <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> bop <span class="free">f</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_trop"><span class="command">lemma</span></span> aext_trop <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> trop <span class="free">f</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_qtop"><span class="command">lemma</span></span> aext_qtop <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qtop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> qtop <span class="free">f</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_plus"><span class="command">lemma</span></span> aext_plus <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_minus"><span class="command">lemma</span></span> aext_minus <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_uminus"><span class="command">lemma</span></span> aext_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_times"><span class="command">lemma</span></span> aext_times <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_divide"><span class="command">lemma</span></span> aext_divide <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Extending a variable expression over $x$ is equivalent to composing $x$ with the alphabet,
  thus effectively yielding a variable whose source is the large alphabet. ›</span></span>
    
<span class="keyword1" id="utp_alphabet-aext_var"><span class="command">lemma</span></span> aext_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"var <span class="free">x</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> var <span class="main">(</span><span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_ulambda"><span class="command">lemma</span></span> aext_ulambda <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet extension is monotonic and continuous. ›</span></span>
    
<span class="keyword1" id="utp_alphabet-aext_mono"><span class="command">lemma</span></span> aext_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_cont"><span class="command">lemma</span></span> aext_cont <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">P</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span>  <span class="bound">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
   
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If a variable is unrestricted in a predicate, then the extended variable is unrestricted
  in the predicate with an alphabet extension. ›</span></span>
    
<span class="keyword1" id="utp_alphabet-unrest_aext"><span class="command">lemma</span></span> unrest_aext <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">a</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">p</span> <span class="main">⟧</span> <span class="main">⟹</span> unrest <span class="main">(</span><span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If a given variable (or alphabet) $b$ is independent of the extension lens $a$, that is, it is
  outside the original state-space of $p$, then it follows that once $p$ is extended by $a$ then
  $b$ cannot be restricted. ›</span></span>
    
<span class="keyword1" id="utp_alphabet-unrest_aext_indep"><span class="command">lemma</span></span> unrest_aext_indep <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span> <span class="main">⟹</span> b <span class="main">♯</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Expression Alphabet Restriction ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Restrict an alphabet by application of a lens that demonstrates how the smaller alphabet
  ($\beta$) injects into the larger alphabet ($\alpha$). Unlike extension, this operation
  can lose information if the expressions refers to variables in the larger alphabet. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> arestr <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> lens <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span>"</span> 90<span class="main">)</span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="keyword1">create</span><span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span>

<span class="keyword1" id="utp_alphabet-arestr_id"><span class="command">lemma</span></span> arestr_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_aext"><span class="command">lemma</span></span> arestr_aext <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ If an expression's alphabet can be divided into two disjoint sections and the expression
  does not depend on the second half then restricting the expression to the first half is
  loss-less. ›</span></span>

<span class="keyword1" id="utp_alphabet-aext_arestr"><span class="command">lemma</span></span> aext_arestr <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"bij_lens <span class="main">(</span><span class="free">a</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"b <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_lens_equiv_id lens_equiv_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_lens_def lens_plus_def sublens_def lens_comp_def prod.case_eq_if<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lens_indep_comm mwb_lens_weak weak_lens.put_get<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alternative formulation of the above law using used-by instead of unrestriction. ›</span></span>

<span class="keyword1" id="utp_alphabet-aext_arestr'"><span class="command">lemma</span></span> aext_arestr' <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms lens_override_def usedBy_uexpr.rep_eq<span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_lit"><span class="command">lemma</span></span> arestr_lit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_zero"><span class="command">lemma</span></span> arestr_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_one"><span class="command">lemma</span></span> arestr_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_numeral"><span class="command">lemma</span></span> arestr_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_var"><span class="command">lemma</span></span> arestr_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"var <span class="free">x</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> var <span class="main">(</span><span class="free">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_true"><span class="command">lemma</span></span> arestr_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_false"><span class="command">lemma</span></span> arestr_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_not"><span class="command">lemma</span></span> arestr_not <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_and"><span class="command">lemma</span></span> arestr_and <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span> <span class="main">∧</span> <span class="free">Q</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_or"><span class="command">lemma</span></span> arestr_or <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span> <span class="main">∨</span> <span class="free">Q</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-arestr_imp"><span class="command">lemma</span></span> arestr_imp <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span> <span class="main">⇒</span> <span class="free">Q</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Predicate Alphabet Restriction ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In order to restrict the variables of a predicate, we also need to existentially quantify
  away the other variables. We can't do this at the level of expressions, as quantifiers are not
  applicable here. Consequently, we need a specialised version of alphabet restriction for
  predicates. It both restricts the variables using quantification and then removes them
  from the alphabet type using expression restriction. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upred_ares</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'β</span> upred"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">upred_ares</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> a<span class="main">)</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
    
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_upred_ares"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> salpha <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span>"</span> 90<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_upred_ares <span class="free">P</span> <span class="free">a</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> upred_ares <span class="free">P</span> <span class="free">a</span>"</span>
  
<span class="keyword1" id="utp_alphabet-upred_aext_ares"><span class="command">lemma</span></span> upred_aext_ares <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span> a <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_alphabet-upred_ares_aext"><span class="command">lemma</span></span> upred_ares_aext <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span> a<span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-upred_arestr_lit"><span class="command">lemma</span></span> upred_arestr_lit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span> a <span class="main">=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-upred_arestr_true"><span class="command">lemma</span></span> upred_arestr_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span> a <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-upred_arestr_false"><span class="command">lemma</span></span> upred_arestr_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span> a <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-upred_arestr_or"><span class="command">lemma</span></span> upred_arestr_or <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span>x <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span>x <span class="main">∨</span> <span class="free">Q</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span>x<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet Lens Laws ›</span></span>

<span class="keyword1" id="utp_alphabet-alpha_in_var"><span class="command">lemma</span></span> alpha_in_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> in_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_alphabet-alpha_out_var"><span class="command">lemma</span></span> alpha_out_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> out_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def<span class="main">)</span>

<span class="keyword1" id="utp_alphabet-in_var_prod_lens"><span class="command">lemma</span></span> in_var_prod_lens <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wb_lens <span class="free">Y</span> <span class="main">⟹</span> in_var <span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> in_var <span class="main">(</span><span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def prod_as_plus lens_comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> fst_lens_plus<span class="main">)</span>

<span class="keyword1" id="utp_alphabet-out_var_prod_lens"><span class="command">lemma</span></span> out_var_prod_lens <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wb_lens <span class="free">X</span> <span class="main">⟹</span> out_var <span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> out_var <span class="main">(</span><span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> out_var_def prod_as_plus lens_comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> snd_lens_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> comp_wb_lens fst_vwb_lens vwb_lens_wb <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alpha_in_var alpha_out_var<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution Alphabet Extension ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This allows us to extend the alphabet of a substitution, in a similar way to expressions. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_ext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⟹</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'β</span> usubst"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1"><span class="free">⊕<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_alphabet-id_subst_ext"><span class="command">lemma</span></span> id_subst_ext <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wb_lens <span class="free">x</span> <span class="main">⟹</span> id <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_alphabet-upd_subst_ext"><span class="command">lemma</span></span> upd_subst_ext <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="main">&amp;</span>x<span class="main">:</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_alphabet-apply_subst_ext"><span class="command">lemma</span></span> apply_subst_ext <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">e</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="free">e</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-aext_upred_eq"><span class="command">lemma</span></span> aext_upred_eq <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">e</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">e</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-subst_aext_comp"><span class="command">lemma</span></span> subst_aext_comp <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="free">ρ</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">∘</span> <span class="free">ρ</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution Alphabet Restriction ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This allows us to reduce the alphabet of a substitution, in a similar way to expressions. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst_res</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'β</span> usubst"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>s</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1"><span class="free">↾<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="keyword1">create</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_alphabet-id_subst_res"><span class="command">lemma</span></span> id_subst_res <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> id <span class="keyword1">↾<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_alphabet-upd_subst_res"><span class="command">lemma</span></span> upd_subst_res <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">σ</span><span class="main">(</span><span class="main">&amp;</span>x<span class="main">:</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="main">&amp;</span>y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-subst_ext_res"><span class="command">lemma</span></span> subst_ext_res <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_alphabet-unrest_subst_alpha_ext"><span class="command">lemma</span></span> unrest_subst_alpha_ext <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span> <span class="quasi_keyword">robust</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lens_indep_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_lift">
<div class="head">
<h1>Theory utp_lift</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Lifting Expressions ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_lift
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="utp_alphabet.html">utp_alphabet</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lifting definitions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define operators for converting an expression to and from a relational state space
  with the help of alphabet extrusion and restriction. In general throughout Isabelle/UTP
  we adopt the notation $\lceil P \rceil$ with some subscript to denote lifting an expression
  into a larger alphabet, and $\lfloor P \rfloor$ for dropping into a smaller alphabet.

  The following two functions lift and drop an expression, respectively, whose alphabet is 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, into a product alphabet <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span> <span class="main"><span class="main">×</span></span> <span class="tfree"><span class="tfree">'β</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This allows us to deal with expressions
  which refer only to undashed variables, and use the type-system to ensure this. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lift_pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">drop_pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌊</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌋<span class="hidden">⇩</span><sub>&lt;</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following two functions lift and drop an expression, respectively, whose alphabet is 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'β</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, into a product alphabet <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span> <span class="main"><span class="main">×</span></span> <span class="tfree"><span class="tfree">'β</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This allows us to deal with expressions
  which refer only to dashed variables. ›</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lift_post</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">drop_post</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌊</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌋<span class="hidden">⇩</span><sub>&gt;</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>e</sub></span> <span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lifting Laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ With the help of our alphabet laws, we can prove some intuitive laws about alphabet
  lifting. For example, lifting variables yields an unprimed or primed relational variable
  expression, respectively. ›</span></span>
  
<span class="keyword1" id="utp_lift-lift_pre_var"><span class="command">lemma</span></span> lift_pre_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span>var <span class="free">x</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">=</span> <span class="main">$</span>x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">alpha_tac</span><span class="main">)</span>

<span class="keyword1" id="utp_lift-lift_post_var"><span class="command">lemma</span></span> lift_post_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span>var <span class="free">x</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span> <span class="main">=</span> <span class="main">$</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">alpha_tac</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution Laws ›</span></span>
    
<span class="keyword1" id="utp_lift-pre_var_subst"><span class="command">lemma</span></span> pre_var_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">)</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">&amp;</span>x<span class="main">⟧</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Crucially, the lifting operators allow us to demonstrate unrestriction properties. For
  example, we can show that no primed variable is restricted in an expression over only the
  first element of the state-space product type. ›</span></span>
  
<span class="keyword1" id="utp_lift-unrest_dash_var_pre"><span class="command">lemma</span></span> unrest_dash_var_pre <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_pred_laws">
<div class="head">
<h1>Theory utp_pred_laws</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Predicate Calculus Laws ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_pred_laws
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_pred.html">utp_pred</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Propositional Logic ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Showing that predicates form a Boolean Algebra (under the predicate operators as opposed to
  the lattice operators) gives us many useful laws. ›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> boolean_algebra <span class="quoted">diff_upred</span> <span class="quoted">not_upred</span> <span class="quoted">conj_upred</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="quoted">disj_upred</span> <span class="quoted">false_upred</span> <span class="quoted">true_upred</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_true"><span class="command">lemma</span></span> taut_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="keyword1">true</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_false"><span class="command">lemma</span></span> taut_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="keyword1">false</span><span class="main">`</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_conj"><span class="command">lemma</span></span> taut_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">A</span> <span class="main">∧</span> <span class="free">B</span><span class="main">`</span> <span class="main">=</span> <span class="main">(</span><span class="main">`</span><span class="free">A</span><span class="main">`</span> <span class="main">∧</span> <span class="main">`</span><span class="free">B</span><span class="main">`</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_conj_elim"><span class="command">lemma</span></span> taut_conj_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">`</span><span class="free">A</span> <span class="main">∧</span> <span class="free">B</span><span class="main">`</span><span class="main">;</span> <span class="main">⟦</span> <span class="main">`</span><span class="free">A</span><span class="main">`</span><span class="main">;</span> <span class="main">`</span><span class="free">B</span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_refine_impl"><span class="command">lemma</span></span> taut_refine_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">P</span><span class="main">;</span> <span class="main">`</span><span class="free">P</span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">`</span><span class="free">Q</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_shEx_elim"><span class="command">lemma</span></span> taut_shEx_elim<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">`</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span> <span class="bound">x</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">`</span><span class="free">P</span> <span class="bound">x</span><span class="main">`</span> <span class="main">⟹</span> <span class="free">Q</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Linking refinement and HOL implication ›</span></span>

<span class="keyword1" id="utp_pred_laws-refine_prop_intro"><span class="command">lemma</span></span> refine_prop_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">Q</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="free">P</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_not"><span class="command">lemma</span></span> taut_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="main">`</span><span class="free">P</span><span class="main">`</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span><span class="main">¬</span> <span class="free">P</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_shAll_intro"><span class="command">lemma</span></span> taut_shAll_intro<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">`</span><span class="free">P</span> <span class="bound">x</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_shAll_intro_2"><span class="command">lemma</span></span> taut_shAll_intro_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">`</span><span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_impl_intro"><span class="command">lemma</span></span> taut_impl_intro<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">Σ</span> <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> <span class="main">`</span><span class="free">P</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="free">Q</span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-upred_eval_taut"><span class="command">lemma</span></span> upred_eval_taut<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">b</span><span class="main">»</span><span class="main">/</span><span class="main">&amp;</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">⟧</span><span class="main">`</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-refBy_order"><span class="command">lemma</span></span> refBy_order<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">`</span><span class="free">Q</span> <span class="main">⇒</span> <span class="free">P</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_idem"><span class="command">lemma</span></span> conj_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-disj_idem"><span class="command">lemma</span></span> disj_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_comm"><span class="command">lemma</span></span> conj_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-disj_comm"><span class="command">lemma</span></span> disj_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_subst"><span class="command">lemma</span></span> conj_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-disj_subst"><span class="command">lemma</span></span> disj_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_assoc"><span class="command">lemma</span></span> conj_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-disj_assoc"><span class="command">lemma</span></span> disj_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_disj_abs"><span class="command">lemma</span></span> conj_disj_abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-disj_conj_abs"><span class="command">lemma</span></span> disj_conj_abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_disj_distr"><span class="command">lemma</span></span> conj_disj_distr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-disj_conj_distr"><span class="command">lemma</span></span> disj_conj_distr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-true_disj_zero"><span class="command">lemma</span></span> true_disj_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">true</span> <span class="main">∨</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred_laws-true_conj_zero"><span class="command">lemma</span></span> true_conj_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">false</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred_laws-false_sup"><span class="command">lemma</span></span> false_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="main">⊓</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="keyword1">false</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred_laws-true_inf"><span class="command">lemma</span></span> true_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="main">⊔</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊔</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred_laws-imp_vacuous"><span class="command">lemma</span></span> imp_vacuous <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">false</span> <span class="main">⇒</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-imp_true"><span class="command">lemma</span></span> imp_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⇒</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-true_imp"><span class="command">lemma</span></span> true_imp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">true</span> <span class="main">⇒</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-impl_mp1"><span class="command">lemma</span></span> impl_mp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-impl_mp2"><span class="command">lemma</span></span> impl_mp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-impl_adjoin"><span class="command">lemma</span></span> impl_adjoin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">R</span> <span class="main">⇒</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-impl_refine_intro"><span class="command">lemma</span></span> impl_refine_intro<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-spec_refine"><span class="command">lemma</span></span> spec_refine<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-impl_disjI"><span class="command">lemma</span></span> impl_disjI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">R</span><span class="main">`</span><span class="main">;</span> <span class="main">`</span><span class="free">Q</span> <span class="main">⇒</span> <span class="free">R</span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">R</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conditional_iff"><span class="command">lemma</span></span> conditional_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⇔</span> <span class="free">R</span><span class="main">)</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-p_and_not_p"><span class="command">lemma</span></span> p_and_not_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-p_or_not_p"><span class="command">lemma</span></span> p_or_not_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-p_imp_p"><span class="command">lemma</span></span> p_imp_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-p_iff_p"><span class="command">lemma</span></span> p_iff_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇔</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-p_imp_false"><span class="command">lemma</span></span> p_imp_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_conj_deMorgans"><span class="command">lemma</span></span> not_conj_deMorgans <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_disj_deMorgans"><span class="command">lemma</span></span> not_disj_deMorgans <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_disj_not_abs"><span class="command">lemma</span></span> conj_disj_not_abs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-subsumption1"><span class="command">lemma</span></span> subsumption1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-subsumption2"><span class="command">lemma</span></span> subsumption2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">Q</span> <span class="main">⇒</span> <span class="free">P</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-neg_conj_cancel1"><span class="command">lemma</span></span> neg_conj_cancel1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-neg_conj_cancel2"><span class="command">lemma</span></span> neg_conj_cancel2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-double_negation"><span class="command">lemma</span></span> double_negation <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> upred<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-true_not_false"><span class="command">lemma</span></span> true_not_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="main">≠</span> <span class="keyword1">false</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="main">≠</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred_laws-closure_conj_distr"><span class="command">lemma</span></span> closure_conj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">∧</span> <span class="main">[</span><span class="free">Q</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-closure_imp_distr"><span class="command">lemma</span></span> closure_imp_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">[</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⇒</span> <span class="main">[</span><span class="free">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⇒</span> <span class="main">[</span><span class="free">Q</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-true_iff"><span class="command">lemma</span></span> true_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇔</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-taut_iff_eq"><span class="command">lemma</span></span> taut_iff_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span> <span class="main">⇔</span> <span class="free">Q</span><span class="main">`</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-impl_alt_def"><span class="command">lemma</span></span> impl_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lattice laws ›</span></span>
    
<span class="keyword1" id="utp_pred_laws-uinf_or"><span class="command">lemma</span></span> uinf_or<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-usup_and"><span class="command">lemma</span></span> usup_and<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_alt_def"><span class="command">lemma</span></span> UINF_alt_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="free">A</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">A</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-USUP_true"><span class="command">lemma</span></span> USUP_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">P</span></span> <span class="main">|</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">∙</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_mem_UNIV"><span class="command">lemma</span></span> UINF_mem_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span>UNIV <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_mem_UNIV"><span class="command">lemma</span></span> USUP_mem_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span>UNIV <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_false"><span class="command">lemma</span></span> USUP_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_mem_false"><span class="command">lemma</span></span> USUP_mem_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_where_false"><span class="command">lemma</span></span> USUP_where_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="keyword1">false</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_true"><span class="command">lemma</span></span> UINF_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_ind_const"><span class="command">lemma</span></span> UINF_ind_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-UINF_mem_true"><span class="command">lemma</span></span> UINF_mem_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_false"><span class="command">lemma</span></span> UINF_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_where_false"><span class="command">lemma</span></span> UINF_where_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="keyword1">false</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_cong_eq"><span class="command">lemma</span></span> UINF_cong_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">`</span><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="free">P<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> UINF_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_as_Sup"><span class="command">lemma</span></span> UINF_as_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∙</span> <span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="free">𝒫</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Sup_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Sup"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-UINF_as_Sup_collect"><span class="command">lemma</span></span> UINF_as_Sup_collect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">P</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Sup_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Setcompr_eq_image<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-UINF_as_Sup_collect'"><span class="command">lemma</span></span> UINF_as_Sup_collect'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">P</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Sup_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> full_SetCompr_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-UINF_as_Sup_image"><span class="command">lemma</span></span> UINF_as_Sup_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">P</span></span> <span class="main">|</span> <span class="main">«</span><span class="bound">P</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">∙</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Sup_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Sup"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_as_Inf"><span class="command">lemma</span></span> USUP_as_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∙</span> <span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="free">𝒫</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Inf_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Inf"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_as_Inf_collect"><span class="command">lemma</span></span> USUP_as_Inf_collect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span><span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">P</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Setcompr_eq_image<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_as_Inf_collect'"><span class="command">lemma</span></span> USUP_as_Inf_collect'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span><span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">P</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Sup_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> full_SetCompr_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_as_Inf_image"><span class="command">lemma</span></span> USUP_as_Inf_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∙</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">𝒫</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq Inf_uexpr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Inf"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_image_eq"><span class="command">lemma</span></span> USUP_image_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"USUP <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">«</span><span class="bound">i</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">»</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">g</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Inf</span> <span class="quoted">Inf</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_image_eq"><span class="command">lemma</span></span> UINF_image_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"UINF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">«</span><span class="bound">i</span><span class="main">»</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">»</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">g</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Sup</span> <span class="quoted">Sup</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-subst_continuous"><span class="command">lemma</span></span> subst_continuous <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="main">{</span><span class="free">σ</span> <span class="main">†</span> <span class="bound">P</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_as_Sup<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">usubst</span></span> setcompr_eq_image<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_UINF"><span class="command">lemma</span></span> not_UINF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span><span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span><span class="main">∙</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_USUP"><span class="command">lemma</span></span> not_USUP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span><span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span><span class="main">∙</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_UINF_ind"><span class="command">lemma</span></span> not_UINF_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_USUP_ind"><span class="command">lemma</span></span> not_USUP_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_empty"><span class="command">lemma</span></span> UINF_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_insert"><span class="command">lemma</span></span> UINF_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span>insert <span class="free">x</span> <span class="free">xs</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">xs</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Sup_insert<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Sup</span> <span class="quoted">Sup</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="utp_pred_laws-UINF_atLeast_first"><span class="command">lemma</span></span> UINF_atLeast_first<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">n</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="free">n</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">{</span>Suc <span class="free">n</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UINF_insert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="utp_pred_laws-UINF_atLeast_Suc"><span class="command">lemma</span></span> UINF_atLeast_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">m</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="free">m</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_le_D not_less_eq_eq<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_empty"><span class="command">lemma</span></span> USUP_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_insert"><span class="command">lemma</span></span> USUP_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span>insert <span class="free">x</span> <span class="free">xs</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">xs</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Inf_insert<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Inf</span> <span class="quoted">Inf</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_atLeast_first"><span class="command">lemma</span></span> USUP_atLeast_first<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">n</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="free">n</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">{</span>Suc <span class="free">n</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> USUP_insert conj_upred_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_pred_laws-USUP_atLeast_Suc"><span class="command">lemma</span></span> USUP_atLeast_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">m</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="free">m</span><span class="main">..}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_le_D not_less_eq_eq<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_UINF_dist"><span class="command">lemma</span></span> conj_UINF_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_UINF_ind_dist"><span class="command">lemma</span></span> conj_UINF_ind_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_pred_laws-disj_UINF_dist"><span class="command">lemma</span></span> disj_UINF_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">∨</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_conj_UINF"><span class="command">lemma</span></span> UINF_conj_UINF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_USUP_dist"><span class="command">lemma</span></span> conj_USUP_dist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> uexpr_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_upred_def USUP.rep_eq inf_uexpr.rep_eq bop.rep_eq lit.rep_eq<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_conj_USUP"><span class="command">lemma</span></span> USUP_conj_USUP <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">∧</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">upred_defs</span></span> bop.rep_eq lit.rep_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_all_cong"><span class="command">lemma</span></span> UINF_all_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_as_Sup_collect assms<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_cong"><span class="command">lemma</span></span> UINF_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_as_Sup_collect assms<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_all_cong"><span class="command">lemma</span></span> USUP_all_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-USUP_cong"><span class="command">lemma</span></span> USUP_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USUP_as_Inf_collect assms<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_subset_mono"><span class="command">lemma</span></span> UINF_subset_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">B</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_subset_mono UINF_as_Sup_collect<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_subset_mono"><span class="command">lemma</span></span> USUP_subset_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">B</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_superset_mono USUP_as_Inf_collect<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_impl"><span class="command">lemma</span></span> UINF_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_is_forall"><span class="command">lemma</span></span> USUP_is_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_ind_is_forall"><span class="command">lemma</span></span> USUP_ind_is_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_is_exists"><span class="command">lemma</span></span> UINF_is_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_all_nats"><span class="command">lemma</span></span> UINF_all_nats <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">n</span></span> <span class="main">∙</span> <span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">n</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-USUP_all_nats"><span class="command">lemma</span></span> USUP_all_nats <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">n</span></span> <span class="main">∙</span> <span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound">n</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_upto_expand_first"><span class="command">lemma</span></span> UINF_upto_expand_first<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">m</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'α</span> upred<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Suc_leI le_eq_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_pred_laws-UINF_upto_expand_last"><span class="command">lemma</span></span> UINF_upto_expand_last<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="utp_pred_laws-UINF_Suc_shift"><span class="command">lemma</span></span> UINF_Suc_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Sup</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_0_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_pred_laws-USUP_upto_expand_first"><span class="command">lemma</span></span> USUP_upto_expand_first<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span>Suc<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_pred_laws-USUP_Suc_shift"><span class="command">lemma</span></span> USUP_Suc_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Inf</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_0_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="utp_pred_laws-UINF_list_conv"><span class="command">lemma</span></span> UINF_list_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span><span class="free">xs</span><span class="main">)</span><span class="main">}</span> <span class="main">∙</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> foldr <span class="main">(∨)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">false</span>"</span></span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_upto_expand_first UINF_Suc_shift<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-USUP_list_conv"><span class="command">lemma</span></span> USUP_list_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span><span class="free">xs</span><span class="main">)</span><span class="main">}</span> <span class="main">∙</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> foldr <span class="main">(∧)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">true</span>"</span></span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USUP_upto_expand_first USUP_Suc_shift<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-UINF_refines"><span class="command">lemma</span></span> UINF_refines<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="bound">i</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">Q</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_as_Sup_collect<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> SUP_least<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_refines'"><span class="command">lemma</span></span> UINF_refines'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Sup_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="utp_pred_laws-UINF_pred_ueq"><span class="command">lemma</span></span> UINF_pred_ueq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="main">«</span><span class="bound">x</span><span class="main">»</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-UINF_pred_lit_eq"><span class="command">lemma</span></span> UINF_pred_lit_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="main">«</span><span class="bound">x</span> <span class="main">=</span> <span class="free">v</span><span class="main">»</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Equality laws ›</span></span>

<span class="keyword1" id="utp_pred_laws-eq_upred_refl"><span class="command">lemma</span></span> eq_upred_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-eq_upred_sym"><span class="command">lemma</span></span> eq_upred_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-eq_cong_left"><span class="command">lemma</span></span> eq_cong_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">Q</span> <span class="main">=</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">meson</span> mwb_lens_def vwb_lens_mwb weak_lens_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_eq_in_var_subst"><span class="command">lemma</span></span> conj_eq_in_var_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="main">$</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_eq_out_var_subst"><span class="command">lemma</span></span> conj_eq_out_var_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_pos_var_subst"><span class="command">lemma</span></span> conj_pos_var_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens.get_put<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_neg_var_subst"><span class="command">lemma</span></span> conj_neg_var_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens.get_put<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-upred_eq_true"><span class="command">lemma</span></span> upred_eq_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-upred_eq_false"><span class="command">lemma</span></span> upred_eq_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-upred_true_eq"><span class="command">lemma</span></span> upred_true_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">true</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-upred_false_eq"><span class="command">lemma</span></span> upred_false_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">false</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-conj_var_subst"><span class="command">lemma</span></span> conj_var_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> var <span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> var <span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens_def wb_lens.get_put<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ HOL Variable Quantifiers ›</span></span>
    
<span class="keyword1" id="utp_pred_laws-shEx_unbound"><span class="command">lemma</span></span> shEx_unbound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shEx_bool"><span class="command">lemma</span></span> shEx_bool <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shEx <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> True <span class="main">∨</span> <span class="free">P</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shEx_commute"><span class="command">lemma</span></span> shEx_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">y</span> <span class="main">∙</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shEx_cong"><span class="command">lemma</span></span> shEx_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> shEx <span class="free">P</span> <span class="main">=</span> shEx <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shEx_insert"><span class="command">lemma</span></span> shEx_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="keyword1">insert<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">y</span><span class="main">⟧</span> <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shEx_one_point"><span class="command">lemma</span></span> shEx_one_point<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">«</span><span class="bound">x</span><span class="main">»</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="free">v</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shAll_unbound"><span class="command">lemma</span></span> shAll_unbound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shAll_bool"><span class="command">lemma</span></span> shAll_bool <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"shAll <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> True <span class="main">∧</span> <span class="free">P</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shAll_cong"><span class="command">lemma</span></span> shAll_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> shAll <span class="free">P</span> <span class="main">=</span> shAll <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Quantifier lifting ›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> uquant_lift

<span class="keyword1" id="utp_pred_laws-shEx_lift_conj_1"><span class="command">lemma</span></span> shEx_lift_conj_1 <span class="main">[</span><span class="operator">uquant_lift</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-shEx_lift_conj_2"><span class="command">lemma</span></span> shEx_lift_conj_2 <span class="main">[</span><span class="operator">uquant_lift</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Case Splitting ›</span></span>
  
<span class="keyword1" id="utp_pred_laws-eq_split_subst"><span class="command">lemma</span></span> eq_split_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">=</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.source_stability<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-eq_split_substI"><span class="command">lemma</span></span> eq_split_substI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">v</span><span class="main">.</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">=</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> eq_split_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_pred_laws-taut_split_subst"><span class="command">lemma</span></span> taut_split_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span><span class="main">`</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="main">`</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">`</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.source_stability<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-eq_split"><span class="command">lemma</span></span> eq_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">`</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">Q</span> <span class="main">⇒</span> <span class="free">P</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-bool_eq_splitI"><span class="command">lemma</span></span> bool_eq_splitI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">=</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span>x<span class="main">⟧</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">=</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms eq_split_subst false_alt_def true_alt_def<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-subst_bool_split"><span class="command">lemma</span></span> subst_bool_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span><span class="main">`</span> <span class="main">=</span> <span class="main">`</span><span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">`</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span><span class="main">`</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="main">`</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">`</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> taut_split_subst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">`</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span>True<span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">`</span> <span class="main">∧</span> <span class="main">`</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span>False<span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">`</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">`</span><span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">`</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_pred_laws-subst_eq_replace"><span class="command">lemma</span></span> subst_eq_replace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">⟦</span><span class="free">u</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="free">u</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="free">u</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ UTP Quantifiers ›</span></span>
    
<span class="keyword1" id="utp_pred_laws-one_point"><span class="command">lemma</span></span> one_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> var <span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-exists_twice"><span class="command">lemma</span></span> exists_twice<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_twice"><span class="command">lemma</span></span> all_twice<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-exists_sub"><span class="command">lemma</span></span> exists_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_sub"><span class="command">lemma</span></span> all_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_commute"><span class="command">lemma</span></span> ex_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lens_indep_comm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-all_commute"><span class="command">lemma</span></span> all_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> y <span class="main">∙</span> <span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lens_indep_comm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_pred_laws-ex_equiv"><span class="command">lemma</span></span> ex_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lens.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_equiv"><span class="command">lemma</span></span> all_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lens.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_zero"><span class="command">lemma</span></span> ex_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="main">∅</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_zero"><span class="command">lemma</span></span> all_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="main">∅</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_plus"><span class="command">lemma</span></span> ex_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> y<span class="main">;</span>x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_plus"><span class="command">lemma</span></span> all_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> y<span class="main">;</span>x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="main">∀</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-closure_all"><span class="command">lemma</span></span> closure_all<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="keyword1">Σ</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-unrest_as_exists"><span class="command">lemma</span></span> unrest_as_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>x <span class="main">♯</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_mono"><span class="command">lemma</span></span> ex_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_weakens"><span class="command">lemma</span></span> ex_weakens<span class="main">:</span> <span class="quoted"><span class="quoted">"wb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_mono"><span class="command">lemma</span></span> all_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_strengthens"><span class="command">lemma</span></span> all_strengthens<span class="main">:</span> <span class="quoted"><span class="quoted">"wb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_unrest"><span class="command">lemma</span></span> ex_unrest<span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-all_unrest"><span class="command">lemma</span></span> all_unrest<span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_ex_not"><span class="command">lemma</span></span> not_ex_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-not_all_not"><span class="command">lemma</span></span> not_all_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> x <span class="main">∙</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_conj_contr_left"><span class="command">lemma</span></span> ex_conj_contr_left<span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-ex_conj_contr_right"><span class="command">lemma</span></span> ex_conj_contr_right<span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Variable Restriction ›</span></span>    
  
<span class="keyword1" id="utp_pred_laws-var_res_all"><span class="command">lemma</span></span> var_res_all<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">Σ</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  
<span class="keyword1" id="utp_pred_laws-var_res_twice"><span class="command">lemma</span></span> var_res_twice<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> x <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> x <span class="main">=</span> <span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conditional laws ›</span></span>

<span class="keyword1" id="utp_pred_laws-cond_def"><span class="command">lemma</span></span> cond_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-cond_idem"><span class="command">lemma</span></span> cond_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_true_false"><span class="command">lemma</span></span> cond_true_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">true</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="keyword1">false</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-cond_symm"><span class="command">lemma</span></span> cond_symm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="main">¬</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_assoc"><span class="command">lemma</span></span> cond_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_distr"><span class="command">lemma</span></span> cond_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_unit_T"><span class="command">lemma</span></span> cond_unit_T <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="keyword1">true</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_unit_F"><span class="command">lemma</span></span> cond_unit_F <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="keyword1">false</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_conj_not"><span class="command">lemma</span></span> cond_conj_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-cond_and_T_integrate"><span class="command">lemma</span></span> cond_and_T_integrate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_L6"><span class="command">lemma</span></span> cond_L6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_L7"><span class="command">lemma</span></span> cond_L7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_and_distr"><span class="command">lemma</span></span> cond_and_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_or_distr"><span class="command">lemma</span></span> cond_or_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_imp_distr"><span class="command">lemma</span></span> cond_imp_distr<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⇒</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_eq_distr"><span class="command">lemma</span></span> cond_eq_distr<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⇔</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⇔</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⇔</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_conj_distr"><span class="command">lemma</span></span> cond_conj_distr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_disj_distr"><span class="command">lemma</span></span> cond_disj_distr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_neg"><span class="command">lemma</span></span> cond_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_conj"><span class="command">lemma</span></span> cond_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-spec_cond_dist"><span class="command">lemma</span></span> spec_cond_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_USUP_dist"><span class="command">lemma</span></span> cond_USUP_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_UINF_dist"><span class="command">lemma</span></span> cond_UINF_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">S</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">G</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_var_subst_left"><span class="command">lemma</span></span> cond_var_subst_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">◃</span> var <span class="free">x</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> var <span class="free">x</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_var_subst_right"><span class="command">lemma</span></span> cond_var_subst_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> var <span class="free">x</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> var <span class="free">x</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens.put_eq<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_var_split"><span class="command">lemma</span></span> cond_var_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">◃</span> var <span class="free">x</span> <span class="main">▹</span> <span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> vwb_lens.put_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_assign_subst"><span class="command">lemma</span></span> cond_assign_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> utp_expr.var <span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">v</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">◃</span> utp_expr.var <span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> vwb_lens.put_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
<span class="keyword1" id="utp_pred_laws-conj_conds"><span class="command">lemma</span></span> conj_conds<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P1</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q1</span> <span class="main">∧</span> <span class="free">P2</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P1</span> <span class="main">∧</span> <span class="free">P2</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q1</span> <span class="main">∧</span> <span class="free">Q2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_pred_laws-disj_conds"><span class="command">lemma</span></span> disj_conds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P1</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q1</span> <span class="main">∨</span> <span class="free">P2</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P1</span> <span class="main">∨</span> <span class="free">P2</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q1</span> <span class="main">∨</span> <span class="free">Q2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_pred_laws-cond_mono"><span class="command">lemma</span></span> cond_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-cond_monotonic"><span class="command">lemma</span></span> cond_monotonic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mono <span class="free">P</span><span class="main">;</span> mono <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> mono <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Additional Expression Laws ›</span></span>

<span class="keyword1" id="utp_pred_laws-le_pred_refl"><span class="command">lemma</span></span> le_pred_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>preorder<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-uzero_le_laws"><span class="command">lemma</span></span> uzero_le_laws <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_semidom<span class="main">}</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> numeral <span class="free">x</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_semidom<span class="main">}</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> numeral <span class="free">x</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_semidom<span class="main">}</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
<span class="keyword1" id="utp_pred_laws-unumeral_le_1"><span class="command">lemma</span></span> unumeral_le_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>numeral <span class="free">i</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>numeral<span class="main">,</span>ord<span class="main">}</span><span class="main">)</span> <span class="main">≤</span> numeral <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>numeral <span class="free">i</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> numeral <span class="free">j</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-unumeral_le_2"><span class="command">lemma</span></span> unumeral_le_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>numeral <span class="free">i</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>numeral<span class="main">,</span>linorder<span class="main">}</span><span class="main">)</span> <span class="main">&gt;</span> numeral <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>numeral <span class="free">i</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> numeral <span class="free">j</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-uset_laws"><span class="command">lemma</span></span> uset_laws <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
<span class="keyword1" id="utp_pred_laws-ulit_eq"><span class="command">lemma</span></span> ulit_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">y</span><span class="main">»</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-ulit_neq"><span class="command">lemma</span></span> ulit_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">«</span><span class="free">x</span><span class="main">»</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">y</span><span class="main">»</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_pred_laws-uset_mems"><span class="command">lemma</span></span> uset_mems <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">{</span><span class="free">y</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span> <span class="main">∨</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Refinement By Observation ›</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Function to obtain the set of observations of a predicate ›</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">obs_upred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧<span class="hidden">⇩</span><sub>o</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>o</sub></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span><span class="bound">b</span><span class="main">}</span>"</span></span>
    
<span class="keyword1" id="utp_pred_laws-obs_upred_refine_iff"><span class="command">lemma</span></span> obs_upred_refine_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟷</span> <span class="main">⟦</span><span class="free">Q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>o</sub></span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>o</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A refinement can be demonstrated by considering only the observations of the predicates
  which are relevant, i.e. not unrestricted, for them. In other words, if the alphabet can
  be split into two disjoint segments, $x$ and $y$, and neither predicate refers to $y$ then
  only $x$ need be considered when checking for observations. ›</span></span>
    
<span class="keyword1" id="utp_pred_laws-refine_by_obs"><span class="command">lemma</span></span> refine_by_obs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"bij_lens <span class="main">(</span><span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">`</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">`</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">`</span><span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">`</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-5<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> obs_upred_refine_iff subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> b<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span><span class="improper">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bij_lens.axioms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bij_lens_axioms_def lens_override_def lens_override_plus<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Cylindric Algebra ›</span></span>

<span class="keyword1" id="utp_pred_laws-C1"><span class="command">lemma</span></span> C1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-C2"><span class="command">lemma</span></span> C2<span class="main">:</span> <span class="quoted"><span class="quoted">"wb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-C3"><span class="command">lemma</span></span> C3<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-C4a"><span class="command">lemma</span></span> C4a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lens.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_pred_laws-C4b"><span class="command">lemma</span></span> C4b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">∃</span> y <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> y <span class="main">∙</span> <span class="main">∃</span> x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_pred_laws-C5"><span class="command">lemma</span></span> C5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">&amp;</span>x<span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-C6"><span class="command">lemma</span></span> C6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">&amp;</span>y <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">&amp;</span>z<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">&amp;</span>y <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">&amp;</span>x <span class="main">∧</span> <span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">&amp;</span>z<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> lens_indep_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_pred_laws-C7"><span class="command">lemma</span></span> C7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"weak_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">&amp;</span>y <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">&amp;</span>y <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_sym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_healthy">
<div class="head">
<h1>Theory utp_healthy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Healthiness Conditions ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_healthy
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_pred_laws.html">utp_pred_laws</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Main Definitions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We collect closure laws for healthiness conditions in the following theorem attribute. ›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> closure
  
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> health <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A predicate $P$ is healthy, under healthiness function $H$, if $P$ is a fixed-point of $H$. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Healthy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">is</span>"</span> 30<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">is</span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_healthy-Healthy_def'"><span class="command">lemma</span></span> Healthy_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">H</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Healthy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_healthy-Healthy_if"><span class="command">lemma</span></span> Healthy_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">H</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Healthy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_healthy-Healthy_intro"><span class="command">lemma</span></span> Healthy_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">declare</span></span> Healthy_def' <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Healthy_carrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> <span class="tfree">'α</span> upred set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>H</sub></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="keyword1">is</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="utp_healthy-Healthy_carrier_image"><span class="command">lemma</span></span> Healthy_carrier_image<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">ℋ</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⟹</span> <span class="free">ℋ</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> Healthy_if mem_Collect_eq subsetCE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_carrier_Collect"><span class="command">lemma</span></span> Healthy_carrier_Collect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">H</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_carrier_image Setcompr_eq_image<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_func"><span class="command">lemma</span></span> Healthy_func<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">F</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span><span class="main">;</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span><span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Healthy_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_healthy-Healthy_comp"><span class="command">lemma</span></span> Healthy_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∘</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
    
<span class="keyword1" id="utp_healthy-Healthy_apply_closed"><span class="command">lemma</span></span> Healthy_apply_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_healthy-Healthy_set_image_member"><span class="command">lemma</span></span> Healthy_set_image_member<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">`</span> <span class="free">A</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="keyword1">is</span> <span class="free">H</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_healthy-Healthy_case_prod"><span class="command">lemma</span></span> Healthy_case_prod <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="keyword1">is</span> <span class="free">H</span> <span class="main">⟧</span> <span class="main">⟹</span> case_prod <span class="free">P</span> <span class="free">v</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_SUPREMUM"><span class="command">lemma</span></span> Healthy_SUPREMUM<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⟹</span> Sup <span class="main">(</span><span class="free">H</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> Healthy_carrier_image<span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_INFIMUM"><span class="command">lemma</span></span> Healthy_INFIMUM<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⟹</span> Inf <span class="main">(</span><span class="free">H</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> Healthy_carrier_image<span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_nu"><span class="command">lemma</span></span> Healthy_nu <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">⟦</span>id<span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">F</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Healthy_def Healthy_func assms eq_id_iff lfp_unfold<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_mu"><span class="command">lemma</span></span> Healthy_mu <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">⟦</span>id<span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">F</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Healthy_def Healthy_func assms eq_id_iff gfp_unfold<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_subset_member"><span class="command">lemma</span></span> Healthy_subset_member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span><span class="main">;</span> <span class="free">P</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ball_Collect Healthy_if<span class="main">)</span>

<span class="keyword1" id="utp_healthy-is_Healthy_subset_member"><span class="command">lemma</span></span> is_Healthy_subset_member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span><span class="main">;</span> <span class="free">P</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Properties of Healthiness Conditions ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Idempotent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Idempotent</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Monotonic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Monotonic</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">≡</span> mono <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IMH</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IMH</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">⟷</span> Idempotent<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span> Monotonic<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Antitone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Antitone</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">⊑</span> <span class="bound">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Conjunctive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Conjunctive</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">P</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">P</span> <span class="main">∧</span> <span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FunctionalConjunctive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FunctionalConjunctive</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">F</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">P</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">P</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> Monotonic<span class="main">(</span><span class="bound">F</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WeakConjunctive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">WeakConjunctive</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">Q</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">P</span> <span class="main">∧</span> <span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Disjunctuous</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Disjunctuous</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span> <span class="main">⊓</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Continuous</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> health <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Continuous</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_healthy-Healthy_Idempotent"><span class="command">lemma</span></span> Healthy_Idempotent <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Idempotent <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def Idempotent_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Healthy_range"><span class="command">lemma</span></span> Healthy_range<span class="main">:</span> <span class="quoted"><span class="quoted">"Idempotent <span class="free">H</span> <span class="main">⟹</span> range <span class="free">H</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def Healthy_if Healthy_Idempotent<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Healthy_if<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Idempotent_id"><span class="command">lemma</span></span> Idempotent_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Idempotent id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Idempotent_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Idempotent_comp"><span class="command">lemma</span></span> Idempotent_comp <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Idempotent <span class="free">f</span><span class="main">;</span> Idempotent <span class="free">g</span><span class="main">;</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟧</span> <span class="main">⟹</span> Idempotent <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Idempotent_def comp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="utp_healthy-Idempotent_image"><span class="command">lemma</span></span> Idempotent_image<span class="main">:</span> <span class="quoted"><span class="quoted">"Idempotent <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Idempotent_def image_cong image_image<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Monotonic_id"><span class="command">lemma</span></span> Monotonic_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Monotonic id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoI<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Monotonic_id'"><span class="command">lemma</span></span> Monotonic_id' <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoI<span class="main">)</span>
    
<span class="keyword1" id="utp_healthy-Monotonic_const"><span class="command">lemma</span></span> Monotonic_const <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Monotonic <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main">)</span>
    
<span class="keyword1" id="utp_healthy-Monotonic_comp"><span class="command">lemma</span></span> Monotonic_comp <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Monotonic <span class="free">f</span><span class="main">;</span> Monotonic <span class="free">g</span> <span class="main">⟧</span> <span class="main">⟹</span> Monotonic <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Monotonic_inf"><span class="command">lemma</span></span> Monotonic_inf <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_healthy-Monotonic_cond"><span class="command">lemma</span></span> Monotonic_cond <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms cond_monotonic<span class="main">)</span>
    
<span class="keyword1" id="utp_healthy-Conjuctive_Idempotent"><span class="command">lemma</span></span> Conjuctive_Idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> Idempotent<span class="main">(</span><span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Conjunctive_def Idempotent_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Conjunctive_Monotonic"><span class="command">lemma</span></span> Conjunctive_Monotonic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> Monotonic<span class="main">(</span><span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Conjunctive_def mono_def
  <span class="keyword1"><span class="command">using</span></span> dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="utp_healthy-Conjunctive_conj"><span class="command">lemma</span></span> Conjunctive_conj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">HC</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">HC</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">HC</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Conjunctive_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> utp_pred_laws.inf.assoc utp_pred_laws.inf.commute<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Conjunctive_distr_conj"><span class="command">lemma</span></span> Conjunctive_distr_conj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">HC</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">HC</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">HC</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="free">HC</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Conjunctive_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conjunctive_conj assms utp_pred_laws.inf.assoc utp_pred_laws.inf_right_idem<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Conjunctive_distr_disj"><span class="command">lemma</span></span> Conjunctive_distr_disj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">HC</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">HC</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">HC</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="free">HC</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Conjunctive_def
  <span class="keyword1"><span class="command">using</span></span> utp_pred_laws.inf_sup_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="utp_healthy-Conjunctive_distr_cond"><span class="command">lemma</span></span> Conjunctive_distr_cond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">HC</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">HC</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">HC</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">HC</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Conjunctive_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cond_conj_distr utp_pred_laws.inf_commute<span class="main">)</span>

<span class="keyword1" id="utp_healthy-FunctionalConjunctive_Monotonic"><span class="command">lemma</span></span> FunctionalConjunctive_Monotonic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"FunctionalConjunctive<span class="main">(</span><span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> Monotonic<span class="main">(</span><span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FunctionalConjunctive_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mono_def utp_pred_laws.inf_mono<span class="main">)</span>

<span class="keyword1" id="utp_healthy-WeakConjunctive_Refinement"><span class="command">lemma</span></span> WeakConjunctive_Refinement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"WeakConjunctive<span class="main">(</span><span class="free">HC</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">HC</span><span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> WeakConjunctive_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> utp_pred_laws.inf.cobounded1<span class="main">)</span>

<span class="keyword1" id="utp_healthy-WeakCojunctive_Healthy_Refinement"><span class="command">lemma</span></span> WeakCojunctive_Healthy_Refinement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"WeakConjunctive<span class="main">(</span><span class="free">HC</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="free">HC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">HC</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> WeakConjunctive_def Healthy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="utp_healthy-WeakConjunctive_implies_WeakConjunctive"><span class="command">lemma</span></span> WeakConjunctive_implies_WeakConjunctive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Conjunctive<span class="main">(</span><span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> WeakConjunctive<span class="main">(</span><span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> WeakConjunctive_def Conjunctive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1"><span class="command">declare</span></span> Conjunctive_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> mono_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>

<span class="keyword1" id="utp_healthy-Disjunctuous_Monotonic"><span class="command">lemma</span></span> Disjunctuous_Monotonic<span class="main">:</span> <span class="quoted"><span class="quoted">"Disjunctuous <span class="free">H</span> <span class="main">⟹</span> Monotonic <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Disjunctuous_def mono_def semilattice_sup_class.le_iff_sup<span class="main">)</span>

<span class="keyword1" id="utp_healthy-ContinuousD"><span class="command">lemma</span></span> ContinuousD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Continuous <span class="free">H</span><span class="main">;</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">P</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">H</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Continuous_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Continuous_Disjunctous"><span class="command">lemma</span></span> Continuous_Disjunctous<span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span> <span class="main">⟹</span> Disjunctuous <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Continuous_def Disjunctuous_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> P Q<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="improper">P</span><span class="main">,</span><span class="improper">Q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_healthy-Continuous_Monotonic"><span class="command">lemma</span></span> Continuous_Monotonic <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span> <span class="main">⟹</span> Monotonic <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Continuous_Disjunctous Disjunctuous_Monotonic<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Continuous_comp"><span class="command">lemma</span></span> Continuous_comp <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Continuous <span class="free">f</span><span class="main">;</span> Continuous <span class="free">g</span> <span class="main">⟧</span> <span class="main">⟹</span> Continuous <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Continuous_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-Continuous_const"><span class="command">lemma</span></span> Continuous_const <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_healthy-Continuous_cond"><span class="command">lemma</span></span> Continuous_cond <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">G</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Closure laws derived from continuity ›</span></span>

<span class="keyword1" id="utp_healthy-Sup_Continuous_closed"><span class="command">lemma</span></span> Sup_Continuous_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Continuous <span class="free">H</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span><span class="main">;</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> ContinuousD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_mem_UNIV<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> UINF_as_Sup<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Healthy_def' SUP_cong image_image<span class="main">)</span>

<span class="keyword1" id="utp_healthy-UINF_mem_Continuous_closed"><span class="command">lemma</span></span> UINF_mem_Continuous_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Continuous <span class="free">H</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span><span class="main">;</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_Continuous_closed UINF_as_Sup_collect<span class="main">)</span>

<span class="keyword1" id="utp_healthy-UINF_mem_Continuous_closed_pair"><span class="command">lemma</span></span> UINF_mem_Continuous_closed_pair <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> UINF_mem_Continuous_closed assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_healthy-UINF_mem_Continuous_closed_triple"><span class="command">lemma</span></span> UINF_mem_Continuous_closed_triple <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> UINF_mem_Continuous_closed assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_healthy-UINF_mem_Continuous_closed_quad"><span class="command">lemma</span></span> UINF_mem_Continuous_closed_quad <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">,</span> <span class="bound">k</span><span class="main">,</span> <span class="bound">l</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">l</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">l</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> UINF_mem_Continuous_closed assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_healthy-UINF_mem_Continuous_closed_quint"><span class="command">lemma</span></span> UINF_mem_Continuous_closed_quint <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">,</span> <span class="bound">k</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span> <span class="bound">m</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">l</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">m</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">l</span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound">m</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">)</span> 
         <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> UINF_mem_Continuous_closed assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_healthy-UINF_ind_closed"><span class="command">lemma</span></span> UINF_ind_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Continuous <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">i</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"UINF <span class="free">P</span> <span class="free">Q</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UINF <span class="free">P</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">Q</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> UINF_mem_Continuous_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_Continuous_closed UINF_as_Sup_collect' assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ All continuous functions are also Scott-continuous ›</span></span>

<span class="keyword1" id="utp_healthy-sup_continuous_Continuous"><span class="command">lemma</span></span> sup_continuous_Continuous <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous <span class="free">F</span> <span class="main">⟹</span> sup_continuous <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Continuous_def sup_continuous_def<span class="main">)</span>

<span class="keyword1" id="utp_healthy-USUP_healthy"><span class="command">lemma</span></span> USUP_healthy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="free">H</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> USUP_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_subset_member<span class="main">)</span>

<span class="keyword1" id="utp_healthy-UINF_healthy"><span class="command">lemma</span></span> UINF_healthy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="free">H</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> UINF_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_subset_member<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_rel">
<div class="head">
<h1>Theory utp_rel</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Alphabetised Relations ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_rel
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="utp_pred_laws.html">utp_pred_laws</a>
  <a href="utp_healthy.html">utp_healthy</a>
  <a href="utp_lift.html">utp_lift</a>
  <a href="utp_tactics.html">utp_tactics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ An alphabetised relation is simply a predicate whose state-space is a product type. In this
  theory we construct the core operators of the relational calculus, and prove a libary of 
  associated theorems, based on Chapters 2 and 5 of the UTP book~\cite{Hoare&amp;98}. ›</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Relational Alphabets ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up convenient syntax to refer to the input and output parts of the alphabet, as is
  common in UTP. Since we are in a product space, these are simply the lenses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inα</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⟹</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">lens_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">inα</span> <span class="main">=</span> <span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">outα</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β</span> <span class="main">⟹</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">lens_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">outα</span> <span class="main">=</span> <span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1" id="utp_rel-inα_uvar"><span class="command">lemma</span></span> inα_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens inα"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inα_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-outα_uvar"><span class="command">lemma</span></span> outα_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens outα"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> outα_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-var_in_alpha"><span class="command">lemma</span></span> var_in_alpha <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> inα <span class="main">=</span> ivar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_lens_def inα_def in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-var_out_alpha"><span class="command">lemma</span></span> var_out_alpha <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> outα <span class="main">=</span> ovar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> outα_def out_var_def snd_lens_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-drop_pre_inv"><span class="command">lemma</span></span> drop_pre_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> outα <span class="main">♯</span> <span class="free">p</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⌈</span><span class="main">⌊</span><span class="free">p</span><span class="main">⌋<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_simp</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-usubst_lookup_ivar_unrest"><span class="command">lemma</span></span> usubst_lookup_ivar_unrest <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>ivar <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">$</span>x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> fstI<span class="main">)</span>

<span class="keyword1" id="utp_rel-usubst_lookup_ovar_unrest"><span class="command">lemma</span></span> usubst_lookup_ovar_unrest <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>ovar <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">$</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> sndI<span class="main">)</span>
    
<span class="keyword1" id="utp_rel-out_alpha_in_indep"><span class="command">lemma</span></span> out_alpha_in_indep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"outα <span class="main">⨝</span> in_var <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"in_var <span class="free">x</span> <span class="main">⨝</span> outα"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def outα_def lens_indep_def fst_lens_def snd_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-in_alpha_out_indep"><span class="command">lemma</span></span> in_alpha_out_indep <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inα <span class="main">⨝</span> out_var <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"out_var <span class="free">x</span> <span class="main">⨝</span> inα"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_var_def inα_def lens_indep_def fst_lens_def lens_comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following two functions lift a predicate substitution to a relational one. ›</span></span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">usubst_rel_lift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> usubst"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="keyword1"><span class="free">⌉<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> inα"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">usubst_rel_drop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> usubst <span class="main">⇒</span> <span class="tfree">'α</span> usubst"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span>_<span class="keyword1">⌋<span class="hidden">⇩</span><sub>s</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌊</span></span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="keyword1"><span class="free">⌋<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>s</sub></span> inα"</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The alphabet of a relation then consists wholly of the input and output portions. ›</span></span>

<span class="keyword1" id="utp_rel-alpha_in_out"><span class="command">lemma</span></span> alpha_in_out<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> inα <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> outα"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_snd_id_lens inα_def lens_equiv_refl outα_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Relational Types and Operators ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We create type synonyms for conditions (which are simply predicates) -- i.e. relations
  without dashed variables --, alphabetised relations where the input and output alphabet can
  be different, and finally homogeneous relations. ›</span></span>
  
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> cond        <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> upred"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> hrel        <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> upred"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> hexpr <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  
<span class="keyword1"><span class="command">translations</span></span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span><span class="tfree"><span class="free">'α</span></span><span class="main">,</span> <span class="tfree"><span class="free">'β</span></span><span class="main">)</span> urel"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span><span class="tfree"><span class="free">'α</span></span> <span class="main">×</span> <span class="tfree"><span class="free">'β</span></span><span class="main">)</span> upred"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up some overloaded constants for sequential composition and the identity in case
  we want to overload their definitions later. ›</span></span>
  
<span class="keyword1"><span class="command">consts</span></span>
  useq     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">;;</span>"</span> 61<span class="main">)</span>
  uassigns <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> usubst <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span><span class="main">)</span>
  uskip    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">II</span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define a specialised version of the conditional where the condition can refer only to
  undashed variables, as is usually the case in programs, but not universally in UTP models. 
  We implement this by lifting the condition predicate into the relational state-space with
  construction <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⌈</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift_rcond</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>←</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main"><span class="free">⌉<span class="hidden">⇩</span><sub>←</sub></span></span> <span class="main">=</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> 
  <span class="entity">rcond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_ <span class="keyword1">◃</span> _ <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>52<span class="main">,</span>0<span class="main">,</span>53<span class="main">]</span> 52<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">◃</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">▹<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">◃</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⌉<span class="hidden">⇩</span><sub>←</sub></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Sequential composition is heterogeneous, and simply requires that the output alphabet
  of the first matches then input alphabet of the second. We define it by lifting HOL's 
  built-in relational composition operator (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">(O)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). Since this returns a set, the
  definition states that the state binding $b$ is an element of this set. ›</span></span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> seqr<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'γ</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span> upred"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="keyword1">O</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="bound">Q</span> <span class="bound">q</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  useq <span class="quoted">seqr</span>
   
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also set up a homogeneous sequential composition operator, and versions of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">true</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">false</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that are explicitly typed by a homogeneous alphabet. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">seqh</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">;;<span class="hidden">⇩</span><sub>h</sub></span>"</span> 61<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">seqh</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">truer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">true<span class="hidden">⇩</span><sub>h</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">truer</span> <span class="main">≡</span> <span class="keyword1">true</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">falser</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">false<span class="hidden">⇩</span><sub>h</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">falser</span> <span class="main">≡</span> <span class="keyword1">false</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define the relational converse operator as an alphabet extrusion on the bijective
  lens <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">swap<span class="hidden">⇩</span><sub>L</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that swaps the elements of the product state-space. ›</span></span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">conv_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conv_r</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">swap<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Assignment is defined using substitutions, where latter defines what each variable should
  map to. This approach, which is originally due to Back~\cite{Back1998}, permits more general 
  assignment expressions. The definition of the operator identifies the after state binding, $b'$, 
  with the substitution function applied to the before state binding $b$. ›</span></span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> assigns_r <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">b'</span><span class="main">)</span><span class="main">.</span> <span class="bound">b'</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  uassigns <span class="quoted">assigns_r</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Relational identity, or skip, is then simply an assignment with the identity substitution:
  it simply identifies all variables. ›</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">skip_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">skip_r</span> <span class="main">=</span> assigns_r id"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  uskip <span class="quoted">skip_r</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Non-deterministic assignment, also known as ``choose'', assigns an arbitrarily chosen value 
  to the given variable ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nd_assign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nd_assign</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">v</span></span> <span class="main">∙</span> assigns_r <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up iterated sequential composition which iterates an indexed predicate over the
  elements of a list. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seqr_iter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> hrel<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">seqr_iter</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">Q</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">II</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A singleton assignment simply applies a singleton substitution function, and similarly
  for a double assignment. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">assign_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">assign_r</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">⟨</span><span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">assign_2_r</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t1</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t2</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t1</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t2</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">assign_2_r</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> assigns_r <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> y <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also define the alphabetised skip operator that identifies all input and output variables
  in the given alphabet lens. All other variables are unrestricted. We also set up syntax for it. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">skip_ra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> lens <span class="main">⇒</span><span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">skip_ra</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>v<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>v<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Similarly, we define the alphabetised assignment operator. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assigns_ra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> lens <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">σ</span></span></span>⟩<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">a</span></span></span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> skip_ra <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Assumptions ($c^{\top}$) and assertions ($c_{\bot}$) are encoded as conditionals. An assumption
  behaves like skip if the condition is true, and otherwise behaves like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">false</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (miracle).
  An assertion is the same, but yields <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">true</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which is an abort. They are the same as
  tests, as in Kleene Algebra with Tests~\cite{kozen1997kleene,Armstrong2015} 
  (KAT), which embeds a Boolean algebra into a Kleene algebra to represent conditions. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rassume</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rassume</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="keyword1">II</span> <span class="main">◃</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">false</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rassert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rassert</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="keyword1">II</span> <span class="main">◃</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">true</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define two variants of while loops based on strongest and weakest fixed points. The former
  is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">false</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for an infinite loop, and the latter is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">true</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">while_top</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">while_bot</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ While loops with invariant decoration (cf. \cite{Armstrong2015}) -- partial correctness. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">while_inv</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> while_top <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ While loops with invariant decoration -- total correctness. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_inv_bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">while_inv_bot</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> while_bot <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ While loops with invariant and variant decorations -- total correctness. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">while_vrt</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">while_vrt</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> while_bot <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uassume"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇧</span><sup>⊤</sup></span>"</span><span class="main">)</span>
  <span class="quoted">"_uassume"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">?[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="quoted">"_uassert"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{</span>_<span class="keyword1">}<span class="hidden">⇩</span><sub>⊥</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uwhile"</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while<span class="hidden">⇧</span><sup>⊤</sup></span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span><span class="main">)</span>
  <span class="quoted">"_uwhile_top"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span><span class="main">)</span>
  <span class="quoted">"_uwhile_bot"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span><span class="main">)</span>
  <span class="quoted">"_uwhile_inv"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">invr</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span><span class="main">)</span>
  <span class="quoted">"_uwhile_inv_bot"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> _ <span class="keyword1">invr</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> 71<span class="main">)</span>
  <span class="quoted">"_uwhile_vrt"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">invr</span> _ <span class="keyword1">vrt</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_uassume <span class="free">b</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> rassume <span class="free">b</span>"</span>
  <span class="quoted">"_uassert <span class="free">b</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> rassert <span class="free">b</span>"</span>
  <span class="quoted">"_uwhile <span class="free">b</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> while_top <span class="free">b</span> <span class="free">P</span>"</span>
  <span class="quoted">"_uwhile_top <span class="free">b</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> while_top <span class="free">b</span> <span class="free">P</span>"</span>
  <span class="quoted">"_uwhile_bot <span class="free">b</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> while_bot <span class="free">b</span> <span class="free">P</span>"</span>
  <span class="quoted">"_uwhile_inv <span class="free">b</span> <span class="free">p</span> <span class="free">S</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> while_inv <span class="free">b</span> <span class="free">p</span> <span class="free">S</span>"</span>
  <span class="quoted">"_uwhile_inv_bot <span class="free">b</span> <span class="free">p</span> <span class="free">S</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> while_inv_bot <span class="free">b</span> <span class="free">p</span> <span class="free">S</span>"</span>
  <span class="quoted">"_uwhile_vrt <span class="free">b</span> <span class="free">p</span> <span class="free">v</span> <span class="free">S</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> while_vrt <span class="free">b</span> <span class="free">p</span> <span class="free">v</span> <span class="free">S</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We implement a poor man's version of alphabet restriction that hides a variable within 
  a relation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_var_res</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>α</sub></span>"</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">↾<span class="hidden">⇩</span><sub>α</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet extension and restriction add additional variables by the given lens in both
  their primed and unprimed versions. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_aext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'β</span> hrel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rel_aext</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_ares</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'β</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'β</span> hrel"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rel_ares</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span>a <span class="main">×</span> a<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We next describe frames and antiframes with the help of lenses. A frame states that $P$
  defines how variables in $a$ changed, and all those outside of $a$ remain the same. An
  antiframe describes the converse: all variables outside $a$ are specified by $P$, and all those in
  remain the same. For more information please see \cite{Morgan90a}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">frame</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">frame</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="main">⊕</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">on</span> <span class="main">&amp;</span>a<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">antiframe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">antiframe</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="main">⊕</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="keyword1">on</span> <span class="main">&amp;</span>a<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Frame extension combines alphabet extension with the frame operator to both add additional 
  variables and then frame those. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_frext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'β</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rel_frext</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> frame <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>rel_aext <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The nameset operator can be used to hide a portion of the after-state that lies outside
  the lens $a$. It can be useful to partition a relation's variables in order to conjoin it
  with another relation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nameset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nameset</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">{</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span>a<span class="main">´</span><span class="main">}</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Syntax Translations ›</span></span>
    
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="comment1">― ‹ Alternative traditional conditional syntax ›</span>
  <span class="quoted">"_utp_if"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">if<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">then</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">else</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 71<span class="main">]</span> 71<span class="main">)</span>
  <span class="comment1">― ‹ Iterated sequential composition ›</span>
  <span class="quoted">"_seqr_iter"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'σ</span> hrel <span class="main">⇒</span> <span class="tfree">'σ</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">;;</span> _ <span class="keyword1">:</span> _ <span class="keyword1">∙</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="comment1">― ‹ Single and multiple assignement ›</span>
  <span class="quoted">"_assignment"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"svids <span class="main">⇒</span> uexprs <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')</span> <span class="keyword1">:=</span> <span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>  
  <span class="quoted">"_assignment"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"svids <span class="main">⇒</span> uexprs <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">:=</span>"</span> 62<span class="main">)</span>
  <span class="comment1">― ‹ Non-deterministic assignment ›</span>
  <span class="quoted">"_nd_assign"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"svids <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">:=</span> <span class="keyword1">*</span>"</span> <span class="main">[</span>62<span class="main">]</span> 62<span class="main">)</span>
  <span class="comment1">― ‹ Substitution constructor ›</span>
  <span class="quoted">"_mk_usubst"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"svids <span class="main">⇒</span> uexprs <span class="main">⇒</span> <span class="tfree">'α</span> usubst"</span></span>
  <span class="comment1">― ‹ Alphabetised skip ›</span>
  <span class="quoted">"_skip_ra"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">II⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
  <span class="comment1">― ‹ Frame ›</span>
  <span class="quoted">"_frame"</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">:[</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>99<span class="main">,</span>0<span class="main">]</span> 100<span class="main">)</span>
  <span class="comment1">― ‹ Antiframe ›</span>
  <span class="quoted">"_antiframe"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">:⟦</span>_<span class="keyword1">⟧</span>"</span> <span class="main">[</span>79<span class="main">,</span>0<span class="main">]</span> 80<span class="main">)</span>
  <span class="comment1">― ‹ Relational Alphabet Extension ›</span>
  <span class="quoted">"_rel_aext"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> salpha <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span>"</span> 90<span class="main">)</span>
  <span class="comment1">― ‹ Relational Alphabet Restriction ›</span>
  <span class="quoted">"_rel_ares"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> salpha <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↾<span class="hidden">⇩</span><sub>r</sub></span>"</span> 90<span class="main">)</span>
  <span class="comment1">― ‹ Frame Extension ›</span>
  <span class="quoted">"_rel_frext"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">:[</span>_<span class="keyword1">]<span class="hidden">⇧</span><sup>+</sup></span>"</span> <span class="main">[</span>99<span class="main">,</span>0<span class="main">]</span> 100<span class="main">)</span>
  <span class="comment1">― ‹ Nameset ›</span>
  <span class="quoted">"_nameset"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"salpha <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ns</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span>999<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_utp_if <span class="free">b</span> <span class="free">P</span> <span class="free">Q</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span>"</span>
  <span class="quoted">"<span class="main">;;</span> <span class="free">x</span> <span class="main">:</span> <span class="free">l</span> <span class="main">∙</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="main">(</span><span class="keyword1">CONST</span> seqr_iter<span class="main">)</span> <span class="free">l</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"_mk_usubst <span class="free">σ</span> <span class="main">(</span>_svid_unit <span class="free">x</span><span class="main">)</span> <span class="free">v</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">&amp;</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span>
  <span class="quoted">"_mk_usubst <span class="free">σ</span> <span class="main">(</span>_svid_list <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>_uexprs <span class="free">v</span> <span class="free">vs</span><span class="main">)</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="main">(</span>_mk_usubst <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="main">&amp;</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="free">vs</span><span class="main">)</span>"</span>
  <span class="quoted">"_assignment <span class="free">xs</span> <span class="free">vs</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> uassigns <span class="main">(</span>_mk_usubst <span class="main">(</span><span class="keyword1">CONST</span> id<span class="main">)</span> <span class="free">xs</span> <span class="free">vs</span><span class="main">)</span>"</span>
  <span class="quoted">"_assignment <span class="free">x</span> <span class="free">v</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uassigns <span class="main">(</span><span class="keyword1">CONST</span> subst_upd <span class="main">(</span><span class="keyword1">CONST</span> id<span class="main">)</span> <span class="free">x</span> <span class="free">v</span><span class="main">)</span>"</span>
  <span class="quoted">"_assignment <span class="free">x</span> <span class="free">v</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_assignment <span class="main">(</span>_spvar <span class="free">x</span><span class="main">)</span> <span class="free">v</span>"</span>
  <span class="quoted">"_nd_assign <span class="free">x</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> nd_assign <span class="main">(</span>_mk_svid_list <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_nd_assign <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> nd_assign <span class="free">x</span>"</span>
  <span class="quoted">"x<span class="main">,</span>y <span class="main">:=</span> <span class="free">u</span><span class="main">,</span><span class="free">v</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uassigns <span class="main">(</span><span class="keyword1">CONST</span> subst_upd <span class="main">(</span><span class="keyword1">CONST</span> subst_upd <span class="main">(</span><span class="keyword1">CONST</span> id<span class="main">)</span> <span class="main">(</span><span class="keyword1">CONST</span> svar <span class="free">x</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">CONST</span> svar <span class="free">y</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span>
  <span class="quoted">"_skip_ra <span class="free">v</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> skip_ra <span class="free">v</span>"</span>
  <span class="quoted">"_frame <span class="free">x</span> <span class="free">P</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> frame <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_frame <span class="main">(</span>_salphaset <span class="main">(</span>_salphamk <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> frame <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_antiframe <span class="free">x</span> <span class="free">P</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> antiframe <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_antiframe <span class="main">(</span>_salphaset <span class="main">(</span>_salphamk <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> antiframe <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_nameset <span class="free">x</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> nameset <span class="free">x</span> <span class="free">P</span>"</span>
  <span class="quoted">"_rel_aext <span class="free">P</span> <span class="free">a</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> rel_aext <span class="free">P</span> <span class="free">a</span>"</span>
  <span class="quoted">"_rel_ares <span class="free">P</span> <span class="free">a</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> rel_ares <span class="free">P</span> <span class="free">a</span>"</span>
  <span class="quoted">"_rel_frext <span class="free">a</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> rel_frext <span class="free">a</span> <span class="free">P</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following code sets up pretty-printing for homogeneous relational expressions. We cannot 
  do this via the ``translations'' command as we only want the rule to apply when the input and output
  alphabet types are the same. The code has to deconstruct a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'α</span></span><span class="main"><span class="main">)</span></span> uexpr"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type, determine 
  that it is relational (product alphabet), and then checks if the types \emph{alpha} and \emph{beta} 
  are the same. If they are, the type is printed as a \emph{hexpr}. Otherwise, we have no match. 
  We then set up a regular translation for the \emph{hrel} type that uses this. ›</span></span>
  
<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tr'</span> <span class="entity">ctxt</span> <span class="main">[</span> <span class="entity">a</span>
            <span class="main">,</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> "prod"<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span> $ <span class="entity">alpha</span> $ <span class="entity">beta</span> <span class="main">]</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">alpha</span> <span class="main">=</span> <span class="entity">beta</span><span class="main">)</span> 
    <span class="keyword2"><span class="keyword">then</span></span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> "hexpr"<span class="antiquote">}</span></span> $ <span class="entity">a</span> $ <span class="entity">alpha</span>
    <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Match<span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> "uexpr"<span class="antiquote">}</span></span><span class="main">,</span><span class="entity">tr'</span><span class="main">)</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>
›</span>
  
<span class="keyword1"><span class="command">translations</span></span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'α</span></span> hrel"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree"><span class="free">'α</span></span><span class="main">)</span> hexpr"</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Relation Properties ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We describe some properties of relations, including functional and injective relations. We
  also provide operators for extracting the domain and range of a UTP relation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ufunctional</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> urel <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ufunctional</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⟷</span> <span class="keyword1">II</span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uinj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> urel <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uinj</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⟷</span> <span class="keyword1">II</span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dom</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="main">∃</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌋<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ran</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> upred"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ran</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="main">∃</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⌋<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span></span>
  
<span class="comment1">― ‹ Configuration for UTP tactics. ›</span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span> <span class="comment1">― ‹ Reread <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">rep_eq</span><span class="antiquote">}</span></span> theorems. ›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Introduction laws ›</span></span>

<span class="keyword1" id="utp_rel-urel_refine_ext"><span class="command">lemma</span></span> urel_refine_ext<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">s</span><span class="main">»</span><span class="main">,</span><span class="main">«</span><span class="bound">s'</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">s</span><span class="main">»</span><span class="main">,</span><span class="main">«</span><span class="bound">s'</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-urel_eq_ext"><span class="command">lemma</span></span> urel_eq_ext<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">s</span><span class="main">»</span><span class="main">,</span><span class="main">«</span><span class="bound">s'</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">=</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">s</span><span class="main">»</span><span class="main">,</span><span class="main">«</span><span class="bound">s'</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction Laws ›</span></span>

<span class="keyword1" id="utp_rel-unrest_iuvar"><span class="command">lemma</span></span> unrest_iuvar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="main">$</span>x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_snd_lens_indep lift_pre_var outα_def unrest_aext_indep<span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_ouvar"><span class="command">lemma</span></span> unrest_ouvar <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="main">$</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inα_def lift_post_var snd_fst_lens_indep unrest_aext_indep<span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_semir_undash"><span class="command">lemma</span></span> unrest_semir_undash <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_semir_dash"><span class="command">lemma</span></span> unrest_semir_dash <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_cond"><span class="command">lemma</span></span> unrest_cond <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> x <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">b</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_lift_rcond"><span class="command">lemma</span></span> unrest_lift_rcond <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⟹</span> x <span class="main">♯</span> <span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>←</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_rcond_def<span class="main">)</span>
    
<span class="keyword1" id="utp_rel-unrest_inα_var"><span class="command">lemma</span></span> unrest_inα_var <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> inα <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">$</span>x <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_outα_var"><span class="command">lemma</span></span> unrest_outα_var <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> outα <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span><span class="main">)</span> uexpr<span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_pre_outα"><span class="command">lemma</span></span> unrest_pre_outα <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> outα_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_post_inα"><span class="command">lemma</span></span> unrest_post_inα <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inα_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_pre_in_var"><span class="command">lemma</span></span> unrest_pre_in_var <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">p1</span> <span class="main">⟹</span> <span class="main">$</span>x <span class="main">♯</span> <span class="main">⌈</span><span class="free">p1</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_post_out_var"><span class="command">lemma</span></span> unrest_post_out_var <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">p1</span> <span class="main">⟹</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="main">⌈</span><span class="free">p1</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_convr_outα"><span class="command">lemma</span></span> unrest_convr_outα <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">p</span> <span class="main">⟹</span> outα <span class="main">♯</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_convr_inα"><span class="command">lemma</span></span> unrest_convr_inα <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">p</span> <span class="main">⟹</span> inα <span class="main">♯</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">lens_defs</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_in_rel_var_res"><span class="command">lemma</span></span> unrest_in_rel_var_res <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">$</span>x <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>α</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_var_res_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_out_rel_var_res"><span class="command">lemma</span></span> unrest_out_rel_var_res <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>α</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_var_res_def <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_out_alpha_usubst_rel_lift"><span class="command">lemma</span></span> unrest_out_alpha_usubst_rel_lift <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel-unrest_in_rel_aext"><span class="command">lemma</span></span> unrest_in_rel_aext <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">$</span>y <span class="main">♯</span> <span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_aext_def unrest_aext_indep<span class="main">)</span>

<span class="keyword1" id="utp_rel-unrest_out_rel_aext"><span class="command">lemma</span></span> unrest_out_rel_aext <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">$</span>y<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_aext_def unrest_aext_indep<span class="main">)</span>

<span class="keyword1" id="utp_rel-rel_aext_false"><span class="command">lemma</span></span> rel_aext_false <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-rel_aext_seq"><span class="command">lemma</span></span> rel_aext_seq <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">;;</span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> aa b y<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">create</span><span class="hidden">⇘</span><sub><span class="free">a</span></sub><span class="hidden">⇙</span> <span class="improper">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_rel-rel_aext_cond"><span class="command">lemma</span></span> rel_aext_cond <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution laws ›</span></span>

<span class="keyword1" id="utp_rel-subst_seq_left"><span class="command">lemma</span></span> subst_seq_left <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pair_inject surjective_pairing<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-subst_seq_right"><span class="command">lemma</span></span> subst_seq_right <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pair_inject surjective_pairing<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following laws support substitution in heterogeneous relations for polymorphically
  typed literal expressions. These cannot be supported more generically due to limitations
  in HOL's type system. The laws are presented in a slightly strange way so as to be as
  general as possible. ›</span></span>

<span class="keyword1" id="utp_rel-bool_seqr_laws"><span class="command">lemma</span></span> bool_seqr_laws <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_rel-zero_one_seqr_laws"><span class="command">lemma</span></span> zero_one_seqr_laws <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="main">0</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="main">1</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">⟦</span><span class="main">0</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">⟦</span><span class="main">1</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_rel-numeral_seqr_laws"><span class="command">lemma</span></span> numeral_seqr_laws <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span><span class="main">⟦</span>numeral <span class="free">n</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">⟦</span>numeral <span class="free">n</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_rel-usubst_condr"><span class="command">lemma</span></span> usubst_condr <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">P</span> <span class="main">◃</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-subst_skip_r"><span class="command">lemma</span></span> subst_skip_r <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">†</span> <span class="keyword1">II</span> <span class="main">=</span> <span class="main">⟨</span><span class="main">⌊</span><span class="free">σ</span><span class="keyword1">⌋<span class="hidden">⇩</span><sub>s</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sndI surjective_pairing<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-subst_pre_skip"><span class="command">lemma</span></span> subst_pre_skip <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="keyword1">II</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel-subst_rel_lift_seq"><span class="command">lemma</span></span> subst_rel_lift_seq <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  
<span class="keyword1" id="utp_rel-subst_rel_lift_comp"><span class="command">lemma</span></span> subst_rel_lift_comp <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∘</span> <span class="main">⌈</span><span class="free">ρ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">=</span> <span class="main">⌈</span><span class="free">σ</span> <span class="main">∘</span> <span class="free">ρ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel-usubst_upd_in_comp"><span class="command">lemma</span></span> usubst_upd_in_comp <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">&amp;</span>inα<span class="main">:</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def fst_lens_def inα_def in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-usubst_upd_out_comp"><span class="command">lemma</span></span> usubst_upd_out_comp <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">&amp;</span>outα<span class="main">:</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def outα_def out_var_def snd_lens_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-subst_lift_upd"><span class="command">lemma</span></span> subst_lift_upd <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">=</span> <span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">⌈</span><span class="free">v</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">alpha</span></span> <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def fst_lens_def inα_def in_var_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-subst_drop_upd"><span class="command">lemma</span></span> subst_drop_upd <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⌋<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">=</span> <span class="main">⌊</span><span class="free">σ</span><span class="keyword1">⌋<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">⌊</span><span class="free">v</span><span class="main">⌋<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_simp</span>

<span class="keyword1" id="utp_rel-subst_lift_pre"><span class="command">lemma</span></span> subst_lift_pre <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">=</span> <span class="main">⌈</span><span class="free">σ</span> <span class="main">†</span> <span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apply_subst_ext fst_vwb_lens inα_def<span class="main">)</span> 
    
<span class="keyword1" id="utp_rel-unrest_usubst_lift_in"><span class="command">lemma</span></span> unrest_usubst_lift_in <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">$</span>x <span class="main">♯</span> <span class="main">⌈</span><span class="free">P</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_simp</span>

<span class="keyword1" id="utp_rel-unrest_usubst_lift_out"><span class="command">lemma</span></span> unrest_usubst_lift_out <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="main">⌈</span><span class="free">P</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_simp</span>

<span class="keyword1" id="utp_rel-subst_lift_cond"><span class="command">lemma</span></span> subst_lift_cond <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="main">⌈</span><span class="free">s</span><span class="main">⌉<span class="hidden">⇩</span><sub>←</sub></span> <span class="main">=</span> <span class="main">⌈</span><span class="free">σ</span> <span class="main">†</span> <span class="free">s</span><span class="main">⌉<span class="hidden">⇩</span><sub>←</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-msubst_seq"><span class="command">lemma</span></span> msubst_seq <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">⟧</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⟦</span><span class="bound">x</span><span class="main">→</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Alphabet laws ›</span></span>

<span class="keyword1" id="utp_rel-aext_cond"><span class="command">lemma</span></span> aext_cond <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">◃</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-aext_seq"><span class="command">lemma</span></span> aext_seq <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> wb_lens_weak weak_lens.put_get<span class="main">)</span>

<span class="keyword1" id="utp_rel-rcond_lift_true"><span class="command">lemma</span></span> rcond_lift_true <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="keyword1">true</span><span class="main">⌉<span class="hidden">⇩</span><sub>←</sub></span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_rel-rcond_lift_false"><span class="command">lemma</span></span> rcond_lift_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="keyword1">false</span><span class="main">⌉<span class="hidden">⇩</span><sub>←</sub></span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_rel-rel_ares_aext"><span class="command">lemma</span></span> rel_ares_aext <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a<span class="main">)</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-rel_aext_ares"><span class="command">lemma</span></span> rel_aext_ares <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">$</span>a<span class="main">,</span> <span class="main">$</span>a<span class="main">´</span><span class="main">}</span> <span class="main">♮</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>r</sub></span> a <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-rel_aext_uses"><span class="command">lemma</span></span> rel_aext_uses <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">$</span>a<span class="main">,</span> <span class="main">$</span>a<span class="main">´</span><span class="main">}</span> <span class="main">♮</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>r</sub></span> a<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>    
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Relational unrestriction ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Relational unrestriction states that a variable is both unchanged by a relation, and is
  not "read" by the relation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RID</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RID</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">declare</span></span> RID_def <span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span>

<span class="keyword1" id="utp_rel-RID1"><span class="command">lemma</span></span> RID1<span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> x <span class="main">:=</span> <span class="main">«</span><span class="bound">v</span><span class="main">»</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">)</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens.get_put wb_lens_weak weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="utp_rel-RID2"><span class="command">lemma</span></span> RID2<span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> x <span class="main">:=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb vwb_lens_wb wb_lens.get_put wb_lens_def weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="utp_rel-RID_assign_commute"><span class="command">lemma</span></span> RID_assign_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> x <span class="main">:=</span> <span class="main">«</span><span class="bound">v</span><span class="main">»</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RID1 RID2<span class="main">)</span>
  
<span class="keyword1" id="utp_rel-RID_idem"><span class="command">lemma</span></span> RID_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-RID_mono"><span class="command">lemma</span></span> RID_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-RID_pr_var"><span class="command">lemma</span></span> RID_pr_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"RID <span class="main">(</span>pr_var <span class="free">x</span><span class="main">)</span> <span class="main">=</span> RID <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_var_def<span class="main">)</span>
    
<span class="keyword1" id="utp_rel-RID_skip_r"><span class="command">lemma</span></span> RID_skip_r<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> vwb_lens.put_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="utp_rel-skip_r_RID"><span class="command">lemma</span></span> skip_r_RID <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">II</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def RID_skip_r<span class="main">)</span>
    
<span class="keyword1" id="utp_rel-RID_disj"><span class="command">lemma</span></span> RID_disj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∨</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel-disj_RID"><span class="command">lemma</span></span> disj_RID <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span> <span class="free">Q</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def RID_disj<span class="main">)</span>

<span class="keyword1" id="utp_rel-RID_conj"><span class="command">lemma</span></span> RID_conj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∧</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∧</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-conj_RID"><span class="command">lemma</span></span> conj_RID <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">P</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span> <span class="free">Q</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Healthy_if Healthy_intro RID_conj<span class="main">)</span>
    
<span class="keyword1" id="utp_rel-RID_assigns_r_diff"><span class="command">lemma</span></span> RID_assigns_r_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens.get_put wb_lens_weak weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_rel-assigns_r_RID"><span class="command">lemma</span></span> assigns_r_RID <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def RID_assigns_r_diff<span class="main">)</span>
  
<span class="keyword1" id="utp_rel-RID_assign_r_same"><span class="command">lemma</span></span> RID_assign_r_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span>x <span class="main">:=</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> vwb_lens.put_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_rel-RID_seq_left"><span class="command">lemma</span></span> RID_seq_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RID_def <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> mwb_lens.put_put vwb_lens_def wb_lens_weak weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel-RID_seq_right"><span class="command">lemma</span></span> RID_seq_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RID_def <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span>  <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span> <span class="quasi_keyword">robust</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> mwb_lens.put_put vwb_lens_def wb_lens_weak weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">;;</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel-seqr_RID_closed"><span class="command">lemma</span></span> seqr_RID_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">P</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">;</span> <span class="free">Q</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Healthy_def RID_seq_right<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unrest_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">♯♯</span>"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">♯♯</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> unrest_relation_def <span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span>

<span class="keyword1" id="utp_rel-runrest_assign_commute"><span class="command">lemma</span></span> runrest_assign_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">:=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RID2 Healthy_def unrest_relation_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-runrest_ident_var"><span class="command">lemma</span></span> runrest_ident_var<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">♯♯</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RID_def assms Healthy_def unrest_relation_def utp_pred_laws.inf.cobounded2 utp_pred_laws.inf_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> utp_pred_laws.inf.assoc utp_pred_laws.inf_left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel-skip_r_runrest"><span class="command">lemma</span></span> skip_r_runrest <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_relation_def <span class="dynamic"><span class="dynamic">closure</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-assigns_r_runrest"><span class="command">lemma</span></span> assigns_r_runrest<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">σ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_relation_def <span class="dynamic"><span class="dynamic">closure</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel-seq_r_runrest"><span class="command">lemma</span></span> seq_r_runrest <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">♯♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">♯♯</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">♯♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unrest_relation_def <span class="dynamic"><span class="dynamic">closure</span></span> <span class="main">)</span>

<span class="keyword1" id="utp_rel-false_runrest"><span class="command">lemma</span></span> false_runrest <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">♯♯</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel-and_runrest"><span class="command">lemma</span></span> and_runrest <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="free">P</span><span class="main">;</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RID_conj Healthy_def unrest_relation_def<span class="main">)</span>

<span class="keyword1" id="utp_rel-or_runrest"><span class="command">lemma</span></span> or_runrest <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="free">P</span><span class="main">;</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">♯♯</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RID_disj Healthy_def unrest_relation_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_recursion">
<div class="head">
<h1>Theory utp_recursion</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Fixed-points and Recursion ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_recursion
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="utp_pred_laws.html">utp_pred_laws</a>
    <a href="utp_rel.html">utp_rel</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Fixed-point Laws ›</span></span>
  
<span class="keyword1" id="utp_recursion-mu_id"><span class="command">lemma</span></span> mu_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym gfp_upperbound<span class="main">)</span>

<span class="keyword1" id="utp_recursion-mu_const"><span class="command">lemma</span></span> mu_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gfp_const<span class="main">)</span>

<span class="keyword1" id="utp_recursion-nu_id"><span class="command">lemma</span></span> nu_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>                                                            
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lfp_lowerbound utp_pred_laws.bot.extremum_unique<span class="main">)</span>

<span class="keyword1" id="utp_recursion-nu_const"><span class="command">lemma</span></span> nu_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_const<span class="main">)</span>

<span class="keyword1" id="utp_recursion-mu_refine_intro"><span class="command">lemma</span></span> mu_refine_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">⇒</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">F</span><span class="main">(</span><span class="free">C</span> <span class="main">⇒</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">C</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">⇒</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">μ</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">⇒</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">ν</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_lowerbound<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Obtaining Unique Fixed-points ›</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Obtaining termination proofs via approximation chains. Theorems and proofs adapted
  from Chapter 2, page 63 of the UTP book~\cite{Hoare&amp;98}.  ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> chain <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> upred"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> chain <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_recursion-chain0"><span class="command">lemma</span></span> chain0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>chain_def<span class="main">)</span>

<span class="keyword1" id="utp_recursion-chainI"><span class="command">lemma</span></span> chainI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Y</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_def<span class="main">)</span>

<span class="keyword1" id="utp_recursion-chainE"><span class="command">lemma</span></span> chainE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">Y</span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">false</span><span class="main">;</span> <span class="free">Y</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_def<span class="main">)</span>

<span class="keyword1" id="utp_recursion-L274"><span class="command">lemma</span></span> L274<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">E</span> <span class="bound">n</span> <span class="keyword1">∧<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span>range <span class="free">E</span><span class="main">)</span> <span class="main">∧</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="main">(</span>range <span class="free">E</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Constructive chains ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">constr</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> upred <span class="main">⇒</span> <span class="tfree">'a</span> upred<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> chain <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">constr</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟷</span> chain <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="bound">X</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_recursion-constrI"><span class="command">lemma</span></span> constrI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">E</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="bound">X</span> <span class="main">∧</span> <span class="free">E</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">E</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"constr <span class="free">F</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> constr_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This lemma gives a way of showing that there is a unique fixed-point when
        the predicate function can be built using a constructive function F
        over an approximation chain E ›</span></span>

<span class="keyword1" id="utp_recursion-chain_pred_terminates"><span class="command">lemma</span></span> chain_pred_terminates<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"constr <span class="free">F</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="main">(</span>range <span class="free">E</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="main">(</span>range <span class="free">E</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">E</span> <span class="bound">n</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="bound">n</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> constr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> hyp <span class="main">=</span> this
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> gfp_unfold<span class="main">[</span><span class="operator">OF</span> hyp<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> constr_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_comm constr_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conj_comm constr_def lfp_unfold<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> L274<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> constr_fp_uniq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"constr <span class="free">F</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span>range <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">C</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> chain_pred_terminates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Noetherian Induction Instantiation›</span></span>
      
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Contribution from Yakoub Nemouchi.The following generalization was used by Tobias Nipkow
        and Peter Lammich  in \emph{Refine\_Monadic} ›</span></span>

<span class="keyword1" id="utp_recursion-wf_fixp_uinduct_pure_ueq_gen"><span class="command">lemma</span></span>  wf_fixp_uinduct_pure_ueq_gen<span class="main">:</span>     
  <span class="keyword2"><span class="keyword">assumes</span></span> fixp_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fp</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">(</span><span class="free">fp</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>              WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     induct_step<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">st</span><span class="main">.</span> <span class="main">⟦</span><span class="main">⋀</span><span class="bound">st'</span><span class="main">.</span> <span class="main">(</span><span class="bound">st'</span><span class="main">,</span><span class="bound">st</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>  <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st'</span><span class="main">»</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">)</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="free">fp</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">B</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">fp</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">st</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="skolem">st</span><span class="main">»</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">fp</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> WF <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct_rule<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="skolem">x</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">B</span> <span class="main">(</span><span class="free">fp</span> <span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induct_step<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> fixp_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_simp</span>  
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next lemma shows that using substitution also work. However it is not that generic
        nor practical for proof automation ... ›</span></span>

<span class="keyword1" id="utp_recursion-refine_usubst_to_ueq"><span class="command">lemma</span></span> refine_usubst_to_ueq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">E</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span><span class="main">⟦</span><span class="main">«</span><span class="free">st'</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>E<span class="main">⟧</span> <span class="main">⊑</span> <span class="free">f</span><span class="main">⟦</span><span class="main">«</span><span class="free">st'</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>E<span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">$</span>E <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">st'</span><span class="main">»</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ By instantiation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> wf_fixp_uinduct_pure_ueq_gen<span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">μ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and lifting of the 
        well-founded relation we have ... ›</span></span>
  
<span class="keyword1" id="utp_recursion-mu_rec_total_pure_rule"><span class="command">lemma</span></span> mu_rec_total_pure_rule<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     M<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">B</span>"</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span>     induct_step<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span> <span class="bound">st</span><span class="main">.</span>  <span class="main">⟦</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">B</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">μ</span> <span class="free">B</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_fixp_uinduct_pure_ueq_gen<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> fp<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="keyword1">μ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Pre<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">Pre</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">B</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M def_gfp_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> WF<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">st'</span><span class="main">.</span> <span class="main">(</span><span class="bound">st'</span><span class="main">,</span> <span class="bound">st</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st'</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> 
                <span class="keyword1">μ</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span> 
                <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">B</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induct_step<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_recursion-nu_rec_total_pure_rule"><span class="command">lemma</span></span> nu_rec_total_pure_rule<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     M<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">B</span>"</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span>     induct_step<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span> <span class="bound">st</span><span class="main">.</span>  <span class="main">⟦</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">B</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">ν</span> <span class="free">B</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_fixp_uinduct_pure_ueq_gen<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> fp<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="keyword1">ν</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Pre<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">Pre</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">B</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M def_lfp_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> WF<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">st'</span><span class="main">.</span> <span class="main">(</span><span class="bound">st'</span><span class="main">,</span> <span class="bound">st</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st'</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> 
                <span class="keyword1">ν</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span> 
                <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">B</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induct_step<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">B</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">Pre</span></span> <span class="main"><span class="main">∧</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">⌈</span></span><span class="free"><span class="free">E</span></span><span class="main"><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">«</span></span><span class="free"><span class="free">st</span></span><span class="main"><span class="main">»</span></span><span class="keyword1"><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span></span><span class="keyword1"><span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span></span><span class="main"><span class="main">«</span></span><span class="free"><span class="free">R</span></span><span class="main"><span class="main">»</span></span> <span class="main"><span class="main">⇒</span></span> <span class="free"><span class="free">Post</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⊑</span></span> <span class="free"><span class="free">B</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">μ</span></span> <span class="free"><span class="free">B</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"mono <span class="free"><span class="free">B</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, thus,  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mu_rec_total_pure_rule<span class="antiquote"><span class="antiquote">}</span></span></span></span> can be expressed as follows›</span></span>
  
<span class="keyword1" id="utp_recursion-mu_rec_total_utp_rule"><span class="command">lemma</span></span> mu_rec_total_utp_rule<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     M<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">B</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span>     induct_step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">μ</span> <span class="free">B</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mu_rec_total_pure_rule<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">e</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">B</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M induct_step monoD order_subst2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_recursion-nu_rec_total_utp_rule"><span class="command">lemma</span></span> nu_rec_total_utp_rule<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     M<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">B</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span>     induct_step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">B</span> <span class="main">(</span><span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">ν</span> <span class="free">B</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nu_rec_total_pure_rule<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">e</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Pre</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">B</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M induct_step monoD order_subst2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_sequent">
<div class="head">
<h1>Theory utp_sequent</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Sequent Calculus ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_sequent
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_pred_laws.html">utp_pred_laws</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sequent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred <span class="main">⇒</span> <span class="tfree">'α</span> upred <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊩</span>"</span> 15<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sequent</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sequent_triv</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊩</span> _"</span> <span class="main">[</span>15<span class="main">]</span> 15<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊩</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">true</span> <span class="main">⊩</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⊩</span> <span class="free">P</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">true</span> <span class="main">⊩</span> <span class="free">P</span>"</span>

<span class="keyword1" id="utp_sequent-sTrue"><span class="command">lemma</span></span> sTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊩</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_sequent-sAx"><span class="command">lemma</span></span> sAx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊩</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_sequent-sNotI"><span class="command">lemma</span></span> sNotI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">⊩</span> <span class="keyword1">false</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="main">¬</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_sequent-sConjI"><span class="command">lemma</span></span> sConjI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="free">P</span><span class="main">;</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_sequent-sImplI"><span class="command">lemma</span></span> sImplI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊩</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="main">(</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_rel_laws">
<div class="head">
<h1>Theory utp_rel_laws</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Relational Calculus Laws ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_rel_laws
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="utp_rel.html">utp_rel</a>
    <a href="utp_recursion.html">utp_recursion</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conditional Laws ›</span></span>
  
<span class="keyword1" id="utp_rel_laws-comp_cond_left_distr"><span class="command">lemma</span></span> comp_cond_left_distr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-cond_seq_left_distr"><span class="command">lemma</span></span> cond_seq_left_distr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-cond_seq_right_distr"><span class="command">lemma</span></span> cond_seq_right_distr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alternative expression of conditional using assumptions and choice ›</span></span>

<span class="keyword1" id="utp_rel_laws-rcond_rassume_expand"><span class="command">lemma</span></span> rcond_rassume_expand<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">b</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">¬</span> <span class="free">b</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Precondition and Postcondition Laws ›</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> precond_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>outα <span class="main">♯</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> postcond_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">true</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>inα <span class="main">♯</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-precond_right_unit"><span class="command">lemma</span></span> precond_right_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="main">;;</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> precond_equiv<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-postcond_left_unit"><span class="command">lemma</span></span> postcond_left_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">true</span> <span class="main">;;</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> postcond_equiv<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> precond_left_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">true</span> <span class="main">;;</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> feasibile_iff_true_right_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="keyword1">true</span> <span class="main">⟷</span> <span class="main">`</span><span class="main">∃</span> outα <span class="main">∙</span> <span class="free">P</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sequential Composition Laws ›</span></span>
    
<span class="keyword1" id="utp_rel_laws-seqr_assoc"><span class="command">lemma</span></span> seqr_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_left_unit"><span class="command">lemma</span></span> seqr_left_unit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">II</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_right_unit"><span class="command">lemma</span></span> seqr_right_unit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="keyword1">II</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_left_zero"><span class="command">lemma</span></span> seqr_left_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_rel_laws-seqr_right_zero"><span class="command">lemma</span></span> seqr_right_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="keyword1">false</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_rel_laws-impl_seqr_mono"><span class="command">lemma</span></span> impl_seqr_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">`</span><span class="main">;</span> <span class="main">`</span><span class="free">R</span> <span class="main">⇒</span> <span class="free">S</span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">S</span><span class="main">)</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_blast</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_mono"><span class="command">lemma</span></span> seqr_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-seqr_monotonic"><span class="command">lemma</span></span> seqr_monotonic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mono <span class="free">P</span><span class="main">;</span> mono <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> mono <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="bound">X</span> <span class="main">;;</span> <span class="free">Q</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_blast</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-Monotonic_seqr_tail"><span class="command">lemma</span></span> Monotonic_seqr_tail <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="main">(</span><span class="main">λ</span> <span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">F</span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms monoD monoI seqr_mono<span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-seqr_exists_left"><span class="command">lemma</span></span> seqr_exists_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_exists_right"><span class="command">lemma</span></span> seqr_exists_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_or_distl"><span class="command">lemma</span></span> seqr_or_distl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_or_distr"><span class="command">lemma</span></span> seqr_or_distr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_inf_distl"><span class="command">lemma</span></span> seqr_inf_distl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_inf_distr"><span class="command">lemma</span></span> seqr_inf_distr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_and_distr_ufunc"><span class="command">lemma</span></span> seqr_and_distr_ufunc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ufunctional <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_and_distl_uinj"><span class="command">lemma</span></span> seqr_and_distl_uinj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uinj <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_unfold"><span class="command">lemma</span></span> seqr_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">v</span> <span class="main">∙</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_middle"><span class="command">lemma</span></span> seqr_middle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">v</span> <span class="main">∙</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.source_stability<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_left_one_point"><span class="command">lemma</span></span> seqr_left_one_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_right_one_point"><span class="command">lemma</span></span> seqr_right_one_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">$</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_left_one_point_true"><span class="command">lemma</span></span> seqr_left_one_point_true<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms seqr_left_one_point true_alt_def upred_eq_true<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_left_one_point_false"><span class="command">lemma</span></span> seqr_left_one_point_false<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">$</span>x<span class="main">´</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms false_alt_def seqr_left_one_point upred_eq_false<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_right_one_point_true"><span class="command">lemma</span></span> seqr_right_one_point_true<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms seqr_right_one_point true_alt_def upred_eq_true<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_right_one_point_false"><span class="command">lemma</span></span> seqr_right_one_point_false<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">¬</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms false_alt_def seqr_right_one_point upred_eq_false<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_insert_ident_left"><span class="command">lemma</span></span> seqr_insert_ident_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> vwb_lens_wb wb_lens_weak weak_lens.put_get<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_insert_ident_right"><span class="command">lemma</span></span> seqr_insert_ident_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> vwb_lens_def wb_lens_def weak_lens.put_get<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_var_ident_lift"><span class="command">lemma</span></span> seq_var_ident_lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens_weak weak_lens.put_get<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_bool_split"><span class="command">lemma</span></span> seqr_bool_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">∨</span> <span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> seqr_middle<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-cond_inter_var_split"><span class="command">lemma</span></span> cond_inter_var_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">R</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">R</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_def seqr_or_distl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">$</span>x<span class="main">´</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">R</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> <span class="free">R</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqr_left_one_point_true seqr_left_one_point_false assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> seqr_pre_transfer<span class="main">:</span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> seqr_pre_transfer'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">q</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⌈</span><span class="free">q</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> seqr_post_out<span class="main">:</span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_post_var_out"><span class="command">lemma</span></span> seqr_post_var_out<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> seqr_post_transfer<span class="main">:</span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_pre_out"><span class="command">lemma</span></span> seqr_pre_out<span class="main">:</span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_pre_var_out"><span class="command">lemma</span></span> seqr_pre_var_out<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_true_lemma"><span class="command">lemma</span></span> seqr_true_lemma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="keyword1">true</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">true</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_to_conj"><span class="command">lemma</span></span> seqr_to_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> outα <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> inα <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> postcond_left_unit seqr_pre_out utp_pred_laws.inf_top.right_neutral<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-shEx_lift_seq_1"><span class="command">lemma</span></span> shEx_lift_seq_1 <span class="main">[</span><span class="operator">uquant_lift</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_rel_laws-shEx_mem_lift_seq_1"><span class="command">lemma</span></span> shEx_mem_lift_seq_1 <span class="main">[</span><span class="operator">uquant_lift</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>

<span class="keyword1" id="utp_rel_laws-shEx_lift_seq_2"><span class="command">lemma</span></span> shEx_lift_seq_2 <span class="main">[</span><span class="operator">uquant_lift</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_rel_laws-shEx_mem_lift_seq_2"><span class="command">lemma</span></span> shEx_mem_lift_seq_2 <span class="main">[</span><span class="operator">uquant_lift</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Iterated Sequential Composition Laws ›</span></span>
  
<span class="keyword1" id="utp_rel_laws-iter_seqr_nil"><span class="command">lemma</span></span> iter_seqr_nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">;;</span> <span class="bound">i</span> <span class="main">:</span> <span class="main">[]</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqr_iter_def<span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-iter_seqr_cons"><span class="command">lemma</span></span> iter_seqr_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">;;</span> <span class="bound">i</span> <span class="main">:</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">;;</span> <span class="bound">i</span> <span class="main">:</span> <span class="free">xs</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqr_iter_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Quantale Laws ›</span></span>

<span class="keyword1" id="utp_rel_laws-seq_Sup_distl"><span class="command">lemma</span></span> seq_Sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">Q</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_Sup_distr"><span class="command">lemma</span></span> seq_Sup_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">P</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_UINF_distl"><span class="command">lemma</span></span> seq_UINF_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">Q</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_as_Sup_collect seq_Sup_distl<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_UINF_distl'"><span class="command">lemma</span></span> seq_UINF_distl'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">∙</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UINF_mem_UNIV seq_UINF_distl<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_UINF_distr"><span class="command">lemma</span></span> seq_UINF_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">P</span></span></span><span class="main">∈</span><span class="free">A</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UINF_as_Sup_collect seq_Sup_distr<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_UINF_distr'"><span class="command">lemma</span></span> seq_UINF_distr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">P</span></span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UINF_mem_UNIV seq_UINF_distr<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_SUP_distl"><span class="command">lemma</span></span> seq_SUP_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_image seq_Sup_distl<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_SUP_distr"><span class="command">lemma</span></span> seq_SUP_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_Sup_distr<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Skip Laws ›</span></span>
    
<span class="keyword1" id="utp_rel_laws-cond_skip"><span class="command">lemma</span></span> cond_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">II</span> <span class="main">∧</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-pre_skip_post"><span class="command">lemma</span></span> pre_skip_post<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">II</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-skip_var"><span class="command">lemma</span></span> skip_var<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span>x <span class="main">∧</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">II</span> <span class="main">∧</span> <span class="main">$</span>x<span class="main">´</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-skip_r_unfold"><span class="command">lemma</span></span> skip_r_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">II</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> <span class="keyword1">II</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>α</sub></span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-skip_r_alpha_eq"><span class="command">lemma</span></span> skip_r_alpha_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">II</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-skip_ra_unfold"><span class="command">lemma</span></span> skip_ra_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"II<span class="hidden">⇘</span><sub>x<span class="main">;</span>y</sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>x <span class="main">∧</span> II<span class="hidden">⇘</span><sub>y</sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-skip_res_as_ra"><span class="command">lemma</span></span> skip_res_as_ra<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">II</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>α</sub></span><span class="free">x</span> <span class="main">=</span> II<span class="hidden">⇘</span><sub>y</sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lens_indep_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Assignment Laws ›</span></span>
  
<span class="keyword1" id="utp_rel_laws-assigns_subst"><span class="command">lemma</span></span> assigns_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="main">⟨</span><span class="free">ρ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">ρ</span> <span class="main">∘</span> <span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_r_comp"><span class="command">lemma</span></span> assigns_r_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌈</span><span class="free">σ</span><span class="keyword1">⌉<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">†</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_r_feasible"><span class="command">lemma</span></span> assigns_r_feasible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">;;</span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_subst"><span class="command">lemma</span></span> assign_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> mwb_lens <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">⌈</span><span class="free">u</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">]</span> <span class="main">†</span> <span class="main">(</span>y <span class="main">:=</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x<span class="main">,</span> y<span class="main">)</span> <span class="main">:=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="main">[</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">u</span><span class="main">]</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_vacuous_skip"><span class="command">lemma</span></span> assign_vacuous_skip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x <span class="main">:=</span> <span class="main">&amp;</span>x<span class="main">)</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following law shows the case for the above law when $x$ is only mainly-well behaved. We
  require that the state is one of those in which $x$ is well defined using and assumption. ›</span></span>

<span class="keyword1" id="utp_rel_laws-assign_vacuous_assume"><span class="command">lemma</span></span> assign_vacuous_assume<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">&amp;</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="keyword1">𝒮</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span><span class="main">»</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">;;</span> <span class="main">(</span>x <span class="main">:=</span> <span class="main">&amp;</span>x<span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">&amp;</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="keyword1">𝒮</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span><span class="main">»</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_rel_laws-assign_simultaneous"><span class="command">lemma</span></span> assign_simultaneous<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span> <span class="main">:=</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="main">&amp;</span>y<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms usubst_upd_comm usubst_upd_var_id<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_idem"><span class="command">lemma</span></span> assigns_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>x<span class="main">,</span>x<span class="main">)</span> <span class="main">:=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_comp"><span class="command">lemma</span></span> assigns_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">;;</span> <span class="main">⟨</span><span class="free">g</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_r_comp <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_cond"><span class="command">lemma</span></span> assigns_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">⟨</span><span class="free">g</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">f</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">g</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_r_conv"><span class="command">lemma</span></span> assigns_r_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">⟨</span>inv <span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_is_inj bij_is_surj surj_f_inv_f<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_pred_transfer"><span class="command">lemma</span></span> assign_pred_transfer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">∧</span> x <span class="main">:=</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-assign_r_comp"><span class="command">lemma</span></span> assign_r_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"x <span class="main">:=</span> <span class="free">u</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span><span class="main">⟦</span><span class="main">⌈</span><span class="free">u</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_r_comp <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">alpha</span></span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-assign_test"><span class="command">lemma</span></span> assign_test<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>x <span class="main">:=</span> <span class="main">«</span><span class="free">u</span><span class="main">»</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x <span class="main">:=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_comp <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_twice"><span class="command">lemma</span></span> assign_twice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> mwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">f</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_comp <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span>
 
<span class="keyword1" id="utp_rel_laws-assign_commute"><span class="command">lemma</span></span> assign_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"x <span class="main">♯</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"y <span class="main">♯</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> y <span class="main">:=</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>y <span class="main">:=</span> <span class="free">f</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_comm<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_cond"><span class="command">lemma</span></span> assign_cond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="main">(</span><span class="free">b</span><span class="main">⟦</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> <span class="main">▹</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_rcond"><span class="command">lemma</span></span> assign_rcond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="main">(</span><span class="free">b</span><span class="main">⟦</span><span class="free">e</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">e</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_r_alt_def"><span class="command">lemma</span></span> assign_r_alt_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"x <span class="main">:=</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">II</span><span class="main">⟦</span><span class="main">⌈</span><span class="free">v</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_r_ufunc"><span class="command">lemma</span></span> assigns_r_ufunc<span class="main">:</span> <span class="quoted"><span class="quoted">"ufunctional <span class="main">⟨</span><span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_r_uinj"><span class="command">lemma</span></span> assigns_r_uinj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span> <span class="main">⟹</span> uinj <span class="main">⟨</span><span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_eq<span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-assigns_r_swap_uinj"><span class="command">lemma</span></span> assigns_r_swap_uinj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> vwb_lens <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> uinj <span class="main">(</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span> <span class="main">:=</span> <span class="main">(</span><span class="main">&amp;</span>y<span class="main">,</span><span class="main">&amp;</span>x<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assigns_r_uinj pr_var_def swap_usubst_inj<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assign_unfold"><span class="command">lemma</span></span> assign_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>x <span class="main">:=</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⌈</span><span class="free">v</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="keyword1">II</span><span class="keyword1">↾<span class="hidden">⇩</span><sub>α</sub></span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> vwb_lens.put_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Non-deterministic Assignment Laws ›</span></span>

<span class="keyword1" id="utp_rel_laws-nd_assign_comp"><span class="command">lemma</span></span> nd_assign_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> x <span class="main">:=</span> <span class="main">*</span> <span class="main">;;</span> y <span class="main">:=</span> <span class="main">*</span> <span class="main">=</span> x<span class="main">,</span>y <span class="main">:=</span> <span class="main">*</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> lens_indep_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_rel_laws-nd_assign_assign"><span class="command">lemma</span></span> nd_assign_assign<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">e</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">:=</span> <span class="main">*</span> <span class="main">;;</span> x <span class="main">:=</span> <span class="free">e</span> <span class="main">=</span> x <span class="main">:=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Converse Laws ›</span></span>

<span class="keyword1" id="utp_rel_laws-convr_invol"><span class="command">lemma</span></span> convr_invol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_rel_laws-lit_convr"><span class="command">lemma</span></span> lit_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">«</span><span class="free">v</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_rel_laws-uivar_convr"><span class="command">lemma</span></span> uivar_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span>x<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">$</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_rel_laws-uovar_convr"><span class="command">lemma</span></span> uovar_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span>x<span class="main">´</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">$</span>x"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_auto</span>

<span class="keyword1" id="utp_rel_laws-uop_convr"><span class="command">lemma</span></span> uop_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uop <span class="free">f</span> <span class="free">u</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> uop <span class="free">f</span> <span class="main">(</span><span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-bop_convr"><span class="command">lemma</span></span> bop_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bop <span class="free">f</span> <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> bop <span class="free">f</span> <span class="main">(</span><span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-eq_convr"><span class="command">lemma</span></span> eq_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-not_convr"><span class="command">lemma</span></span> not_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-disj_convr"><span class="command">lemma</span></span> disj_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">∨</span> <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">∨</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-conj_convr"><span class="command">lemma</span></span> conj_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">∧</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seqr_convr"><span class="command">lemma</span></span> seqr_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">;;</span> <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">;;</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-pre_convr"><span class="command">lemma</span></span> pre_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-post_convr"><span class="command">lemma</span></span> post_convr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Assertion and Assumption Laws ›</span></span>

<span class="keyword1"><span class="command">declare</span></span> sublens_def <span class="main">[</span><span class="operator">lens_defs</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  
<span class="keyword1" id="utp_rel_laws-assume_false"><span class="command">lemma</span></span> assume_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">false</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  
<span class="keyword1" id="utp_rel_laws-assume_true"><span class="command">lemma</span></span> assume_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">true</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-assume_seq"><span class="command">lemma</span></span> assume_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">b</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">;;</span> <span class="main">[</span><span class="free">c</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="free">c</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assert_false"><span class="command">lemma</span></span> assert_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">false</span><span class="main">}<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assert_true"><span class="command">lemma</span></span> assert_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">true</span><span class="main">}<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-assert_seq"><span class="command">lemma</span></span> assert_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">}<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="main">;;</span> <span class="main">{</span><span class="free">c</span><span class="main">}<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="free">c</span><span class="main">)</span><span class="main">}<span class="hidden">⇩</span><sub>⊥</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Frame and Antiframe Laws ›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> frame

<span class="keyword1" id="utp_rel_laws-frame_all"><span class="command">lemma</span></span> frame_all <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Σ</span><span class="main">:[</span><span class="free">P</span><span class="main">]</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-frame_none"><span class="command">lemma</span></span> frame_none <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∅</span><span class="main">:[</span><span class="free">P</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-frame_commute"><span class="command">lemma</span></span> frame_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>y <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>y<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"x<span class="main">:[</span><span class="free">P</span><span class="main">]</span> <span class="main">;;</span> y<span class="main">:[</span><span class="free">Q</span><span class="main">]</span> <span class="main">=</span> y<span class="main">:[</span><span class="free">Q</span><span class="main">]</span> <span class="main">;;</span> x<span class="main">:[</span><span class="free">P</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> s s' s<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">s</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="improper">s'</span> <span class="keyword1">on</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="improper">s<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">on</span> <span class="free">x</span> <span class="main">=</span> <span class="improper">s<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>L</sub></span> <span class="improper">s'</span> <span class="keyword1">on</span> <span class="free">y</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lens_indep_get lens_indep_sym lens_override_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep.lens_put_comm lens_override_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> s s' s<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="improper">s</span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="improper">s<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="improper">s'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="improper">s</span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="improper">s<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="improper">s<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="improper">s'</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lens_indep_get lens_indep_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lens_indep.lens_put_comm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_rel_laws-frame_contract_RID"><span class="command">lemma</span></span> frame_contract_RID<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> RID<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x<span class="main">;</span>y<span class="main">)</span><span class="main">:[</span><span class="free">P</span><span class="main">]</span> <span class="main">=</span> y<span class="main">:[</span><span class="free">P</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x<span class="main">;</span>y<span class="main">)</span><span class="main">:[</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> y<span class="main">:[</span>RID<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep.lens_put_comm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_if assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1" id="utp_rel_laws-frame_miracle"><span class="command">lemma</span></span> frame_miracle <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"x<span class="main">:[</span><span class="keyword1">false</span><span class="main">]</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-frame_skip"><span class="command">lemma</span></span> frame_skip <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> x<span class="main">:[</span><span class="keyword1">II</span><span class="main">]</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-frame_assign_in"><span class="command">lemma</span></span> frame_assign_in <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">a</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">a</span> <span class="main">⟧</span> <span class="main">⟹</span> a<span class="main">:[</span>x <span class="main">:=</span> <span class="free">v</span><span class="main">]</span> <span class="main">=</span> x <span class="main">:=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_get_put_quasi_commute lens_put_of_quotient<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-frame_conj_true"><span class="command">lemma</span></span> frame_conj_true <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">{</span><span class="main">$</span>x<span class="main">,</span><span class="main">$</span>x<span class="main">´</span><span class="main">}</span> <span class="main">♮</span> <span class="free">P</span><span class="main">;</span> vwb_lens <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> x<span class="main">:[</span><span class="keyword1">true</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> x<span class="main">:[</span><span class="free">P</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-frame_is_assign"><span class="command">lemma</span></span> frame_is_assign <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> x<span class="main">:[</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⌈</span><span class="free">v</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">]</span> <span class="main">=</span> x <span class="main">:=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-frame_seq"><span class="command">lemma</span></span> frame_seq <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="main">{</span><span class="main">$</span>x<span class="main">,</span><span class="main">$</span>x<span class="main">´</span><span class="main">}</span> <span class="main">♮</span> <span class="free">P</span><span class="main">;</span> <span class="main">{</span><span class="main">$</span>x<span class="main">,</span><span class="main">$</span>x<span class="main">´</span><span class="main">}</span> <span class="main">♮</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> x<span class="main">:[</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">]</span> <span class="main">=</span> x<span class="main">:[</span><span class="free">P</span><span class="main">]</span> <span class="main">;;</span> x<span class="main">:[</span><span class="free">Q</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb vwb_lens_wb wb_lens_def weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_rel_laws-frame_to_antiframe"><span class="command">lemma</span></span> frame_to_antiframe <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> x<span class="main">:[</span><span class="free">P</span><span class="main">]</span> <span class="main">=</span> y<span class="main">:⟦</span><span class="free">P</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lens_indep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lens_indep_def surj_pair<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-rel_frext_miracle"><span class="command">lemma</span></span> rel_frext_miracle <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"a<span class="main">:[</span><span class="keyword1">false</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-rel_frext_skip"><span class="command">lemma</span></span> rel_frext_skip <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> a<span class="main">:[</span><span class="keyword1">II</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-rel_frext_seq"><span class="command">lemma</span></span> rel_frext_seq <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> a<span class="main">:[</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span>a<span class="main">:[</span><span class="free">P</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">;;</span> a<span class="main">:[</span><span class="free">Q</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> s s' s<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">a</span></sub><span class="hidden">⇙</span> <span class="improper">s</span> <span class="improper">s<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mwb_lens.put_put vwb_lens_mwb<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_rel_laws-rel_frext_assigns"><span class="command">lemma</span></span> rel_frext_assigns <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span> <span class="main">⟹</span> a<span class="main">:[</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">σ</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">a</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-rel_frext_rcond"><span class="command">lemma</span></span> rel_frext_rcond <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"a<span class="main">:[</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span>a<span class="main">:[</span><span class="free">P</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">a</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> a<span class="main">:[</span><span class="free">Q</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-rel_frext_commute"><span class="command">lemma</span></span> rel_frext_commute<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> x<span class="main">:[</span><span class="free">P</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">;;</span> y<span class="main">:[</span><span class="free">Q</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> y<span class="main">:[</span><span class="free">Q</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">;;</span> x<span class="main">:[</span><span class="free">P</span><span class="main">]<span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a c b<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="bound">b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> lens_indep_comm lens_indep_get<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep.lens_put_irr2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">put</span><span class="hidden">⇘</span><sub><span class="free">x</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">get</span><span class="hidden">⇘</span><sub><span class="free">y</span></sub><span class="hidden">⇙</span> <span class="bound">b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lens_indep_comm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep.lens_put_irr2<span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="utp_rel_laws-antiframe_disj"><span class="command">lemma</span></span> antiframe_disj <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x<span class="main">:⟦</span><span class="free">P</span><span class="main">⟧</span> <span class="main">∨</span> x<span class="main">:⟦</span><span class="free">Q</span><span class="main">⟧</span><span class="main">)</span> <span class="main">=</span> x<span class="main">:⟦</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-antiframe_seq"><span class="command">lemma</span></span> antiframe_seq <span class="main">[</span><span class="operator">frame</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> <span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">(</span>x<span class="main">:⟦</span><span class="free">P</span><span class="main">⟧</span> <span class="main">;;</span> x<span class="main">:⟦</span><span class="free">Q</span><span class="main">⟧</span><span class="main">)</span> <span class="main">=</span> x<span class="main">:⟦</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens_def weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens.put_twice wb_lens_def weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="utp_rel_laws-nameset_skip"><span class="command">lemma</span></span> nameset_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">ns</span> x <span class="main">∙</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> II<span class="hidden">⇘</span><sub>x</sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-nameset_skip_ra"><span class="command">lemma</span></span> nameset_skip_ra<span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">ns</span> x <span class="main">∙</span> II<span class="hidden">⇘</span><sub>x</sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> II<span class="hidden">⇘</span><sub>x</sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">declare</span></span> sublens_def <span class="main">[</span><span class="operator">lens_defs</span><span class="main">]</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ While Loop Laws ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> while_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> monoI seqr_mono cond_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_top_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lfp_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_top_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> while_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="keyword1">false</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> while_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> while_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="keyword1">true</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_top_def <span class="dynamic"><span class="dynamic">alpha</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lfp_lowerbound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> while_bot_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> monoI seqr_mono cond_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_bot_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gfp_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_bot_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> while_bot_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="keyword1">false</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_bot_def mu_const <span class="dynamic"><span class="dynamic">alpha</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> while_bot_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="keyword1">true</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_bot_def <span class="dynamic"><span class="dynamic">alpha</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ An infinite loop with a feasible body corresponds to a program error (non-termination). ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> while_infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="keyword1">true<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">=</span> <span class="keyword1">true</span> <span class="main">⟹</span> <span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="keyword1">true</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_bot_true<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> gfp_upperbound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Algebraic Properties ›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> upred_semiring<span class="main">:</span> semiring_1
  <span class="keyword2"><span class="keyword">where</span></span> times <span class="main">=</span> <span class="quoted">seqr</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">skip_r</span> <span class="keyword2"><span class="keyword">and</span></span> zero <span class="main">=</span> <span class="quoted"><span class="keyword1">false<span class="hidden">⇩</span><sub>h</sub></span></span> <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">=</span> <span class="quoted">Lattices.sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> upred_semiring.power_Suc <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We introduce the power syntax derived from semirings ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">upower</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>^</b></span>"</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">upower</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> upred_semiring.power <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">i</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> power.power <span class="keyword1">II</span> <span class="free">op</span> <span class="main">;;</span> <span class="free">P</span> <span class="free">i</span>"</span>
  <span class="quoted">"<span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">i</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="main">(</span><span class="keyword1">CONST</span> power.power <span class="keyword1">II</span> <span class="free">op</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Set up transfer tactic for powers ›</span></span>

<span class="keyword1" id="utp_rel_laws-upower_rep_eq"><span class="command">lemma</span></span> upower_rep_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">i</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">p</span><span class="main">}</span> <span class="main">^^</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc seqr.rep_eq relpow_commute upred_semiring.power_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel_laws-upower_rep_eq_alt"><span class="command">lemma</span></span> upower_rep_eq_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>power.power <span class="main">⟨</span>id<span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(;;)</span> <span class="free">P</span> <span class="free">i</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">p</span><span class="main">}</span> <span class="main">^^</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> skip_r_def upower_rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span>
  
<span class="keyword1" id="utp_rel_laws-Sup_power_expand"><span class="command">lemma</span></span> Sup_power_expand<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>complete_lattice"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="free">P</span> <span class="main">`</span> UNIV<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="free">P</span> <span class="main">`</span> insert <span class="main">0</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">⨅</span> <span class="main">(</span><span class="free">P</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="free">P</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast_Suc_greaterThan greaterThan_0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel_laws-Sup_upto_Suc"><span class="command">lemma</span></span> Sup_upto_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span>insert <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0_atMost_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> Suc <span class="free">n</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lattices.sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following two proofs are adapted from the AFP entry 
  \href{https://www.isa-afp.org/entries/Kleene_Algebra.shtml}{Kleene Algebra}. 
  See also~\cite{Armstrong2012,Armstrong2015}. ›</span></span>

<span class="keyword1" id="utp_rel_laws-upower_inductl"><span class="command">lemma</span></span> upower_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">n</span> <span class="main">;;</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_semiring.power_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> dual_order.trans order_refl seqr_assoc seqr_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel_laws-upower_inductr"><span class="command">lemma</span></span> upower_inductr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">R</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">R</span> <span class="main">;;</span> <span class="main">(</span><span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">;;</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">;;</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">;;</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seqr_assoc upred_semiring.power_Suc2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">⊑</span> <span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc.hyps assms eq_iff seqr_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel_laws-SUP_atLeastAtMost_first"><span class="command">lemma</span></span> SUP_atLeastAtMost_first<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>complete_lattice"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="free">m</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span>Suc <span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SUP_insert assms atLeastAtMost_insertL<span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-upower_seqr_iter"><span class="command">lemma</span></span> upower_seqr_iter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">;;</span> <span class="bound">Q</span> <span class="main">:</span> replicate <span class="free">n</span> <span class="free">P</span> <span class="main">∙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_semiring.power_Suc<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-assigns_power"><span class="command">lemma</span></span> assigns_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="free">n</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Kleene Star ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ustar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="hidden">❙</span><b>^</b></span><span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_rel_laws-ustar_rep_eq"><span class="command">lemma</span></span> ustar_rep_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">p</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ustar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relpow_imp_rtrancl rtrancl_imp_relpow<span class="main">)</span>

<span class="keyword1"><span class="command">update_uexpr_rep_eq_thms</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Kleene Plus ›</span></span>

<span class="keyword1"><span class="command">purge_notation</span></span> trancl <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uplus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>+</sup></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1" id="utp_rel_laws-uplus_power_def"><span class="command">lemma</span></span> uplus_power_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uplus_def ustar_def seq_UINF_distl' UINF_atLeast_Suc upred_semiring.power_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Omega ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uomega</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>ω</sup></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Relation Algebra Laws ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> RA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqr_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> RA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">II</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> RA3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> RA4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">;;</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> RA5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">∨</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> RA6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">;;</span><span class="free">R</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">;;</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> seqr_or_distl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> RA7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span> <span class="main">;;</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Kleene Algebra Laws ›</span></span>

<span class="keyword1" id="utp_rel_laws-ustar_alt_def"><span class="command">lemma</span></span> ustar_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ustar_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ustar_sub_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="keyword1">II</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span><span class="main">;;</span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_into_trancl2 trancl_into_rtrancl<span class="main">)</span>
    
<span class="keyword1"><span class="command">theorem</span></span> ustar_inductl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;;</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;;</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ustar_def UINF_as_Sup_collect' seq_SUP_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_least assms upower_inductl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ustar_inductr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">;;</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="free">R</span> <span class="main">;;</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">;;</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">i</span><span class="main">.</span> <span class="free">R</span> <span class="main">;;</span> <span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ustar_def UINF_as_Sup_collect' seq_SUP_distl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊑</span> <span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_least assms upower_inductr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel_laws-ustar_refines_nu"><span class="command">lemma</span></span> ustar_refines_nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lfp_greatest semilattice_sup_class.le_sup_iff 
      semilattice_sup_class.sup_idem upred_semiring.mult_2_right 
      upred_semiring.one_add_one ustar_inductl<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-ustar_as_nu"><span class="command">lemma</span></span> ustar_as_nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ustar_refines_nu<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lfp_lowerbound upred_semiring.add_commute ustar_sub_unfoldl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_rel_laws-ustar_unfoldl"><span class="command">lemma</span></span> ustar_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1">II</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ustar_as_nu<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lfp_unfold<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> monoI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ While loop can be expressed using Kleene star ›</span></span>

<span class="keyword1" id="utp_rel_laws-while_star_form"><span class="command">lemma</span></span> while_star_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;;</span> <span class="main">[</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">false</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1"</span> false_upred_def sup_continuous_Continuous sup_continuous_lfp while_top_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">^^</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">false</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">^^</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">false</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sup_power_expand<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">^^</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">false</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>^</b></span><span class="bound">i</span> <span class="main">;;</span> <span class="main">(</span><span class="keyword1">false</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SUP_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">P</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">false</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> <span class="skolem">i</span> <span class="main">;;</span> <span class="main">(</span><span class="keyword1">false</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_semiring.power_Suc<span class="main">)</span>
           <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> RA1 comp_cond_left_distr cond_L6 upred_semiring.mult.left_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>^</b></span><span class="bound">i</span> <span class="main">;;</span> <span class="main">[</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;;</span> <span class="main">[</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seq_UINF_distr ustar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Omega Algebra Laws ›</span></span>

<span class="keyword1" id="utp_rel_laws-uomega_induct"><span class="command">lemma</span></span> uomega_induct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="free">P</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">P</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uomega_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> eq_refl gfp_unfold monoI seqr_mono<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Refinement Laws ›</span></span>

<span class="keyword1" id="utp_rel_laws-skip_r_refine"><span class="command">lemma</span></span> skip_r_refine<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⇒</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_blast</span>

<span class="keyword1" id="utp_rel_laws-conj_refine_left"><span class="command">lemma</span></span> conj_refine_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">⇒</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  
<span class="keyword1" id="utp_rel_laws-pre_weak_rel"><span class="command">lemma</span></span> pre_weak_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">I</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Pre</span> <span class="main">⇒</span> <span class="free">Post</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-cond_refine_rel"><span class="command">lemma</span></span> cond_refine_rel<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⌈</span><span class="main">¬</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊑</span> <span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aext_not assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cond_def lift_rcond_def utp_pred_laws.le_sup_iff<span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-seq_refine_pred"><span class="command">lemma</span></span> seq_refine_pred<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">s</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">s</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">b</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>
    
<span class="keyword1" id="utp_rel_laws-seq_refine_unrest"><span class="command">lemma</span></span> seq_refine_unrest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"outα <span class="main">♯</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"inα <span class="main">♯</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">s</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">s</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">⇒</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span> 
    
 <span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Domain and Range Laws ›</span></span>
  
<span class="keyword1" id="utp_rel_laws-Dom_conv_Ran"><span class="command">lemma</span></span> Dom_conv_Ran<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span> <span class="main">=</span> Ran<span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-Ran_conv_Dom"><span class="command">lemma</span></span> Ran_conv_Dom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ran<span class="main">(</span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>-</sup></span><span class="main">)</span> <span class="main">=</span> Dom<span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>  

<span class="keyword1" id="utp_rel_laws-Dom_skip"><span class="command">lemma</span></span> Dom_skip<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="keyword1">II</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-Dom_assigns"><span class="command">lemma</span></span> Dom_assigns<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   
<span class="keyword1" id="utp_rel_laws-Dom_miracle"><span class="command">lemma</span></span> Dom_miracle<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="keyword1">false</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-Dom_assume"><span class="command">lemma</span></span> Dom_assume<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="main">[</span><span class="free">b</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-Dom_seq"><span class="command">lemma</span></span> Dom_seq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> Dom<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">[</span>Dom<span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-Dom_disj"><span class="command">lemma</span></span> Dom_disj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Dom<span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∨</span> Dom<span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_rel_laws-Dom_inf"><span class="command">lemma</span></span> Dom_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Dom<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Dom<span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">∨</span> Dom<span class="main">(</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_rel_laws-assume_Dom"><span class="command">lemma</span></span> assume_Dom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span>Dom<span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">]<span class="hidden">⇧</span><sup>⊤</sup></span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_theory">
<div class="head">
<h1>Theory utp_theory</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ UTP Theories ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_theory
<span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_rel_laws.html">utp_rel_laws</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Here, we mechanise a representation of UTP theories using locales~\cite{Ballarin06}. We also
  link them to the HOL-Algebra library~\cite{Ballarin17}, which allows us to import properties from 
  complete lattices and Galois connections. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Complete lattice of predicates ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upred_lattice</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> upred<span class="main">)</span> gorder"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝒫</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">upred_lattice</span> <span class="main">=</span> <span class="main">⦇</span> carrier <span class="main">=</span> UNIV<span class="main">,</span> eq <span class="main">=</span> <span class="main">(=)</span><span class="main">,</span> le <span class="main">=</span> <span class="main">(⊑)</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">𝒫</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the complete lattice of alphabetised predicates. All other theories will
  be defined relative to it. ›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> upred_lattice<span class="main">:</span> complete_lattice <span class="quoted"><span class="keyword1">𝒫</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_lattice_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> upred set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> is_lub <span class="main">⦇</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> eq <span class="main">=</span> <span class="main">(=)</span><span class="main">,</span> le <span class="main">=</span> <span class="main">(⊑)</span><span class="main">⦈</span> <span class="bound">s</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> least_UpperI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_greatest <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower Upper_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> is_glb <span class="main">⦇</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> eq <span class="main">=</span> <span class="main">(=)</span><span class="main">,</span> le <span class="main">=</span> <span class="main">(⊑)</span><span class="main">⦈</span> <span class="bound">i</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> greatest_LowerI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_least <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper Lower_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_theory-upred_weak_complete_lattice"><span class="command">lemma</span></span> upred_weak_complete_lattice <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"weak_complete_lattice <span class="keyword1">𝒫</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_lattice.weak.weak_complete_lattice_axioms<span class="main">)</span>

<span class="keyword1" id="utp_theory-upred_lattice_eq"><span class="command">lemma</span></span> upred_lattice_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(.=</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_lattice_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-upred_lattice_le"><span class="command">lemma</span></span> upred_lattice_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le <span class="keyword1">𝒫</span> <span class="free">P</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_lattice_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-upred_lattice_carrier"><span class="command">lemma</span></span> upred_lattice_carrier <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"carrier <span class="keyword1">𝒫</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_lattice_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-Healthy_fixed_points"><span class="command">lemma</span></span> Healthy_fixed_points <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps <span class="keyword1">𝒫</span> <span class="free">H</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_def upred_lattice_def Healthy_def<span class="main">)</span>
    
<span class="keyword1" id="utp_theory-upred_lattice_Idempotent"><span class="command">lemma</span></span> upred_lattice_Idempotent <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Idem</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span> <span class="free">H</span> <span class="main">=</span> Idempotent <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> upred_lattice.weak_partial_order_axioms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idempotent_def Idempotent_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-upred_lattice_Monotonic"><span class="command">lemma</span></span> upred_lattice_Monotonic <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Mono</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span> <span class="free">H</span> <span class="main">=</span> Monotonic <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> upred_lattice.weak_partial_order_axioms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isotone_def mono_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ UTP theories hierarchy ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">utp_order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> health <span class="main">⇒</span> <span class="tfree">'α</span> hrel gorder"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_order</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">⦇</span> carrier <span class="main">=</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="keyword1">is</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span><span class="main">,</span> eq <span class="main">=</span> <span class="main">(=)</span><span class="main">,</span> le <span class="main">=</span> <span class="main">(⊑)</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Constant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">utp_order</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> obtains the order structure associated with a UTP theory.
  Its carrier is the set of healthy predicates, equality is HOL equality, and the order is
  refinement. ›</span></span>

<span class="keyword1" id="utp_theory-utp_order_carrier"><span class="command">lemma</span></span> utp_order_carrier <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>utp_order <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-utp_order_eq"><span class="command">lemma</span></span> utp_order_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq <span class="main">(</span>utp_order <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-utp_order_le"><span class="command">lemma</span></span> utp_order_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le <span class="main">(</span>utp_order <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(⊑)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-utp_partial_order"><span class="command">lemma</span></span> utp_partial_order<span class="main">:</span> <span class="quoted"><span class="quoted">"partial_order <span class="main">(</span>utp_order <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-utp_weak_partial_order"><span class="command">lemma</span></span> utp_weak_partial_order<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_partial_order <span class="main">(</span>utp_order <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-mono_Monotone_utp_order"><span class="command">lemma</span></span> mono_Monotone_utp_order<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mono <span class="free">f</span> <span class="main">⟹</span> Monotone <span class="main">(</span>utp_order <span class="free">T</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isotone_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> partial_order_def utp_partial_order<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> monoD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="utp_theory-isotone_utp_orderI"><span class="command">lemma</span></span> isotone_utp_orderI<span class="main">:</span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">H</span> <span class="main">⟹</span> isotone <span class="main">(</span>utp_order <span class="free">X</span><span class="main">)</span> <span class="main">(</span>utp_order <span class="free">Y</span><span class="main">)</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def isotone_def utp_weak_partial_order<span class="main">)</span>

<span class="keyword1" id="utp_theory-Mono_utp_orderI"><span class="command">lemma</span></span> Mono_utp_orderI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="bound">Q</span><span class="main">;</span> <span class="bound">P</span> <span class="keyword1">is</span> <span class="free">H</span><span class="main">;</span> <span class="bound">Q</span> <span class="keyword1">is</span> <span class="free">H</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">F</span><span class="main">(</span><span class="bound">Q</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">Mono</span><span class="hidden">⇘</span><sub>utp_order <span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isotone_def utp_weak_partial_order<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The UTP order can equivalently be characterised as the fixed point lattice, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> fpl<span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>

<span class="keyword1" id="utp_theory-utp_order_fpl"><span class="command">lemma</span></span> utp_order_fpl<span class="main">:</span> <span class="quoted"><span class="quoted">"utp_order <span class="free">H</span> <span class="main">=</span> fpl <span class="keyword1">𝒫</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def upred_lattice_def fps_def Healthy_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ UTP theory hierarchy ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We next define a hierarchy of locales that characterise different classes of UTP theory.
  Minimally we require that a UTP theory's healthiness condition is idempotent. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">hcond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ℋ</span></span></span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HCond_Idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">thy_order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel gorder"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">thy_order</span> <span class="main">≡</span> utp_order <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>

  <span class="keyword1" id="utp_theory-HCond_Idempotent"><span class="command">lemma</span></span> HCond_Idempotent <span class="main">[</span><span class="operator">closure</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Idempotent <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Idempotent_def HCond_Idem<span class="main">)</span>

  <span class="keyword1"><span class="command">sublocale</span></span> utp_po<span class="main">:</span> partial_order <span class="quoted"><span class="quoted">"utp_order <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We need to remove some transitivity rules to stop them being applied in calculations ›</span></span>

  <span class="keyword1"><span class="command">declare</span></span> utp_po.trans <span class="main">[</span><span class="operator">trans</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_lattice <span class="main">=</span> utp_theory <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> uthy_lattice<span class="main">:</span> <span class="quoted"><span class="quoted">"complete_lattice <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> complete_lattice <span class="quoted"><span class="quoted">"utp_order <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uthy_lattice<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> top_closed <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> bottom_closed <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The healthiness conditions of a UTP theory lattice form a complete lattice, and allows us to make
  use of complete lattice results from HOL-Algebra~\cite{Ballarin17}, such as the Knaster-Tarski theorem. We can also
  retrieve lattice operators as below. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_top</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊤</b></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">utp_top</span> <span class="main">≡</span> top <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_bottom</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊥</b></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">utp_bottom</span> <span class="main">≡</span> bottom <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_join</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊔</b></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_join</span> <span class="main">≡</span> join <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_meet</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊓</b></span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_meet</span> <span class="main">≡</span> meet <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_sup</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⨆</b></span>_"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_sup</span> <span class="main">≡</span> Lattice.sup <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_inf</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⨅</b></span>_"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_inf</span> <span class="main">≡</span> Lattice.inf <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_gfp</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ν</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_gfp</span> <span class="main">≡</span> GREATEST_FP <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">utp_lfp</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>μ</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">utp_lfp</span> <span class="main">≡</span> LEAST_FP <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_tmu"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>μ</b></span>ı _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_tnu"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ν</b></span>ı _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> gfp <span class="main">(</span><span class="quoted">"<span class="keyword1">μ</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> lfp <span class="main">(</span><span class="quoted">"<span class="keyword1">ν</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>μ</b></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">X</span> <span class="main">∙</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> LEAST_FP <span class="main">(</span><span class="keyword1">CONST</span> utp_order <span class="free">H</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>  
  <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ν</b></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">X</span> <span class="main">∙</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> GREATEST_FP <span class="main">(</span><span class="keyword1">CONST</span> utp_order <span class="free">H</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1" id="utp_theory-upred_lattice_inf"><span class="command">lemma</span></span> upred_lattice_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Lattice.inf <span class="keyword1">𝒫</span> <span class="free">A</span> <span class="main">=</span> <span class="main">⨅</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_least Sup_upper UNIV_I antisym_conv subsetI upred_lattice.weak.inf_greatest upred_lattice.weak.inf_lower upred_lattice_carrier upred_lattice_le<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can then derive a number of properties about these operators, as below. ›</span></span>

<span class="keyword1"><span class="command">context</span></span> utp_theory_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="utp_theory-LFP_healthy_comp"><span class="command">lemma</span></span> LFP_healthy_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>μ</b></span> <span class="free">F</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>μ</b></span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="bound">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LEAST_FP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="utp_theory-GFP_healthy_comp"><span class="command">lemma</span></span> GFP_healthy_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ν</b></span> <span class="free">F</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>ν</b></span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="free">F</span> <span class="bound">P</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="bound">P</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GREATEST_FP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="utp_theory-top_healthy"><span class="command">lemma</span></span> top_healthy <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> weak.top_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="utp_theory-bottom_healthy"><span class="command">lemma</span></span> bottom_healthy <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> weak.bottom_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="utp_theory-utp_top"><span class="command">lemma</span></span> utp_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊑</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> weak.top_higher <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="utp_theory-utp_bottom"><span class="command">lemma</span></span> utp_bottom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> weak.bottom_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="utp_theory-upred_top"><span class="command">lemma</span></span> upred_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ball_UNIV greatest_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="utp_theory-upred_bottom"><span class="command">lemma</span></span> upred_bottom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ One way of obtaining a complete lattice is showing that the healthiness conditions
  are monotone, which the below locale characterises. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_mono <span class="main">=</span> utp_theory <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HCond_Mono <span class="main">[</span><span class="operator">closure</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Monotonic <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> utp_theory_mono <span class="main">⊆</span> utp_theory_lattice
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> weak_complete_lattice <span class="quoted"><span class="quoted">"fpl <span class="keyword1">𝒫</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Knaster_Tarski<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complete_lattice <span class="main">(</span>fpl <span class="keyword1">𝒫</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_def sup_exists<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sup_exists inf_exists<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"complete_lattice <span class="main">(</span>utp_order <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_lattice_def<span class="main">)</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"utp_theory_lattice <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_theory_axioms utp_theory_lattice.intro utp_theory_lattice_axioms.intro<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In a monotone theory, the top and bottom can always be obtained by applying the healthiness
  condition to the predicate top and bottom, respectively. ›</span></span>

<span class="keyword1"><span class="command">context</span></span> utp_theory_mono
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="utp_theory-healthy_top"><span class="command">lemma</span></span> healthy_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="keyword1">false</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">=</span> <span class="main">⊤</span><span class="hidden">⇘</span><sub>fpl <span class="keyword1">𝒫</span> <span class="keyword1"><span class="free">ℋ</span></span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_fpl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⊤</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Knaster_Tarski_idem_extremes<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">𝒫</span></span> <span class="quoted"><span class="keyword1"><span class="free">ℋ</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HCond_Idempotent HCond_Mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="keyword1">false</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_top<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_theory-healthy_bottom"><span class="command">lemma</span></span> healthy_bottom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="keyword1">true</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">=</span> <span class="main">⊥</span><span class="hidden">⇘</span><sub>fpl <span class="keyword1">𝒫</span> <span class="keyword1"><span class="free">ℋ</span></span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_fpl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⊥</span><span class="hidden">⇘</span><sub><span class="keyword1">𝒫</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Knaster_Tarski_idem_extremes<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">𝒫</span></span> <span class="quoted"><span class="keyword1"><span class="free">ℋ</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HCond_Idempotent HCond_Mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="keyword1">true</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upred_bottom<span class="main">)</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_theory-healthy_inf"><span class="command">lemma</span></span> healthy_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="free">A</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Knaster_Tarski_idem_inf_eq<span class="main">[</span><span class="operator">OF</span> upred_weak_complete_lattice<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℋ</span></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> HCond_Idempotent HCond_Mono assms partial_object.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> upred_lattice_def upred_lattice_inf utp_order_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_continuous <span class="main">=</span> utp_theory <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HCond_Cont <span class="main">[</span><span class="operator">closure</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> utp_theory_continuous <span class="main">⊆</span> utp_theory_mono
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Continuous_Monotonic HCond_Cont<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> utp_theory_continuous
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="utp_theory-healthy_inf_cont"><span class="command">lemma</span></span> healthy_inf_cont<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="free">A</span> <span class="main">=</span> <span class="main">⨅</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="free">A</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span><span class="main">`</span><span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Continuous_def HCond_Cont assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> healthy_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨅</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Healthy_carrier_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="utp_theory-healthy_inf_def"><span class="command">lemma</span></span> healthy_inf_def<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms healthy_inf_cont weak.weak_inf_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="utp_theory-healthy_meet_cont"><span class="command">lemma</span></span> healthy_meet_cont<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>⊓</b></span> <span class="free">Q</span> <span class="main">=</span> <span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> healthy_inf_cont<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">}</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_if meet_def<span class="main">)</span>

  <span class="keyword1" id="utp_theory-meet_is_healthy"><span class="command">lemma</span></span> meet_is_healthy <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Continuous_Disjunctous Disjunctuous_def HCond_Cont Healthy_def' assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1" id="utp_theory-meet_bottom"><span class="command">lemma</span></span> meet_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms semilattice_sup_class.sup_absorb2 utp_bottom<span class="main">)</span>

  <span class="keyword1" id="utp_theory-meet_top"><span class="command">lemma</span></span> meet_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">=</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms semilattice_sup_class.sup_absorb1 utp_top<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The UTP theory lfp operator can be rewritten to the alphabetised predicate lfp when
    in a continuous context. ›</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> utp_lfp_def<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>μ</b></span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">F</span><span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">⊑</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> utp_top weak.top_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_healthy<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>μ</b></span> <span class="free">F</span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span><span class="main">(</span><span class="bound">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span> <span class="main">⊑</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span><span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HCond_Idem Healthy_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> funcset_mem mem_Collect_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
          <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 HCond_Mono mono_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span> <span class="main">⊑</span> <span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_upper2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⊑</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 Healthy_def<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> F mono_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="skolem">P</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">with</span></span> ne <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LEAST_FP_def gfp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> healthy_inf_cont<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> ne <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">F</span> <span class="main">(</span><span class="keyword1"><span class="free">ℋ</span></span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="keyword1"><span class="hidden">❙</span><b>μ</b></span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LEAST_FP_def gfp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> healthy_inf_cont<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def Sup_upper<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="utp_theory-UINF_ind_Healthy"><span class="command">lemma</span></span> UINF_ind_Healthy <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">closure</span></span> assms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In another direction, we can also characterise UTP theories that are relational. Minimally
  this requires that the healthiness condition is closed under sequential composition. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_rel <span class="main">=</span>
  utp_theory <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Healthy_Sequence <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span><span class="main">;</span> <span class="free">Q</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="utp_theory-upower_Suc_Healthy"><span class="command">lemma</span></span> upower_Suc_Healthy <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>^</b></span> Suc <span class="free">n</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">closure</span></span> assms upred_semiring.power_Suc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_cont_rel <span class="main">=</span> utp_theory_rel <span class="main">+</span> utp_theory_continuous
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="utp_theory-seq_cont_Sup_distl"><span class="command">lemma</span></span> seq_cont_Sup_distl<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="main">{</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">Q</span> <span class="main">|</span> <span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">P</span> <span class="main">;;</span> <span class="bound">Q</span> <span class="main">|</span> <span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Healthy_Sequence assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> healthy_inf_cont seq_Sup_distl setcompr_eq_image assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="utp_theory-seq_cont_Sup_distr"><span class="command">lemma</span></span> seq_cont_Sup_distr<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="free">A</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⨅</b></span> <span class="main">{</span><span class="bound">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span> <span class="main">⊆</span> <span class="main">⟦</span><span class="keyword1"><span class="free">ℋ</span></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Healthy_Sequence assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> healthy_inf_cont seq_Sup_distr setcompr_eq_image assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="utp_theory-uplus_healthy"><span class="command">lemma</span></span> uplus_healthy <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>  
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uplus_power_def <span class="dynamic"><span class="dynamic">closure</span></span> assms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ There also exist UTP theories with units. Not all theories have both a left and a right unit 
  (e.g. H1-H2 designs) and so we split up the locale into two cases. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_units <span class="main">=</span>
  utp_theory_rel <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">utp_unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">ℐℐ</span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Healthy_Unit <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℐℐ</span></span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can characterise the theory Kleene star by lifting the relational one. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">utp_star</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">❙</span><b>⋆</b></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">utp_star</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;;</span> <span class="keyword1"><span class="free">ℐℐ</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can then characterise tests as refinements of units. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">utp_test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> hrel <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">utp_test</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">ℐℐ</span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_left_unital <span class="main">=</span>
  utp_theory_units <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Unit_Left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1"><span class="free">ℐℐ</span></span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_right_unital <span class="main">=</span>
  utp_theory_units <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Unit_Right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1"><span class="free">ℐℐ</span></span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_unital <span class="main">=</span>
  utp_theory_left_unital <span class="main">+</span> utp_theory_right_unital
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="utp_theory-Unit_self"><span class="command">lemma</span></span> Unit_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℐℐ</span></span> <span class="main">;;</span> <span class="keyword1"><span class="free">ℐℐ</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">ℐℐ</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_Unit Unit_Right<span class="main">)</span>

<span class="keyword1" id="utp_theory-utest_intro"><span class="command">lemma</span></span> utest_intro<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℐℐ</span></span> <span class="main">⊑</span> <span class="free">P</span> <span class="main">⟹</span> utp_test <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_test_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-utest_Unit"><span class="command">lemma</span></span> utest_Unit <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"utp_test <span class="keyword1"><span class="free">ℐℐ</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_test_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_mono_unital <span class="main">=</span> utp_theory_unital <span class="main">+</span> utp_theory_mono
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="utp_theory-utest_Top"><span class="command">lemma</span></span> utest_Top <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"utp_test <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_Unit utp_test_def utp_top<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_cont_unital <span class="main">=</span> utp_theory_cont_rel <span class="main">+</span> utp_theory_unital

<span class="keyword1"><span class="command">sublocale</span></span> utp_theory_cont_unital <span class="main">⊆</span> utp_theory_mono_unital
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_theory_mono_axioms utp_theory_mono_unital_def utp_theory_unital_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_unital_zerol <span class="main">=</span>
  utp_theory_unital <span class="main">+</span>
  utp_theory_lattice <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Top_Left_Zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> utp_theory_cont_unital_zerol <span class="main">=</span>
  utp_theory_cont_unital <span class="main">+</span> utp_theory_unital_zerol
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="utp_theory-Top_test_Right_Zero"><span class="command">lemma</span></span> Top_test_Right_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">is</span> <span class="keyword1"><span class="free">ℋ</span></span>"</span></span> <span class="quoted"><span class="quoted">"utp_test <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">;;</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">ℐℐ</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">ℐℐ</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> semilattice_sup_class.le_iff_sup utp_test_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Top_Left_Zero Unit_Left assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> meet_top top_healthy upred_semiring.distrib_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Theory of relations ›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_theory<span class="main">:</span> utp_theory_mono_unital <span class="quoted">id</span> <span class="quoted">skip_r</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"rel_theory.utp_top <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_theory.utp_bottom <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>utp_order id<span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">is</span> id<span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"utp_theory_mono_unital id <span class="keyword1">II</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> utp_theory_mono_unital <span class="quoted">id</span> <span class="quoted">skip_r</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"utp_top <span class="main">=</span> <span class="keyword1">false</span>"</span></span> <span class="quoted"><span class="quoted">"utp_bottom <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> healthy_top healthy_bottom<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>utp_order id<span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">is</span> id<span class="main">)</span> <span class="main">=</span> True"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_order_def Healthy_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">thm</span></span> rel_theory.GFP_unfold

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Theory links ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can also describe links between theories, such a Galois connections and retractions,
  using the following notation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_conn</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇐⟨</span>_<span class="keyword1">,</span>_<span class="keyword1">⟩⇒</span> _"</span> <span class="main">[</span>90<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>91<span class="main">]</span> 91<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">H1</span></span></span> <span class="main"><span class="free">⇐⟨</span></span><span class="free"><span class="bound"><span class="entity">ℋ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">ℋ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">⟩⇒</span></span> <span class="free"><span class="bound"><span class="entity">H2</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> orderA <span class="main">=</span> utp_order <span class="free"><span class="bound"><span class="entity">H1</span></span></span><span class="main">,</span> orderB <span class="main">=</span> utp_order <span class="free"><span class="bound"><span class="entity">H2</span></span></span><span class="main">,</span> lower <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ℋ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> upper <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ℋ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="utp_theory-mk_conn_orderA"><span class="command">lemma</span></span> mk_conn_orderA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒳</span><span class="hidden">⇘</span><sub><span class="free">H1</span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩⇒</span> <span class="free">H2</span></sub><span class="hidden">⇙</span> <span class="main">=</span> utp_order <span class="free">H1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mk_conn_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-mk_conn_orderB"><span class="command">lemma</span></span> mk_conn_orderB <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒴</span><span class="hidden">⇘</span><sub><span class="free">H1</span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩⇒</span> <span class="free">H2</span></sub><span class="hidden">⇙</span> <span class="main">=</span> utp_order <span class="free">H2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mk_conn_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-mk_conn_lower"><span class="command">lemma</span></span> mk_conn_lower <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">π<span class="hidden">⇩</span><sub>*</sub></span><span class="hidden">⇘</span><sub><span class="free">H1</span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩⇒</span> <span class="free">H2</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_conn_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-mk_conn_upper"><span class="command">lemma</span></span> mk_conn_upper <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">π<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H1</span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩⇒</span> <span class="free">H2</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_conn_def<span class="main">)</span>

<span class="keyword1" id="utp_theory-galois_comp"><span class="command">lemma</span></span> galois_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>4</sub></span><span class="main">⟩⇒</span> <span class="free">H<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>g</sub></span> <span class="main">(</span><span class="free">H<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩⇒</span> <span class="free">H<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">H<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇐⟨</span><span class="free">ℋ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∘</span><span class="free">ℋ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">,</span><span class="free">ℋ<span class="hidden">⇩</span><sub>4</sub></span><span class="main">∘</span><span class="free">ℋ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩⇒</span> <span class="free">H<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_galcon_def mk_conn_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Example Galois connection / retract: Existential quantification ›</span></span>

<span class="keyword1" id="utp_theory-Idempotent_ex"><span class="command">lemma</span></span> Idempotent_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> Idempotent <span class="main">(</span>ex <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Idempotent_def exists_twice<span class="main">)</span>

<span class="keyword1" id="utp_theory-Monotonic_ex"><span class="command">lemma</span></span> Monotonic_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> Monotonic <span class="main">(</span>ex <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def ex_mono<span class="main">)</span>

<span class="keyword1" id="utp_theory-ex_closed_unrest"><span class="command">lemma</span></span> ex_closed_unrest<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">⟦</span>ex <span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">=</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> x <span class="main">♯</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def unrest_as_exists<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Any theory can be composed with an existential quantification to produce a Galois connection ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ex_retract<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Idempotent <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"ex <span class="free">x</span> <span class="main">∘</span> <span class="free">H</span> <span class="main">=</span> <span class="free">H</span> <span class="main">∘</span> ex <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"retract <span class="main">(</span><span class="main">(</span>ex <span class="free">x</span> <span class="main">∘</span> <span class="free">H</span><span class="main">)</span> <span class="main">⇐⟨</span>ex <span class="free">x</span><span class="main">,</span> <span class="free">H</span><span class="main">⟩⇒</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∈</span> <span class="main">⟦</span>ex <span class="free">x</span> <span class="main">∘</span> <span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Healthy_Idempotent assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ex <span class="free">x</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span>ex <span class="free">x</span> <span class="main">∘</span> <span class="free">H</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pi_iff Healthy_def fun_eq_iff exists_twice<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">Q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="keyword1">is</span> <span class="main">(</span>ex <span class="free">x</span> <span class="main">∘</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="keyword1">is</span> <span class="free">H</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="skolem">P</span> <span class="main">⊑</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Healthy_Idempotent Healthy_if assms comp_apply dual_order.trans ex_weakens utp_pred_laws.ex_mono vwb_lens_wb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="keyword1">is</span> <span class="main">(</span>ex <span class="free">x</span> <span class="main">∘</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> x <span class="main">∙</span> <span class="free">H</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ex_retract_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"retract <span class="main">(</span>ex <span class="free">x</span> <span class="main">⇐⟨</span>ex <span class="free">x</span><span class="main">,</span> id<span class="main">⟩⇒</span> id<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ex_retract<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> H<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"id"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_hoare">
<div class="head">
<h1>Theory utp_hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Relational Hoare calculus ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_hoare
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="utp_rel_laws.html">utp_rel_laws</a>
    <a href="utp_theory.html">utp_theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Hoare Triple Definitions and Tactics ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> cond <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⦃</span>_<span class="keyword1">⦄</span><span class="keyword3">/ </span>_<span class="keyword3">/ </span><span class="keyword1">⦃</span>_<span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦃</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">⦄</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">⦃</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="keyword1"><span class="free">⦄<span class="hidden">⇩</span><sub>u</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> hoare_r_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>

<span class="keyword1"><span class="command">named_theorems</span></span> hoare <span class="keyword2"><span class="keyword">and</span></span> hoare_safe

<span class="keyword1"><span class="command">method</span></span> hoare_split <span class="keyword2"><span class="keyword">uses</span></span> hr <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_comp<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="comment1">― ‹ Combine Assignments where possible ›</span>
   <span class="main">(</span><span class="operator">auto</span>
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hoare</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hoare_safe</span></span> <span class="dynamic"><span class="dynamic">hr</span></span>
    <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_comm conj_assoc <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">unrest</span></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> <span class="comment1">― ‹ Apply Hoare logic laws ›</span>

<span class="keyword1"><span class="command">method</span></span> hoare_auto <span class="keyword2"><span class="keyword">uses</span></span> hr <span class="main">=</span> <span class="main">(</span><span class="operator">hoare_split</span> <span class="quasi_keyword">hr</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hr</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Basic Laws ›</span></span>

<span class="keyword1" id="utp_hoare-hoare_meaning"><span class="command">lemma</span></span> hoare_meaning<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">P</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">⟦</span><span class="free">S</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">⟦</span><span class="free">Q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>e</sub></span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_hoare-hoare_assume"><span class="command">lemma</span></span> hoare_assume<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">P</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">?[</span><span class="free">P</span><span class="main">]</span> <span class="main">;;</span> <span class="free">S</span> <span class="main">=</span> <span class="main">?[</span><span class="free">P</span><span class="main">]</span> <span class="main">;;</span> <span class="free">S</span> <span class="main">;;</span> <span class="main">?[</span><span class="free">Q</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_hoare-hoare_r_conj"><span class="command">lemma</span></span> hoare_r_conj <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span><span class="main">;</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">s</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span> <span class="main">∧</span> <span class="free">s</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-hoare_r_weaken_pre"><span class="command">lemma</span></span> hoare_r_weaken_pre <span class="main">[</span><span class="operator">hoare</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_hoare-pre_str_hoare_r"><span class="command">lemma</span></span> pre_str_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">`</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>
    
<span class="keyword1" id="utp_hoare-post_weak_hoare_r"><span class="command">lemma</span></span> post_weak_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">q<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇒</span> <span class="free">q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">q<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-hoare_r_conseq"><span class="command">lemma</span></span> hoare_r_conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">`</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">`</span><span class="main">;</span> <span class="main">⦃</span><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span><span class="main">;</span> <span class="main">`</span><span class="free">q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇒</span> <span class="free">q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">`</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Assignment Laws ›</span></span>

<span class="keyword1" id="utp_hoare-assigns_hoare_r"><span class="command">lemma</span></span> assigns_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p</span> <span class="main">⇒</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">q</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-assigns_backward_hoare_r"><span class="command">lemma</span></span> assigns_backward_hoare_r<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">σ</span> <span class="main">†</span> <span class="free">p</span><span class="main">⦄</span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-assign_floyd_hoare_r"><span class="command">lemma</span></span> assign_floyd_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> assign_r <span class="free">x</span> <span class="free">e</span> <span class="main">⦃</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">v</span> <span class="main">∙</span> <span class="free">p</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">e</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_hoare-assigns_init_hoare"><span class="command">lemma</span></span> assigns_init_hoare <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">p</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span><span class="main">;</span> <span class="main">⦃</span><span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span>x <span class="main">:=</span> <span class="free">v</span> <span class="main">;;</span> <span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_hoare-skip_hoare_r"><span class="command">lemma</span></span> skip_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">II</span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-skip_hoare_impl_r"><span class="command">lemma</span></span> skip_hoare_impl_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p</span> <span class="main">⇒</span> <span class="free">q</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">II</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sequence Laws ›</span></span>

<span class="keyword1" id="utp_hoare-seq_hoare_r"><span class="command">lemma</span></span> seq_hoare_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦃</span><span class="free">s</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="free">s</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-seq_hoare_invariant"><span class="command">lemma</span></span> seq_hoare_invariant <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-seq_hoare_stronger_pre_1"><span class="command">lemma</span></span> seq_hoare_stronger_pre_1 <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-seq_hoare_stronger_pre_2"><span class="command">lemma</span></span> seq_hoare_stronger_pre_2 <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>
    
<span class="keyword1" id="utp_hoare-seq_hoare_inv_r_2"><span class="command">lemma</span></span> seq_hoare_inv_r_2 <span class="main">[</span><span class="operator">hoare</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-seq_hoare_inv_r_3"><span class="command">lemma</span></span> seq_hoare_inv_r_3 <span class="main">[</span><span class="operator">hoare</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">;;</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conditional Laws ›</span></span>

<span class="keyword1" id="utp_hoare-cond_hoare_r"><span class="command">lemma</span></span> cond_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⦃</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">;</span> <span class="main">⦃</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span><span class="free">T</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">S</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">T</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_hoare-cond_hoare_r_wp"><span class="command">lemma</span></span> cond_hoare_r_wp<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p'</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p''</span><span class="main">⦄</span><span class="free">T</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p''</span><span class="main">)</span><span class="main">⦄</span><span class="free">S</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">T</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_simp</span>

<span class="keyword1" id="utp_hoare-cond_hoare_r_sp"><span class="command">lemma</span></span> cond_hoare_r_sp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⦃</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⦃</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span><span class="free">T</span><span class="main">⦃</span><span class="free">s</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">S</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">T</span><span class="main">⦃</span><span class="free">q</span> <span class="main">∨</span> <span class="free">s</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">pred_simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Recursion Laws ›</span></span>

<span class="keyword1" id="utp_hoare-nu_hoare_r_partial"><span class="command">lemma</span></span> nu_hoare_r_partial<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> induct_step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">st</span> <span class="bound">P</span><span class="main">.</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="bound">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">F</span> <span class="bound">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>   
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">ν</span> <span class="free">F</span> <span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> hoare_r_def induct_step lfp_lowerbound order_refl<span class="main">)</span>

<span class="keyword1" id="utp_hoare-mu_hoare_r"><span class="command">lemma</span></span> mu_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> induct_step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">st</span> <span class="bound">P</span><span class="main">.</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span><span class="main">⦄</span><span class="bound">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">e</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="main">⦄</span><span class="free">F</span> <span class="bound">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>   
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">μ</span> <span class="free">F</span> <span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> hoare_r_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mu_rec_total_utp_rule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> WF M <span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">e</span></span> <span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">st</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> induct_step<span class="main">[</span><span class="operator">unfolded</span> hoare_r_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span> <span class="main">«</span><span class="skolem">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">q</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">st</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">alpha</span></span><span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="utp_hoare-mu_hoare_r'"><span class="command">lemma</span></span> mu_hoare_r'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> induct_step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">st</span> <span class="bound">P</span><span class="main">.</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span><span class="main">⦄</span> <span class="bound">P</span> <span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">e</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="main">⦄</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> I0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p'</span> <span class="main">⇒</span> <span class="free">p</span><span class="main">`</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p'</span><span class="main">⦄</span> <span class="keyword1">μ</span> <span class="free">F</span> <span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> I0 M WF induct_step mu_hoare_r pre_str_hoare_r<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Iteration Rules ›</span></span>

<span class="keyword1" id="utp_hoare-iter_hoare_r"><span class="command">lemma</span></span> iter_hoare_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">P</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">P</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">P</span><span class="main">⦄</span><span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⦃</span><span class="free">P</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq rtrancl_induct<span class="main">)</span>

<span class="keyword1" id="utp_hoare-while_hoare_r"><span class="command">lemma</span></span> while_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">b</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">S</span> <span class="keyword1">od</span><span class="main">⦃</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_top_def hoare_r_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> lfp_lowerbound<span class="main">)</span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_hoare-while_invr_hoare_r"><span class="command">lemma</span></span> while_invr_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">b</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">pre</span> <span class="main">⇒</span> <span class="free">p</span><span class="main">`</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">post</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">pre</span><span class="main">⦄</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">invr</span> <span class="free">p</span> <span class="keyword1">do</span> <span class="free">S</span> <span class="keyword1">od</span><span class="main">⦃</span><span class="free">post</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms hoare_r_conseq while_hoare_r while_inv_def<span class="main">)</span>

<span class="keyword1" id="utp_hoare-while_r_minimal_partial"><span class="command">lemma</span></span> while_r_minimal_partial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> seq_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p</span> <span class="main">⇒</span> <span class="free">invar</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> induct_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">invar</span><span class="main">∧</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">C</span> <span class="main">⦃</span><span class="free">invar</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">C</span> <span class="keyword1">od</span><span class="main">⦃</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">invar</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> induct_step pre_str_hoare_r seq_step while_hoare_r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="utp_hoare-approx_chain"><span class="command">lemma</span></span> approx_chain<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">n</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Total correctness law for Hoare logic, based on constructive chains. This is limited to
  variants that have naturals numbers as their range. ›</span></span>
    
<span class="keyword1" id="utp_hoare-while_term_hoare_r"><span class="command">lemma</span></span> while_term_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">z</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">z</span><span class="main">»</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">z</span><span class="main">»</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">S</span> <span class="keyword1">od</span><span class="main">⦃</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="main">¬</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">S</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mu_refine_intro<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="main">¬</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">S</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="main">¬</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">n</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">S</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">S</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> constr_fp_uniq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?E</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">n</span><span class="main">.</span> <span class="var">?E</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
          
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">S</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_mono monoI seqr_mono<span class="main">)</span>
          
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"constr <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">S</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span> <span class="var">?E</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> constrI<span class="main">)</span>
        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain <span class="var">?E</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> chainI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="main">0</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span>Suc <span class="bound">i</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⊑</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">i</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
          
        <span class="keyword1"><span class="command">from</span></span> assms
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span> <span class="main">=</span>
                     <span class="main">(</span><span class="free">S</span> <span class="main">;;</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">n</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">»</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> less_antisym less_trans <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hoare_r_def while_bot_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="utp_hoare-while_vrt_hoare_r"><span class="command">lemma</span></span> while_vrt_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">z</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">z</span><span class="main">»</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">z</span><span class="main">»</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">pre</span> <span class="main">⇒</span> <span class="free">p</span><span class="main">`</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">post</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">pre</span><span class="main">⦄</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">invr</span> <span class="free">p</span> <span class="keyword1">vrt</span> <span class="free">v</span> <span class="keyword1">do</span> <span class="free">S</span> <span class="keyword1">od</span><span class="main">⦃</span><span class="free">post</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hoare_r_conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_vrt_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> while_term_hoare_r<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ General total correctness law based on well-founded induction ›</span></span>
        
<span class="keyword1" id="utp_hoare-while_wf_hoare_r"><span class="command">lemma</span></span> while_wf_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">pre</span> <span class="main">⇒</span> <span class="free">p</span><span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> induct_step<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">st</span><span class="main">.</span> <span class="main">⦃</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">∧</span> <span class="free">e</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> PHI<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">post</span><span class="main">`</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">pre</span><span class="main">⦄</span><span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">invr</span> <span class="free">p</span> <span class="keyword1">do</span> <span class="free">Q</span> <span class="keyword1">od</span><span class="main">⦃</span><span class="free">post</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> hoare_r_def while_inv_bot_def while_bot_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pre_weak_rel<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> I0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⌈</span><span class="free">pre</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">`</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">post</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="free">Q</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mu_rec_total_utp_rule<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">e</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> WF<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Monotonic <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">Q</span> <span class="main">;;</span> <span class="bound">X</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">closure</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> induct_step'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="main">⌈</span><span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">∧</span>  <span class="free">e</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">(</span><span class="main">⌈</span><span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span> <span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> induct_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>  
    <span class="keyword1"><span class="command">with</span></span> PHI
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">st</span><span class="main">.</span> <span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">post</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⌈</span><span class="free">p</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌈</span><span class="free">e</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">,</span> <span class="main">«</span><span class="bound">st</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">«</span><span class="free">R</span><span class="main">»</span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">post</span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">II</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>       
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Frame Rules ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Frame rule: If starting $S$ in a state satisfying $p establishes q$ in the final state, then
  we can insert an invariant predicate $r$ when $S$ is framed by $a$, provided that $r$ does not
  refer to variables in the frame, and $q$ does not refer to variables outside the frame. ›</span></span>

<span class="keyword1" id="utp_hoare-frame_hoare_r"><span class="command">lemma</span></span> frame_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♯</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">r</span><span class="main">⦄</span>a<span class="main">:[</span><span class="free">P</span><span class="main">]</span><span class="main">⦃</span><span class="free">q</span> <span class="main">∧</span> <span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="utp_hoare-frame_strong_hoare_r"><span class="command">lemma</span></span> frame_strong_hoare_r <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♯</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">r</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">r</span><span class="main">⦄</span>a<span class="main">:[</span><span class="free">S</span><span class="main">]</span><span class="main">⦃</span><span class="free">q</span> <span class="main">∧</span> <span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="utp_hoare-frame_hoare_r'"><span class="command">lemma</span></span> frame_hoare_r' <span class="main">[</span><span class="operator">hoare_safe</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♯</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">r</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span><span class="free">S</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">r</span> <span class="main">∧</span> <span class="free">p</span><span class="main">⦄</span>a<span class="main">:[</span><span class="free">S</span><span class="main">]</span><span class="main">⦃</span><span class="free">r</span> <span class="main">∧</span> <span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frame_strong_hoare_r utp_pred_laws.inf.commute<span class="main">)</span>

<span class="keyword1" id="utp_hoare-antiframe_hoare_r"><span class="command">lemma</span></span> antiframe_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♯</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">r</span><span class="main">⦄</span> a<span class="main">:⟦</span><span class="free">P</span><span class="main">⟧</span> <span class="main">⦃</span><span class="free">q</span> <span class="main">∧</span> <span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
    
<span class="keyword1" id="utp_hoare-antiframe_strong_hoare_r"><span class="command">lemma</span></span> antiframe_strong_hoare_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♯</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">r</span><span class="main">⦄</span><span class="free">P</span><span class="main">⦃</span><span class="free">q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">∧</span> <span class="free">r</span><span class="main">⦄</span> a<span class="main">:⟦</span><span class="free">P</span><span class="main">⟧</span> <span class="main">⦃</span><span class="free">q</span> <span class="main">∧</span> <span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_wp">
<div class="head">
<h1>Theory utp_wp</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Weakest (Liberal) Precondition Calculus›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_wp
<span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_hoare.html">utp_hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A very quick implementation of wlp -- more laws still needed!›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> wp

<span class="keyword1"><span class="command">method</span></span> wp_tac <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">wp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">consts</span></span>
  uwp <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> 

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uwp"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">wp</span>"</span> 60<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_uwp <span class="free">P</span> <span class="free">b</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uwp <span class="free">P</span> <span class="free">b</span>"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wp_upred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="tfree">'β</span> cond <span class="main">⇒</span> <span class="tfree">'α</span> cond"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wp_upred</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">;;</span> <span class="main">(</span><span class="main">¬</span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel<span class="main">⌋<span class="hidden">⇩</span><sub>&lt;</sub></span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  uwp <span class="quoted">wp_upred</span>

<span class="keyword1"><span class="command">declare</span></span> wp_upred_def <span class="main">[</span><span class="operator">urel_defs</span><span class="main">]</span>

<span class="keyword1" id="utp_wp-wp_true"><span class="command">lemma</span></span> wp_true <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">wp</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span>  
  
<span class="keyword1"><span class="command">theorem</span></span> wp_assigns_r <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="keyword1">wp</span> <span class="free">r</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_skip_r <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">II</span> <span class="keyword1">wp</span> <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_abort <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="keyword1">true</span> <span class="main">⟹</span> <span class="keyword1">true</span> <span class="keyword1">wp</span> <span class="free">r</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_conj <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">wp</span> <span class="main">(</span><span class="free">q</span> <span class="main">∧</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">wp</span> <span class="free">q</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">wp</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_seq_r <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">wp</span> <span class="free">r</span> <span class="main">=</span> <span class="free">P</span> <span class="keyword1">wp</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">wp</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_choice <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">wp</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">wp</span> <span class="free">R</span> <span class="main">∧</span> <span class="free">Q</span> <span class="keyword1">wp</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_cond <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">wp</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">⇒</span> <span class="free">P</span> <span class="keyword1">wp</span> <span class="free">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">b</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">Q</span> <span class="keyword1">wp</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1" id="utp_wp-wp_USUP_pre"><span class="command">lemma</span></span> wp_USUP_pre <span class="main">[</span><span class="operator">wp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">wp</span> <span class="main">(</span><span class="main">⨆</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∙</span> <span class="free">P</span> <span class="keyword1">wp</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> wp_hoare_link<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">wp</span> <span class="free">r</span> <span class="main">⊑</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If two programs have the same weakest precondition for any postcondition then the programs
  are the same.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> wp_eq_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">r</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">wp</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">Q</span> <span class="keyword1">wp</span> <span class="bound">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span> <span class="quasi_keyword">robust</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_dynlog">
<div class="head">
<h1>Theory utp_dynlog</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Dynamic Logic ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_dynlog
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_sequent.html">utp_sequent</a> <a href="utp_wp.html">utp_wp</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Definitions ›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> dynlog_simp <span class="keyword2"><span class="keyword">and</span></span> dynlog_intro

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dBox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> hrel <span class="main">⇒</span> <span class="tfree">'s</span> upred <span class="main">⇒</span> <span class="tfree">'s</span> upred"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>[</b></span>_<span class="keyword1"><span class="hidden">❙</span><b>]</b></span>_"</span> <span class="main">[</span>0<span class="main">,</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dBox</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">wp</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dDia</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> hrel <span class="main">⇒</span> <span class="tfree">'s</span> upred <span class="main">⇒</span> <span class="tfree">'s</span> upred"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>&lt;</b></span>_<span class="keyword1"><span class="hidden">❙</span><b>&gt;</b></span>_"</span> <span class="main">[</span>0<span class="main">,</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dDia</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">❙</span><b>]</b></span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Box Laws ›</span></span>

<span class="keyword1" id="utp_dynlog-dBox_false"><span class="command">lemma</span></span> dBox_false <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="keyword1">false</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_skip"><span class="command">lemma</span></span> dBox_skip <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="keyword1">II</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_assigns"><span class="command">lemma</span></span> dBox_assigns <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_def wp_assigns_r<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_choice"><span class="command">lemma</span></span> dBox_choice <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_seq"><span class="command">lemma</span></span> dBox_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_def wp_seq_r<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_star_unfold"><span class="command">lemma</span></span> dBox_star_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="free">Φ</span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dBox_choice dBox_seq dBox_skip ustar_unfoldl<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_star_induct"><span class="command">lemma</span></span> dBox_star_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">(</span><span class="free">Φ</span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="main">(</span><span class="free">Φ</span> <span class="main">⇒</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq rtrancl_induct<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dBox_test"><span class="command">lemma</span></span> dBox_test<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>[</b></span><span class="main">?[</span><span class="free">p</span><span class="main">]</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⇒</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Diamond Laws ›</span></span>

<span class="keyword1" id="utp_dynlog-dDia_false"><span class="command">lemma</span></span> dDia_false <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="keyword1">false</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_false dDia_def<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dDia_skip"><span class="command">lemma</span></span> dDia_skip <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="keyword1">II</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_skip dDia_def<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dDia_assigns"><span class="command">lemma</span></span> dDia_assigns <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">†</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_assigns dDia_def subst_not<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dDia_choice"><span class="command">lemma</span></span> dDia_choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">∨</span> <span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_def dDia_def wp_choice<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dDia_seq"><span class="command">lemma</span></span> dDia_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_def dDia_def wp_seq_r<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-dDia_test"><span class="command">lemma</span></span> dDia_test<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>&lt;</b></span><span class="main">?[</span><span class="free">p</span><span class="main">]</span><span class="main"><span class="hidden">❙</span><b>&gt;</b></span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">∧</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sequent Laws ›</span></span>

<span class="keyword1" id="utp_dynlog-sBoxSeq"><span class="command">lemma</span></span> sBoxSeq <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊩</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span> <span class="main">≡</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dBox_def wp_seq_r<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-sBoxTest"><span class="command">lemma</span></span> sBoxTest <span class="main">[</span><span class="operator">dynlog_intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊩</span> <span class="main">(</span><span class="free">b</span> <span class="main">⇒</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊩</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="main">?[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_dynlog-sBoxAssignFwd"><span class="command">lemma</span></span> sBoxAssignFwd <span class="main">[</span><span class="operator">dynlog_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">v</span><span class="main">;</span> x <span class="main">♯</span> <span class="free">Γ</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">⊩</span> <span class="main"><span class="hidden">❙</span><b>[</b></span>x <span class="main">:=</span> <span class="free">v</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">v</span> <span class="main">∧</span> <span class="free">Γ</span><span class="main">)</span> <span class="main">⊩</span> <span class="free">Φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-sBoxIndStar"><span class="command">lemma</span></span> sBoxIndStar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊩</span> <span class="main">[</span><span class="free">Φ</span> <span class="main">⇒</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span><span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟹</span> <span class="free">Φ</span> <span class="main">⊩</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">Φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq rtrancl_induct<span class="main">)</span>

<span class="keyword1" id="utp_dynlog-hoare_as_dynlog"><span class="command">lemma</span></span> hoare_as_dynlog<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊩</span> <span class="main"><span class="hidden">❙</span><b>[</b></span><span class="free">Q</span><span class="main"><span class="hidden">❙</span><b>]</b></span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_state_parser">
<div class="head">
<h1>Theory utp_state_parser</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ State Variable Declaration Parser ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_state_parser
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="utp_rel.html">utp_rel</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This theory sets up a parser for state blocks, as an alternative way of providing lenses to
  a predicate. A program with local variables can be represented by a predicate indexed by a tuple
  of lenses, where each lens represents a variable. These lenses must then be supplied with respect
  to a suitable state space. Instead of creating a type to represent this alphabet, we can create
  a product type for the state space, with an entry for each variable. Then each variable becomes
  a composition of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">fst<span class="hidden">⇩</span><sub>L</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">snd<span class="hidden">⇩</span><sub>L</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> lenses to index the correct position in the
  variable vector. 

  We first creation a vacuous definition that will mark when an indexed predicate denotes a state
  block. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">state_block</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'p</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">state_block</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We declare a number of syntax translations to produce lens and product types, to obtain
  a type for the overall state space, to construct a tuple that denotes the lens vector parameter, 
  to construct the vector itself, and finally to construct the state declaration. ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_lensT"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> type <span class="main">⇒</span> type"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">LENSTYPE'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_pairT"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> type <span class="main">⇒</span> type"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">PAIRTYPE'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_state_type"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> type"</span></span>
  <span class="quoted">"_state_tuple"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> pttrn <span class="main">⇒</span> logic"</span></span>
  <span class="quoted">"_state_lenses"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic"</span></span>
  <span class="quoted">"_state_decl"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">LOCAL</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span> 

<span class="keyword1"><span class="command">translations</span></span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="keyword1">PAIRTYPE(</span><span class="tfree"><span class="free">'a</span></span><span class="main">,</span> <span class="tfree"><span class="free">'b</span></span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span> <span class="main">×</span> <span class="tfree"><span class="free">'b</span></span>"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="keyword1">LENSTYPE(</span><span class="tfree"><span class="free">'a</span></span><span class="main">,</span> <span class="tfree"><span class="free">'b</span></span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span> <span class="main">⟹</span> <span class="tfree"><span class="free">'b</span></span>"</span>

  <span class="quoted">"_state_type <span class="main">(</span>_constrain <span class="free">x</span> <span class="free">t</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">t</span>"</span>
  <span class="quoted">"_state_type <span class="main">(</span><span class="keyword1">CONST</span> Pair <span class="main">(</span>_constrain <span class="free">x</span> <span class="free">t</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"_pairT <span class="free">t</span> <span class="main">(</span>_state_type <span class="free">vs</span><span class="main">)</span>"</span>

  <span class="quoted">"_state_tuple <span class="free">st</span> <span class="main">(</span>_constrain <span class="free">x</span> <span class="free">t</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"_constrain <span class="free">x</span> <span class="main">(</span>_lensT <span class="free">t</span> <span class="free">st</span><span class="main">)</span>"</span>
  <span class="quoted">"_state_tuple <span class="free">st</span> <span class="main">(</span><span class="keyword1">CONST</span> Pair <span class="main">(</span>_constrain <span class="free">x</span> <span class="free">t</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span> <span class="main">=&gt;</span>
    <span class="quoted">"<span class="keyword1">CONST</span> Product_Type.Pair <span class="main">(</span>_constrain <span class="free">x</span> <span class="main">(</span>_lensT <span class="free">t</span> <span class="free">st</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>_state_tuple <span class="free">st</span> <span class="free">vs</span><span class="main">)</span>"</span>

  <span class="quoted">"_state_decl <span class="free">vs</span> <span class="free">P</span>"</span> <span class="main">=&gt;</span>
    <span class="quoted">"<span class="keyword1">CONST</span> state_block <span class="main">(</span>_abs <span class="main">(</span>_state_tuple <span class="main">(</span>_state_type <span class="free">vs</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span>_state_lenses <span class="free">vs</span><span class="main">)</span>"</span>
  <span class="quoted">"_state_decl <span class="free">vs</span> <span class="free">P</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> state_block <span class="main">(</span>_abs <span class="free">vs</span> <span class="free">P</span><span class="main">)</span> <span class="free">k</span>"</span>

<span class="keyword1"><span class="command">parse_translation</span></span> <span class="quoted">‹
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword3"><span class="keyword">open</span></span> HOLogic<span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lens_comp</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "lens_comp"<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fst_lens</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "fst_lens"<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">snd_lens</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "snd_lens"<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">id_lens</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "id_lens"<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">;</span>
    <span class="comment1">(* Construct a tuple of lenses for each of the possible locally declared variables *)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> 
      <span class="entity">state_lenses</span> <span class="entity">n</span> <span class="entity">st</span> <span class="main">=</span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">n</span> <span class="main">=</span> <span class="inner_numeral">1</span><span class="main">)</span> 
          <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">st</span>
          <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">pair_const</span> dummyT dummyT $ <span class="main">(</span><span class="entity">lens_comp</span> $ <span class="entity">fst_lens</span> $ <span class="entity">st</span><span class="main">)</span> $ <span class="main">(</span><span class="entity">state_lenses</span> <span class="main">(</span><span class="entity">n</span> - <span class="inner_numeral">1</span><span class="main">)</span> <span class="main">(</span><span class="entity">lens_comp</span> $ <span class="entity">snd_lens</span> $ <span class="entity">st</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">fun</span></span>
      <span class="comment1">(* Add up the number of variable declarations in the tuple *)</span>
      <span class="entity">var_decl_num</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "Product_Type.Pair"<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span> $ <span class="main">_</span> $ <span class="entity">vs</span><span class="main">)</span> <span class="main">=</span> <span class="entity">var_decl_num</span> <span class="entity">vs</span> + <span class="inner_numeral">1</span> <span class="main">|</span>
      <span class="entity">var_decl_num</span> <span class="main">_</span> <span class="main">=</span> <span class="inner_numeral">1</span><span class="main">;</span>

    
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">state_lens</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">vs</span><span class="main">]</span> <span class="main">=</span> <span class="entity">state_lenses</span> <span class="main">(</span><span class="entity">var_decl_num</span> <span class="entity">vs</span><span class="main">)</span> <span class="entity">id_lens</span> <span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
  <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"_state_lenses"</span><span class="main">,</span> <span class="entity">state_lens</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Examples ›</span></span>

<span class="keyword1"><span class="command">term</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">LOCAL</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">y</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">z</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∙</span> x <span class="main">:=</span> <span class="main">(</span><span class="main">&amp;</span>x <span class="main">+</span> <span class="main">&amp;</span>z<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LOCAL</span> p <span class="main">∙</span> <span class="keyword1">II</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_rel_opsem">
<div class="head">
<h1>Theory utp_rel_opsem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Relational Operational Semantics ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_rel_opsem
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="utp_rel_laws.html">utp_rel_laws</a> 
    <a href="utp_hoare.html">utp_hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This theory uses the laws of relational calculus to create a basic operational semantics.
  It is based on Chapter 10 of the UTP book~\cite{Hoare&amp;98}. ›</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">trel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> usubst <span class="main">×</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> usubst <span class="main">×</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span>"</span> 85<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→<span class="hidden">⇩</span><sub>u</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_rel_opsem-trans_trel"><span class="command">lemma</span></span> trans_trel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">ρ</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">ρ</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">φ</span><span class="main">,</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="utp_rel_opsem-skip_trel"><span class="command">lemma</span></span> skip_trel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="keyword1">II</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="utp_rel_opsem-assigns_trel"><span class="command">lemma</span></span> assigns_trel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="main">⟨</span><span class="free">ρ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∘</span> <span class="free">σ</span><span class="main">,</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_comp<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-assign_trel"><span class="command">lemma</span></span> assign_trel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> x <span class="main">:=</span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="main">&amp;</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">†</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_comp <span class="dynamic"><span class="dynamic">usubst</span></span><span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-seq_trel"><span class="command">lemma</span></span> seq_trel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">ρ</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">ρ</span><span class="main">,</span> <span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms order_refl seqr_assoc seqr_mono trel.simps<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-seq_skip_trel"><span class="command">lemma</span></span> seq_skip_trel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="keyword1">II</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="utp_rel_opsem-nondet_left_trel"><span class="command">lemma</span></span> nondet_left_trel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> disj_comm disj_upred_def semilattice_sup_class.sup.absorb_iff1 semilattice_sup_class.sup.left_idem seqr_or_distr trel.simps<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-nondet_right_trel"><span class="command">lemma</span></span> nondet_right_trel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqr_mono<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-rcond_true_trel"><span class="command">lemma</span></span> rcond_true_trel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_r_comp <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">alpha</span></span> cond_unit_T<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-rcond_false_trel"><span class="command">lemma</span></span> rcond_false_trel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assigns_r_comp <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">alpha</span></span> cond_unit_F<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-while_true_trel"><span class="command">lemma</span></span> while_true_trel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rcond_true_trel while_unfold<span class="main">)</span>

<span class="keyword1" id="utp_rel_opsem-while_false_trel"><span class="command">lemma</span></span> while_false_trel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="free">σ</span><span class="main">,</span> <span class="keyword1">II</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rcond_false_trel while_unfold<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Theorem linking Hoare calculus and operational semantics. If we start $Q$ in a state $\sigma_0$
  satisfying $p$, and $Q$ reaches final state $\sigma_1$ then $r$ holds in this final state. ›</span></span>
    
<span class="keyword1"><span class="command">theorem</span></span> hoare_opsem_link<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">σ<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">`</span><span class="bound">σ<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">†</span> <span class="free">p</span><span class="main">`</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">σ<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="bound">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">`</span><span class="bound">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">†</span> <span class="free">r</span><span class="main">`</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a b<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="improper">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">declare</span></span> trel.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_sym_eval">
<div class="head">
<h1>Theory utp_sym_eval</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Symbolic Evaluation of Relational Programs ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_sym_eval
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_rel_opsem.html">utp_rel_opsem</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following operator applies a variable context $\Gamma$ as an assignment, and composes 
  it with a relation $P$ for the purposes of evaluation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">utp_sym_eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> usubst <span class="main">⇒</span> <span class="tfree">'s</span> hrel <span class="main">⇒</span> <span class="tfree">'s</span> hrel"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">utp_sym_eval</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> symeval

<span class="keyword1" id="utp_sym_eval-seq_symeval"><span class="command">lemma</span></span> seq_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊨</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">⊨</span> <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-assigns_symeval"><span class="command">lemma</span></span> assigns_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊨</span> <span class="main">⟨</span><span class="free">σ</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">∘</span> <span class="free">Γ</span><span class="main">)</span> <span class="main">⊨</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-term_symeval"><span class="command">lemma</span></span> term_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">II</span><span class="main">)</span> <span class="main">;;</span> <span class="free">P</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-if_true_symeval"><span class="command">lemma</span></span> if_true_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">true</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_sym_eval_def <span class="dynamic"><span class="dynamic">usubst</span></span> assigns_r_comp<span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-if_false_symeval"><span class="command">lemma</span></span> if_false_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">false</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_sym_eval_def <span class="dynamic"><span class="dynamic">usubst</span></span> assigns_r_comp<span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-while_true_symeval"><span class="command">lemma</span></span> while_true_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">true</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> while_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">symeval</span></span><span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-while_false_symeval"><span class="command">lemma</span></span> while_false_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">false</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> while_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">symeval</span></span><span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-while_inv_true_symeval"><span class="command">lemma</span></span> while_inv_true_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">true</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">invr</span> <span class="free">S</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> while_inv_def while_true_symeval<span class="main">)</span>

<span class="keyword1" id="utp_sym_eval-while_inv_false_symeval"><span class="command">lemma</span></span> while_inv_false_symeval <span class="main">[</span><span class="operator">symeval</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">†</span> <span class="free">b</span> <span class="main">=</span> <span class="keyword1">false</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">invr</span> <span class="free">S</span> <span class="keyword1">do</span> <span class="free">P</span> <span class="keyword1">od</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> while_false_symeval while_inv_def<span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> sym_eval <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">symeval</span></span> <span class="dynamic"><span class="dynamic">usubst</span></span> <span class="dynamic"><span class="dynamic">lit_simps</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_terminated"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">terminated:</span> _"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">terminated:</span> <span class="free">Γ</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">Γ</span> <span class="main">⊨</span> <span class="keyword1">II</span>"</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_sp">
<div class="head">
<h1>Theory utp_sp</h1>
</div>
<pre class="source"><span class="comment1">(*************************************************************************************************)</span>
<span class="comment1">(* Project: The Isabelle/UTP Proof System                                                        *)</span>
<span class="comment1">(* File: utp_sp.thy                                                                              *)</span>
<span class="comment1">(* Authors: Yakoub Nemouchi (Virginia Tech, USA) and Simon Foster (University of York, UK)       *)</span>
<span class="comment1">(* Emails: nemouchi@vt.edu and simon.foster@york.ac.uk                                           *)</span>
<span class="comment1">(*************************************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Strong Postcondition Calculus›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_sp
<span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_wp.html">utp_wp</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> sp

<span class="keyword1"><span class="command">method</span></span> sp_tac <span class="main">=</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">sp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">consts</span></span>
  usp <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">sp</span>"</span> 60<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sp_upred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> cond <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="tfree">'β</span> cond"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sp_upred</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="main">(</span><span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel<span class="main">⌋<span class="hidden">⇩</span><sub>&gt;</sub></span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  usp <span class="quoted">sp_upred</span>

<span class="keyword1"><span class="command">declare</span></span> sp_upred_def <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span>

<span class="keyword1" id="utp_sp-sp_false"><span class="command">lemma</span></span> sp_false <span class="main">[</span><span class="operator">sp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">sp</span> <span class="keyword1">false</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_simp</span><span class="main">)</span> 

<span class="keyword1" id="utp_sp-sp_true"><span class="command">lemma</span></span> sp_true <span class="main">[</span><span class="operator">sp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="keyword1">false</span> <span class="main">⟹</span> <span class="free">q</span> <span class="keyword1">sp</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span> 
    
<span class="keyword1" id="utp_sp-sp_assigns_r"><span class="command">lemma</span></span> sp_assigns_r <span class="main">[</span><span class="operator">sp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">sp</span> x <span class="main">:=</span> <span class="free">e</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">v</span> <span class="main">∙</span> <span class="free">p</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span> <span class="main">∧</span> <span class="main">&amp;</span>x <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">e</span><span class="main">⟦</span><span class="main">«</span><span class="bound">v</span><span class="main">»</span><span class="main">/</span>x<span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vwb_lens.put_eq<span class="main">)</span> 

<span class="keyword1" id="utp_sp-sp_it_is_post_condition"><span class="command">lemma</span></span> sp_it_is_post_condition<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">p</span> <span class="keyword1">sp</span> <span class="free">C</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>
    
<span class="keyword1" id="utp_sp-sp_it_is_the_strongest_post"><span class="command">lemma</span></span> sp_it_is_the_strongest_post<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p</span> <span class="keyword1">sp</span> <span class="free">C</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">`</span><span class="main">⟹</span><span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>
    
<span class="keyword1" id="utp_sp-sp_so"><span class="command">lemma</span></span> sp_so<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">p</span> <span class="keyword1">sp</span> <span class="free">C</span> <span class="main">⇒</span> <span class="free">Q</span><span class="main">`</span> <span class="main">=</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>
    
<span class="keyword1"><span class="command">theorem</span></span> sp_hoare_link<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">r</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊑</span> <span class="free">p</span> <span class="keyword1">sp</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>   
                             
<span class="keyword1" id="utp_sp-sp_while_r"><span class="command">lemma</span></span> sp_while_r <span class="main">[</span><span class="operator">sp</span><span class="main">]</span><span class="main">:</span> 
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">`</span><span class="free">pre</span> <span class="main">⇒</span> <span class="free">I</span><span class="main">`</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⦃</span><span class="free">I</span> <span class="main">∧</span> <span class="free">b</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">I'</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">`</span><span class="free">I'</span> <span class="main">⇒</span> <span class="free">I</span><span class="main">`</span>›</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">pre</span> <span class="keyword1">sp</span> <span class="free">invar</span> <span class="free">I</span> <span class="keyword1">while<span class="hidden">⇩</span><sub>⊥</sub></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">C</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="free">b</span> <span class="main">∧</span> <span class="free">I</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> sp_upred_def     
   <span class="keyword1"><span class="command">oops</span></span>  
     
<span class="keyword1"><span class="command">theorem</span></span> sp_eq_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">sp</span> <span class="free">P</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">sp</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span> <span class="quasi_keyword">robust</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>  
    
<span class="keyword1" id="utp_sp-wp_sp_sym"><span class="command">lemma</span></span> wp_sp_sym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">prog</span> <span class="keyword1">wp</span> <span class="main">(</span><span class="keyword1">true</span> <span class="keyword1">sp</span> <span class="free">prog</span><span class="main">)</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>
     
<span class="keyword1" id="utp_sp-it_is_pre_condition"><span class="command">lemma</span></span> it_is_pre_condition<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">C</span> <span class="keyword1">wp</span> <span class="free">Q</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>    

<span class="keyword1" id="utp_sp-it_is_the_weakest_pre"><span class="command">lemma</span></span> it_is_the_weakest_pre<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">C</span> <span class="keyword1">wp</span> <span class="free">Q</span><span class="main">`</span> <span class="main">=</span> <span class="main">⦃</span><span class="free">P</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>  

<span class="keyword1" id="utp_sp-s_pre"><span class="command">lemma</span></span> s_pre<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">P</span> <span class="main">⇒</span> <span class="free">C</span> <span class="keyword1">wp</span> <span class="free">Q</span><span class="main">`</span><span class="main">=</span><span class="main">⦃</span><span class="free">P</span><span class="main">⦄</span><span class="free">C</span><span class="main">⦃</span><span class="free">Q</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_blast</span>     

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_concurrency">
<div class="head">
<h1>Theory utp_concurrency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Concurrent Programming ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_concurrency
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="utp_hoare.html">utp_hoare</a>
    <a href="utp_rel.html">utp_rel</a>
    <a href="utp_tactics.html">utp_tactics</a>
    <a href="utp_theory.html">utp_theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In this theory we describe the UTP scheme for concurrency, \emph{parallel-by-merge},
  which provides a general parallel operator parametrised by a ``merge predicate'' that explains
  how to merge the after states of the composed predicates. It can thus be applied to many languages
  and concurrency schemes, with this theory providing a number of generic laws. The operator is
  explained in more detail in Chapter 7 of the UTP book~\cite{Hoare&amp;98}. ›</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Variable Renamings ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In parallel-by-merge constructions, a merge predicate defines the behaviour following execution of
  of parallel processes, $P \parallel Q$, as a relation that merges the output of $P$ and $Q$. In order 
  to achieve this we need to separate the variable values output from $P$ and $Q$, and in addition the 
  variable values before execution. The following three constructs do these separations. The initial
  state-space before execution is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'α</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the final state-space after the first parallel process
  is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and the final state-space for the second is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. These three functions
  lift variables on these three state-spaces, respectively.
›</span></span>

<span class="keyword1"><span class="command">alphabet</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> mrg <span class="main">=</span>
  mrg_prior <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span>"</span></span>
  mrg_left  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  mrg_right  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pre_uvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> mrg<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pre_uvar</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> mrg_prior"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">left_uvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> mrg<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">left_uvar</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> mrg_left"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">right_uvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> mrg<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">right_uvar</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> mrg_right"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We set up syntax for the three variable classes using a subscript $&lt;$, $0$-$x$, and $1$-$x$,
  respectively. ›</span></span> 

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_svarpre"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svid"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇩</span><sub>&lt;</sub></span>"</span> <span class="main">[</span>995<span class="main">]</span> 995<span class="main">)</span>
  <span class="quoted">"_svarleft"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svid"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">0-</span>_"</span> <span class="main">[</span>995<span class="main">]</span> 995<span class="main">)</span>
  <span class="quoted">"_svarright"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> svid"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">1-</span>_"</span> <span class="main">[</span>995<span class="main">]</span> 995<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_svarpre <span class="free">x</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> pre_uvar <span class="free">x</span>"</span>
  <span class="quoted">"_svarleft <span class="free">x</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> left_uvar <span class="free">x</span>"</span>
  <span class="quoted">"_svarright <span class="free">x</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> right_uvar <span class="free">x</span>"</span>
  <span class="quoted">"_svarpre <span class="keyword1">Σ</span>"</span>   <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> pre_uvar <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span>
  <span class="quoted">"_svarleft <span class="keyword1">Σ</span>"</span>  <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> left_uvar <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span>
  <span class="quoted">"_svarright <span class="keyword1">Σ</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> right_uvar <span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span>"</span>  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We proved behavedness closure properties about the lenses. ›</span></span>
  
<span class="keyword1" id="utp_concurrency-left_uvar"><span class="command">lemma</span></span> left_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> vwb_lens <span class="main">(</span>left_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_uvar_def <span class="main">)</span>

<span class="keyword1" id="utp_concurrency-right_uvar"><span class="command">lemma</span></span> right_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> vwb_lens <span class="main">(</span>right_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-pre_uvar"><span class="command">lemma</span></span> pre_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> vwb_lens <span class="main">(</span>pre_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-left_uvar_mwb"><span class="command">lemma</span></span> left_uvar_mwb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> mwb_lens <span class="main">(</span>left_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_uvar_def <span class="main">)</span>

<span class="keyword1" id="utp_concurrency-right_uvar_mwb"><span class="command">lemma</span></span> right_uvar_mwb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> mwb_lens <span class="main">(</span>right_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-pre_uvar_mwb"><span class="command">lemma</span></span> pre_uvar_mwb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mwb_lens <span class="free">x</span> <span class="main">⟹</span> mwb_lens <span class="main">(</span>pre_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_uvar_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We prove various independence laws about the variable classes. ›</span></span>
  
<span class="keyword1" id="utp_concurrency-left_uvar_indep_right_uvar"><span class="command">lemma</span></span> left_uvar_indep_right_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"left_uvar <span class="free">x</span> <span class="main">⨝</span> right_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_uvar_def right_uvar_def lens_comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-left_uvar_indep_pre_uvar"><span class="command">lemma</span></span> left_uvar_indep_pre_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"left_uvar <span class="free">x</span> <span class="main">⨝</span> pre_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_uvar_def pre_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-left_uvar_indep_left_uvar"><span class="command">lemma</span></span> left_uvar_indep_left_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> left_uvar <span class="free">x</span> <span class="main">⨝</span> left_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-right_uvar_indep_left_uvar"><span class="command">lemma</span></span> right_uvar_indep_left_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"right_uvar <span class="free">x</span> <span class="main">⨝</span> left_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_sym<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-right_uvar_indep_pre_uvar"><span class="command">lemma</span></span> right_uvar_indep_pre_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"right_uvar <span class="free">x</span> <span class="main">⨝</span> pre_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_uvar_def pre_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-right_uvar_indep_right_uvar"><span class="command">lemma</span></span> right_uvar_indep_right_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> right_uvar <span class="free">x</span> <span class="main">⨝</span> right_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-pre_uvar_indep_left_uvar"><span class="command">lemma</span></span> pre_uvar_indep_left_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pre_uvar <span class="free">x</span> <span class="main">⨝</span> left_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_sym<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-pre_uvar_indep_right_uvar"><span class="command">lemma</span></span> pre_uvar_indep_right_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pre_uvar <span class="free">x</span> <span class="main">⨝</span> right_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_sym<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-pre_uvar_indep_pre_uvar"><span class="command">lemma</span></span> pre_uvar_indep_pre_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⨝</span> <span class="free">y</span> <span class="main">⟹</span> pre_uvar <span class="free">x</span> <span class="main">⨝</span> pre_uvar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_uvar_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Merge Predicates ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A merge predicate is a relation whose input has three parts: the prior variables, the output
  variables of the left predicate, and the output of the right predicate. ›</span></span>
  
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> merge <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> mrg<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> urel"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ skip is the merge predicate which ignores the output of both parallel predicates ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">skip<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> merge"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">skip<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ swap is a predicate that the swaps the left and right indices; it is used to specify
        commutativity of the parallel operator ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">swap<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> mrg<span class="main">)</span> hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">swap<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">:=</span> <span class="main">(</span><span class="main">&amp;</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">&amp;</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A symmetric merge is one for which swapping the order of the merged concurrent predicates
  has no effect. We represent this by the following healthiness condition that states that
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"swap<span class="hidden">⇩</span><sub>m</sub>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a left-unit. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SymMerge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> merge <span class="main">⇒</span> <span class="tfree">'α</span> merge"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">SymMerge</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>swap<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Separating Simulations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ U0 and U1 are relations modify the variables of the input state-space such that they become 
  indexed with $0$ and $1$, respectively. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">U0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> mrg<span class="main">)</span> urel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U0</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">U1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="tfree">'β<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> mrg<span class="main">)</span> urel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U1</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_concurrency-U0_swap"><span class="command">lemma</span></span> U0_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U0 <span class="main">;;</span> swap<span class="hidden">⇩</span><sub>m</sub><span class="main">)</span> <span class="main">=</span> U1"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_swap"><span class="command">lemma</span></span> U1_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U1 <span class="main">;;</span> swap<span class="hidden">⇩</span><sub>m</sub><span class="main">)</span> <span class="main">=</span> U0"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ As shown below, separating simulations can also be expressed using the following two 
  alphabet extrusions ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">U0α</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U0α</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> mrg_left<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">U1α</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U1α</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>L</sub></span> <span class="keyword1">×<span class="hidden">⇩</span><sub>L</sub></span> mrg_right<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We then create the following intuitive syntax for separating simulations. ›</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">U0_alpha_lift</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>0</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌉<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> U0α"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">U1_alpha_lift</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌈</span>_<span class="keyword1">⌉<span class="hidden">⇩</span><sub>1</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌈</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">⌉<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>p</sub></span> U1α"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⌈</span></span><span class="free"><span class="free">P</span></span><span class="main"><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is predicate $P$ where all variables are indexed by $0$, and 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⌈</span></span><span class="free"><span class="free">P</span></span><span class="main"><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is where all variables are indexed by $1$. We can thus equivalently express separating 
  simulations using alphabet extrusion. ›</span></span>
  
<span class="keyword1" id="utp_concurrency-U0_as_alpha"><span class="command">lemma</span></span> U0_as_alpha<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_as_alpha"><span class="command">lemma</span></span> U1_as_alpha<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U1<span class="main">)</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0α_vwb_lens"><span class="command">lemma</span></span> U0α_vwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens U0α"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U0α_def id_vwb_lens prod_vwb_lens<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1α_vwb_lens"><span class="command">lemma</span></span> U1α_vwb_lens <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens U1α"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U1α_def id_vwb_lens prod_vwb_lens<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0α_indep_right_uvar"><span class="command">lemma</span></span> U0α_indep_right_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> U0α <span class="main">⨝</span> out_var <span class="main">(</span>right_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> plus_pres_lens_indep fst_snd_lens_indep lens_indep_left_comp
            <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U0α_def right_uvar_def out_var_def prod_as_plus lens_comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1α_indep_left_uvar"><span class="command">lemma</span></span> U1α_indep_left_uvar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">x</span> <span class="main">⟹</span> U1α <span class="main">⨝</span> out_var <span class="main">(</span>left_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> plus_pres_lens_indep fst_snd_lens_indep lens_indep_left_comp
            <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U1α_def left_uvar_def out_var_def prod_as_plus lens_comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0_alpha_lift_bool_subst"><span class="command">lemma</span></span> U0_alpha_lift_bool_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">$</span><span class="main">0-</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">$</span><span class="main">0-</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_alpha_lift_bool_subst"><span class="command">lemma</span></span> U1_alpha_lift_bool_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">$</span><span class="main">1-</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">$</span><span class="main">1-</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ</span> <span class="main">†</span> <span class="main">⌈</span><span class="free">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0_alpha_out_var"><span class="command">lemma</span></span> U0_alpha_out_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="main">$</span>x<span class="main">´</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">$</span><span class="main">0-</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_alpha_out_var"><span class="command">lemma</span></span> U1_alpha_out_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="main">$</span>x<span class="main">´</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">$</span><span class="main">1-</span>x<span class="main">´</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0_skip"><span class="command">lemma</span></span> U0_skip <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="keyword1">II</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_skip"><span class="command">lemma</span></span> U1_skip <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="keyword1">II</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0_seqr"><span class="command">lemma</span></span> U0_seqr <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_seqr"><span class="command">lemma</span></span> U1_seqr <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">P</span> <span class="main">;;</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0α_comp_in_var"><span class="command">lemma</span></span> U0α_comp_in_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> U0α <span class="main">=</span> in_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U0α_def alpha_in_var in_var_prod_lens pre_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U0α_comp_out_var"><span class="command">lemma</span></span> U0α_comp_out_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> U0α <span class="main">=</span> out_var <span class="main">(</span>left_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U0α_def alpha_out_var id_wb_lens left_uvar_def out_var_prod_lens<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1α_comp_in_var"><span class="command">lemma</span></span> U1α_comp_in_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>in_var <span class="free">x</span><span class="main">)</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> U1α <span class="main">=</span> in_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U1α_def alpha_in_var in_var_prod_lens pre_uvar_def<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1α_comp_out_var"><span class="command">lemma</span></span> U1α_comp_out_var <span class="main">[</span><span class="operator">alpha</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>out_var <span class="free">x</span><span class="main">)</span> <span class="keyword1">;<span class="hidden">⇩</span><sub>L</sub></span> U1α <span class="main">=</span> out_var <span class="main">(</span>right_uvar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U1α_def alpha_out_var id_wb_lens right_uvar_def out_var_prod_lens<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Associative Merges ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Associativity of a merge means that if we construct a three way merge from a two way merge
  and then rotate the three inputs of the merge to the left, then we get exactly the same three
  way merge back. 

  We first construct the operator that constructs the three way merge by effectively wiring up
  the two way merge in an appropriate way.
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ThreeWayMerge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> merge <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> mrg<span class="main">)</span> mrg<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> urel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>M</b>3'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ThreeWayMerge</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="main">∧</span> <span class="main">$</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="main">1-</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">;;</span> U0 <span class="main">∧</span> <span class="main">$</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="main">1-</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next definition rotates the inputs to a three way merge to the left one place. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rotate<span class="hidden">⇩</span><sub>m</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rotate<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">1-</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">1-</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">:=</span> <span class="main">(</span><span class="main">&amp;</span><span class="main">1-</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">&amp;</span><span class="main">1-</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">&amp;</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Finally, a merge is associative if rotating the inputs does not effect the output. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">AssocMerge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> merge <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">AssocMerge</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span>rotate<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b>3(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b>3(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Parallel Operators ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We implement the following useful abbreviation for separating of two parallel processes and
  copying of the before variables, all to act as input to the merge predicate. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">par_sep</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∥<span class="hidden">⇩</span><sub>s</sub></span>"</span> 85<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">∥<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following implementation of parallel by merge is less general than the book version, in
  that it does not properly partition the alphabet into two disjoint segments. We could actually
  achieve this specifying lenses into the larger alphabet, but this would complicate the definition
  of programs. May reconsider later. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">par_by_merge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">,</span> <span class="tfree">'γ</span><span class="main">)</span> mrg<span class="main">,</span> <span class="tfree">'δ</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'γ</span><span class="main">)</span> urel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'δ</span><span class="main">)</span> urel"</span></span> 
  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span> _"</span> <span class="main">[</span>85<span class="main">,</span>0<span class="main">,</span>86<span class="main">]</span> 85<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> ∥<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">∥<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_concurrency-par_by_merge_alt_def"><span class="command">lemma</span></span> par_by_merge_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⌈</span><span class="free">P</span><span class="main">⌉<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="main">⌈</span><span class="free">Q</span><span class="main">⌉<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_by_merge_def U0_as_alpha U1_as_alpha<span class="main">)</span>

<span class="keyword1" id="utp_concurrency-shEx_pbm_left"><span class="command">lemma</span></span> shEx_pbm_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-shEx_pbm_right"><span class="command">lemma</span></span> shEx_pbm_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span> <span class="main">∙</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unrestriction Laws ›</span></span>
  
<span class="keyword1" id="utp_concurrency-unrest_in_par_by_merge"><span class="command">lemma</span></span> unrest_in_par_by_merge <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">$</span>x <span class="main">♯</span> <span class="free">P</span><span class="main">;</span> <span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">♯</span> <span class="free">M</span><span class="main">;</span> <span class="main">$</span>x <span class="main">♯</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">$</span>x <span class="main">♯</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-unrest_out_par_by_merge"><span class="command">lemma</span></span> unrest_out_par_by_merge <span class="main">[</span><span class="operator">unrest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">$</span>x<span class="main">´</span> <span class="main">♯</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Substitution laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Substitution is a little tricky because when we push the expression through the composition
  operator the alphabet of the expression must also change. Consequently for now we only support
  literal substitution, though this could be generalised with suitable alphabet coercsions. We
  need quite a number of variants to support this which are below. ›</span></span>

<span class="keyword1" id="utp_concurrency-U0_seq_subst"><span class="command">lemma</span></span> U0_seq_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U0<span class="main">)</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="main">0-</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> U0<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-U1_seq_subst"><span class="command">lemma</span></span> U1_seq_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U1<span class="main">)</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="main">1-</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span> <span class="main">;;</span> U1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-lit_pbm_subst"><span class="command">lemma</span></span> lit_pbm_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">Q</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="main">«</span><span class="free">v</span><span class="main">»</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_concurrency-bool_pbm_subst"><span class="command">lemma</span></span> bool_pbm_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">Q</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">Q</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">false</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="keyword1">false</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword1">true</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="keyword1">true</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_concurrency-zero_one_pbm_subst"><span class="command">lemma</span></span> zero_one_pbm_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="main">0</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="main">0</span><span class="main">/</span><span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">Q</span><span class="main">⟦</span><span class="main">0</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">(</span><span class="bound">P</span><span class="main">⟦</span><span class="main">1</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="main">1</span><span class="main">/</span><span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">Q</span><span class="main">⟦</span><span class="main">1</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="main">0</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span><span class="main">1</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="utp_concurrency-numeral_pbm_subst"><span class="command">lemma</span></span> numeral_pbm_subst <span class="main">[</span><span class="operator">usubst</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="main">(</span><span class="bound">P</span><span class="main">⟦</span>numeral <span class="free">n</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span>numeral <span class="free">n</span><span class="main">/</span><span class="main">$</span>x<span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">Q</span><span class="main">⟦</span>numeral <span class="free">n</span><span class="main">/</span><span class="main">$</span>x<span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">Q</span> <span class="bound">M</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span><span class="main">(</span><span class="main">$</span>x<span class="main">´</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">σ</span> <span class="main">†</span> <span class="main">(</span><span class="bound">P</span> ∥<span class="hidden">⇘</span><sub><span class="bound">M</span><span class="main">⟦</span>numeral <span class="free">n</span><span class="main">/</span><span class="main">$</span>x<span class="main">´</span><span class="main">⟧</span></sub><span class="hidden">⇙</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Parallel-by-merge laws ›</span></span>

<span class="keyword1" id="utp_concurrency-par_by_merge_false"><span class="command">lemma</span></span> par_by_merge_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="keyword1">false</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-par_by_merge_left_false"><span class="command">lemma</span></span> par_by_merge_left_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">false</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-par_by_merge_right_false"><span class="command">lemma</span></span> par_by_merge_right_false <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="keyword1">false</span> <span class="main">=</span> <span class="keyword1">false</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-par_by_merge_seq_add"><span class="command">lemma</span></span> par_by_merge_seq_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span> <span class="main">;;</span> <span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_by_merge_def seqr_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A skip parallel-by-merge yields a skip whenever the parallel predicates are both feasible. ›</span></span>

<span class="keyword1" id="utp_concurrency-par_by_merge_skip"><span class="command">lemma</span></span> par_by_merge_skip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">;;</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">;;</span> <span class="keyword1">true</span> <span class="main">=</span> <span class="keyword1">true</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub>skip<span class="hidden">⇩</span><sub>m</sub></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-skip_merge_swap"><span class="command">lemma</span></span> skip_merge_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"swap<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> skip<span class="hidden">⇩</span><sub>m</sub> <span class="main">=</span> skip<span class="hidden">⇩</span><sub>m</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-par_sep_swap"><span class="command">lemma</span></span> par_sep_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">∥<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">Q</span> <span class="main">;;</span> swap<span class="hidden">⇩</span><sub>m</sub> <span class="main">=</span> <span class="free">Q</span> <span class="keyword1">∥<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
        
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Parallel-by-merge commutes when the merge predicate is unchanged by swap ›</span></span>

<span class="keyword1" id="utp_concurrency-par_by_merge_commute_swap"><span class="command">lemma</span></span> par_by_merge_commute_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span> ∥<span class="hidden">⇘</span><sub>swap<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> <span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> ∥<span class="hidden">⇘</span><sub>swap<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> <span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> swap<span class="hidden">⇩</span><sub>m</sub><span class="main">)</span> <span class="main">;;</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_by_merge_def seqr_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> U0 <span class="main">;;</span> swap<span class="hidden">⇩</span><sub>m</sub><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U1 <span class="main">;;</span> swap<span class="hidden">⇩</span><sub>m</sub><span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U0_swap U1_swap<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_by_merge_def utp_pred_laws.inf.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="keyword1">is</span> SymMerge"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Healthy_if assms par_by_merge_commute_swap<span class="main">)</span>
    
<span class="keyword1" id="utp_concurrency-par_by_merge_mono_1"><span class="command">lemma</span></span> par_by_merge_mono_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-par_by_merge_mono_2"><span class="command">lemma</span></span> par_by_merge_mono_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-par_by_merge_mono"><span class="command">lemma</span></span> par_by_merge_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">P<span class="hidden">⇩</span><sub>2</sub></span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dual_order.trans par_by_merge_mono_1 par_by_merge_mono_2<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_assoc<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="keyword1">is</span> SymMerge"</span></span> <span class="quoted"><span class="quoted">"AssocMerge <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span> <span class="main">=</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">Q</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> U0 <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">R</span> <span class="main">;;</span> U1 <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b>3(</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> U0 <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">R</span> <span class="main">;;</span> U1 <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> rotate<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b>3(</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AssocMerge_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> U0<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">R</span> <span class="main">;;</span> U0 <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> U1 <span class="main">;;</span> U1<span class="main">)</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">)</span> <span class="main">;;</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b>3(</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">Q</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> par_by_merge_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
        
<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_choice_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_choice_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_or_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span> <span class="main">∨</span> <span class="free">Q</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_or_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">∨</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_USUP_mem_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_USUP_ind_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_USUP_mem_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main">∈</span><span class="free">I</span> <span class="main">∙</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> par_by_merge_USUP_ind_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∙</span> <span class="free">P</span> ∥<span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
   
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Example: Simple State-Space Division ›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following merge predicate divides the state space using a pair of independent lenses. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">StateMerge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> merge"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">M[</span>_<span class="keyword1">|</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>σ</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">M[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="keyword1"><span class="free">]<span class="hidden">⇩</span><sub>σ</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main"><span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⊕</span> <span class="main">$</span><span class="main">0-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="keyword1">on</span> <span class="main">&amp;</span>a<span class="main">)</span> <span class="main">⊕</span> <span class="main">$</span><span class="main">1-</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="keyword1">on</span> <span class="main">&amp;</span>b<span class="main">)</span>"</span></span>

<span class="keyword1" id="utp_concurrency-swap_StateMerge"><span class="command">lemma</span></span> swap_StateMerge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span>swap<span class="hidden">⇩</span><sub>m</sub> <span class="main">;;</span> <span class="keyword1">M[</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">]<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">M[</span><span class="free">b</span><span class="main">|</span><span class="free">a</span><span class="keyword1">]<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_comm<span class="main">)</span>
   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">StateParallel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⟹</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> hrel <span class="main">⇒</span> <span class="tfree">'α</span> hrel"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">|</span>_<span class="keyword1">|</span>_<span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> _"</span> <span class="main">[</span>85<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>86<span class="main">]</span> 86<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="keyword1"><span class="free">|<span class="hidden">⇩</span><sub>σ</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> ∥<span class="hidden">⇘</span><sub><span class="keyword1">M[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">|</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="keyword1">]<span class="hidden">⇩</span><sub>σ</sub></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>
    
<span class="keyword1" id="utp_concurrency-StateParallel_commute"><span class="command">lemma</span></span> StateParallel_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span> <span class="main">|</span><span class="free">b</span><span class="main">|</span><span class="free">a</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> par_by_merge_commute_swap swap_StateMerge<span class="main">)</span>
        
<span class="keyword1" id="utp_concurrency-StateParallel_form"><span class="command">lemma</span></span> StateParallel_form<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="main">(</span><span class="bound">st<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="bound">st<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∙</span> <span class="free">P</span><span class="main">⟦</span><span class="main">«</span><span class="bound">st<span class="hidden">⇩</span><sub>0</sub></span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">⟦</span><span class="main">«</span><span class="bound">st<span class="hidden">⇩</span><sub>1</sub></span><span class="main">»</span><span class="main">/</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span><span class="main">⟧</span> <span class="main">∧</span> <span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">(</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span> <span class="main">⊕</span> <span class="main">«</span><span class="bound">st<span class="hidden">⇩</span><sub>0</sub></span><span class="main">»</span> <span class="keyword1">on</span> <span class="main">&amp;</span>a<span class="main">)</span> <span class="main">⊕</span> <span class="main">«</span><span class="bound">st<span class="hidden">⇩</span><sub>1</sub></span><span class="main">»</span> <span class="keyword1">on</span> <span class="main">&amp;</span>b<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_concurrency-StateParallel_form'"><span class="command">lemma</span></span> StateParallel_form'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span> <span class="main">=</span> <span class="main">{</span><span class="main">&amp;</span>a<span class="main">,</span><span class="main">&amp;</span>b<span class="main">}</span><span class="main">:[</span><span class="main">(</span><span class="free">P</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">{</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span>a<span class="main">´</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">↾<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">{</span><span class="main">$</span><span class="keyword1"><span class="hidden">❙</span><b>v</b></span><span class="main">,</span><span class="main">$</span>b<span class="main">´</span><span class="main">}</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> StateParallel_form<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens_axioms_def wb_lens_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> vwb_lens_wb wb_lens.get_put<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lens_indep_comm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> lens_indep_comm vwb_lens_wb wb_lens_def weak_lens.put_get<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can frame all the variables that the parallel operator refers to ›</span></span>
    
<span class="keyword1" id="utp_concurrency-StateParallel_frame"><span class="command">lemma</span></span> StateParallel_frame<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">&amp;</span>a<span class="main">,</span><span class="main">&amp;</span>b<span class="main">}</span><span class="main">:[</span><span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span><span class="main">]</span> <span class="main">=</span> <span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> StateParallel_form<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lens_indep_comm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Parallel Hoare logic rule. This employs something similar to separating conjunction in
  the postcondition, but we explicitly require that the two conjuncts only refer to variables
  on the left and right of the parallel composition explicitly. ›</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> StateParallel_hoare <span class="main">[</span><span class="operator">hoare</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c</span><span class="main">⦄</span><span class="free">P</span><span class="main">⦃</span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c</span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"b <span class="main">♮</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c</span><span class="main">⦄</span><span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span><span class="main">⦃</span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹ Parallelise the specification ›</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">(</span><span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊑</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> StateParallel_form<span class="main"><span class="keyword3">,</span></span> <span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> lens_indep_comm<span class="main">)</span>
  <span class="comment1">― ‹ Prove Hoare rule by monotonicity of parallelism ›</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊑</span> <span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> par_by_merge_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> hoare_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⌈</span><span class="free">c</span><span class="main">⌉<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="main">⇒</span> <span class="main">⌈</span><span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌉<span class="hidden">⇩</span><sub>&gt;</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> hoare_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hoare_r_def <span class="keyword1"><span class="command">using</span></span> 1 2 order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Specialised version of the above law where an invariant expression referring to variables
  outside the frame is preserved. ›</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> StateParallel_frame_hoare <span class="main">[</span><span class="operator">hoare</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"vwb_lens <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⨝</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♮</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"b <span class="main">♮</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"a <span class="main">♯</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"b <span class="main">♯</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦄</span><span class="free">P</span><span class="main">⦃</span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦄</span><span class="free">Q</span><span class="main">⦃</span><span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦄</span><span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span><span class="main">⦃</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⦄</span><span class="main">{</span><span class="main">&amp;</span>a<span class="main">,</span><span class="main">&amp;</span>b<span class="main">}</span><span class="main">:[</span><span class="free">P</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="keyword1">|<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">Q</span><span class="main">]</span><span class="main">⦃</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> frame_hoare_r' StateParallel_hoare <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms <span class="dynamic"><span class="dynamic">unrest</span></span> plus_vwb_lens<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> StateParallel_frame assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp">
<div class="head">
<h1>Theory utp</h1>
</div>
<pre class="source"><span class="comment1">(******************************************************************************)</span>
<span class="comment1">(* Project: The Isabelle/UTP Proof System                                     *)</span>
<span class="comment1">(* File: utp.thy                                                              *)</span>
<span class="comment1">(* Authors: Simon Foster and Frank Zeyda (University of York, UK)             *)</span>
<span class="comment1">(* Emails: simon.foster@york.ac.uk and frank.zeyda@york.ac.uk                 *)</span>
<span class="comment1">(******************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Meta-theory for the Standard Core ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="utp_var.html">utp_var</a>
  <a href="utp_expr.html">utp_expr</a>
  <a href="utp_expr_insts.html">utp_expr_insts</a>
  <a href="utp_expr_funcs.html">utp_expr_funcs</a>
  <a href="utp_unrest.html">utp_unrest</a>
  <a href="utp_usedby.html">utp_usedby</a>
  <a href="utp_subst.html">utp_subst</a>
  <a href="utp_meta_subst.html">utp_meta_subst</a>
  <a href="utp_alphabet.html">utp_alphabet</a>
  <a href="utp_lift.html">utp_lift</a>
  <a href="utp_pred.html">utp_pred</a>
  <a href="utp_pred_laws.html">utp_pred_laws</a>
  <a href="utp_recursion.html">utp_recursion</a>
  <a href="utp_dynlog.html">utp_dynlog</a>
  <a href="utp_rel.html">utp_rel</a>
  <a href="utp_rel_laws.html">utp_rel_laws</a>
  <a href="utp_sequent.html">utp_sequent</a>
  <a href="utp_state_parser.html">utp_state_parser</a>
  <a href="utp_sym_eval.html">utp_sym_eval</a>
  <a href="utp_tactics.html">utp_tactics</a>
  <a href="utp_hoare.html">utp_hoare</a>
  <a href="utp_wp.html">utp_wp</a>
  <a href="utp_sp.html">utp_sp</a>
  <a href="utp_theory.html">utp_theory</a>
  <a href="utp_concurrency.html">utp_concurrency</a>
  <a href="utp_rel_opsem.html">utp_rel_opsem</a>
<span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_expr_ovld">
<div class="head">
<h1>Theory utp_expr_ovld</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Overloaded Expression Constructs ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_expr_ovld
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp.html">utp</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Overloadable Constants ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ For convenience, we often want to utilise the same expression syntax for multiple constructs.
  This can be achieved using ad-hoc overloading. We create a number of polymorphic constants and then
  overload their definitions using appropriate implementations. In order for this to work,
  each collection must have its own unique type. Thus we do not use the HOL map type directly,
  but rather our own partial function type, for example. ›</span></span>
  
<span class="keyword1"><span class="command">consts</span></span>
  <span class="comment1">― ‹ Empty elements, for example empty set, nil list, 0... ›</span> 
  uempty     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span>"</span></span>
  <span class="comment1">― ‹ Function application, map application, list application... ›</span>
  uapply     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="comment1">― ‹ Function update, map update, list update... ›</span>
  uupd       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'f</span>"</span></span>
  <span class="comment1">― ‹ Domain of maps, lists... ›</span>
  udom       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="comment1">― ‹ Range of maps, lists... ›</span>
  uran       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="comment1">― ‹ Domain restriction ›</span>
  udomres    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'f</span>"</span></span>
  <span class="comment1">― ‹ Range restriction ›</span>
  uranres    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'f</span>"</span></span>
  <span class="comment1">― ‹ Collection cardinality ›</span>
  ucard      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> nat"</span></span>
  <span class="comment1">― ‹ Collection summation ›</span>
  usums      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="comment1">― ‹ Construct a collection from a list of entries ›</span>
  uentries   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'k</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'k</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'f</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We need a function corresponding to function application in order to overload. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_apply</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fun_apply</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> fun_apply_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ffun_entries</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'k</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'k</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> ffun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ffun_entries</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> graph_ffun <span class="main">{</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We then set up the overloading for a number of useful constructs for various collections. ›</span></span>
  
<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  uempty <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  uapply <span class="quoted">fun_apply</span> <span class="keyword2"><span class="keyword">and</span></span> uapply <span class="quoted">nth</span> <span class="keyword2"><span class="keyword">and</span></span> uapply <span class="quoted">pfun_app</span> <span class="keyword2"><span class="keyword">and</span></span>
  uapply <span class="quoted">ffun_app</span> <span class="keyword2"><span class="keyword">and</span></span>
  uupd <span class="quoted">pfun_upd</span> <span class="keyword2"><span class="keyword">and</span></span> uupd <span class="quoted">ffun_upd</span> <span class="keyword2"><span class="keyword">and</span></span> uupd <span class="quoted">list_augment</span> <span class="keyword2"><span class="keyword">and</span></span>
  udom <span class="quoted">Domain</span> <span class="keyword2"><span class="keyword">and</span></span> udom <span class="quoted">pdom</span> <span class="keyword2"><span class="keyword">and</span></span> udom <span class="quoted">fdom</span> <span class="keyword2"><span class="keyword">and</span></span> udom <span class="quoted">seq_dom</span> <span class="keyword2"><span class="keyword">and</span></span>
  udom <span class="quoted">Range</span> <span class="keyword2"><span class="keyword">and</span></span> uran <span class="quoted">pran</span> <span class="keyword2"><span class="keyword">and</span></span> uran <span class="quoted">fran</span> <span class="keyword2"><span class="keyword">and</span></span> uran <span class="quoted">set</span> <span class="keyword2"><span class="keyword">and</span></span>
  udomres <span class="quoted">pdom_res</span> <span class="keyword2"><span class="keyword">and</span></span> udomres <span class="quoted">fdom_res</span> <span class="keyword2"><span class="keyword">and</span></span>
  uranres <span class="quoted">pran_res</span> <span class="keyword2"><span class="keyword">and</span></span> udomres <span class="quoted">fran_res</span> <span class="keyword2"><span class="keyword">and</span></span>
  ucard <span class="quoted">card</span> <span class="keyword2"><span class="keyword">and</span></span> ucard <span class="quoted">pcard</span> <span class="keyword2"><span class="keyword">and</span></span> ucard <span class="quoted">length</span> <span class="keyword2"><span class="keyword">and</span></span>
  usums <span class="quoted">list_sum</span> <span class="keyword2"><span class="keyword">and</span></span> usums <span class="quoted">Sum</span> <span class="keyword2"><span class="keyword">and</span></span> usums <span class="quoted">pfun_sum</span> <span class="keyword2"><span class="keyword">and</span></span>
  uentries <span class="quoted">pfun_entries</span> <span class="keyword2"><span class="keyword">and</span></span> uentries <span class="quoted">ffun_entries</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Syntax Translations ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_uundef"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_umap_empty"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[]<span class="hidden">⇩</span><sub>u</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_uapply"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr <span class="main">⇒</span> utuple_args <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>a</sub></span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_umaplet"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>logic<span class="main">,</span> logic<span class="main">]</span> <span class="main">=&gt;</span> umaplet"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">↦</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">""</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"umaplet <span class="main">=&gt;</span> umaplets"</span></span>             <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_UMaplets"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>umaplet<span class="main">,</span> umaplets<span class="main">]</span> <span class="main">=&gt;</span> umaplets"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_UMapUpd"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>logic<span class="main">,</span> umaplets<span class="main">]</span> <span class="main">=&gt;</span> logic"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/</span><span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">[</span>900<span class="main">,</span>0<span class="main">]</span> 900<span class="main">)</span>
  <span class="quoted">"_UMap"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"umaplets <span class="main">=&gt;</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">]<span class="hidden">⇩</span><sub>u</sub></span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_ucard"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_udom"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">dom<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_uran"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ran<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_usum"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_udom_res"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊲<span class="hidden">⇩</span><sub>u</sub></span>"</span> 85<span class="main">)</span>
  <span class="quoted">"_uran_res"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊳<span class="hidden">⇩</span><sub>u</sub></span>"</span> 85<span class="main">)</span>
  <span class="quoted">"_uentries"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">entr<span class="hidden">⇩</span><sub>u</sub>'(</span>_<span class="keyword1">,</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="comment1">― ‹ Pretty printing for adhoc-overloaded constructs ›</span>
  <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span>    <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uapply <span class="free">f</span> <span class="free">x</span>"</span>
  <span class="quoted">"<span class="keyword1">dom<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">f</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> udom <span class="free">f</span>"</span>
  <span class="quoted">"<span class="keyword1">ran<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">f</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uran <span class="free">f</span>"</span>  
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">⊲<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">f</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> udomres <span class="free">A</span> <span class="free">f</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊳<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uranres <span class="free">f</span> <span class="free">A</span>"</span>
  <span class="quoted">"<span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">f</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> ucard <span class="free">f</span>"</span>
  <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">k</span> <span class="main">↦</span> <span class="free">v</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uupd <span class="free">f</span> <span class="free">k</span> <span class="free">v</span>"</span>
  <span class="quoted">"<span class="main">0</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> uempty"</span> <span class="comment1">― ‹ We have to do this so we don't see uempty. Is there a better way of printing? ›</span>

  <span class="comment1">― ‹ Overloaded construct translations ›</span>
  <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">,</span><span class="free">u</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> uapply <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">,</span><span class="free">u</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span>
  <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> uapply <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span>
  <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> uapply <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span>  
  <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> uapply <span class="free">f</span> <span class="free">x</span>"</span>
  <span class="quoted">"<span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">xs</span><span class="main">)</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> ucard <span class="free">xs</span>"</span>
  <span class="quoted">"<span class="keyword1">sum<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">A</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> usums <span class="free">A</span>"</span>
  <span class="quoted">"<span class="keyword1">dom<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">f</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> udom <span class="free">f</span>"</span>
  <span class="quoted">"<span class="keyword1">ran<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">f</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="keyword1">CONST</span> uran <span class="free">f</span>"</span>
  <span class="quoted">"<span class="keyword1">[]<span class="hidden">⇩</span><sub>u</sub></span>"</span>     <span class="main">=&gt;</span> <span class="quoted">"<span class="main">«</span><span class="keyword1">CONST</span> uempty<span class="main">»</span>"</span>
  <span class="quoted">"<span class="keyword1">⊥<span class="hidden">⇩</span><sub>u</sub></span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="main">«</span><span class="keyword1">CONST</span> undefined<span class="main">»</span>"</span>
  <span class="quoted">"<span class="free">A</span> <span class="keyword1">⊲<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">f</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> udomres<span class="main">)</span> <span class="free">A</span> <span class="free">f</span>"</span>
  <span class="quoted">"<span class="free">f</span> <span class="keyword1">⊳<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> uranres<span class="main">)</span> <span class="free">f</span> <span class="free">A</span>"</span>
  <span class="quoted">"<span class="keyword1">entr<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">d</span><span class="main">,</span><span class="free">f</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> uentries <span class="free">d</span> <span class="main">«</span><span class="free">f</span><span class="main">»</span>"</span>
  <span class="quoted">"_UMapUpd <span class="free">m</span> <span class="main">(</span>_UMaplets <span class="free">xy</span> <span class="free">ms</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"_UMapUpd <span class="main">(</span>_UMapUpd <span class="free">m</span> <span class="free">xy</span><span class="main">)</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_UMapUpd <span class="free">m</span> <span class="main">(</span>_umaplet  <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> trop <span class="keyword1">CONST</span> uupd <span class="free">m</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"_UMap <span class="free">ms</span>"</span>                      <span class="main">==</span> <span class="quoted">"_UMapUpd <span class="keyword1">[]<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">ms</span>"</span>
  <span class="quoted">"_UMap <span class="main">(</span>_UMaplets <span class="free">ms1</span> <span class="free">ms2</span><span class="main">)</span>"</span>     <span class="main">&lt;=</span> <span class="quoted">"_UMapUpd <span class="main">(</span>_UMap <span class="free">ms1</span><span class="main">)</span> <span class="free">ms2</span>"</span>
  <span class="quoted">"_UMaplets <span class="free">ms1</span> <span class="main">(</span>_UMaplets <span class="free">ms2</span> <span class="free">ms3</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_UMaplets <span class="main">(</span>_UMaplets <span class="free">ms1</span> <span class="free">ms2</span><span class="main">)</span> <span class="free">ms3</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Simplifications ›</span></span>

<span class="keyword1" id="utp_expr_ovld-ufun_apply_lit"><span class="command">lemma</span></span> ufun_apply_lit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">f</span><span class="main">»</span><span class="main">(</span><span class="main">«</span><span class="free">x</span><span class="main">»</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="main">«</span><span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_ovld-lit_plus_appl"><span class="command">lemma</span></span> lit_plus_appl <span class="main">[</span><span class="operator">lit_norm</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="main">(+)</span><span class="main">»</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_ovld-lit_minus_appl"><span class="command">lemma</span></span> lit_minus_appl <span class="main">[</span><span class="operator">lit_norm</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="main">(-)</span><span class="main">»</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_ovld-lit_mult_appl"><span class="command">lemma</span></span> lit_mult_appl <span class="main">[</span><span class="operator">lit_norm</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span>times<span class="main">»</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="utp_expr_ovld-lit_divide_apply"><span class="command">lemma</span></span> lit_divide_apply <span class="main">[</span><span class="operator">lit_norm</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="main">(/)</span><span class="main">»</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span><span class="main">(</span><span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">/</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">uexpr_defs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_ovld-pfun_entries_apply"><span class="command">lemma</span></span> pfun_entries_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">entr<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">d</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> pfun<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr<span class="main">)</span><span class="main">(</span><span class="free">i</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">«</span><span class="free">f</span><span class="main">»</span><span class="main">(</span><span class="free">i</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span><span class="main">)</span> <span class="main">◃</span> <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">d</span> <span class="main">▹</span> <span class="keyword1">⊥<span class="hidden">⇩</span><sub>u</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pred_auto</span><span class="main">)</span>
    
<span class="keyword1" id="utp_expr_ovld-udom_uupdate_pfun"><span class="command">lemma</span></span> udom_uupdate_pfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> pfun<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">dom<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">m</span><span class="main">(</span><span class="free">k</span> <span class="main">↦</span> <span class="free">v</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">k</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">∪<span class="hidden">⇩</span><sub>u</sub></span> <span class="keyword1">dom<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_expr_ovld-uapply_uupdate_pfun"><span class="command">lemma</span></span> uapply_uupdate_pfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> pfun<span class="main">,</span> <span class="tfree">'α</span><span class="main">)</span> uexpr"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">(</span><span class="free">k</span> <span class="main">↦</span> <span class="free">v</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span><span class="main">)</span><span class="main">(</span><span class="free">i</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">v</span> <span class="main">◃</span> <span class="free">i</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">k</span> <span class="main">▹</span> <span class="free">m</span><span class="main">(</span><span class="free">i</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Indexed Assignment ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="comment1">― ‹ Indexed assignment ›</span>
  <span class="quoted">"_assignment_upd"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">[</span>_<span class="keyword1">]</span> <span class="keyword1">:=</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>63<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 62<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="comment1">― ‹ Indexed assignment uses the overloaded collection update function \emph{uupd}. ›</span>
  <span class="quoted">"_assignment_upd <span class="free">x</span> <span class="free">k</span> <span class="free">v</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"x <span class="main">:=</span> <span class="main">&amp;</span>x<span class="main">(</span><span class="free">k</span> <span class="main">↦</span> <span class="free">v</span><span class="keyword1">)<span class="hidden">⇩</span><sub>u</sub></span>"</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_full">
<div class="head">
<h1>Theory utp_full</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Meta-theory for the Standard Core with Overloaded Constructs ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_full
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp.html">utp</a> <a href="utp_expr_ovld.html">utp_expr_ovld</a>
<span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_easy_parser">
<div class="head">
<h1>Theory utp_easy_parser</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ UTP Easy Expression Parser ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_easy_parser
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="utp_full.html">utp_full</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Replacing the Expression Grammar ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following theory provides an easy to use expression parser that is primarily targetted
  towards expressing programs. Unlike the built-in UTP expression syntax, this uses a closed grammar
  separate to the HOL \emph{logic} nonterminal, that gives more freedom in what can be expressed.
  In particular, identifiers are interpreted as UTP variables rather than HOL variables and functions
  do not require subscripts and other strange decorations. 

  The first step is to remove the from the UTP parse the following grammar rule that uses arbitrary
  HOL logic to represent expressions. Instead, we will populate the \emph{uexp} grammar manually.
›</span></span>

<span class="keyword1"><span class="command">purge_syntax</span></span>
  <span class="quoted">"_uexp_l"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_"</span> <span class="main">[</span>64<span class="main">]</span> 64<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Expression Operators ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ue_quote"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>e</sub></span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_tuple"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexprs <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_lit"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">«</span>_<span class="keyword1">»</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_var"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"svid <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_ue_eq"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">=</span>"</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_uop"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"id   <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_ue_bop"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"id   <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_ue_trop"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"id   <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">'(</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_ue_apply"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_ue_quote <span class="free">e</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">e</span>"</span>
  <span class="quoted">"_ue_tuple <span class="main">(</span>_uexprs <span class="free">x</span> <span class="main">(</span>_uexprs <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"_ue_tuple <span class="main">(</span>_uexprs <span class="free">x</span> <span class="main">(</span>_ue_tuple <span class="main">(</span>_uexprs <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"_ue_tuple <span class="main">(</span>_uexprs <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="keyword1">CONST</span> Pair <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_tuple <span class="free">x</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span>"</span>
  <span class="quoted">"_ue_lit <span class="free">x</span>"</span>    <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> lit <span class="free">x</span>"</span>
  <span class="quoted">"_ue_var <span class="free">x</span>"</span>    <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> utp_expr.var <span class="main">(</span><span class="keyword1">CONST</span> pr_var <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_ue_eq <span class="free">x</span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_uop <span class="free">f</span> <span class="free">x</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> uop <span class="free">f</span> <span class="free">x</span>"</span>
  <span class="quoted">"_ue_bop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_trop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> trop <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_apply <span class="free">f</span> <span class="free">x</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="keyword1">)<span class="hidden">⇩</span><sub>a</sub></span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Predicate Operators ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ue_true"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">true</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_false"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">false</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_not"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">¬</span> _"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span>
  <span class="quoted">"_ue_conj"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧</span>"</span> 135<span class="main">)</span>
  <span class="quoted">"_ue_disj"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨</span>"</span> 130<span class="main">)</span>
  <span class="quoted">"_ue_impl"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⇒</span>"</span> 125<span class="main">)</span>
  <span class="quoted">"_ue_iff"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⇒</span>"</span> 125<span class="main">)</span>
  <span class="quoted">"_ue_mem"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∈</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>151<span class="main">,</span> 151<span class="main">]</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_nmem"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∉</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>151<span class="main">,</span> 151<span class="main">]</span> 150<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_ue_true"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> true_upred"</span>
  <span class="quoted">"_ue_false"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> false_upred"</span>
  <span class="quoted">"_ue_not <span class="free">p</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> not_upred <span class="free">p</span>"</span>
  <span class="quoted">"_ue_conj <span class="free">p</span> <span class="free">q</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">p</span> <span class="keyword1">∧<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span>"</span>
  <span class="quoted">"_ue_disj <span class="free">p</span> <span class="free">q</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">p</span> <span class="keyword1">∨<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span>"</span>
  <span class="quoted">"_ue_impl <span class="free">p</span> <span class="free">q</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">p</span> <span class="main">⇒</span> <span class="free">q</span>"</span>
  <span class="quoted">"_ue_iff <span class="free">p</span> <span class="free">q</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="free">p</span> <span class="main">⇔</span> <span class="free">q</span>"</span>
  <span class="quoted">"_ue_mem <span class="free">x</span> <span class="free">A</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span>
  <span class="quoted">"_ue_nmem <span class="free">x</span> <span class="free">A</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">∉<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">A</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Arithmetic Operators ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ue_num"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"num_const <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_ue_size"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">#</span>_"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_ue_eq"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">=</span>"</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_le"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≤</span>"</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_lt"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;</span>"</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_ge"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≥</span>"</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_gt"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&gt;</span>"</span> 150<span class="main">)</span>
  <span class="quoted">"_ue_zero"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_one"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">1</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_plus"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 165<span class="main">)</span>
  <span class="quoted">"_ue_uminus"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>181<span class="main">]</span> 180<span class="main">)</span>
  <span class="quoted">"_ue_minus"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">-</span>"</span> 165<span class="main">)</span>
  <span class="quoted">"_ue_times"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*</span>"</span> 170<span class="main">)</span>
  <span class="quoted">"_ue_div"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">div</span>"</span> 170<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_ue_num <span class="free">x</span>"</span>    <span class="main">=&gt;</span> <span class="quoted">"_Numeral <span class="free">x</span>"</span>
  <span class="quoted">"_ue_size <span class="free">e</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">#<span class="hidden">⇩</span><sub>u</sub>(</span><span class="free">e</span><span class="main">)</span>"</span>
  <span class="quoted">"_ue_le <span class="free">x</span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_lt <span class="free">x</span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_ge <span class="free">x</span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">≥<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_gt <span class="free">x</span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="keyword1">&gt;<span class="hidden">⇩</span><sub>u</sub></span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_zero"</span>     <span class="main">=&gt;</span> <span class="quoted">"<span class="main">0</span>"</span> 
  <span class="quoted">"_ue_one"</span>      <span class="main">=&gt;</span> <span class="quoted">"<span class="main">1</span>"</span>
  <span class="quoted">"_ue_plus <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_uminus <span class="free">x</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">-</span> <span class="free">x</span>"</span>
  <span class="quoted">"_ue_minus <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_times <span class="free">x</span> <span class="free">y</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span>
  <span class="quoted">"_ue_div <span class="free">x</span> <span class="free">y</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> divide <span class="free">x</span> <span class="free">y</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sets ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ue_empset"</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{}</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_setprod"</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">×</span>"</span> 80<span class="main">)</span>
  <span class="quoted">"_ue_atLeastAtMost"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_<span class="keyword1">..</span>_<span class="keyword1">}</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_atLeastLessThan"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{</span>_<span class="keyword1">..&lt;</span>_<span class="keyword1">}</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_ue_empset"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">{}<span class="hidden">⇩</span><sub>u</sub></span>"</span>
  <span class="quoted">"_ue_setprod <span class="free">e</span> <span class="free">f</span>"</span> <span class="main">=&gt;</span>  <span class="quoted">"<span class="keyword1">CONST</span> bop <span class="main">(</span><span class="keyword1">CONST</span> Product_Type.Times<span class="main">)</span> <span class="free">e</span> <span class="free">f</span>"</span>
  <span class="quoted">"_ue_atLeastAtMost <span class="free">m</span> <span class="free">n</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span>
  <span class="quoted">"_ue_atLeastLessThan <span class="free">m</span> <span class="free">n</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="keyword1">}<span class="hidden">⇩</span><sub>u</sub></span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Imperative Program Syntax ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ue_if_then"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_hoare"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"uexp <span class="main">⇒</span> logic <span class="main">⇒</span> uexp <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">{{</span>_<span class="keyword1">}}</span> <span class="keyword3">/ </span>_ <span class="keyword3">/ </span><span class="keyword1">{{</span>_<span class="keyword1">}}</span>"</span><span class="main">)</span>
  <span class="quoted">"_ue_wp"</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> uexp <span class="main">⇒</span> uexp"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">wp</span>"</span> 60<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_ue_if_then <span class="free">b</span> <span class="free">P</span> <span class="free">Q</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span>"</span>
  <span class="quoted">"_ue_hoare <span class="free">b</span> <span class="free">P</span> <span class="free">c</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">⦃</span><span class="free">b</span><span class="main">⦄</span><span class="free">P</span><span class="main">⦃</span><span class="free">c</span><span class="keyword1">⦄<span class="hidden">⇩</span><sub>u</sub></span>"</span>
  <span class="quoted">"_ue_wp <span class="free">P</span> <span class="free">b</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="free">P</span> <span class="keyword1">wp</span> b"</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="sum_list">
<div class="head">
<h1>Theory sum_list</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Example: Summing a List ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> sum_list
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="utp_easy_parser.html">../utp_easy_parser</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This theory exemplifies the use of the Isabelle/UTP Hoare logic verification component. 
  We first create a state space with the variables the program needs. ›</span></span>

<span class="keyword1"><span class="command">alphabet</span></span> st_sum_list <span class="main">=</span> 
  i   <span class="main">::</span> <span class="quoted">nat</span>
  xs  <span class="main">::</span> <span class="quoted"><span class="quoted">"int list"</span></span>
  ans <span class="main">::</span> <span class="quoted">int</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Next, we define the program as by a homogeneous relation over the state-space type. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Sum_List</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"st_sum_list hrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Sum_List</span> <span class="main">≡</span>
  i <span class="main">:=</span> <span class="main">0</span> <span class="main">;;</span>
  ans <span class="main">:=</span> <span class="main">0</span> <span class="main">;;</span>
  <span class="keyword1">while</span> <span class="main">(</span>i <span class="main">&lt;</span> <span class="main">#</span>xs<span class="main">)</span> <span class="keyword1">invr</span> <span class="main">(</span>ans <span class="main">=</span> list_sum<span class="main">(</span>take<span class="main">(</span>i<span class="main">,</span> xs<span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1">do</span>
    ans <span class="main">:=</span> ans <span class="main">+</span> xs<span class="main">[</span>i<span class="main">]</span> <span class="main">;;</span>
    i <span class="main">:=</span> i <span class="main">+</span> <span class="main">1</span>
  <span class="keyword1">od</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Next, we symbolically evaluate some examples. ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TRY(</span><span class="main">[</span><span class="main">&amp;</span>xs <span class="keyword1">↦<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">«</span><span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">»</span><span class="main">]</span> <span class="main">⊨</span> Sum_List<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">sym_eval</span><span class="main">)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Finally, we verify the program. ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Sum_List_sums<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{{</span>xs <span class="main">=</span> <span class="main">«</span><span class="free">XS</span><span class="main">»</span><span class="main">}}</span> Sum_List <span class="main">{{</span>ans <span class="main">=</span> list_sum<span class="main">(</span>xs<span class="main">)</span><span class="main">}}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">hoare_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add.foldr_snoc take_Suc_conv_app_nth<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="utp_simple_time">
<div class="head">
<h1>Theory utp_simple_time</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Simple UTP real-time theory ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> utp_simple_time <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="utp.html">../utp</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In this section we give a small example UTP theory, and show how Isabelle/UTP can be
  used to automate production of programming laws. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Observation Space and Signature ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We first declare the observation space for our theory of timed relations. It consists
  of two variables, to denote time and the program state, respectively. ›</span></span>

<span class="keyword1"><span class="command">alphabet</span></span> <span class="tfree">'s</span> st_time <span class="main">=</span> 
  clock <span class="main">::</span> <span class="quoted">nat</span>  st <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A timed relation is a homogeneous relation over the declared observation space. ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'s</span> time_rel <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> st_time hrel"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We introduce the following operator for adding an $n$-unit delay to a timed relation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Wait</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'s</span> time_rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Wait</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>clock<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>clock <span class="main">+</span> <span class="main">«</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">»</span> <span class="main">∧</span> <span class="main">$</span>st<span class="main">´</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>st<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ UTP Theory ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define a single healthiness condition which ensures that the clock monotonically
  advances, and so forbids reverse time travel. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> time_rel <span class="main">⇒</span> <span class="tfree">'s</span> time_rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">upred_defs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">HT</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">$</span>clock <span class="keyword1">≤<span class="hidden">⇩</span><sub>u</sub></span> <span class="main">$</span>clock<span class="main">´</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This healthiness condition is idempotent, monotonic, and also continuous, meaning it
  distributes through arbitary non-empty infima. ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> HT_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"HT<span class="main">(</span>HT<span class="main">(</span><span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> HT<span class="main">(</span><span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> HT_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> HT<span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> HT<span class="main">(</span><span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">theorem</span></span> HT_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"Continuous HT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rel_auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We now create the UTP theory object for timed relations. This is done using a local 
  interpretation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"utp_theory_continuous HT"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This raises the proof obligations
  that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">HT</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is both idempotent and continuous, which we have proved already. 
  The result of this command is a collection of theorems that can be derived from these 
  facts. Notably, we obtain a complete lattice of timed relations via the Knaster-Tarski theorem. 
  We also apply some locale rewrites so that the theorems that are exports have a more intuitive 
  form. ›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> time_theory<span class="main">:</span> utp_theory_continuous <span class="quoted">HT</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> carrier time_theory.thy_order <span class="main">⟷</span> <span class="free">P</span> <span class="keyword1">is</span> HT"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"carrier time_theory.thy_order <span class="main">→</span> carrier time_theory.thy_order <span class="main">≡</span> <span class="main">⟦</span>HT<span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">→</span> <span class="main">⟦</span>HT<span class="keyword1">⟧<span class="hidden">⇩</span><sub>H</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"le time_theory.thy_order <span class="main">=</span> <span class="main">(⊑)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq time_theory.thy_order <span class="main">=</span> <span class="main">(=)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"utp_theory_continuous HT"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> HT <span class="main">(</span>HT <span class="bound">P</span><span class="main">)</span> <span class="main">=</span> HT <span class="bound">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HT_idem<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Continuous HT"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HT_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The object \textit{time-theory} is a new namespace that contains both definitions and theorems.
  Since the theory forms a complete lattice, we obtain a top element, bottom element, and a
  least fixed-point constructor. We give all of these some intuitive syntax. ›</span></span>

<span class="keyword1"><span class="command">notation</span></span> time_theory.utp_top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤<span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> time_theory.utp_bottom <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥<span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> time_theory.utp_lfp <span class="main">(</span><span class="quoted">"<span class="keyword1">μ<span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Below is a selection of theorems that have been exported by the locale interpretation. ›</span></span>

<span class="keyword1"><span class="command">thm</span></span> time_theory.bottom_healthy
<span class="keyword1"><span class="command">thm</span></span> time_theory.top_higher
<span class="keyword1"><span class="command">thm</span></span> time_theory.meet_bottom
<span class="keyword1"><span class="command">thm</span></span> time_theory.LFP_unfold

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Closure Laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">HT</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> applied to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Wait</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has no affect, since the latter always advances time. ›</span></span>

<span class="keyword1" id="utp_simple_time-HT_Wait"><span class="command">lemma</span></span> HT_Wait<span class="main">:</span> <span class="quoted"><span class="quoted">"HT<span class="main">(</span>Wait<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Wait<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1" id="utp_simple_time-HT_Wait_closed"><span class="command">lemma</span></span> HT_Wait_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Wait<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">is</span> HT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HT_Wait Healthy_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Relational identity, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="keyword1"><span class="quoted"><span class="keyword1">II</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, is likewise <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">HT</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-healthy. ›</span></span>

<span class="keyword1" id="utp_simple_time-HT_skip_closed"><span class="command">lemma</span></span> HT_skip_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">II</span> <span class="keyword1">is</span> HT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">HT</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is closed under sequential composition, which can be shown 
  by transitivity of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(≤)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>

<span class="keyword1" id="utp_simple_time-HT_seqr_closed"><span class="command">lemma</span></span> HT_seqr_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="keyword1">is</span> HT<span class="main">;</span> <span class="free">Q</span> <span class="keyword1">is</span> HT <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="keyword1">is</span> HT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> dual_order.trans<span class="main">)</span> <span class="comment1">― ‹ Sledgehammer required ›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Assignment is also healthy, provided that the clock variable is not assigned. ›</span></span>

<span class="keyword1" id="utp_simple_time-HT_assign_closed"><span class="command">lemma</span></span> HT_assign_closed <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> clock <span class="main">⨝</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">:=</span> <span class="free">v</span> <span class="keyword1">is</span> HT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> eq_iff lens.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lens_indep_get st_time.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ An alternative characterisation of the above is that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is within the state space lens. ›</span></span>

<span class="keyword1" id="utp_simple_time-HT_assign_closed'"><span class="command">lemma</span></span> HT_assign_closed' <span class="main">[</span><span class="operator">closure</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vwb_lens <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>L</sub></span> st <span class="main">⟧</span> <span class="main">⟹</span> x <span class="main">:=</span> <span class="free">v</span> <span class="keyword1">is</span> HT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Algebraic Laws ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Finally, we prove some useful algebraic laws. ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Wait_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"Wait<span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">II</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">theorem</span></span> Wait_Wait<span class="main">:</span> <span class="quoted"><span class="quoted">"Wait<span class="main">(</span><span class="free">m</span><span class="main">)</span> <span class="main">;;</span> Wait<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> Wait <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> Wait_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"Wait<span class="main">(</span><span class="free">m</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Wait <span class="free">m</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span><span class="main">⟦</span><span class="main">&amp;</span>clock<span class="main">+</span><span class="main">«</span><span class="free">m</span><span class="main">»</span><span class="main">/</span><span class="main">&amp;</span>clock<span class="main">⟧</span> <span class="keyword1">▹<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>Wait <span class="free">m</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rel_auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>