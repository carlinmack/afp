<div id="Singleton">
<div class="head">
<h1>Theory Singleton</h1>
</div>
<pre class="source"><span class="comment1">(*
  Title:      Singleton.thy
  Author:     Diego Marmsoler
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"A Theory of Singletons"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In the following, we formalize the specification of the singleton pattern as described in~\cite{Marmsoler2018c}.
›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> Singleton
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../DynamicArchitectures/Dynamic_Architecture_Calculus.html">DynamicArchitectures.Dynamic_Architecture_Calculus</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="plain_text">Singletons</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following we formalize a variant of the Singleton pattern.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> singleton <span class="main">=</span> dynamic_component <span class="quoted"><span class="free">cmp</span></span> <span class="quoted"><span class="free">active</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">active</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">cmp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> <span class="tfree">'cmp</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">σ⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> alwaysActive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">id</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">id</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">id'</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id</span> <span class="main">=</span> <span class="bound">id'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Calculus Interpretation"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] baIA<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> baIA <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] baIN1<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> baIN1 <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] baIN2<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> baIN2 <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Architectural Guarantees"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">the_singleton</span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">id</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">id'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id'</span> <span class="main">=</span> <span class="bound">id</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ts_prop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">cnf</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">id</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="bound">id</span> <span class="main">=</span> the_singleton"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">id</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">id</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">id</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">id'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id'</span> <span class="main">=</span> <span class="bound">id</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">id</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">id'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id'</span> <span class="main">=</span> <span class="skolem">id</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">id'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="skolem">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id'</span> <span class="main">=</span> <span class="skolem">id</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">id'</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">id'</span>∥<span class="hidden">⇘</span><sub><span class="skolem">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="skolem">id'</span> <span class="main">=</span> <span class="skolem">id</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">id'</span>∥<span class="hidden">⇘</span><sub><span class="skolem">k</span></sub><span class="hidden">⇙</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> unique <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">id</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">id'</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id</span> <span class="main">=</span> <span class="bound">id'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">id'</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="skolem">i''</span> <span class="main">=</span> <span class="bound">id'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">id'</span>∥<span class="hidden">⇘</span><sub><span class="skolem">k</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">id</span><span class="main">=</span><span class="skolem">i''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">id'</span><span class="main">=</span><span class="skolem">i''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">id'</span> <span class="main">=</span> <span class="skolem">id</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i''</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">id'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id'</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="bound">id'</span> <span class="main">=</span> <span class="skolem">i''</span> <span class="main">⟹</span> <span class="skolem">i''</span> <span class="main">=</span> <span class="skolem">id</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">id</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="skolem">id</span> <span class="main">=</span> the_singleton"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> the_singleton_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> g1 <span class="main">=</span> this
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">id</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">id</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="bound">id</span> <span class="main">=</span> the_singleton"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> alwaysActive <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">id</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">id</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">id</span> <span class="main">=</span> the_singleton"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">id</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">declare</span></span> ts_prop<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  
<span class="keyword1" id="Singleton-lNact_active"><span class="command">lemma</span></span> lNact_active<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cid</span> <span class="free">t</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lNact_active ts_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Singleton-lNxt_active"><span class="command">lemma</span></span> lNxt_active<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cid</span> <span class="free">t</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nxtAct_active<span class="main">)</span>
    
<span class="keyword1" id="Singleton-baI"><span class="command">lemma</span></span> baI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_singleton</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">[</span><span class="free">φ</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> baIANow<span class="main">)</span>
  
<span class="keyword1" id="Singleton-baE"><span class="command">lemma</span></span> baE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">[</span><span class="free">φ</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>                      
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_singleton</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> baEANow<span class="main">)</span>

<span class="keyword1" id="Singleton-evtE"><span class="command">lemma</span></span> evtE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">id</span> <span class="free">n</span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n'</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> evtEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"the_singleton"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nxtAct_active<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Singleton-globE"><span class="command">lemma</span></span> globE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">id</span> <span class="free">n</span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n'</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="skolem">n'</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≤</span><span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">γ</span><span class="main">)</span>›</span></span> globEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Singleton-untilI"><span class="command">lemma</span></span> untilI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> cnf"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'cmp</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n'</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n'</span> <span class="free">γ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n''</span><span class="main">.</span> <span class="main">⟦</span><span class="free">n</span><span class="main">≤</span><span class="bound">n''</span><span class="main">;</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">⟧</span> <span class="main">⟹</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">(</span><span class="free">γ'</span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n'</span><span class="main">≥</span><span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'''</span> <span class="main">&lt;</span> <span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="bound">n''</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="bound">n'''</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="bound">n'''</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''''</span> <span class="free">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="bound">n''</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="bound">n''</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n'''</span> <span class="free">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n'</span> <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> untilIA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"the_singleton"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="free">γ'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Singleton-untilE"><span class="command">lemma</span></span> untilE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">id</span> <span class="free">n</span> <span class="free">γ'</span> <span class="free">γ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">(</span><span class="free">γ'</span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n'</span> <span class="free">γ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="free">n</span> <span class="main">(</span><span class="free">γ'</span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">γ</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ'</span><span class="main">)</span> <span class="main">∨</span>
   <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span>
   eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> untilEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"the_singleton"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="free">γ'</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the_singleton∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="main">⟨</span>the_singleton <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="bound">n''</span> <span class="free">γ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹eval the_singleton <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>the_singleton <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Publisher_Subscriber">
<div class="head">
<h1>Theory Publisher_Subscriber</h1>
</div>
<pre class="source"><span class="comment1">(*
  Title:      Publisher_Subscriber.thy
  Author:     Diego Marmsoler
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"A Theory of Publisher-Subscriber Architectures"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In the following, we formalize the specification of the publisher subscriber pattern as described in~\cite{Marmsoler2018c}.
›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> Publisher_Subscriber
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Singleton.html">Singleton</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Subscriptions"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'evt</span> subscription <span class="main">=</span> sub <span class="tfree"><span class="quoted"><span class="tfree">'evt</span></span></span> <span class="main">|</span> unsub <span class="tfree"><span class="quoted"><span class="tfree">'evt</span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Publisher-Subscriber Architectures"</span></span>

<span class="keyword1"><span class="command">locale</span></span> publisher_subscriber <span class="main">=</span>
  pb<span class="main">:</span> singleton <span class="quoted"><span class="free">pbactive</span></span> <span class="quoted"><span class="free">pbcmp</span></span> <span class="main">+</span>
  sb<span class="main">:</span> dynamic_component <span class="quoted"><span class="free">sbcmp</span></span> <span class="quoted"><span class="free">sbactive</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">pbactive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'pid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pbcmp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'pid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> <span class="tfree">'PB</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">σ⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sbactive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'sid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sbcmp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'sid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> <span class="tfree">'SB</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">σ⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pbsb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'PB</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'evt</span> set<span class="main">)</span> subscription set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pbnt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'PB</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'evt</span> <span class="main">×</span> <span class="tfree">'msg</span><span class="main">)</span>"</span></span>             
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sbnt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'SB</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'evt</span> <span class="main">×</span> <span class="tfree">'msg</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sbsb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'SB</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'evt</span> set<span class="main">)</span> subscription"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">pid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">pid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span>
      <span class="main">⟹</span> <span class="free">pbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">pid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">sid</span><span class="main">∈</span><span class="main">{</span><span class="bound">sid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">sid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">sbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conn2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">n''</span> <span class="bound">sid</span> <span class="bound">pid</span> <span class="bound">E</span> <span class="bound">e</span> <span class="bound">m</span><span class="main">.</span>
      <span class="main">⟦</span><span class="bound">t</span> <span class="main">∈</span> arch<span class="main">;</span> <span class="main"><span class="free">∥</span></span><span class="bound">pid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span><span class="main">;</span> <span class="main"><span class="free">∥</span></span><span class="bound">sid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span><span class="main">;</span> sub <span class="bound">E</span> <span class="main">=</span> <span class="free">sbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="bound">n''</span><span class="main">≥</span> <span class="bound">n</span><span class="main">;</span> <span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">;</span>
      <span class="main">∄</span><span class="bound">n'</span> <span class="bound">E'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">≤</span> <span class="bound">n''</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="bound">sid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
        unsub <span class="bound">E'</span> <span class="main">=</span> <span class="free">sbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> <span class="bound">E'</span><span class="main">;</span>
      <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">pbnt</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">pid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main"><span class="free">∥</span></span><span class="bound">sid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="free">pbnt</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">pid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">sbnt</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Calculus Interpretation"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] pb.baIA<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> pb.baIA <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] sb.baIA<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> sb.baIA <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Results from Singleton"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">the_pb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'pid</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">the_pb</span> <span class="main">≡</span> pb.the_singleton"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] pb.ts_prop<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> pb.ts_prop<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\noindent
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Architectural Guarantees"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following theorem ensures that a subscriber indeed receives all messages associated with an event for which he is subscribed.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> msgDelivery<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">n''</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sid</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'sid</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">E</span> <span class="free">e</span> <span class="free">m</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> arch"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">sid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sub <span class="free">E</span> <span class="main">=</span> <span class="free">sbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">n'</span> <span class="bound">E'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">sid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> unsub <span class="bound">E'</span> <span class="main">=</span> <span class="free">sbsb</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="free">e</span> <span class="main">∈</span> <span class="bound">E'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">pbnt</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_pb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">sid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n''</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">sbnt</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms conn2 pb.ts_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since a publisher is actually a singleton, we can provide an alternative version of constraint <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] conn1<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Publisher_Subscriber-conn1A"><span class="command">lemma</span></span> conn1A<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">pbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_pb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">sid</span><span class="main">∈</span><span class="main">{</span><span class="bound">sid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">sid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">sbsb</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">sid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conn1<span class="main">[</span><span class="operator">OF</span> pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Blackboard">
<div class="head">
<h1>Theory Blackboard</h1>
</div>
<pre class="source"><span class="comment1">(*
  Title:      Blackboard.thy
  Author:     Diego Marmsoler
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"A Theory of Blackboard Architectures"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In the following, we formalize the specification of the blackboard pattern as described in~\cite{Marmsoler2018c}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Blackboard
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Publisher_Subscriber.html">Publisher_Subscriber</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Problems and Solutions"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Blackboards work with problems and solutions for them.
›</span></span>
<span class="keyword1"><span class="command">typedecl</span></span> PROB
<span class="keyword1"><span class="command">consts</span></span> sb <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>PROB <span class="main">×</span> PROB<span class="main">)</span> set"</span></span>
<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span> sbWF<span class="main">:</span> <span class="quoted"><span class="quoted">"wf sb"</span></span>
<span class="keyword1"><span class="command">typedecl</span></span> SOL
<span class="keyword1"><span class="command">consts</span></span> solve<span class="main">::</span> <span class="quoted"><span class="quoted">"PROB <span class="main">⇒</span> SOL"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Blackboard Architectures"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following, we describe the locale for the blackboard pattern.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> blackboard <span class="main">=</span> publisher_subscriber <span class="quoted"><span class="free">bbactive</span></span> <span class="quoted"><span class="free">bbcmp</span></span> <span class="quoted"><span class="free">ksactive</span></span> <span class="quoted"><span class="free">kscmp</span></span> <span class="quoted"><span class="free">bbrp</span></span> <span class="quoted"><span class="free">bbcs</span></span> <span class="quoted"><span class="free">kscs</span></span> <span class="quoted"><span class="free">ksrp</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">bbactive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'bid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bbcmp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'bid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> <span class="tfree">'BB</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">σ⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ksactive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'kid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">kscmp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'kid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> <span class="tfree">'KS</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">σ⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bbrp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'BB</span> <span class="main">⇒</span> <span class="main">(</span>PROB set<span class="main">)</span> subscription set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bbcs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'BB</span> <span class="main">⇒</span> <span class="main">(</span>PROB <span class="main">×</span> SOL<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">kscs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'KS</span> <span class="main">⇒</span> <span class="main">(</span>PROB <span class="main">×</span> SOL<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ksrp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'KS</span> <span class="main">⇒</span> <span class="main">(</span>PROB set<span class="main">)</span> subscription"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bbns</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'BB</span> <span class="main">⇒</span> <span class="main">(</span>PROB <span class="main">×</span> SOL<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ksns</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'KS</span> <span class="main">⇒</span> <span class="main">(</span>PROB <span class="main">×</span> SOL<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bbop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'BB</span> <span class="main">⇒</span> PROB"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ksop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'KS</span> <span class="main">⇒</span> PROB set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prob</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'kid</span> <span class="main">⇒</span> PROB"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    ks1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ks</span><span class="main">.</span> <span class="bound">p</span><span class="main">=</span><span class="free">prob</span> <span class="bound">ks</span>"</span></span> <span class="comment1">― ‹Component Parameter›</span>
    <span class="comment1">― ‹Assertions about component behavior.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvbb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">bId</span> <span class="bound">p</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span> <span class="main">∈</span> arch<span class="main">⟧</span> <span class="main">⟹</span> pb.eval <span class="bound">bId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">∈</span><span class="free">bbns</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>
      <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvbb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">bId</span> <span class="bound">P</span> <span class="bound">q</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span><span class="main">∈</span>arch<span class="main">⟧</span> <span class="main">⟹</span> pb.eval <span class="bound">bId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> <span class="bound">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
      <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="bound">q</span> <span class="main">=</span> <span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvbb3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">bId</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span><span class="main">∈</span>arch<span class="main">⟧</span> <span class="main">⟹</span> pb.eval <span class="bound">bId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> <span class="free">bbop</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
      <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="bound">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">𝔚<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span>solve<span class="main">(</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvks1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">kId</span> <span class="bound">p</span> <span class="bound">P</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span><span class="main">∈</span>arch<span class="main">;</span> <span class="bound">p</span> <span class="main">=</span> <span class="free">prob</span> <span class="bound">kId</span><span class="main">⟧</span> <span class="main">⟹</span> sb.eval <span class="bound">kId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
      <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>sb.pred <span class="main">(</span><span class="bound">q</span><span class="main">∈</span><span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span>solve<span class="main">(</span><span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> solve <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvks2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">kId</span> <span class="bound">p</span> <span class="bound">P</span> <span class="bound">q</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span> <span class="main">∈</span> arch<span class="main">;</span><span class="bound">p</span> <span class="main">=</span> <span class="free">prob</span> <span class="bound">kId</span><span class="main">⟧</span> <span class="main">⟹</span> sb.eval <span class="bound">kId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> <span class="bound">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> sb<span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvks3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">kId</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span><span class="main">∈</span>arch<span class="main">;</span><span class="bound">p</span> <span class="main">=</span> <span class="free">prob</span> <span class="bound">kId</span><span class="main">⟧</span> <span class="main">⟹</span> sb.eval <span class="bound">kId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="free">ksop</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bhvks4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">t'</span> <span class="bound">kId</span> <span class="bound">p</span> <span class="bound">P</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span><span class="main">∈</span>arch<span class="main">;</span> <span class="bound">p</span><span class="main">∈</span><span class="bound">P</span><span class="main">⟧</span> <span class="main">⟹</span> sb.eval <span class="bound">kId</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
      <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
      <span class="main">(</span><span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="bound">p</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">𝔚<span class="hidden">⇩</span><sub>b</sub></span>
      <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span>solve <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="comment1">― ‹Assertions about component activation.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> actks<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">kid</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span> <span class="main">∈</span> arch<span class="main">;</span> <span class="main"><span class="free">∥</span></span><span class="bound">kid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span><span class="main">;</span> <span class="bound">p</span><span class="main">=</span><span class="free">prob</span> <span class="bound">kid</span><span class="main">;</span> <span class="bound">p</span><span class="main">∈</span><span class="free">ksop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">kid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> solve <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="bound">n'</span> <span class="main">⟶</span> <span class="main"><span class="free">∥</span></span><span class="bound">kid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∥</span></span><span class="bound">kid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> solve <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="comment1">― ‹Assertions about connections.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> conn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">bid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">bid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span>
      <span class="main">⟹</span> <span class="free">bbns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">bid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">kid</span><span class="main">∈</span><span class="main">{</span><span class="bound">kid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">kid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conn2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">kid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">kid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span>
      <span class="main">⟹</span> <span class="free">ksop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">bid</span><span class="main">∈</span><span class="main">{</span><span class="bound">bid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">bid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">bid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">notation</span></span> sb.lNAct <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_ <span class="keyword1">⇐</span> _<span class="keyword1">⟩⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">notation</span></span> sb.nxtAct <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_ <span class="keyword1">→</span> _<span class="keyword1">⟩⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">notation</span></span> pb.lNAct <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_ <span class="keyword1">⇐</span> _<span class="keyword1">⟩⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">notation</span></span> pb.nxtAct <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_ <span class="keyword1">→</span> _<span class="keyword1">⟩⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>

  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Calculus Interpretation"</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \noindent
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] pb.baIA<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> pb.baIA <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \noindent
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] sb.baIA<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> sb.baIA <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Results from Singleton"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">the_bb</span> <span class="main">≡</span> the_pb"</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \noindent
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] pb.ts_prop<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> pb.ts_prop<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \noindent
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Results from Publisher Subscriber"</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
	\noindent
	<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] msgDelivery<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> msgDelivery <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
  <span class="keyword1" id="Blackboard-conn2_bb"><span class="command">lemma</span></span> conn2_bb<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">kid</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'kid</span></span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">kid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span><span class="free">ksop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ksop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">kid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">bid</span><span class="main">∈</span><span class="main">{</span><span class="bound">bid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">bid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">bid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conn2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">bid</span><span class="main">.</span><span class="main">{</span><span class="bound">bid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">bid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">)</span><span class="main">=</span><span class="main">{</span>the_bb<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pb.ts_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">bid</span><span class="main">∈</span><span class="main">{</span><span class="bound">bid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">bid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">bid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Knowledge Sources"</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    In the following we introduce an abbreviation for knowledge sources which are able to solve a specific problem.
›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sKs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"PROB <span class="main">⇒</span> <span class="tfree">'kid</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sKs</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">kid</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free">prob</span> <span class="bound">kid</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Blackboard-sks_prob"><span class="command">lemma</span></span> sks_prob<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">prob</span> <span class="main">(</span>sKs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sKs_def someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">kid</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="free">prob</span> <span class="bound">kid</span>"</span></span><span class="main">]</span> ks1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Architectural Guarantees"</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    The following theorem verifies that a problem is eventually solved by the pattern even if no knowledge source exist which can solve the problem on its own.
    It assumes, however, that for every open sub problem, a corresponding knowledge source able to solve the problem will be eventually activated.
›</span></span>
  <span class="keyword1" id="Blackboard-pSolved_Ind"><span class="command">lemma</span></span> pSolved_Ind<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span><span class="tfree">'BB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t''</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span><span class="tfree">'KS</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">∈</span>arch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="main">(</span><span class="free">bbop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span>solve<span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">(*\eqref{eq:bb:g}*)</span>
  <span class="comment1">― ‹The proof is by well-founded induction over the subproblem relation <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">sb</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">sb</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="comment1">― ‹We first show that the subproblem relation is indeed well-founded ...›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf sb"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sbWF<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">― ‹... then we show that a problem <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">p</span></span><span class="antiquote">}</span></span> is indeed solved›</span>
    <span class="comment1">― ‹if all its sub-problems <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">p'</span></span><span class="antiquote">}</span></span> are eventually solved›</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> indH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p'</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> sb <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p'</span><span class="main">∈</span><span class="bound">P</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span>solve<span class="main">(</span><span class="bound">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">P</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">P</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sub <span class="skolem">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pb.baI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> pb.globE<span class="main">[</span><span class="operator">OF</span> bhvbb2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="bound">bb</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pb.impE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n'</span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> pb.evtE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pb.baE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="comment1">― ‹Problem p is provided at the output of the blackboard until it is solved›</span>
        <span class="comment1">― ‹or forever...›</span>
        <span class="keyword1"><span class="command">from</span></span> pb.globE<span class="main">[</span><span class="operator">OF</span> bhvbb3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
          <span class="main">(</span><span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">𝔚<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span> <span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.baI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span>
          <span class="main">(</span><span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">𝔚<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span><span class="main">(</span><span class="bound">bb</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pb.impE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span>
          <span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="keyword1">∨<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pb.wuntil_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span>
          <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">∨</span>
          <span class="main">(</span>pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span> <span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pb.disjE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="comment1">― ‹We need to consider both cases, the case in which the problem is eventually›</span>
        <span class="comment1">― ‹solved and the case in which the problem is always provided as an output›</span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="comment1">― ‹First we consider the case in which the problem is eventually solved:›</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span>
            <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span>pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="bound">i</span>
            <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="bound">i</span> <span class="main">⟶</span> pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="bound">k</span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.untilE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≥</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">i</span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.baEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">≥</span><span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="comment1">― ‹Now we consider the case in which p is always provided at the output›</span>
          <span class="comment1">― ‹of the blackboard:›</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n</span>
            <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span><span class="main">=</span><span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span>pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="bound">n'</span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.globE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> outp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.baE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="comment1">― ‹thus, by assumption there exists a KS which is able to solve p and which›</span>
          <span class="comment1">― ‹is active at <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">n'</span><span class="antiquote">}</span></span>...›</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">≥</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="comment1">― ‹... and get the problem as its input.›</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">≥</span><span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">bbop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> outp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="free">ksop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conn2_bb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="comment1">― ‹thus the ks will either solve the problem or not solve it and›</span>
          <span class="comment1">― ‹be activated forever›</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
            <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="bound">n'</span> <span class="main">⟶</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> actks<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> sks_prob <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="comment1">― ‹if the ks solves it›</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">⟶</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
            <span class="comment1">― ‹it is forwarded to the blackboard›</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>›</span></span> sb.nxtAct_active<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">bbns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> conn1<span class="main">[</span><span class="operator">OF</span> pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="comment1">― ‹finally, the blackboard will forward the solution which finishes the proof.›</span>
            <span class="keyword1"><span class="command">with</span></span> bhvbb1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span>
              <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.globE pb.impE<span class="main">[</span><span class="operator">of</span> <span class="quoted">the_bb</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.evtE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> arch›</span></span> pb.baEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">≥</span><span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="comment1">― ‹otherwise, we derive a contradiction›</span>
            <span class="keyword3"><span class="command">assume</span></span> case_ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>

            <span class="comment1">― ‹first, the KS will eventually register for the subproblems P it requires to solve p...›</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>
              <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="skolem">p</span><span class="main">∈</span><span class="free">ksop</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.globEA<span class="main">[</span><span class="operator">OF</span> _ bhvks3<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t''</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> sks_prob <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">ksop</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">ksop</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> sb.nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∈</span><span class="free">ksop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sb.baIA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.impE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>
              <span class="main">⟶</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">∨</span>
              <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span>
              sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> sb.evtEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> case_ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> case_ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.nxtActLe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">≥</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
              <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> sub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              <span class="quoted"><span class="quoted">"sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.baEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> sb.baIA sks_prob <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="comment1">― ‹the knowledgesource will eventually get a solution for each required subproblem:›</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">p'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="bound">p'</span><span class="main">∈</span><span class="skolem">P</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
              <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span>solve <span class="bound">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p'</span><span class="main">.</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="bound">p'</span><span class="main">∈</span><span class="skolem">P</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
                <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span>solve <span class="bound">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="comment1">― ‹by induction hypothesis, the blackboard will eventually provide solutions for subproblems›</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="main">(</span>sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>
                  <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.predE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>
                      <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">𝔚<span class="hidden">⇩</span><sub>b</sub></span>
                      <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> sb.globEA<span class="main">[</span><span class="operator">OF</span> _ bhvks4<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t''</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
                      <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">∈</span><span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
                      <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
                      <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">𝔚<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> sb.impE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
                      <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">∨</span>
                      sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
                      <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.wuntil_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span>
                      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="var">?γ'</span> <span class="keyword1">𝔘<span class="hidden">⇩</span><sub>b</sub></span> <span class="var">?γ</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                        lass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>
                        <span class="main">⟶</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="var">?γ</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>
                        <span class="main">⟶</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="var">?γ'</span><span class="main">)</span> <span class="main">∨</span>
                        <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n'</span> <span class="var">?γ</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="var">?γ'</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> sb.untilEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t''</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
                        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
                        <span class="keyword1"><span class="command">with</span></span> lass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>
                          <span class="main">⟶</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="var">?γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> sb.nxtActLe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n'</span> <span class="var">?γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>›</span></span>
                        <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span>
                          <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span>
                          sb.evtIA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="var"><span class="quoted"><span class="var">?γ</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">with</span></span> lass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n'</span> <span class="var">?γ</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="var">?γ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
                          <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span>›</span></span>
                            sb.evtIA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="var"><span class="quoted"><span class="var">?γ</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> cass<span class="main">:</span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>
                        <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> sb"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span>
                          <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span> <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> sb<span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> sb.globEA<span class="main">[</span><span class="operator">OF</span> _ bhvks2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> arch›</span></span> sks_prob <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
                          <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">using</span></span> sb.baEANow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> sb"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
                        sks_prob <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sub <span class="skolem">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> conn1A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sub <span class="skolem">P</span> <span class="main">∈</span> <span class="free">bbrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> indH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                      <span class="comment1">― ‹and due to the publisher subscriber property,›</span>
                      <span class="comment1">― ‹the knowledge source will receive them›</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">n</span> <span class="bound">P</span><span class="main">.</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
                        unsub <span class="bound">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">∈</span> <span class="bound">P</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span>
                        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">P'</span><span class="main">.</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
                          unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">∈</span> <span class="bound">P'</span>"</span></span>
                        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
                          <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                          <span class="quoted"><span class="quoted">"unsub <span class="skolem">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n</span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
                          <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
                          <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                        <span class="keyword1"><span class="command">with</span></span> cass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n</span> <span class="main">(</span><span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">P'</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="bound">P'</span><span class="main">)</span>
                          <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> sb.globEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t''</span></span>
                          <span class="quoted"><span class="quoted">"<span class="keyword1">¬<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">(</span><span class="keyword1">∃<span class="hidden">⇩</span><sub>b</sub></span><span class="bound">P'</span><span class="main">.</span> sb.pred <span class="main">(</span><span class="skolem">p'</span> <span class="main">∈</span> <span class="bound">P'</span><span class="main">)</span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> unsub <span class="bound">P'</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
                          <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> sb.negE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>›</span></span>
                        <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span> <span class="main">≥</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">with</span></span> case_ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">m</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">m</span></sub><span class="hidden">⇙</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> arch›</span></span> msgDelivery<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="quoted">"solve <span class="skolem">p'</span>"</span></span><span class="main">]</span>
                        <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">m</span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> sb.baIANow <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">m</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">m</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">m</span></sub><span class="hidden">⇙</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> sb.nxtActLe <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>
                        <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> sb.evtIA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="skolem">p'</span><span class="main">∈</span><span class="skolem">P</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
                  <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span>solve <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> sb.impI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sb.allI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="comment1">― ‹Thus, the knowlege source will eventually solve the problem at hand...›</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>
              <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
              <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="bound">q</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> solve <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.conjI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>
              <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> sub <span class="skolem">P</span> <span class="main">=</span> <span class="free">ksrp</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">∧<span class="hidden">⇧</span><sup>b</sup></span>
              <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span>sb.pred <span class="main">(</span><span class="bound">q</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
              <span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> solve <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">kscs</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
              <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="bound">ks</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> arch›</span></span>
              sb.globEA<span class="main">[</span><span class="operator">OF</span> _ bhvks1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> sks_prob <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>
              <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="free">ksns</span><span class="main">(</span><span class="bound">ks</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.impE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="comment1">― ‹and forward it to the blackboard›</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span> <span class="main">⟶</span>
              sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="bound">n''</span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="free">ksns</span><span class="main">(</span><span class="bound">ks</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
              <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span>
              sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="free">ksns</span><span class="main">(</span><span class="bound">ks</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.evtEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span> <span class="main">≥</span> <span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
            <span class="keyword1"><span class="command">with</span></span> case_ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">≤</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.nxtActLe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sb.eval <span class="main">(</span>sKs <span class="skolem">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">t''</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="free">ksns</span><span class="main">(</span><span class="bound">ks</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.evtEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>sKs <span class="skolem">p</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> sb.baEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="quoted"><span class="quoted">"sKs <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">ksns</span> <span class="bound">ks</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">bbns</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> conn1<span class="main">[</span><span class="operator">OF</span> pb.ts_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">(</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span>solve<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">bbns</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.baI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="comment1">― ‹finally, the blackboard will forward the solution which finishes the proof.›</span>
            <span class="keyword1"><span class="command">with</span></span> bhvbb1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>
              <span class="main">(</span><span class="keyword1">◇<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.globE pb.impE<span class="main">[</span><span class="operator">of</span> <span class="quoted">the_bb</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">"pb.eval the_bb <span class="free">t</span> <span class="free">t'</span> <span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="bound">bb</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">∈</span>arch›</span></span> pb.evtE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> solve <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> arch›</span></span> pb.baEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'''</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> sb.nxtActLe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">≥</span><span class="skolem">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>sKs <span class="skolem">p</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> sb.nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>f</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span>›</span></span>
                <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>r</sub></span><span class="main">≥</span><span class="main">⟨</span>sKs <span class="skolem">p</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>k</sub></span><span class="main">≥</span><span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> pSolved<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span><span class="tfree">'BB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t''</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span><span class="tfree">'KS</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">∈</span>arch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>sKs <span class="main">(</span><span class="free">bbop</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span>sub <span class="bound">P</span> <span class="main">∈</span> <span class="free">bbrp</span><span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
        <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span>solve<span class="main">(</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bbcs</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the_bb</sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms pSolved_Ind <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Auxiliary">
<div class="head">
<h1>Theory Auxiliary</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Some Auxiliary Results"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Auxiliary <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Auxiliary-disjE3"><span class="command">lemma</span></span> disjE3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span> <span class="main">∨</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟹</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟹</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⟹</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Auxiliary-ge_induct"><span class="command">lemma</span></span> ge_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">i</span><span class="main">.</span>  <span class="bound">m</span><span class="main">&lt;</span><span class="bound">n</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">m</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">i</span><span class="main">.</span>  <span class="bound">m</span><span class="main">&lt;</span><span class="bound">n</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">m</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">m</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">m</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">i</span><span class="main">.</span>  <span class="bound">m</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">m</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">i</span><span class="main">.</span>  <span class="bound">m</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> nat_less_induct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">j</span>"</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> a0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Auxiliary-my_induct"><span class="command">lemma</span></span> my_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≤</span><span class="free">j</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> less base <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">j</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">::</span></span>nat<span class="main"><span class="main">.</span></span> <span class="free"><span class="free">j</span></span><span class="main"><span class="main">-</span></span><span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">≥</span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">⟶</span></span> <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">j</span></span><span class="main"><span class="main">-</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">j</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">i</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> base <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span><span class="free">j</span><span class="main">-</span><span class="skolem">x</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≤</span><span class="free">j</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">n'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&gt;</span><span class="free">j</span><span class="main">-</span><span class="skolem">x</span> <span class="main">⟶</span> <span class="skolem">n'</span><span class="main">≤</span><span class="free">j</span> <span class="main">⟶</span> <span class="free">P</span> <span class="skolem">n'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> HOL.impI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> HOL.impI<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_less_trans less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">≤</span> <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asmp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">≤</span> <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span><span class="main">-</span><span class="skolem">x</span><span class="main">&lt;</span><span class="free">j</span>›</span></span> step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">-</span><span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Auxiliary-Greatest_ex_le_nat"><span class="command">lemma</span></span> Greatest_ex_le_nat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k'</span> <span class="main">⟶</span> <span class="bound">k'</span> <span class="main">≤</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span>Greatest <span class="free">P</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Greatest_equality assms less_le_not_le<span class="main">)</span>

<span class="keyword1" id="Auxiliary-cardEx"><span class="command">lemma</span></span> cardEx<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&gt;</span> card <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span><span class="main">∈</span><span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span><span class="main">≤</span>card <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Auxiliary-cardshift"><span class="command">lemma</span></span> cardshift<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">+</span><span class="free">n''</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI'<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">n''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">(</span><span class="free">n''</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">+</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">x</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="free">n''</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span><span class="main">-</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">+</span><span class="free">n''</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">x</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span><span class="main">-</span><span class="free">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">+</span><span class="free">n''</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span><span class="main">-</span><span class="free">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">=</span><span class="skolem">x</span><span class="main">+</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">n''</span><span class="main">+</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">(</span><span class="free">n''</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="RF_LTL">
<div class="head">
<h1>Theory RF_LTL</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Relative Frequency LTL"</span></span>

<span class="keyword1"><span class="command">theory</span></span> RF_LTL
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span> <a href="Auxiliary.html">Auxiliary</a> <a href="../DynamicArchitectures/Dynamic_Architecture_Calculus.html">DynamicArchitectures.Dynamic_Architecture_Calculus</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'s</span> seq <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ccard</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="RF_LTL-ccard_same"><span class="command">lemma</span></span> ccard_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span>Suc <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span>Suc <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≤</span>Suc <span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RF_LTL-ccard_zero"><span class="command">lemma</span></span> ccard_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RF_LTL-ccard_inc"><span class="command">lemma</span></span> ccard_inc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Suc <span class="main">(</span>ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n'</span> <span class="main">∉</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_insert_disjoint<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>Suc <span class="free">n'</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Suc <span class="free">n'</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> assms <span class="main">(</span>1<span class="main">)</span> assms <span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> insert <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RF_LTL-ccard_mono"><span class="command">lemma</span></span> ccard_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">≥</span><span class="free">n'</span> <span class="main">⟹</span> ccard <span class="free">n</span> <span class="main">(</span><span class="free">n''</span><span class="main">::</span>nat<span class="main">)</span> <span class="free">p</span> <span class="main">≥</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≤</span><span class="skolem">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Suc <span class="main">(</span>ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_inc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≤</span><span class="skolem">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RF_LTL-ccard_ub"><span class="command">lemma</span></span> ccard_ub<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span> <span class="main">≤</span> Suc <span class="free">n'</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≥</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">p</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≥</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≥</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">..</span><span class="free">n'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">≥</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">}</span> <span class="main">=</span> Suc <span class="free">n'</span> <span class="main">-</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RF_LTL-ccard_sum"><span class="command">lemma</span></span> ccard_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n''</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">≥</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">+</span> ccard <span class="free">n''</span> <span class="free">n'</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n''</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?LHS</span> <span class="main">=</span> <span class="var">?RHS</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?LHS</span> <span class="main">⊆</span> <span class="var">?RHS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?RHS</span> <span class="main">⊆</span> <span class="var">?LHS</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?RHS</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">&gt;</span><span class="free">n''</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?LHS</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?LHS</span> <span class="main">=</span> card <span class="var">?RHS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">=</span> card <span class="var">?RHS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?RHS</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n''</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_Un_disjoint<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n''</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n''</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n''</span> <span class="free">n'</span> <span class="free">P</span><span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&gt;</span><span class="free">n''</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RF_LTL-ccard_ex"><span class="command">lemma</span></span> ccard_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≥</span><span class="main">1</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">&lt;</span> ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n''</span><span class="main">.</span> <span class="bound">n'</span><span class="main">&gt;</span><span class="free">n</span> <span class="main">∧</span> ccard <span class="free">n</span> <span class="bound">n'</span> <span class="free">P</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">&gt;</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span> <span class="main">=</span> <span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessE less_imp_le_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n''</span><span class="main">&gt;</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n'</span><span class="main">=</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ccard_inc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n''</span><span class="main">&gt;</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n'</span><span class="main">=</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ccard_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">&gt;</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LeastI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Least_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> antisym le_less_trans<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?l</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span><span class="main">&gt;</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span><span class="main">&lt;</span><span class="free">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="var">?l</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="var">?l</span> <span class="free">P</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">c</span><span class="main">&lt;</span>ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">+</span> ccard <span class="skolem">n'</span> <span class="free">n''</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">n''</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">c</span><span class="main">&lt;</span>ccard <span class="free">n</span> <span class="free">n''</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n'</span> <span class="free">n''</span> <span class="free">P</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n'</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="skolem">n'</span> <span class="free">n''</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">&gt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'''</span> <span class="main">=</span> <span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'''</span> <span class="main">≥</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessE less_imp_le_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Suc <span class="skolem">n'''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n''</span><span class="main">&gt;</span><span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n'''</span><span class="main">=</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">≥</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ccard_inc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">n'''</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="skolem">n'''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n''</span><span class="main">&gt;</span><span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n'''</span><span class="main">=</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">≥</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ccard_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">n'''</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LeastI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="var">?l</span> <span class="free">P</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">+</span> ccard <span class="skolem">n'</span> <span class="var">?l</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Least_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> antisym le_less_trans<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?l</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="var">?l</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> LeastI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span><span class="main">&gt;</span><span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n'</span> <span class="var">?l</span> <span class="free">P</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?l</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> Suc <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">&lt;</span> <span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LeastI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n''</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span><span class="var">?l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RF_LTL-ccard_freq"><span class="command">lemma</span></span> ccard_freq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">::</span>nat<span class="main">)</span><span class="main">≥</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">&gt;</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">cnf</span> <span class="main">∧</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">&gt;</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main">&gt;</span>card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?LHS</span><span class="main">&gt;</span>card <span class="var">?RHS</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="var">?LHS</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RHS</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cardEx<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?LHS</span></span></span> <span class="var"><span class="quoted"><span class="var">?RHS</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">Q</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n''</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="free">P</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_inc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">cnf</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n''</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="free">Q</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n''</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">n''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">cnf</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n''</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">cnf</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">cnf</span> <span class="main">∧</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span> <span class="main">⟶</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> leI less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?gcond</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≥</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">n''</span><span class="main">≤</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="bound">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="var">?gcond</span> <span class="bound">n''</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">&gt;</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n''</span><span class="main">.</span> <span class="var">?gcond</span> <span class="bound">n''</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">&gt;</span> <span class="free">cnf</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="free">cnf</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≤</span><span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ccard_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cnf</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?gcond</span> <span class="bound">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> gex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n''</span><span class="main">.</span> <span class="var">?gcond</span> <span class="bound">n''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?gcond</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="bound">n''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> boundedGreatest<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?gcond</span></span></span> <span class="main">_</span> <span class="quoted"><span class="free">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GreatestI_ex_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?gcond</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span> <span class="main">⟹</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">P</span> <span class="main">≤</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ge_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> step.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cas<span class="main">:</span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> cas <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">x</span><span class="main">=</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≥</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">-</span><span class="main">1</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">cnf</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">-</span><span class="main">1</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">cnf</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">cnf</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">-</span><span class="main">1</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">cnf</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ccard_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">cnf</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&lt;</span><span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">P</span> <span class="main">≤</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n''</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">-</span><span class="main">1</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="free">cnf</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">cnf</span><span class="main">)</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> semiring_normalization_rules<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">cnf</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">cnf</span>›</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&lt;</span><span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">+</span> ccard <span class="skolem">n''</span> <span class="skolem">n'</span> <span class="free">Q</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ccard_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="skolem">n''</span> <span class="skolem">n'</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="skolem">n''</span> <span class="skolem">n'</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&lt;</span><span class="skolem">n'</span>›</span></span> ccard_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> geq <span class="main">=</span> this
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">P</span> <span class="main">≤</span> ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">&gt;</span> <span class="free">cnf</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">&gt;</span> <span class="free">cnf</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="var">?g</span> <span class="free">n'</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">cnf</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">cnf</span> <span class="main">∧</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">cnf</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">cnf</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span><span class="var">?g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ccard <span class="var">?g</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ccard_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cnf</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">1</span><span class="main">.</span> ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">Q</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">cnf</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">Q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&gt;</span><span class="var">?g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span><span class="main">≥</span><span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">Q</span> <span class="main">+</span> ccard <span class="var">?g</span> <span class="skolem">n''</span> <span class="free">Q</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ccard_sum<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="free">n</span> <span class="var">?g</span> <span class="free">Q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span> <span class="main">+</span> ccard <span class="var">?g</span> <span class="skolem">n''</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ccard <span class="var">?g</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">cnf</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="skolem">n''</span> <span class="free">Q</span> <span class="main">=</span> Suc <span class="skolem">x</span> <span class="main">*</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&gt;</span><span class="var">?g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span><span class="main">≥</span><span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="var">?g</span><span class="main">.</span> <span class="var">?gcond</span> <span class="bound">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?gcond</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?gcond</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GreatestI_ex_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?gcond</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">P</span><span class="main">≤</span>ccard <span class="free">n</span> <span class="free">n'</span> <span class="free">Q</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_sum<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span> <span class="main">≥</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> honest <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bc</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> seq"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> growth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> <span class="free">n'</span><span class="main">≤</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="free">n'</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="free">n'</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span><span class="free">n'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">@</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> dishonest <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bc</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> seq"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mining</span><span class="main">::</span><span class="quoted"><span class="quoted">"bool seq"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> growth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="bound">n</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="RF_LTL-prefix_save"><span class="command">lemma</span></span> prefix_save<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n''</span> <span class="main">⟶</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">n'''</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">sbc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">≥</span><span class="free">n'</span> <span class="main">⟹</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="free">n''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> growth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">using</span></span> prefix_length_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="skolem">n</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> step.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> prefix_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="free">n''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≤</span><span class="free">n''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n''</span> <span class="main">∧</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">n'''</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n''</span> <span class="main">∧</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">n'''</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n''</span> <span class="main">⟶</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">n'''</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="free">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prefix_save<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">sbc</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">n''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> grow_mining<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms growth leD prefix_length_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RF_LTL-length_suc_length"><span class="command">lemma</span></span> length_suc_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="free">bc</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff growth le_SucI length_append_singleton prefix_length_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> dishonest_growth <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bc</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat seq"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mining</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> as2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">bc</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">mining</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> dishonest <span class="main">⊆</span> dishonest_growth <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> grow_mining length_suc_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> dishonest_growth
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> ccard_diff_lgth<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span> <span class="main">⟹</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="free">bc</span> <span class="free">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> as1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">∨</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_neq_implies_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">bc</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ccard_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">bc</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> Suc <span class="main">(</span>ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ccard_inc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> honest_growth <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bc</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat seq"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mining</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">init</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> <span class="free">bc</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> as2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">mining</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">bc</span> <span class="bound">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="RF_LTL-grow_mono"><span class="command">lemma</span></span> grow_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span><span class="main">⟹</span><span class="free">bc</span> <span class="free">n'</span><span class="main">≥</span><span class="free">bc</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> as1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> ccard_diff_lgth<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="free">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span> <span class="main">≥</span> ccard <span class="free">n</span> <span class="free">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">bc</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="skolem">n'</span><span class="main">≥</span><span class="free">bc</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> grow_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="free">bc</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> as1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span> <span class="main">≥</span> <span class="free">bc</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_le_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">mining</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>›</span></span> step.hyps
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ccard_inc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ccard <span class="free">n</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ccard <span class="free">n</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">mining</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ccard_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> as1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span> <span class="main">≥</span> <span class="free">bc</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="free">bc</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_le_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> bounded_growth <span class="main">=</span> hg<span class="main">:</span> honest_growth <span class="quoted"><span class="free">hbc</span></span> <span class="quoted"><span class="free">hmining</span></span> <span class="main">+</span> dg<span class="main">:</span> dishonest_growth <span class="quoted"><span class="free">dbc</span></span> <span class="quoted"><span class="free">dmining</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hbc</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat seq"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dbc</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat seq"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">hmining</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dmining</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sbc</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">cnf</span><span class="main">::</span><span class="quoted">nat</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">n'</span><span class="main">.</span> ccard <span class="bound">n</span> <span class="bound">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">cnf</span> <span class="main">⟹</span> ccard <span class="bound">n</span> <span class="bound">n'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">cnf</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hbc</span> <span class="main">0</span> <span class="main">≥</span> <span class="free">sbc</span><span class="main">+</span><span class="free">cnf</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dbc</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">sbc</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hn_upper_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dbc</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">hbc</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">dbc</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">hbc</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">dbc</span> <span class="free">n</span> <span class="main">≥</span> <span class="free">hbc</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a2 a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hbc</span> <span class="main">0</span> <span class="main">&gt;</span> <span class="free">dbc</span> <span class="main">0</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hbc</span> <span class="free">n</span><span class="main">≥</span><span class="free">hbc</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hg.grow_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dbc</span> <span class="free">n</span> <span class="main">-</span> <span class="free">dbc</span> <span class="main">0</span> <span class="main">&gt;</span> <span class="free">hbc</span> <span class="free">n</span> <span class="main">-</span> <span class="free">hbc</span> <span class="main">0</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="main">0</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">hbc</span> <span class="free">n</span> <span class="main">-</span> <span class="free">hbc</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hg.ccard_diff_lgth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dbc</span> <span class="free">n</span> <span class="main">-</span> <span class="free">dbc</span> <span class="main">0</span> <span class="main">≤</span> ccard <span class="main">0</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dg.ccard_diff_lgth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ccard <span class="main">0</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> ccard <span class="main">0</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">cnf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">cnf</span> <span class="main">∧</span> ccard <span class="bound">n'</span> <span class="bound">n''</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">cnf</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ccard_freq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> fair <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Blockchain">
<div class="head">
<h1>Theory Blockchain</h1>
</div>
<pre class="source"><span class="comment1">(*
  Title:      Blockchain.thy
  Author:     Diego Marmsoler
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Blockchain Architectures"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Blockchain <span class="keyword2"><span class="keyword">imports</span></span> <a href="Auxiliary.html">Auxiliary</a> <a href="../DynamicArchitectures/Dynamic_Architecture_Calculus.html">DynamicArchitectures.Dynamic_Architecture_Calculus</a> <a href="RF_LTL.html">RF_LTL</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Blockchains"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A blockchain itself is modeled as a simple list.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> BC <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">max_cond</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> BC<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> BC <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_cond</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">no_syntax</span></span> 
  <span class="quoted">"_MAX1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">MAX</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_MAX"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">MAX</span> _<span class="keyword1">:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_MAX1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">MAX</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_MAX"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">MAX</span> _<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MAX</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> BC<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> BC"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">MAX</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> max_cond <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Blockchain-max_ex"><span class="command">lemma</span></span> max_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">XS</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> BC<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">XS</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">XS</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="bound">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Finite_Set.finite_ne_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">XS</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">XS</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> BC"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="bound">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> BC"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> BC<span class="main">)</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="bound">xs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">∈</span><span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span>insert <span class="skolem">zs</span> <span class="skolem">F</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span>insert <span class="skolem">zs</span> <span class="skolem">F</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="bound">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">zs</span> <span class="main">≥</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="skolem">xs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> length <span class="skolem">zs</span> <span class="main">≥</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">zs</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="skolem">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-max_prop"><span class="command">lemma</span></span> max_prop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">XS</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> BC<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">XS</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">XS</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"MAX <span class="free">XS</span> <span class="main">∈</span> <span class="free">XS</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="free">XS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="bound">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">XS</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> MAX_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">XS</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"MAX <span class="free">XS</span> <span class="main">∈</span> <span class="free">XS</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="free">XS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">XS</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="free">XS</span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="bound">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-max_less"><span class="command">lemma</span></span> max_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> BC"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b'</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> BC"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> BC<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">&gt;</span> length <span class="free">b'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>MAX <span class="free">B</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="free">b'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">≤</span> length <span class="bound">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> MAX_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="bound">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span><span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">b</span> <span class="main">&gt;</span> length <span class="free">b'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Blockchain Architectures"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following we describe the locale for blockchain architectures.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Blockchain <span class="main">=</span> dynamic_component <span class="quoted"><span class="free">cmp</span></span> <span class="quoted"><span class="free">active</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">active</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'nid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥⇘</span>_<span class="keyword1">⇙</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">cmp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'nid</span> <span class="main">⇒</span> cnf <span class="main">⇒</span> <span class="tfree">'ND</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">σ⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>110<span class="main">]</span>60<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ND</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'nid</span> BC<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pout</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ND</span> <span class="main">⇒</span> <span class="tfree">'nid</span> BC"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ND</span> <span class="main">⇒</span> <span class="tfree">'nid</span> BC"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mining</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'ND</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">honest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'nid</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">actHn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cnf <span class="main">⇒</span> <span class="tfree">'nid</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">actDn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cnf <span class="main">⇒</span> <span class="tfree">'nid</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">PoW</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">hmining</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dmining</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">cb</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">actHn</span> <span class="free">k</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">nid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">honest</span> <span class="bound">nid</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">actDn</span> <span class="free">k</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">nid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">honest</span> <span class="bound">nid</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hmining</span> <span class="free">t</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dmining</span> <span class="free">t</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actDn</span> <span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> consensus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="bound">bc'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'nid</span> BC<span class="main">)</span><span class="main">.</span> <span class="main">⟦</span><span class="free">honest</span> <span class="bound">nid</span><span class="main">⟧</span> <span class="main">⟹</span> eval <span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
    <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="bound">bc'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="bound">nd</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>
      <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">nd</span><span class="main">.</span><span class="main">(</span><span class="main">¬</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> <span class="bound">bc'</span> <span class="main">∨</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> <span class="bound">bc'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> attacker<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="bound">bc'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="free">honest</span> <span class="bound">nid</span><span class="main">⟧</span> <span class="main">⟹</span> eval <span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span>
    <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">(</span><span class="main">[</span><span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="bound">bc'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pin</span> <span class="bound">nd</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span>
      <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">nd</span><span class="main">.</span><span class="main">(</span><span class="main">¬</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span> <span class="bound">bc'</span> <span class="main">∨</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> <span class="bound">bc'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> forward<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> eval <span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="free">pout</span> <span class="bound">nd</span> <span class="main">=</span> <span class="free">bc</span> <span class="bound">nd</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="comment1">― ‹At each time point a node will forward its blockchain to the network›</span>
    <span class="keyword2"><span class="keyword">and</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> eval <span class="bound">nid</span> <span class="bound">t</span> <span class="bound">t'</span> <span class="main">0</span> <span class="main">[</span><span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="free">bc</span> <span class="bound">nd</span><span class="main">=</span><span class="main">[]</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">nid</span><span class="main">.</span> <span class="main">⟦</span><span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">;</span> <span class="free">honest</span> <span class="bound">nid</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="free">pin</span> <span class="main">(</span><span class="free">cmp</span> <span class="bound">nid</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">nid'</span><span class="main">∈</span><span class="free">actHn</span> <span class="bound">k</span><span class="main">.</span> <span class="main">{</span><span class="free">pout</span> <span class="main">(</span><span class="free">cmp</span> <span class="bound">nid'</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> act<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> finite <span class="main">{</span><span class="bound">nid</span><span class="main">::</span><span class="tfree">'nid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> actHn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∃</span><span class="bound">nid</span><span class="main">.</span> <span class="free">honest</span> <span class="bound">nid</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">n'</span><span class="main">.</span> ccard <span class="bound">n</span> <span class="bound">n'</span> <span class="main">(</span><span class="free">dmining</span> <span class="free">t</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">cb</span> <span class="main">⟹</span> ccard <span class="bound">n</span> <span class="bound">n'</span> <span class="main">(</span><span class="free">hmining</span> <span class="free">t</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">cb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">nid</span> <span class="bound">b</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">⟦</span><span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">nid</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">⟦</span><span class="free">honest</span> <span class="bound">nid</span><span class="main">;</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">;</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="bound">t</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="bound">t</span> <span class="bound">n</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Blockchain-init_model"><span class="command">lemma</span></span> init_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="free">nid</span> <span class="free">t</span> <span class="free">n</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> init <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> baEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">⟨</span><span class="free">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-fwd_bc"><span class="command">lemma</span></span> fwd_bc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">nid</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> cnf"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'ND</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">pout</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms forward globEANow<span class="main">[</span><span class="operator">THEN</span> baEANow<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Blockchain-finite_input"><span class="command">lemma</span></span> finite_input<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">dep</span> <span class="free">nid'</span> <span class="main">≡</span> <span class="free">pout</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">pin</span> <span class="main">(</span><span class="free">cmp</span> <span class="free">nid</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> act <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">pin</span> <span class="main">(</span><span class="free">cmp</span> <span class="free">nid</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">dep</span> <span class="main">`</span> <span class="main">{</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span><span class="free">cmp</span> <span class="free">nid</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">dep</span> <span class="main">`</span> <span class="main">{</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> closed <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span><span class="free">cmp</span> <span class="free">nid</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">pout</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fwd_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">dep</span> <span class="skolem">nid'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> image_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_surj <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-nempty_input"><span class="command">lemma</span></span> nempty_input<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">pin</span> <span class="main">(</span><span class="free">cmp</span> <span class="free">nid</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="free">n</span>"</span></span><span class="main">]</span> act assms actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Blockchain-onlyone"><span class="command">lemma</span></span> onlyone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dynamic_component.nxtActI latestAct_prop<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> latestAct_prop<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_le_trans order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> latestActless<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> leI le_less_Suc_eq le_less_trans nxtActI order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Component Behavior"</span></span>

<span class="keyword1" id="Blockchain-bhv_hn_ex"><span class="command">lemma</span></span> bhv_hn_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'ND</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tid</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">tid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span>
    Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cond</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="bound">nd</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?check</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="main">¬</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="free">tid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span><span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> consensus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> globEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> baIA<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cond</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> impE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxtAct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> latestActNxtAct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.strict_implies_order<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> onlyone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nxtEA1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> baEANow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?check</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-bhv_hn_in"><span class="command">lemma</span></span> bhv_hn_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'ND</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tid</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">tid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cond</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="bound">nd</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?check</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="main">¬</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="free">tid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span><span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> consensus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> globEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> baIA<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cond</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> impE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxtAct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> latestActNxtAct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.strict_implies_order<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> onlyone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">tid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nxtEA1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> baEANow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?check</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-bhv_hn_context"><span class="command">lemma</span></span> bhv_hn_context<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">tid</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">(</span><span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> casmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> bhv_hn_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> casmp <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> max_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>
    closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> bhv_hn_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="free">tid</span> <span class="free">t</span> <span class="free">n</span> <span class="bound">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-bhv_dn"><span class="command">lemma</span></span> bhv_dn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'ND</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">uid</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="free">uid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
         <span class="main">∨</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cond</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="bound">nd</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?check</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="main">¬</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="bound">nd</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
    <span class="main">∨</span> <span class="free">mining</span> <span class="bound">nd</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="bound">nd</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">honest</span> <span class="free">uid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">uid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">□<span class="hidden">⇩</span><sub>b</sub></span><span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> attacker<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">uid</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">⇐</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">uid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span><span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> globEA<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">uid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword1">⟶<span class="hidden">⇧</span><sup>b</sup></span> <span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span><span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">uid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> baIA<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cond</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">uid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> impE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">uid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?cond</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">○<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxtAct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">&gt;</span><span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActNxt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> latestActNxtAct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.strict_implies_order<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> onlyone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">uid</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nxtEA1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">uid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?check</span><span class="keyword1">]<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtActI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> baEANow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">uid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?check</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-bhv_dn_context"><span class="command">lemma</span></span> bhv_dn_context<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="free">uid</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">(</span><span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∨</span> <span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bc_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?bc</span> <span class="main">∈</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span><span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> someI_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="var">?bc</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bhv_dn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">uid</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">uid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> casmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?bc</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> bc_ex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?bc</span> <span class="main">∈</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="var">?bc</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> casmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
      <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">∈</span> <span class="main">{</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">uid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="free">uid</span> <span class="free">t</span> <span class="free">n</span> <span class="bound">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">uid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">uid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> casmp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Maximal Honest Blockchains"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mbc_cond</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mbc_cond</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">nid'</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">nid</span></span></span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Blockchain-mbc_ex"><span class="command">lemma</span></span> mbc_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> mbc_cond <span class="free">t</span> <span class="free">n</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ALL</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MAX <span class="var">?ALL</span> <span class="main">∈</span> <span class="var">?ALL</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> max_prop<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> actHn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ALL</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?ALL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> MAX <span class="var">?ALL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nid'</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="var">?ALL</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nid</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?ALL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b'</span><span class="main">∈</span><span class="var">?ALL</span><span class="main">.</span> length <span class="bound">b'</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="var">?ALL</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> max_prop<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?ALL</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ALL</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?ALL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>Blockchain.MAX <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MBC</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">MBC</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> mbc_cond <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Blockchain-mbc_prop"><span class="command">lemma</span></span> mbc_prop<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mbc_cond <span class="free">t</span> <span class="free">n</span> <span class="main">(</span>MBC <span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> mbc_ex<span class="main">]</span> MBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Honest Proof of Work"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An important construction is the maximal proof of work available in the honest community.
  The construction was already introduces in the locale itself since it was used to express some of the locale assumptions.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pow_cond</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pow_cond</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span>"</span></span>

<span class="keyword1" id="Blockchain-pow_ex"><span class="command">lemma</span></span> pow_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pow_cond <span class="free">t</span> <span class="free">n</span> <span class="main">(</span>length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> pow_cond <span class="free">t</span> <span class="free">n</span> <span class="bound">x'</span> <span class="main">⟶</span> <span class="bound">x'</span><span class="main">≥</span>length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mbc_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Blockchain-pow_prop"><span class="command">lemma</span></span> pow_prop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pow_cond <span class="free">t</span> <span class="free">n</span> <span class="main">(</span><span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pow_ex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pow_cond <span class="free">t</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> pow_cond <span class="free">t</span> <span class="free">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LeastI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pow_cond <span class="free">t</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> PoW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Blockchain-pow_eq"><span class="command">lemma</span></span> pow_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">tid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">tid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">tid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> pow_cond <span class="free">t</span> <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> PoW_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-pow_mbc"><span class="command">lemma</span></span> pow_mbc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mbc_prop pow_eq<span class="main">)</span>

<span class="keyword1" id="Blockchain-pow_less"><span class="command">lemma</span></span> pow_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pow_cond <span class="free">t</span> <span class="free">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pow_ex assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> pow_cond <span class="free">t</span> <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Least_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pow_cond <span class="free">t</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> PoW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-pow_le_max"><span class="command">lemma</span></span> pow_le_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">tid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> mbc_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="main">(</span>MBC <span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>MBC <span class="free">t</span> <span class="free">n</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">pout</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> forward globEANow<span class="main">[</span><span class="operator">THEN</span> baEANow<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"MBC <span class="free">t</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nd</span><span class="main">.</span> <span class="free">pout</span> <span class="bound">nd</span> <span class="main">=</span> <span class="free">bc</span> <span class="bound">nd</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>MBC <span class="free">t</span> <span class="free">n</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="main">(</span>MBC <span class="free">t</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conn actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>MBC <span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> pow_mbc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-pow_ge_lgth"><span class="command">lemma</span></span> pow_ge_lgth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">tid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">tid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pow_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-pow_le_lgth"><span class="command">lemma</span></span> pow_le_lgth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">tid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms nempty_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> finite_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_prop<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_le_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-pow_mono"><span class="command">lemma</span></span> pow_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n'</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="skolem">n'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> actHn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tid</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="skolem">tid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> latestActless le_less_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span>Suc <span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span>Suc <span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">tid</span>›</span></span> bhv_hn_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tid</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">tid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>Blockchain.MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_le_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="skolem">n'</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">tid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_ge_lgth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">tid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">tid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="skolem">n'</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> latestActless le_less_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span>Suc <span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span>Suc <span class="skolem">n'</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n''</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">@</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">tid</span>›</span></span> bhv_hn_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tid</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">tid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>›</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pow_le_lgth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">tid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">tid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">tid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_ge_lgth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-pow_equals"><span class="command">lemma</span></span> pow_equals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">=</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">≥</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">≤</span><span class="free">n'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">=</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pow_mono assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> eq_iff<span class="main">)</span>

<span class="keyword1" id="Blockchain-pow_mining_suc"><span class="command">lemma</span></span> pow_mining_suc<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">hmining</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hmining_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="skolem">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mine <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bhv_hn_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> latestActEq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pow_ge_lgth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pow_le_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nid</span><span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="skolem">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mine <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bhv_hn_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> latestActEq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">∨</span>
    <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">n</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asmp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">PoW</span> <span class="free">t</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pow_le_lgth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pow_ge_lgth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"History"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following we introduce an operator which extracts the development of a blockchain up to a time point <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">his_prop</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span>∥<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>⟩<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">n'</span></span></span></sub><span class="hidden">⇙</span> <span class="main">∧</span>
  <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">nid'</span></span></span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">nid'</span></span></span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">nid'</span></span></span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> 
<span class="entity">his</span><span class="main">::</span> <span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'nid</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">t</span><span class="main">::</span><span class="quoted">trace</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">nid</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'nid</span></span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">nid</span><span class="main">)</span> <span class="main">∈</span> <span class="free">his</span> <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">nid'</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">his</span> <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">;</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">nid'</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">his</span> <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>

<span class="keyword1" id="Blockchain-his_act"><span class="command">lemma</span></span> his_act<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> his.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In addition we also introduce an operator to obtain the predecessor of a blockchains development.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">hisPred</span>"</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hisPred</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Blockchain-hisPrev_prop"><span class="command">lemma</span></span> hisPrev_prop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n'</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i'</span></span><span class="main">≤</span><span class="free">n'</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">i'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">i'</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n'a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'a</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n'a</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'a</span> <span class="main">≤</span> <span class="bound">i'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundedGreatest<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="free">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n'a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'a</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n'a</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'a</span> <span class="main">≤</span> <span class="skolem">i'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GreatestI_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">i'</span></span><span class="main">]</span> hisPred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-hisPrev_nex_less"><span class="command">lemma</span></span> hisPrev_nex_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">∧</span> fst <span class="bound">x</span><span class="main">&gt;</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">∧</span> fst <span class="bound">x</span><span class="main">&gt;</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="skolem"><span class="skolem">nid''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="skolem">nid''</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≤</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="skolem">nid''</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&lt;</span> <span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i'</span></span><span class="main">≤</span><span class="free">n'</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">i'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">i'</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n'a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'a</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n'a</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'a</span> <span class="main">≤</span> <span class="bound">i'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> boundedGreatest<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="free">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n'a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'a</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n'a</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'a</span> <span class="main">≤</span> <span class="skolem">i'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">i'</span></span><span class="main">]</span> hisPred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-his_le"><span class="command">lemma</span></span> his_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">x</span><span class="main">≤</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> his.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n'</span> <span class="skolem">nid'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"2.hyps"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="skolem">nid'</span> <span class="free">t</span> <span class="skolem">n'</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-his_determ_base"><span class="command">lemma</span></span> his_determ_base<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">⟹</span> <span class="free">nid'</span><span class="main">=</span><span class="free">nid</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> his.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'</span> <span class="skolem">nid'a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'a</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">nid'a</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="skolem">nid'a</span> <span class="free">t</span> <span class="skolem">n'</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="skolem">nid'a</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid'a</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid'</span><span class="main">)</span><span class="main">&lt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'a</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≤</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span> <span class="main">=</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-hisPrev_same"><span class="command">lemma</span></span> hisPrev_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n''</span><span class="main">,</span><span class="free">nid''</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">=</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">=</span><span class="free">n''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n'</span><span class="main">=</span><span class="free">n''</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&gt;</span><span class="free">n''</span> <span class="main">∨</span> <span class="free">n'</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n''</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n''</span><span class="main">&lt;</span>fst <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> hisPrev_nex_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n''</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="comment1">(*Symmetric*)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&gt;</span><span class="free">n''</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">n''</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n''</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">&lt;</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">&lt;</span>fst <span class="main">(</span><span class="free">n''</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> hisPrev_nex_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-his_determ_ext"><span class="command">lemma</span></span> his_determ_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≤</span><span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> my_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nid''</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> his_determ_base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span><span class="main">=</span><span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span><span class="main">=</span><span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_determ_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span> <span class="main">=</span> <span class="skolem">nid'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> his.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">=</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">=</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="skolem">n''</span><span class="main">≥</span><span class="free">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?x</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?x</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">nid''</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?x</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">&gt;</span> hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hisPrev_nex_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">=</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span><span class="main">=</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">=</span><span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nid''</span><span class="main">=</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> his.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> step.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n'nid'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nid''</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span> <span class="main">=</span> <span class="skolem">nid'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> his.cases<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> step.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> n'nid''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">=</span><span class="skolem">n''''</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> n'nid'' <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">nid''</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">&gt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n'''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'''</span><span class="main">&gt;</span><span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'''</span><span class="main">=</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> n'nid'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="comment1">(*Symmetric*)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> n'nid' <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''''</span><span class="main">&gt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''''</span><span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n''''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''''</span><span class="main">&gt;</span><span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''''</span><span class="main">=</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> n'nid' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">=</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n'''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> n'nid'' <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">nid''</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">&gt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n''''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> n'nid' <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''''</span> <span class="skolem">nid''''</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''''</span><span class="main">&gt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> hisPrev_same <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'''</span><span class="main">=</span><span class="skolem">nid''''</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> n'nid'' <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">nid''</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span> <span class="skolem">nid'''</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">&gt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'''</span><span class="main">,</span> <span class="skolem">nid'''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''''</span><span class="main">,</span> <span class="skolem">nid''''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'''</span><span class="main">=</span><span class="skolem">n''''</span>›</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n'nid' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span> <span class="main">=</span> <span class="skolem">nid'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> his.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">=</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">=</span><span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≥</span><span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="skolem">n''</span><span class="main">≥</span><span class="skolem">n'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?x</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&gt;</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?x</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">nid''</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?x</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">&gt;</span> hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hisPrev_nex_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="skolem">n''</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="skolem">n'</span><span class="main">≥</span><span class="skolem">n''</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">=</span><span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="main">=</span> hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span><span class="skolem">n''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hisPrev_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n''</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="skolem">nid''</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">=</span><span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">nid''</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid''</span><span class="main">=</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span> <span class="skolem">nid''</span> <span class="bound">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">=</span><span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">nid''</span><span class="main">=</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> his_determ_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms his_le his_determ_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">corollary</span></span> his_determ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid''</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nid'</span><span class="main">=</span><span class="free">nid''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms his_le his_determ_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">corollary</span></span> his_determ_the<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="free">nid'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms his_determ theI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> his_determ_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Blockchain Development"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">devBC</span><span class="main">::</span><span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span> option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">devBC</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> Option.None<span class="main">)</span>"</span></span>

<span class="keyword1" id="Blockchain-devBC_some"><span class="command">lemma</span></span> devBC_some<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">=</span> Some <span class="free">nid</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="free">nid</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">nid</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nid'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span> <span class="main">=</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_determ_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devBC_act"><span class="command">lemma</span></span> devBC_act<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">=</span>Option.None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_none_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">=</span> <span class="main">(</span>Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> devBC_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_determ_the <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">=</span> <span class="main">(</span>Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">nid'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> his_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-his_ex"><span class="command">lemma</span></span> his_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> devBC_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devExt_nopt_leq"><span class="command">lemma</span></span> devExt_nopt_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≤</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> his_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An extended version of the development in which deactivations are filled with the last value.
›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">devExt</span><span class="main">::</span><span class="quoted"><span class="quoted">"trace <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'nid</span> BC"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">.</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="bound">n'</span><span class="main">)</span><span class="main">;</span> Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">devExt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">.</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">devExt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">devExt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">+</span> Suc <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">devExt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">+</span> Suc <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">+</span> Suc <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">+</span> Suc <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">devExt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">devExt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span><span class="main">.</span>
       <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span>
                    <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span><span class="main">.</span>
       <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">.</span>
       <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'</span><span class="main">.</span>
       <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'</span><span class="main">.</span>
       <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="free">devExt_sumC</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span><span class="main">.</span>
       <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">.</span>
       <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'</span><span class="main">.</span>
       <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'</span><span class="main">.</span>
       <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">devExt_sumC</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">.</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'</span><span class="main">.</span>
        <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'</span><span class="main">.</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">devExt_sumC</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'a</span><span class="main">.</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'a</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'a</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">ta</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'a</span><span class="main">.</span>
       <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'a</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">t</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">devExt_sumC</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="bound">n'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span> <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="bound">n'a</span><span class="main">.</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       Option.is_none <span class="main">(</span>devBC <span class="bound">ta</span> <span class="bound">na</span> <span class="bound">nida</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span> <span class="main">+</span> Suc <span class="bound">n'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> Suc <span class="bound">n'a</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">devExt_sumC</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">devExt_sumC</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">na</span><span class="main">,</span> <span class="bound">nida</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub>'</span><span class="main">,</span> <span class="bound">n'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span><span class="main">.</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span><span class="main">::</span><span class="quoted">bool</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"trace <span class="main">×</span>nat<span class="main">×</span><span class="tfree">'nid</span><span class="main">×</span>nat<span class="main">×</span>nat"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'</span><span class="main">.</span> Option.is_none <span class="main">(</span>devBC <span class="bound">t</span> <span class="bound">n</span> <span class="bound">nid</span> <span class="main">(</span><span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">nid</span><span class="main">,</span> <span class="bound">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> Suc <span class="bound">n'</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">P</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">,</span> <span class="skolem">nid</span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">,</span> <span class="skolem">nid</span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">,</span> <span class="skolem">nid</span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">,</span> <span class="skolem">nid</span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">=</span>Suc <span class="skolem">n''</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="quoted"><span class="skolem">n''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="skolem">t</span> <span class="skolem">n</span> <span class="skolem">nid</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">,</span> <span class="skolem">nid</span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">=</span>Suc <span class="skolem">n''</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="quoted"><span class="skolem">n''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">lexicographic_order</span>

<span class="keyword1" id="Blockchain-devExt_same"><span class="command">lemma</span></span> devExt_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'''</span><span class="main">≤</span><span class="free">n''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'''</span><span class="main">≥</span><span class="free">n'</span><span class="main">⟹</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">n'''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n'''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dec_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n''''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n''''</span><span class="main">&gt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n''''</span><span class="main">≤</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span>Suc <span class="skolem">n''''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''''</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n''''</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="main">(</span><span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="main">(</span><span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''''</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">n''''</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> step.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devExt_bc"><span class="command">lemma</span></span> devExt_bc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n''</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devExt_greatest"><span class="command">lemma</span></span> devExt_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n''</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?P</span> <span class="bound">n'''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''''</span> <span class="main">⟶</span> <span class="bound">n''''</span><span class="main">≤</span><span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundedGreatest<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GreatestI_ex_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">-</span><span class="free">n'</span><span class="main">+</span><span class="free">n'</span> <span class="main">=</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="var">?G</span><span class="main">-</span><span class="free">n'</span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">-</span><span class="free">n'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nat</span><span class="main">.</span> Suc <span class="bound">nat</span> <span class="main">=</span> <span class="var">?G</span> <span class="main">-</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">nat</span> <span class="main">=</span> <span class="var">?G</span><span class="main">-</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span> <span class="main">+</span> Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="free">n'</span> <span class="main">+</span> Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">nat</span> <span class="main">=</span> <span class="var">?G</span> <span class="main">-</span> <span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="var">?G</span><span class="main">-</span><span class="free">n'</span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="var">?G</span><span class="main">-</span><span class="free">n'</span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">-</span><span class="free">n'</span><span class="main">+</span><span class="free">n'</span> <span class="main">=</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span><span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">-</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''''</span> <span class="main">⟶</span> <span class="bound">n''''</span><span class="main">≤</span><span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="var">?G</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="var">?G</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">≥</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>›</span></span> devExt_same<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">=</span><span class="free">n'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''''</span> <span class="main">⟶</span> <span class="bound">n''''</span><span class="main">≤</span><span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="var">?G</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">=</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">n''</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> devExt_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">=</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?G</span><span class="main">=</span><span class="free">n'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''''</span> <span class="main">⟶</span> <span class="bound">n''''</span><span class="main">≤</span><span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="var">?G</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="var">?G</span><span class="main">&gt;</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">n''</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> devExt_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">n''</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''''</span> <span class="main">⟶</span> <span class="bound">n''''</span><span class="main">≤</span><span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="var">?G</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">&lt;</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="var">?G</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">&lt;</span><span class="free">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n'</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">≥</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'''</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">n'''</span><span class="main">&lt;</span><span class="free">n'</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span><span class="main">≥</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">≥</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'''</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n'''</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?G</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span><span class="main">&lt;</span><span class="free">n'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="var">?G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''''</span> <span class="main">⟶</span> <span class="bound">n''''</span><span class="main">≤</span><span class="bound">n'''</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n'''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'''</span> <span class="main">⟶</span> <span class="bound">n'''</span><span class="main">≤</span><span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devExt_shift"><span class="command">lemma</span></span> devExt_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">n''</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">n''</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">&lt;</span><span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devExt_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">0</span><span class="main">=</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span><span class="main">=</span><span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n''</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span><span class="main">=</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span><span class="main">=</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="free">n'</span><span class="main">.</span> <span class="bound">n'''</span><span class="main">≤</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span> <span class="main">⟶</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">n''</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">&lt;</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> devExt_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">+</span><span class="free">n''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">n''</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n'</span><span class="main">+</span><span class="free">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devExt_bc_geq"><span class="command">lemma</span></span> devExt_bc_geq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?LHS</span> <span class="main">=</span> <span class="var">?RHS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devExt_shift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">n'</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-his_bc_empty"><span class="command">lemma</span></span> his_bc_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid''</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid''</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> his.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">nid'</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span><span class="main">&lt;</span><span class="free">n'</span> <span class="main">∧</span>
      <span class="main">(</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span>snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n'</span> <span class="free">nid'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main"><span class="free">∥</span></span>snd <span class="bound">x</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">∥</span></span>snd <span class="bound">x</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> init_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">∥</span></span>snd <span class="bound">x</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">∥</span></span>snd <span class="bound">x</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span>snd <span class="bound">x</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="free">nid'</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid''</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span>›</span></span> bhv_hn_context<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">nid'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid''</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asmp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="free">nid'</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid''</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> latestAct_cond <span class="free">nid'</span> <span class="free">t</span> <span class="free">n'</span> <span class="bound">n</span>›</span></span> bhv_dn_context<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">nid'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid''</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid''</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span><span class="free">nid'</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="free">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asmp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Blockchain-devExt_devop"><span class="command">lemma</span></span> devExt_devop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nid</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?nid</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">≤</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devExt_nopt_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
        his_determ_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">.</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span>Suc <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>›</span></span>
              <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n''</span><span class="main">=</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&lt;</span>Suc <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n'</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span>Suc <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n''</span><span class="main">=</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span><span class="main">&lt;</span>Suc <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">n'</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> devExt_greatest<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="quoted"><span class="free">n'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">nid</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">n''</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span><span class="main">≠</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="bound">n''</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> hisPred_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> his_determ_the <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n'</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nat</span><span class="main">.</span> <span class="free">n'</span> <span class="main">=</span> Suc <span class="bound">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">=</span> Suc <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n'</span> <span class="main">=</span> Suc <span class="skolem">nat</span>›</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="bound">n''</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span><span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hisPred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hisPrev_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> his_determ_the <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="var">?x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="var">?x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fst_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span><span class="main">]</span>
        snd_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span>hisPred <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?nid</span> <span class="bound">x</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?nid</span> <span class="var">?x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> his_prop <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span> <span class="var">?nid</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="var">?nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="var">?x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="var">?x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="var">?nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>snd <span class="var">?x</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span>fst <span class="var">?x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="var">?nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="var">?nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="var">?nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="var">?nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nid</span><span class="main">=</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> his_determ_the <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?nid</span><span class="main">=</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">nid'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> his_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">+</span>Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n''</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span> the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> his_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> devBC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="bound">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> his_determ_the <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">nid'</span><span class="main">.</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span> <span class="bound">nid'</span><span class="main">)</span> <span class="main">∈</span> his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">nid'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">,</span><span class="skolem">nid'</span><span class="main">)</span><span class="main">∈</span>his <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="free">n</span> <span class="free">nid</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> his_bc_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">devLgthBC</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">devLgthBC</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n'</span><span class="main">.</span> length <span class="main">(</span>devExt <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nid</span></span></span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>s</sub></span></span></span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> blockchain_save<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>cnf"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sbc</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nid</span><span class="main">.</span> <span class="free">honest</span> <span class="bound">nid</span> <span class="main">⟶</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nid</span><span class="main">∈</span><span class="free">actDn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≥</span>length <span class="free">sbc</span> <span class="main">+</span> <span class="free">cb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">∀</span><span class="bound">nid</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="bound">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span> <span class="main">⟶</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span> <span class="main">∨</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sbc</span><span class="main">=</span><span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sbc</span><span class="main">=</span><span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">nid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="bound">nid</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ge_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nid</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="skolem">nid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> lAct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span>    
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
            <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> bhv_hn_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> nempty_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> finite_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nid'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> closed<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="skolem">nid'</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid'</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">≥</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="skolem">nid'</span>"</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>  <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>  <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?P</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''</span> <span class="main">⟶</span> <span class="bound">n''</span><span class="main">≤</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundedGreatest<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dishonest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>›</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>›</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span><span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
                  <span class="keyword1"><span class="command">interpret</span></span> ut<span class="main">:</span> dishonest <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span>
                    <span class="keyword1"><span class="command">from</span></span> devExt_devop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dishonest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span><span class="free">actDn</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actDn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dmining_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">0</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> devExt_bc_geq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> devExt_bc_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> prefix <span class="free">sbc</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'''</span><span class="main">.</span> <span class="bound">n'''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span> <span class="main">∧</span> length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="bound">n'''</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
                    ut.prefix_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">sbc</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devExt_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>›</span></span> dishonest <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> cas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">.</span> <span class="bound">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">sbc</span><span class="main">=</span><span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> cas <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main">¬</span>Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">GREATEST</span> <span class="bound">n'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span>"</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> <span class="var">?P</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n''</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n''</span><span class="main">⟶</span> <span class="bound">n''</span><span class="main">≤</span><span class="bound">n'</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> boundedGreatest<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GreatestI_ex_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="var">?n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devBC_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="var">?n'</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span> <span class="main">∨</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="var">?n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">proof</span></span>
                        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="var">?n'</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> exists <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span><span class="var">?n'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_ex_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>›</span></span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="var">?n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> cas <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword1"><span class="command">interpret</span></span> ut<span class="main">:</span> dishonest <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">proof</span></span>
                          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span>
                          <span class="keyword1"><span class="command">from</span></span> devExt_devop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
                          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">proof</span></span>
                            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span><span class="main">)</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command">next</span></span>
                            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span>"</span></span>
                              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
                              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span>
                              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>›</span></span>
                              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> cas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span>
                              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span><span class="free">actDn</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actDn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dmining_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">qed</span></span>
                        <span class="keyword1"><span class="command">qed</span></span>
  
                        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="var">?n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> exists <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&gt;</span><span class="var">?n'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Greatest_ex_le_nat<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="var">?n'</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="var">?n'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devExt_bc_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> prefix <span class="free">sbc</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'''</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">n'''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n'''</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ut.prefix_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">sbc</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> devExt_shift <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">+</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">.</span> <span class="bound">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> asmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asmp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> devBC_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">∈</span><span class="free">actDn</span> <span class="main">(</span><span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> actDn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asmp <span class="keyword1"><span class="command">have</span></span>
                      <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> cas <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> dishonest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">&gt;</span><span class="skolem">n'</span><span class="main">.</span> <span class="bound">n''</span><span class="main">≤</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">interpret</span></span> ut<span class="main">:</span> dishonest <span class="quoted"><span class="quoted">"devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span>
                  <span class="keyword1"><span class="command">from</span></span> devExt_devop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span> <span class="main">∨</span>
                    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span>
                    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span>"</span></span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span>Suc <span class="skolem">n''</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Option.is_none <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>›</span></span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">honest</span> <span class="main">(</span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dishonest <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span></sub><span class="hidden">⇙</span>›</span></span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span><span class="free">actDn</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> actDn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dmining_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">interpret</span></span> dishonest_growth <span class="quoted"><span class="quoted">"devLgthBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
                <span class="keyword1"><span class="command">interpret</span></span> honest_growth <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> pow_mining_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">interpret</span></span> bg<span class="main">:</span> bounded_growth <span class="quoted"><span class="quoted">"length <span class="free">sbc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"devLgthBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">hmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">sbc</span>"</span></span> <span class="quoted"><span class="free">cb</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span><span class="main">≥</span><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">sbc</span> <span class="main">+</span> <span class="free">cb</span> <span class="main">≤</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">sbc</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n''</span> <span class="skolem">n'''</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">cb</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n''</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">dmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">cb</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n''</span> <span class="main">+</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">+</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">dmining</span> <span class="free">t</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> cardshift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">n'''</span></span> <span class="quoted"><span class="quoted">"<span class="free">dmining</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> fair<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">+</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'''</span> <span class="main">+</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">cb</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n''</span> <span class="main">+</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">+</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">hmining</span> <span class="free">t</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">cb</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n''</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n'''</span> <span class="main">∧</span> <span class="free">hmining</span> <span class="free">t</span> <span class="main">(</span><span class="skolem">n'</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> cardshift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n''</span></span> <span class="quoted"><span class="skolem">n'''</span></span> <span class="quoted"><span class="quoted">"<span class="free">hmining</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> bg.hn_upper_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">≥</span><span class="skolem">n'</span>›</span></span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub>the <span class="main">(</span>devBC <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> devExt <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="skolem">nid'</span> <span class="skolem">n'</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">-</span><span class="skolem">n'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> devExt_bc_geq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">nid'</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">PoW</span> <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid'</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">PoW</span> <span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">≤</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>›</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">≤</span> length <span class="main">(</span>MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_le_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> MAX <span class="main">(</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>›</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid'</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">pin</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">.</span> length <span class="bound">b</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span>
            <span class="free">mining</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> bhv_hn_in<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">sbc</span> <span class="main">(</span><span class="free">bc</span> <span class="main">(</span>σ<span class="hidden">⇘</span><sub><span class="skolem">nid</span></sub><span class="hidden">⇙</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lAct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span> <span class="main">≥</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> latestActless <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> latestAct_cond <span class="skolem">nid</span> <span class="free">t</span> <span class="skolem">n</span> <span class="bound">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span></sub><span class="hidden">⇙</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> latestAct_prop<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nid</span> <span class="main">∈</span> <span class="free">actHn</span> <span class="main">(</span><span class="free">t</span> <span class="main">⟨</span><span class="skolem">nid</span> <span class="main">←</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> actHn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="skolem">n</span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nxtAct_active <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> nAct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">∧</span> <span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="bound">n'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">nid</span> <span class="main">→</span> <span class="free">t</span>⟩<span class="hidden">⇘</span><sub><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">∥</span></span><span class="skolem">nid</span>∥<span class="hidden">⇘</span><sub><span class="free">t</span> <span class="skolem">n</span></sub><span class="hidden">⇙</span>›</span></span> nxtAct_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">nid</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">honest</span> <span class="skolem">nid</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>